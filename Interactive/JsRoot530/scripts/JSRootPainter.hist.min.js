(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.js","JSRootPainter.hist.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.hist.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.hist.js")}a(JSROOT,d3)}}}(function(b,c){b.sources.push("hist");b.ToolbarIcons.th2color={recs:[{x:0,y:256,w:13,h:39,f:"rgb(38,62,168)"},{x:13,y:371,w:39,h:39},{y:294,h:39},{y:256,h:39},{y:218,h:39},{x:51,y:410,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:90,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294},{y:256,h:39,f:"rgb(16,100,220)"},{y:218,h:39},{y:179,h:39,f:"rgb(22,82,205)"},{y:141,h:39},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:0,h:27},{x:128,y:448,w:39,h:39},{y:410},{y:371,h:39},{y:333,h:39,f:"rgb(22,82,205)"},{y:294,f:"rgb(20,129,214)"},{y:256,h:39,f:"rgb(9,157,204)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(20,129,214)"},{y:141,h:39,f:"rgb(16,100,220)"},{y:102,h:39,f:"rgb(22,82,205)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{y:0,h:27},{x:166,y:486,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(82,186,146)"},{y:256,h:39,f:"rgb(179,189,101)"},{y:218,h:39,f:"rgb(116,189,129)"},{y:179,h:39,f:"rgb(82,186,146)"},{y:141,h:39,f:"rgb(14,143,209)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:205,y:486,w:39,h:14},{y:448,h:39},{y:410},{y:371,h:39,f:"rgb(16,100,220)"},{y:333,h:39,f:"rgb(9,157,204)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(244,198,59)"},{y:218,h:39},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(13,167,195)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(22,82,205)"},{y:26,h:39,f:"rgb(38,62,168)"},{x:243,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(30,175,179)"},{y:294,f:"rgb(209,187,89)"},{y:256,h:39,f:"rgb(251,230,29)"},{y:218,h:39,f:"rgb(249,249,15)"},{y:179,h:39,f:"rgb(226,192,75)"},{y:141,h:39,f:"rgb(30,175,179)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:282,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(18,114,217)"},{y:333,h:39,f:"rgb(14,143,209)"},{y:294,f:"rgb(149,190,113)"},{y:256,h:39,f:"rgb(226,192,75)"},{y:218,h:39,f:"rgb(244,198,59)"},{y:179,h:39,f:"rgb(149,190,113)"},{y:141,h:39,f:"rgb(9,157,204)"},{y:102,h:39,f:"rgb(18,114,217)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:320,y:448,w:39,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39,f:"rgb(20,129,214)"},{y:294,f:"rgb(46,183,164)"},{y:256,h:39},{y:218,h:39,f:"rgb(82,186,146)"},{y:179,h:39,f:"rgb(9,157,204)"},{y:141,h:39,f:"rgb(20,129,214)"},{y:102,h:39,f:"rgb(16,100,220)"},{y:64,f:"rgb(38,62,168)"},{y:26,h:39},{x:358,y:448,h:39},{y:410},{y:371,h:39,f:"rgb(22,82,205)"},{y:333,h:39},{y:294,f:"rgb(16,100,220)"},{y:256,h:39,f:"rgb(20,129,214)"},{y:218,h:39,f:"rgb(14,143,209)"},{y:179,h:39,f:"rgb(18,114,217)"},{y:141,h:39,f:"rgb(22,82,205)"},{y:102,h:39,f:"rgb(38,62,168)"},{y:64},{y:26,h:39},{x:397,y:448,w:39,h:39},{y:371,h:39},{y:333,h:39},{y:294,f:"rgb(22,82,205)"},{y:256,h:39},{y:218,h:39},{y:179,h:39,f:"rgb(38,62,168)"},{y:141,h:39},{y:102,h:39},{y:64},{y:26,h:39},{x:435,y:410,h:39},{y:371,h:39},{y:333,h:39},{y:294},{y:256,h:39},{y:218,h:39},{y:179,h:39},{y:141,h:39},{y:102,h:39},{y:64},{x:474,y:256,h:39},{y:179,h:39}]};b.ToolbarIcons.th2colorz={recs:[{x:128,y:486,w:256,h:26,f:"rgb(38,62,168)"},{y:461,f:"rgb(22,82,205)"},{y:435,f:"rgb(16,100,220)"},{y:410,f:"rgb(18,114,217)"},{y:384,f:"rgb(20,129,214)"},{y:358,f:"rgb(14,143,209)"},{y:333,f:"rgb(9,157,204)"},{y:307,f:"rgb(13,167,195)"},{y:282,f:"rgb(30,175,179)"},{y:256,f:"rgb(46,183,164)"},{y:230,f:"rgb(82,186,146)"},{y:205,f:"rgb(116,189,129)"},{y:179,f:"rgb(149,190,113)"},{y:154,f:"rgb(179,189,101)"},{y:128,f:"rgb(209,187,89)"},{y:102,f:"rgb(226,192,75)"},{y:77,f:"rgb(244,198,59)"},{y:51,f:"rgb(253,210,43)"},{y:26,f:"rgb(251,230,29)"},{y:0,f:"rgb(249,249,15)"}]};b.ToolbarIcons.th2draw3d={path:"M172.768,0H51.726C23.202,0,0.002,23.194,0.002,51.712v89.918c0,28.512,23.2,51.718,51.724,51.718h121.042   c28.518,0,51.724-23.2,51.724-51.718V51.712C224.486,23.194,201.286,0,172.768,0z M177.512,141.63c0,2.611-2.124,4.745-4.75,4.745   H51.726c-2.626,0-4.751-2.134-4.751-4.745V51.712c0-2.614,2.125-4.739,4.751-4.739h121.042c2.62,0,4.75,2.125,4.75,4.739 L177.512,141.63L177.512,141.63z M460.293,0H339.237c-28.521,0-51.721,23.194-51.721,51.712v89.918c0,28.512,23.2,51.718,51.721,51.718h121.045   c28.521,0,51.721-23.2,51.721-51.718V51.712C512.002,23.194,488.802,0,460.293,0z M465.03,141.63c0,2.611-2.122,4.745-4.748,4.745   H339.237c-2.614,0-4.747-2.128-4.747-4.745V51.712c0-2.614,2.133-4.739,4.747-4.739h121.045c2.626,0,4.748,2.125,4.748,4.739 V141.63z M172.768,256.149H51.726c-28.524,0-51.724,23.205-51.724,51.726v89.915c0,28.504,23.2,51.715,51.724,51.715h121.042   c28.518,0,51.724-23.199,51.724-51.715v-89.915C224.486,279.354,201.286,256.149,172.768,256.149z M177.512,397.784   c0,2.615-2.124,4.736-4.75,4.736H51.726c-2.626-0.006-4.751-2.121-4.751-4.736v-89.909c0-2.626,2.125-4.753,4.751-4.753h121.042 c2.62,0,4.75,2.116,4.75,4.753L177.512,397.784L177.512,397.784z M460.293,256.149H339.237c-28.521,0-51.721,23.199-51.721,51.726v89.915c0,28.504,23.2,51.715,51.721,51.715h121.045   c28.521,0,51.721-23.199,51.721-51.715v-89.915C512.002,279.354,488.802,256.149,460.293,256.149z M465.03,397.784   c0,2.615-2.122,4.736-4.748,4.736H339.237c-2.614,0-4.747-2.121-4.747-4.736v-89.909c0-2.626,2.121-4.753,4.747-4.753h121.045 c2.615,0,4.748,2.116,4.748,4.753V397.784z"};b.Painter.CreateDefaultPalette=function(){function s(y,x,B){var i,z,A;if(B<1e-100){i=z=A=x}else{function w(E,D,C){if(C<0){C+=1}if(C>1){C-=1}if(C<1/6){return E+(D-E)*6*C}if(C<1/2){return D}if(C<2/3){return E+(D-E)*(2/3-C)*6}return E}var u=(x<0.5)?x*(1+B):x+B-x*B,v=2*x-u;i=w(v,u,y+1/3);z=w(v,u,y);A=w(v,u,y-1/3)}return"rgb("+Math.round(i*255)+","+Math.round(z*255)+","+Math.round(A*255)+")"}var k=[],o=1,t=0.5,l=280,j=0,r=50;for(var m=0;m<r;++m){var p=(l-(m+1)*((l-j)/r))/360,q=s(p,t,o);k.push(q)}return new b.ColorPalette(k)};b.Painter.CreateGrayPalette=function(){var j=[];for(var k=0;k<50;++k){var l=Math.round((k+2)/60*255);j.push("rgb("+l+","+l+","+l+")")}return new b.ColorPalette(j)};b.Painter.CreateGradientColorTable=function(t,p,i,j,r,o){var m=[];for(var q=1;q<t.length;q++){var l=parseInt(Math.floor(r*t[q])-Math.floor(r*t[q-1]));for(var s=0;s<l;s++){var k=Math.round(p[q-1]+s*(p[q]-p[q-1])/l)+","+Math.round(i[q-1]+s*(i[q]-i[q-1])/l)+","+Math.round(j[q-1]+s*(j[q]-j[q-1])/l);m.push("rgb("+k+")")}}return new b.ColorPalette(m)};b.Painter.GetColorPalette=function(j,o){j=j||b.gStyle.Palette;if((j>0)&&(j<10)){return b.Painter.CreateGrayPalette()}if(j<51){return b.Painter.CreateDefaultPalette()}if(j>112){j=57}var m,l,i,k=[0,0.125,0.25,0.375,0.5,0.625,0.75,0.875,1];switch(j){case 51:m=[0,9,13,17,24,32,27,25,29];l=[0,0,0,2,37,74,113,160,221];i=[28,42,59,78,98,129,154,184,221];break;case 52:m=[0,32,64,96,128,160,192,224,255];l=[0,32,64,96,128,160,192,224,255];i=[0,32,64,96,128,160,192,224,255];break;case 53:m=[0,45,99,156,212,230,237,234,242];l=[0,0,0,45,101,168,238,238,243];i=[0,1,1,3,9,8,11,95,230];break;case 54:m=[0,22,44,68,93,124,160,192,237];l=[0,16,41,67,93,125,162,194,241];i=[97,100,99,99,93,68,44,26,74];break;case 55:m=[0,5,15,35,102,196,208,199,110];l=[0,48,124,192,206,226,97,16,0];i=[99,142,198,201,90,22,13,8,2];break;case 56:m=[242,234,237,230,212,156,99,45,0];l=[243,238,238,168,101,45,0,0,0];i=[230,95,11,8,9,3,1,1,0];break;case 57:m=[0.2082*255,0.0592*255,0.078*255,0.0232*255,0.1802*255,0.5301*255,0.8186*255,0.9956*255,0.9764*255];l=[0.1664*255,0.3599*255,0.5041*255,0.6419*255,0.7178*255,0.7492*255,0.7328*255,0.7862*255,0.9832*255];i=[0.5293*255,0.8684*255,0.8385*255,0.7914*255,0.6425*255,0.4662*255,0.3499*255,0.1968*255,0.0539*255];break;case 58:m=[0,0.0956*255,0.0098*255,0.2124*255,0.6905*255,0.9242*255,0.7914*255,0.7596*255,1*255];l=[0,0.1147*255,0.3616*255,0.5041*255,0.4577*255,0.4691*255,0.6905*255,0.9237*255,1*255];i=[0,0.2669*255,0.3121*255,0.1318*255,0.2236*255,0.6741*255,0.9882*255,0.9593*255,1*255];break;case 59:m=[13,23,25,63,76,104,137,161,206];l=[95,67,37,21,0,12,35,52,79];i=[4,3,2,6,11,22,49,98,208];break;case 60:m=[0,61,89,122,143,160,185,204,231];l=[0,0,0,0,14,37,72,132,235];i=[0,140,224,144,4,5,6,9,13];break;case 61:m=[14,7,2,0,5,11,55,131,229];l=[105,56,26,1,42,74,131,171,229];i=[2,21,35,60,92,113,160,185,229];break;case 62:m=[0,0,0,70,148,231,235,237,244];l=[0,0,0,0,0,69,67,216,244];i=[0,102,228,231,177,124,137,20,244];break;case 63:m=[50,56,63,68,93,121,165,192,241];l=[66,81,91,96,111,128,155,189,241];i=[97,91,75,65,77,103,143,167,217];break;case 64:m=[145,166,167,156,131,114,101,112,132];l=[158,178,179,181,163,154,144,152,159];i=[190,199,201,192,176,169,160,166,190];break;case 65:m=[93,91,99,108,130,125,132,155,174];l=[126,124,128,129,131,121,119,153,173];i=[103,94,87,85,80,85,107,120,146];break;case 66:m=[24,40,69,90,104,114,120,132,103];l=[29,52,94,127,150,162,159,151,101];i=[29,52,96,132,162,181,184,186,131];break;case 67:m=[46,38,61,92,113,121,132,150,191];l=[46,36,40,69,110,135,131,92,34];i=[46,80,74,70,81,105,165,211,225];break;case 68:m=[0,4,12,30,52,101,142,190,237];l=[0,40,86,121,140,172,187,213,240];i=[0,9,14,18,21,23,27,35,101];break;case 69:m=[198,206,206,211,198,181,161,171,244];l=[103,133,150,172,178,174,163,175,244];i=[49,54,55,66,91,130,184,224,244];break;case 70:m=[243,243,240,240,241,239,186,151,129];l=[0,46,99,149,194,220,183,166,147];i=[6,8,36,91,169,235,246,240,233];break;case 71:m=[22,19,19,25,35,53,88,139,210];l=[0,32,69,108,135,159,183,198,215];i=[77,96,110,116,110,100,90,78,70];break;case 72:m=[68,116,165,182,189,180,145,111,71];l=[37,82,135,178,204,225,221,202,147];i=[16,55,105,147,196,226,232,224,178];break;case 73:m=[61,99,136,181,213,225,198,136,24];l=[149,140,96,83,132,178,190,135,22];i=[214,203,168,135,110,100,111,113,22];break;case 74:m=[76,120,156,183,197,180,162,154,140];l=[34,35,42,69,102,137,164,188,197];i=[64,69,78,105,142,177,205,217,198];break;case 75:m=[37,102,157,188,196,214,223,235,251];l=[37,29,25,37,67,91,132,185,251];i=[37,32,33,45,66,98,137,187,251];break;case 76:m=[79,100,119,137,153,172,192,205,250];l=[63,79,93,103,115,135,167,196,250];i=[51,59,66,61,62,70,110,160,250];break;case 77:m=[43,44,50,66,125,172,178,155,157];l=[63,63,85,101,138,163,122,51,39];i=[121,101,58,44,47,55,57,44,43];break;case 78:m=[0,41,62,79,90,87,99,140,228];l=[0,57,81,93,85,70,71,125,228];i=[95,91,91,82,60,43,44,112,228];break;case 79:m=[49,59,72,88,114,141,176,205,222];l=[78,72,66,57,59,75,106,142,173];i=[78,55,46,40,39,39,40,41,47];break;case 80:m=[243,222,201,185,165,158,166,187,219];l=[94,108,132,135,125,96,68,51,61];i=[7,9,12,19,45,89,118,146,118];break;case 81:m=[19,44,74,105,137,166,194,206,220];l=[19,28,40,55,82,110,159,181,220];i=[19,42,68,96,129,157,188,203,220];break;case 82:m=[33,44,70,99,140,165,199,211,216];l=[38,50,76,105,140,165,191,189,167];i=[55,67,97,124,140,166,163,129,52];break;case 83:m=[0,33,73,124,136,152,159,171,223];l=[0,43,92,124,134,126,121,144,223];i=[0,43,68,76,73,64,72,114,223];break;case 84:m=[5,18,45,124,193,223,205,128,49];l=[48,134,207,230,193,113,28,0,7];i=[6,15,41,121,193,226,208,130,49];break;case 85:m=[180,106,104,135,164,188,189,165,144];l=[72,126,154,184,198,207,205,190,179];i=[41,120,158,188,194,181,145,100,62];break;case 86:m=[57,72,94,117,136,154,174,192,215];l=[0,33,68,109,140,171,192,196,209];i=[116,137,173,201,200,201,203,190,187];break;case 87:m=[31,71,123,160,210,222,214,199,183];l=[40,117,171,211,231,220,190,132,65];i=[234,214,228,222,210,160,105,60,34];break;case 88:m=[123,108,109,126,154,172,188,196,218];l=[184,138,130,133,154,175,188,196,218];i=[208,130,109,99,110,122,150,171,218];break;case 89:m=[105,106,122,143,159,172,176,181,207];l=[252,197,194,187,174,162,153,136,125];i=[146,133,144,155,163,167,166,162,174];break;case 90:m=[171,141,145,152,154,159,163,158,177];l=[236,143,100,63,53,55,44,31,6];i=[59,48,46,44,42,54,82,112,179];break;case 91:m=[180,190,209,223,204,228,205,152,91];l=[93,125,147,172,181,224,233,198,158];i=[236,218,160,133,114,132,162,220,218];break;case 92:m=[225,183,162,135,115,111,119,145,211];l=[205,177,166,135,124,117,117,132,172];i=[186,165,155,135,126,130,150,178,226];break;case 93:m=[39,43,59,63,80,116,153,177,223];l=[39,43,59,74,91,114,139,165,223];i=[39,50,59,70,85,115,151,176,223];break;case 94:m=[0,38,60,76,84,89,101,128,204];l=[0,10,15,23,35,57,83,123,199];i=[0,11,22,40,63,86,97,94,85];break;case 95:m=[94,112,141,165,167,140,91,49,27];l=[27,46,88,135,166,161,135,97,58];i=[42,52,81,106,139,158,155,137,116];break;case 96:m=[30,49,79,117,135,151,146,138,147];l=[63,60,72,90,94,94,68,46,16];i=[18,28,41,56,62,63,50,36,21];break;case 97:m=[0,30,63,101,143,152,169,187,230];l=[0,14,28,42,58,61,67,74,91];i=[39,26,21,18,15,14,14,13,13];break;case 98:m=[149,140,164,179,182,181,131,87,61];l=[62,70,107,136,144,138,117,87,74];i=[40,38,45,49,49,49,38,32,34];break;case 99:m=[99,112,148,165,179,182,183,183,208];l=[39,40,57,79,104,127,148,161,198];i=[15,16,18,33,51,79,103,129,177];break;case 100:m=[99,116,154,174,200,196,201,201,230];l=[0,0,8,32,58,83,119,136,173];i=[5,6,7,9,9,14,17,19,24];break;case 101:m=[82,106,126,141,155,163,142,107,66];l=[62,44,69,107,135,152,149,132,119];i=[39,25,31,60,73,68,49,72,188];break;case 102:m=[18,29,44,72,116,158,184,208,221];l=[27,46,71,105,146,177,189,190,183];i=[39,55,80,108,130,133,124,100,76];break;case 103:m=[0,48,119,173,212,224,228,228,245];l=[0,13,30,47,79,127,167,205,245];i=[0,68,75,43,16,22,55,128,245];break;case 104:m=[34,70,129,187,225,226,216,193,179];l=[48,91,147,194,226,229,196,110,12];i=[234,212,216,224,206,110,53,40,29];break;case 105:m=[30,55,103,147,174,203,188,151,105];l=[0,65,138,182,187,175,121,53,9];i=[191,202,212,208,171,140,97,57,30];break;case 106:m=[112,97,113,125,138,159,178,188,225];l=[16,17,24,37,56,81,110,136,189];i=[38,35,46,59,78,103,130,152,201];break;case 107:m=[18,72,5,23,29,201,200,98,29];l=[0,0,43,167,211,117,0,0,0];i=[51,203,177,26,10,9,8,3,0];break;case 108:m=[19,42,64,88,118,147,175,187,205];l=[19,55,89,125,154,169,161,129,70];i=[19,32,47,70,100,128,145,130,75];break;case 109:m=[33,31,42,68,86,111,141,172,227];l=[255,175,145,106,88,55,15,0,0];i=[255,205,202,203,208,205,203,206,231];break;case 110:m=[0,25,50,79,110,145,181,201,254];l=[0,16,30,46,63,82,101,124,179];i=[0,12,21,29,39,49,61,74,103];break;case 111:m=[0,13,30,44,72,120,156,200,247];l=[0,36,84,117,141,153,151,158,247];i=[0,94,100,82,56,66,76,131,247];break;case 112:m=[26,51,43,33,28,35,74,144,246];l=[9,24,55,87,118,150,180,200,222];i=[30,96,112,114,112,101,72,35,0];break;default:return b.Painter.CreateDefaultPalette()}return b.Painter.CreateGradientColorTable(k,m,l,i,255,o)};b.Painter.drawPaletteAxis=function(l,j,k){j.fBorderSize=1;j.fShadowColor=0;var i=new b.TPavePainter(j);i.SetDivId(l);i.z_handle=new b.TAxisPainter(j.fAxis,true);i.z_handle.SetDivId(l,-1);i.Cleanup=function(){if(this.z_handle){this.z_handle.Cleanup();delete this.z_handle}b.TObjectPainter.prototype.Cleanup.call(this)};i.PaveDrawFunc=function(w,v,D){var B=this,V=this.GetObject(),C=V.fAxis,q=(typeof D=="string")&&(D.indexOf("canmove")>0),A=(typeof D=="string")&&(D.indexOf("postpone")>0),s=C.fNdiv%100,y=parseInt(this.draw_g.attr("x")),x=parseInt(this.draw_g.attr("y")),m=this.pad_width(),p=this.pad_height(),Y=C.fLabelOffset*m,t=this.main_painter(),E=this.frame_painter(),o=0,F=100,U=t.fContour;if(s<=0){s=8}C.fTickSize=0.6*w/m;if(U){o=Math.min(U[0],t.zmin);F=Math.max(U[U.length-1],t.zmax)}else{if((t.gmaxbin!==undefined)&&(t.gminbin!==undefined)){o=t.gminbin;F=t.gmaxbin}else{if((t.hmin!==undefined)&&(t.hmax!==undefined)){o=t.hmin;F=t.hmax}}}var N=null,R="normal";if(this.root_pad().fLogz){N=c.scaleLog();R="log"}else{N=c.scaleLinear()}N.domain([o,F]).range([v,0]);this.draw_g.selectAll("rect").style("fill","white");if(!U||A){this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",w).attr("height",v).style("fill","white")}else{for(var W=0;W<U.length-1;++W){var L=N(U[W]),K=N(U[W+1]),u=t.getContourColor((U[W]+U[W+1])/2);var S=this.draw_g.append("svg:rect").attr("x",0).attr("y",Math.round(K)).attr("width",w).attr("height",Math.round(L)-Math.round(K)).style("fill",u).style("stroke",u).property("fill0",u).property("fill1",c.rgb(u).darker(0.5).toString());if(E&&E.tooltip_allowed){S.on("mouseover",function(){c.select(this).transition().duration(100).style("fill",c.select(this).property("fill1"))}).on("mouseout",function(){c.select(this).transition().duration(100).style("fill",c.select(this).property("fill0"))}).append("svg:title").text(U[W].toFixed(2)+" - "+U[W+1].toFixed(2))}if(b.gStyle.Zooming){S.on("dblclick",function(){B.main_painter().Unzoom("z")})}}}this.z_handle.SetAxisConfig("zaxis",R,N,o,F,o,F);this.z_handle.max_tick_size=Math.round(w*0.7);this.z_handle.DrawAxis(true,this.draw_g,w,v,"translate("+w+", 0)");if(q&&("getBoundingClientRect" in this.draw_g.node())){var J=this.draw_g.node().getBoundingClientRect();var H=(y+parseInt(J.width))-Math.round(0.995*m)+3;if(H>0){this.draw_g.attr("x",y-H).attr("y",x).attr("transform","translate("+(y-H)+", "+x+")");V.fX1NDC-=H/m;V.fX2NDC-=H/m}}if(!b.gStyle.Zooming){return}var M=null,I=false,P=0,O=0,Q=null;function X(){if(!I){return}c.event.preventDefault();var r=c.mouse(M);if(r[1]<P){P=r[1]}else{O=r[1]}Q.attr("y",P).attr("height",Math.abs(O-P))}function T(){if(!I){return}c.event.preventDefault();c.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null);Q.remove();Q=null;I=false;var r=Math.min(N.invert(P),N.invert(O)),z=Math.max(N.invert(P),N.invert(O));B.main_painter().Zoom("z",r,z)}function G(){if(I){return}I=true;c.event.preventDefault();M=this;var r=c.mouse(M);P=O=r[1];Q=B.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",w).attr("y",P).attr("height",5);c.select(window).on("mousemove.colzoomRect",X).on("mouseup.colzoomRect",T,true);c.event.stopPropagation()}this.draw_g.select(".axis_zoom").on("mousedown",G).on("dblclick",function(){B.main_painter().Unzoom("z")})};i.ShowContextMenu=function(m){this.main_painter().ShowContextMenu("z",m,this.GetObject().fAxis)};i.UseContextMenu=true;i.DrawPave(k);return i.DrawingReady()};b.EAxisBits={kTickPlus:b.BIT(9),kTickMinus:b.BIT(10),kAxisRange:b.BIT(11),kCenterTitle:b.BIT(12),kCenterLabels:b.BIT(14),kRotateTitle:b.BIT(15),kPalette:b.BIT(16),kNoExponent:b.BIT(17),kLabelsHori:b.BIT(18),kLabelsVert:b.BIT(19),kLabelsDown:b.BIT(20),kLabelsUp:b.BIT(21),kIsInteger:b.BIT(22),kMoreLogLabels:b.BIT(23),kDecimals:b.BIT(11)};function d(j,i){b.TObjectPainter.call(this,j);this.embedded=i;this.name="yaxis";this.kind="normal";this.func=null;this.order=0;this.full_min=0;this.full_max=1;this.scale_min=0;this.scale_max=1;this.ticks=[];this.invert_side=false}d.prototype=Object.create(b.TObjectPainter.prototype);d.prototype.Cleanup=function(){this.ticks=[];this.func=null;delete this.format;b.TObjectPainter.prototype.Cleanup.call(this)};d.prototype.SetAxisConfig=function(k,m,o,l,j,i,p){this.name=k;this.kind=m;this.func=o;this.full_min=l;this.full_max=j;this.scale_min=i;this.scale_max=p};d.prototype.format10Exp=function(i,l){var k="";if(l){l=Math.round(l/Math.pow(10,i));if((l!=0)&&(l!=1)){k=l.toString()+(b.gStyle.Latex?"#times":"x")}}k+="10";if(b.gStyle.Latex>1){return k+"^{"+i+"}"}var j={"0":"\u2070","1":"\xB9","2":"\xB2","3":"\xB3","4":"\u2074","5":"\u2075","6":"\u2076","7":"\u2077","8":"\u2078","9":"\u2079","-":"\u207B"};var m=i.toString();for(var o=0;o<m.length;++o){k+=j[m[o]]}return k};d.prototype.CreateFormatFuncs=function(){var k=this.GetObject(),j=(k&&k._typename==="TGaxis");delete this.format;var p=508;if(j){p=k.fNdiv}else{if(k){p=Math.max(k.fNdivisions,4)}}this.nticks=p%100;this.nticks2=(p%10000-this.nticks)/100;this.nticks3=Math.floor(p/10000);if(k&&!j&&(this.nticks>7)){this.nticks=7}var l=Math.abs(this.func.range()[1]-this.func.range()[0]);if(l<=0){l=100}if(this.kind=="time"){if(this.nticks>8){this.nticks=8}var i=this.scale_max-this.scale_min,o=b.Painter.getTimeFormat(k),m=b.Painter.chooseTimeFormat(i/l,false);if((o.length==0)||(i<0.1*(this.full_max-this.full_min))){o=b.Painter.chooseTimeFormat(i/this.nticks,true)}this.tfunc1=this.tfunc2=c.timeFormat(o);if(m!==o){this.tfunc2=c.timeFormat(m)}this.format=function(r,q){return q?this.tfunc1(r):this.tfunc2(r)}}else{if(this.kind=="log"){if(this.nticks2>1){this.nticks*=this.nticks2;this.nticks2=1}this.noexp=k?k.TestBit(b.EAxisBits.kNoExponent):false;if((this.scale_max<300)&&(this.scale_min>0.3)){this.noexp=true}this.moreloglabels=k?k.TestBit(b.EAxisBits.kMoreLogLabels):false;this.format=function(v,q,t){var u=parseFloat(v),s=Math.round(u);if(!q){return((s===u)&&(Math.abs(s)<1000000000))?s.toString():u.toExponential(4)}if(u<=0){return null}var r=b.log10(u);if(this.moreloglabels||(Math.abs(r-Math.round(r))<0.001)){if(!this.noexp&&!t){return this.format10Exp(Math.floor(r+0.01),u)}return(r<0)?u.toFixed(Math.round(-r+0.5)):u.toFixed(0)}return null}}else{if(this.kind=="labels"){this.nticks=50;var i=this.scale_max-this.scale_min;if(this.nticks>i){this.nticks=Math.round(i)}this.nticks2=1;this.axis=k;this.format=function(t){var s=Math.round(parseInt(t))+1;if((s<1)||(s>this.axis.fNbins)){return null}for(var r=0;r<this.axis.fLabels.arr.length;++r){var q=this.axis.fLabels.arr[r];if(q.fUniqueID==s){return q.fString}}return null}}else{this.order=0;this.ndig=0;this.format=function(s,q){var r=parseFloat(s);if(q&&this.order){r=r/Math.pow(10,this.order)}if(r===Math.round(r)){return(Math.abs(r)<1000000000)?r.toFixed(0):r.toExponential(4)}return(this.ndig>10)?r.toExponential(4):r.toFixed(this.ndig+(q?0:2))}}}}};d.prototype.ProduceTicks=function(m,i){if(!this.noticksopt){return this.func.ticks(m*(i||1))}if(i){m=(m-1)*i}var k=this.func.domain(),j=[];for(var l=0;l<=m;++l){j.push((k[0]*(m-l)+k[1]*l)/m)}return j};d.prototype.CreateTicks=function(p,u,o,B){if(o&&this.nticks&&(this.kind=="normal")){this.noticksopt=true}var y={nminor:0,nmiddle:0,nmajor:0,func:this.func};y.minor=y.middle=y.major=this.ProduceTicks(this.nticks);if(p){var E=y.major,A=(this.scale_max-this.scale_min)*0.00001;if(E[0]>this.scale_min+A){E.unshift(this.scale_min)}if(E[E.length-1]<this.scale_max-A){E.push(this.scale_max)}return E}if(this.nticks2>1){y.minor=y.middle=this.ProduceTicks(y.major.length,this.nticks2);var l=Math.abs(this.func.range()[1]-this.func.range()[0]);if((y.middle.length<=y.major.length)||(y.middle.length>l/3.5)){y.minor=y.middle=y.major}else{if((this.nticks3>1)&&(this.kind!=="log")){y.minor=this.ProduceTicks(y.middle.length,this.nticks3);if((y.minor.length<=y.middle.length)||(y.minor.length>l/1.7)){y.minor=y.middle}}}}y.reset=function(){this.nminor=this.nmiddle=this.nmajor=0};y.next=function(F){if(this.nminor>=this.minor.length){return false}this.tick=this.minor[this.nminor++];this.grpos=this.func(this.tick);if(F){this.grpos=Math.round(this.grpos)}this.kind=3;if((this.nmiddle<this.middle.length)&&(Math.abs(this.grpos-this.func(this.middle[this.nmiddle]))<1)){this.nmiddle++;this.kind=2}if((this.nmajor<this.major.length)&&(Math.abs(this.grpos-this.func(this.major[this.nmajor]))<1)){this.nmajor++;this.kind=1}return true};y.last_major=function(){return(this.kind!==1)?false:this.nmajor==this.major.length};y.next_major_grpos=function(){if(this.nmajor>=this.major.length){return null}return this.func(this.major[this.nmajor])};this.order=0;this.ndig=0;if((this.kind=="normal")&&(y.major.length>0)){var t=0,m=0;if(!u){var j=Math.max(Math.abs(y.major[0]),Math.abs(y.major[y.major.length-1])),D=Math.min(Math.abs(y.major[0]),Math.abs(y.major[y.major.length-1])),r=(j>0)?Math.round(b.log10(j)/3)*3:0,q=(D>0)?Math.round(b.log10(D)/3)*3:0;if(j||D){t=Math.max(r,q)+3;m=Math.min(r,q)-3}}var k=0,z=this.ndig,i=10000000000;for(var w=m;w<=t;w+=3){this.order=w;this.ndig=0;var s=[],C=0,v=0;while(C<y.major.length){var x=this.format(y.major[C],true);if(s.indexOf(x)<0){s.push(x);v+=x.length;C++;continue}if(++this.ndig>11){break}s=[];C=0;v=0}if(!w&&(this.ndig<4)){v-=(y.major.length*2+3)}if(v<i){i=v;k=this.order;z=this.ndig}}this.order=k;this.ndig=z;if(B){if(this.order){console.warn("Axis painter - integer labels are configured, but axis order "+this.order+" is preferable")}if(this.ndig){console.warn("Axis painter - integer labels are configured, but "+this.ndig+" decimal digits are required")}this.ndig=0;this.order=0}}return y};d.prototype.IsCenterLabels=function(){if(this.kind==="labels"){return true}if(this.kind==="log"){return false}var i=this.GetObject();return i&&i.TestBit(b.EAxisBits.kCenterLabels)};d.prototype.AddTitleDrag=function(l,k,u,r,o){if(!b.gStyle.MoveResize){return}var j=this,m=null,p="",v,y,x,t,s,i,w,q;if(b._test_d3_===3){p="drag";v=c.behavior.drag().origin(Object)}else{v=c.drag().subject(Object)}v.on(p+"start",function(){c.event.sourceEvent.preventDefault();c.event.sourceEvent.stopPropagation();var A=l.node().getBBox(),z=j.GetObject();t=y=l.property("shift_x");s=x=l.property("shift_y");i=k?(y>0):(x>0);if(z.TestBit(b.EAxisBits.kCenterTitle)){q=(r===k)?o:0}else{q=Math.round(o/2)}m=l.append("rect").classed("zoom",true).attr("x",A.x).attr("y",A.y).attr("width",A.width).attr("height",A.height).style("cursor","move")}).on("drag",function(){if(!m){return}c.event.sourceEvent.preventDefault();c.event.sourceEvent.stopPropagation();y+=c.event.dx;x+=c.event.dy;var A=l.property("shift_x"),z=l.property("shift_y");if(k){A=y;if(Math.abs(x-z)>Math.abs(x-q)){z=q}}else{z=x;if(Math.abs(y-A)>Math.abs(y-q)){A=q}}if(i===(k?(A>0):(z>0))){t=A;s=z;l.attr("transform","translate("+t+","+s+")")}}).on(p+"end",function(){if(!m){return}c.event.sourceEvent.preventDefault();c.event.sourceEvent.stopPropagation();l.property("shift_x",t).property("shift_y",s);var z=j.GetObject();z.fTitleOffset=(k?t:s)/u;if((k?s:t)===q){z.InvertBit(b.EAxisBits.kCenterTitle)}m.remove();m=null});l.style("cursor","move").call(v)};d.prototype.DrawAxis=function(G,N,M,S,an,k,ae,aF){var p=this.GetObject(),am="",aC=(p&&p._typename==="TGaxis"),ac=N,J=0.03,P=100,o=true,H=this.pad_width()||10,L=this.pad_height()||10;this.vertical=G;function I(w,r){return(w&&!r)||(!w&&r)}if(!ae){ae=0}else{if(this.invert_side){ae=-ae}}if(aC){if(!this.lineatt){this.lineatt=new b.TAttLineHandler(p)}o=p.fLineColor!=0;am=p.fChopt;J=p.fTickSize;P=(G?1.7*S:0.6*M)}else{if(!this.lineatt){this.lineatt=new b.TAttLineHandler(p.fAxisColor,1)}am=I(G,this.invert_side)?"-S":"+S";J=p.fTickLength;P=(G?H:L)}if(!aC||(this.name==="zaxis")){ac=N.select("."+this.name+"_container");if(ac.empty()){ac=N.append("svg:g").attr("class",this.name+"_container")}else{ac.selectAll("*").remove()}}else{if(!aF&&o){ac.append("svg:line").attr("x1",0).attr("y1",0).attr("x1",G?0:M).attr("y1",G?S:0).call(this.lineatt.func)}}ac.attr("transform",an||null);var az=1,u=0,W=Math.min(H,L),K=(am.indexOf("+")>=0),i=(am.indexOf("-")>=0),ai=(am.indexOf("S")>=0),af=(am.indexOf("Y")>=0),E=(am.indexOf("0")>=0),Y=(am.indexOf("O")>=0),j=(am.indexOf("U")>=0),aj=(am.indexOf("N")>=0),D=(am.indexOf("I")>=0),al=p.TestBit(b.EAxisBits.kNoExponent);if(aC&&p.TestBit(b.EAxisBits.kTickPlus)){K=true}if(aC&&p.TestBit(b.EAxisBits.kTickMinus)){i=true}if(K&&i){az=1;u=1}else{if(i){az=I(k,G)?1:-1}else{if(K){az=I(k,G)?-1:1}}}J=Math.round((ai?J:0.03)*P);if(this.max_tick_size&&(J>this.max_tick_size)){J=this.max_tick_size}this.CreateFormatFuncs();var Q="",at="",v=0,A=0;this.ticks=[];var Z=this.CreateTicks(false,al,aj,D);while(Z.next(true)){var aq=Math.round(J/4),ao=0;if(Z.kind<3){aq=Math.round(J/2)}if(Z.kind==1){if(!("format" in this)||(this.format(Z.tick,true)!==null)){aq=J}this.ticks.push(Z.grpos)}if(u>0){ao=-aq}else{if(az<0){ao=-aq;aq=0}else{ao=0}}if(Q.length==0){Q=G?("M"+aq+","+Z.grpos):("M"+Z.grpos+","+(-aq));at=G?("M"+(ae-aq)+","+Z.grpos):("M"+Z.grpos+","+(ae+aq))}else{Q+=G?("m"+(aq-A)+","+(Z.grpos-v)):("m"+(Z.grpos-v)+","+(A-aq));at+=G?("m"+(A-aq)+","+(Z.grpos-v)):("m"+(Z.grpos-v)+","+(aq-A))}Q+=G?("h"+(ao-aq)):("v"+(aq-ao));at+=G?("h"+(aq-ao)):("v"+(ao-aq));v=Z.grpos;A=ao}if((Q.length>0)&&!aF&&o){ac.append("svg:path").attr("d",Q).call(this.lineatt.func)}if((ae!==0)&&(at.length>0)&&!aF&&o){ac.append("svg:path").attr("d",at).call(this.lineatt.func)}var B=Math.round((p.fLabelSize<1)?p.fLabelSize*W:p.fLabelSize);if((B<=0)||(Math.abs(p.fLabelOffset)>1.1)){j=true}var V=G?S:0,X=b.Painter.getFontDetails(p.fLabelFont,B),ak=this.get_color(p.fLabelColor),ar=Math.round(p.fLabelOffset*W),ah=ac.append("svg:g").attr("class","axis_labels");if(!aF&&!j){var aE=1,z=0,ad=this.IsCenterLabels(),y=p.TestBit(b.EAxisBits.kLabelsVert),aw=G?-ar*az:(ar+2)*az+u*J;this.StartTextDrawing(X,"font",ah);for(var C=0;C<Z.major.length;++C){var t=this.format(Z.major[C],true);if(t===null){continue}var ap=Math.round(this.func(Z.major[C])),ab=(C>0)?Math.abs(Math.round(ap-this.func(Z.major[C-1]))):0,x=(C<Z.major.length-1)?Math.abs(Math.round(this.func(Z.major[C+1])-ap)):0;if(ad){var R=x||ab;ap=Math.round(ap-(G?0.5*R:-0.5*R));if((ap<-5)||(ap>(G?S:M)+5)){continue}}var au={text:t,color:ak,latex:1,draw_g:ah};z=Math.max(z,t.length);if(G){au.x=aw;au.y=ap;au.align=y?((az<0)?23:20):((az<0)?12:32)}else{au.x=ap;au.y=aw;au.align=y?((az<0)?12:32):((az<0)?20:23)}if(y){au.rotate=270}var aD=this.DrawText(au);if(aD&&!G&&!y&&(this.kind!="log")){var l=ab*0.45+x*0.45;if(!ab){l=0.9*x}else{if(!x){l=0.9*ab}}aE=Math.min(aE,l/aD)}}if(this.order){this.DrawText({color:ak,x:G?az*5:M+5,y:this.has_obstacle?aw:(G?-3:-3*az),align:G?((az<0)?30:10):(I(this.has_obstacle,(az<0))?13:10),latex:1,text:"#times"+this.format10Exp(this.order),draw_g:ah})}this.FinishTextDrawing(ah);if((aE>0)&&(aE<1)){if(!G&&!y&&(z>5)&&(aE<0.7)){ah.selectAll("text").each(function(){var r=c.select(this),w=r.attr("transform");r.attr("transform",w+" rotate(25)").style("text-anchor","start")});aE=1}if(aE!=1){X.size=Math.floor(X.size*aE+0.7);ah.call(X.func)}}}if(b.gStyle.Zooming&&!this.disable_zooming){var O=ac.append("svg:rect").attr("class","axis_zoom").style("opacity","0").style("cursor","crosshair");if(G){O.attr("x",(az>0)?(-2*X.size-3):3).attr("y",0).attr("width",2*X.size+3).attr("height",S)}else{O.attr("x",0).attr("y",(az>0)?0:-X.size-3).attr("width",M).attr("height",X.size+3)}}if((p.fTitle.length>0)&&!aF){var T=ac.append("svg:g").attr("class","axis_title"),ag=(p.fTitleSize>=1)?p.fTitleSize:Math.round(p.fTitleSize*W),m=1.6*(p.fTitleSize<1?p.fTitleSize:p.fTitleSize/W),aa=p.TestBit(b.EAxisBits.kCenterTitle),U=p.TestBit(b.EAxisBits.kRotateTitle)?-1:1,q=this.get_color(p.fTitleColor),ay=0,ax=0;this.StartTextDrawing(p.fTitleFont,ag,T);var F=((U<0)&&!k)||((U>=0)&&k);if(G){m*=-az*H;ay=Math.round(m*p.fTitleOffset);if((this.name=="zaxis")&&aC&&("getBoundingClientRect" in ac.node())){var s=ac.node().getBoundingClientRect();if(ay<s.width-J){ay=Math.round(s.width-J)}}ax=Math.round(aa?S/2:(k?S:0));this.DrawText({align:(aa?"middle":(F?"begin":"end"))+";middle",rotate:(U<0)?90:270,text:p.fTitle,color:q,draw_g:T})}else{m*=az*L;ay=Math.round(aa?M/2:(k?0:M));ax=Math.round(m*p.fTitleOffset);this.DrawText({align:(aa?"middle":(F?"begin":"end"))+";middle",rotate:(U<0)?180:0,text:p.fTitle,color:q,draw_g:T})}var av=null;if(G&&(p.fTitleOffset==0)&&("getBoundingClientRect" in ac.node())){av=ac.node().getBoundingClientRect()}this.FinishTextDrawing(T,function(){if(av){var r=T.node().getBoundingClientRect();ay=(az>0)?Math.round(av.left-r.right-ag*0.3):Math.round(av.right-r.left+ag*0.3)}T.attr("transform","translate("+ay+","+ax+")").property("shift_x",ay).property("shift_y",ax)});this.AddTitleDrag(T,G,m,k,G?S:M)}this.position=0;if("getBoundingClientRect" in ac.node()){var aB=ac.node().getBoundingClientRect(),aA=this.svg_pad().node().getBoundingClientRect();this.position=aB.left-aA.left}};d.prototype.Redraw=function(){var m=this.GetObject(),j=this.AxisToSvg("x",m.fX1,"pad"),y=this.AxisToSvg("y",m.fY1,"pad"),i=this.AxisToSvg("x",m.fX2,"pad"),v=this.AxisToSvg("y",m.fY2,"pad"),z=i-j,r=y-v,o=Math.abs(z)<Math.abs(r),k=null,s=false,l="normal",p=m.fWmin,u=m.fWmax,q=p,x=u;if(m.fChopt.indexOf("t")>=0){k=c.scaleTime();l="time";this.toffset=b.Painter.getTimeOffset(m);q=new Date(this.toffset+p*1000);x=new Date(this.toffset+u*1000)}else{if(m.fChopt.indexOf("G")>=0){k=c.scaleLog();l="log"}else{k=c.scaleLinear();l="normal"}}k.domain([q,x]);if(o){if(r>0){k.range([r,0])}else{var t=y;y=v;v=t;r=-r;s=true;k.range([0,r])}}else{if(z>0){k.range([0,z])}else{var t=j;j=i;i=t;z=-z;s=true;k.range([z,0])}}this.SetAxisConfig(o?"yaxis":"xaxis",l,k,p,u,p,u);this.CreateG();this.DrawAxis(o,this.draw_g,z,r,"translate("+j+","+v+")",s)};b.Painter.drawGaxis=function(l,k,j){var i=new b.TAxisPainter(k,false);i.SetDivId(l);i.disable_zooming=true;i.Redraw();return i.DrawingReady()};function a(i){b.TObjectPainter.call(this,i);this.Enabled=true;this.UseContextMenu=true;this.UseTextColor=false;this.FirstRun=1;this.AssignFinishPave()}a.prototype=Object.create(b.TObjectPainter.prototype);a.prototype.AssignFinishPave=function(){function i(){if(this.FirstRun<=0){return}this.FirstRun--;if(this.FirstRun!==0){return}delete this.FinishPave;this.DrawingReady()}this.FinishPave=i.bind(this)};a.prototype.DrawPave=function(p){this.UseTextColor=false;if(!this.Enabled){return this.RemoveDrawG()}var q=this.GetObject();if(q.fInit===0){q.fInit=1;var l=this.root_pad();if(q.fOption.indexOf("NDC")>=0){q.fX1NDC=q.fX1;q.fX2NDC=q.fX2;q.fY1NDC=q.fY1;q.fY2NDC=q.fY2}else{if(l){if(l.fLogx){if(q.fX1>0){q.fX1=b.log10(q.fX1)}if(q.fX2>0){q.fX2=b.log10(q.fX2)}}if(l.fLogy){if(q.fY1>0){q.fY1=b.log10(q.fY1)}if(q.fY2>0){q.fY2=b.log10(q.fY2)}}q.fX1NDC=(q.fX1-l.fX1)/(l.fX2-l.fX1);q.fY1NDC=(q.fY1-l.fY1)/(l.fY2-l.fY1);q.fX2NDC=(q.fX2-l.fX1)/(l.fX2-l.fX1);q.fY2NDC=(q.fY2-l.fY1)/(l.fY2-l.fY1)}else{q.fX1NDC=q.fY1NDC=0.1;q.fX2NDC=q.fY2NDC=0.9}}}var i=Math.round(q.fX1NDC*this.pad_width()),r=Math.round((1-q.fY2NDC)*this.pad_height()),j=Math.round((q.fX2NDC-q.fX1NDC)*this.pad_width()),o=Math.round((q.fY2NDC-q.fY1NDC)*this.pad_height()),k=q.fBorderSize;this.CreateG();this.draw_g.attr("transform","translate("+i+","+r+")");if((k>1)&&(q.fShadowColor>0)){this.draw_g.append("svg:path").attr("d","M"+j+","+o+"v"+(-o+k)+"h"+k+"v"+o+"h"+(-j)+"v"+(-k)+"Z").style("fill",this.get_color(q.fShadowColor)).style("stroke",this.get_color(q.fShadowColor)).style("stroke-width","1px")}if(!this.lineatt){this.lineatt=new b.TAttLineHandler(q,k>0?1:0)}if(!this.fillatt){this.fillatt=this.createAttFill(q)}var m=this.draw_g.append("svg:path").attr("d","M0,0h"+j+"v"+o+"h-"+j+"z").call(this.fillatt.func).call(this.lineatt.func);if("PaveDrawFunc" in this){this.PaveDrawFunc(j,o,p)}if(b.BatchMode){return}m.style("pointer-events","visibleFill").on("mouseenter",this.ShowObjectStatus.bind(this));this.draw_g.attr("x",i).attr("y",r).attr("width",j).attr("height",o);this.AddDrag({obj:q,minwidth:10,minheight:20,canselect:true,redraw:this.DrawPave.bind(this),ctxmenu:b.touches&&b.gStyle.ContextMenu&&this.UseContextMenu});if(this.UseContextMenu&&b.gStyle.ContextMenu){this.draw_g.on("contextmenu",this.ShowContextMenu.bind(this))}};a.prototype.DrawPaveLabel=function(i,k){this.UseTextColor=true;var j=this.GetObject();this.StartTextDrawing(j.fTextFont,k/1.2);this.DrawText({align:j.fTextAlign,width:i,height:k,text:j.fLabel,color:this.get_color(j.fTextColor)});this.FinishTextDrawing(null,this.FinishPave)};a.prototype.DrawPaveStats=function(z,s,k){if(k&&this.IsStats()){this.FillStatistic()}var w=this.GetObject(),i=[],G=this.get_color(w.fTextColor),F=0,D=0,E=0;for(var C=0;C<w.fLines.arr.length;++C){var l=w.fLines.arr[C];if((l._typename=="TText")||(l._typename=="TLatex")){i.push(l.fTitle)}}var r=i.length;for(var C=0;C<r;++C){var q=i[C];if(C>0){E=Math.max(E,q.length)}if((C==0)||(q.indexOf("|")<0)){continue}if(F===0){F=i.length-1}var y=q.split("|");if(y.length>D){D=y.length}}var x=s/r,m=false,H=w.fMargin*z;this.StartTextDrawing(w.fTextFont,s/(r*1.2));this.UseTextColor=true;if(r==1){this.DrawText({align:w.fTextAlign,width:z,height:s,text:i[0],color:G,latex:1})}else{for(var C=0;C<r;++C){var v=C*x,B=G;this.UseTextColor=true;if(F&&(C>=F)){var y=i[C].split("|");for(var u=0;u<y.length;++u){this.DrawText({align:"middle",x:z*u/D,y:v,latex:0,width:z/D,height:x,text:y[u],color:B})}}else{if(i[C].indexOf("=")<0){if(C==0){m=true;if(i[C].length>E+5){i[C]=i[C].substr(0,E+2)+"..."}}this.DrawText({align:(C==0)?"middle":"start",x:H,y:v,width:z-2*H,height:x,text:i[C],color:B})}else{var y=i[C].split("="),p=0;for(var u=0;u<2;++u){p+=this.DrawText({align:(u==0)?"start":"end",x:H,y:v,width:z-2*H,height:x,text:y[u],color:B})}this.TextScaleFactor(1.05*p/(z-2*H),this.draw_g)}}}}var o="";if((w.fBorderSize>0)&&m){o+="M0,"+Math.round(x)+"h"+z}if((F>0)&&(D>1)){for(var A=F;A<r;++A){o+="M0,"+Math.round(A*x)+"h"+z}for(var t=0;t<D-1;++t){o+="M"+Math.round(z/D*(t+1))+","+Math.round(F*x)+"V"+s}}if(o){this.draw_g.append("svg:path").attr("d",o).call(this.lineatt.func)}this.FinishTextDrawing(undefined,this.FinishPave);this.draw_g.classed("most_upper_primitives",true)};a.prototype.DrawPaveText=function(J,F){var I=this.GetObject(),S=this.get_color(I.fTextColor),D=0,k=[],i=this.pad_height(),v=false,G=(I.fLabel.length>0);if(G){this.FirstRun++}for(var M=0;M<I.fLines.arr.length;++M){var l=I.fLines.arr[M];if((l._typename=="TText")||(l._typename=="TLatex")){D++;if((l.fX>0)||(l.fY>0)){v=true}}}var t=0;for(var M=0;M<I.fLines.arr.length;++M){var l=I.fLines.arr[M],p=(D>0)?Math.round((1-(t-0.5)/D)*F):0;switch(l._typename){case"TText":case"TLatex":t++;if(v){var r=l.fX,q=l.fY;if((r>0)&&(r<1)){r=Math.round(r*J)}else{r=I.fMargin*J}if((q>0)&&(q<1)){q=Math.round((1-q)*F)}else{q=p}var L=l.fTextColor?this.get_color(l.fTextColor):"";if(!L){L=S;this.UseTextColor=true}this.StartTextDrawing(I.fTextFont,(l.fTextSize||I.fTextSize)*i);this.DrawText({align:l.fTextAlign||I.fTextAlign,x:r,y:q,text:l.fTitle,color:L,latex:(l._typename=="TText")?0:1});this.FinishTextDrawing(undefined,this.FinishPave);this.FirstRun++}else{k.push(l)}break;case"TLine":case"TBox":var E=l.fX1,C=l.fX2,P=l.fY1,O=l.fY2;if(E!==0){E=Math.round(E*J)}C=C?Math.round(C*J):J;P=P?Math.round((1-P)*F):p;O=O?Math.round((1-O)*F):p;if(l._typename=="TLine"){var Q=new b.TAttLineHandler(l);this.draw_g.append("svg:line").attr("x1",E).attr("y1",P).attr("x2",C).attr("y2",O).call(Q.func)}else{var K=this.createAttFill(l);this.draw_g.append("svg:rect").attr("x",E).attr("y",O).attr("width",C-E).attr("height",P-O).call(K.func)}break}}if(v){if(this.FinishPave){this.FinishPave()}}else{var H=F/D,o=false,R=I.fMargin*J;this.StartTextDrawing(I.fTextFont,F/(D*1.2));for(var M=0;M<D;++M){var s=null,B=k[M];if(D==1){s={align:I.fTextAlign,x:0,y:0,width:J,height:F}}else{s={align:I.fTextAlign,x:R,y:M*H,width:J-2*R,height:H};if(B.fTextColor){s.color=this.get_color(B.fTextColor)}if(B.fTextSize){s.font_size=Math.round(B.fTextSize*i)}}s.latex=(B._typename=="TText"?0:1);s.text=B.fTitle;if(!s.color){this.UseTextColor=true;s.color=S}this.DrawText(s)}this.FinishTextDrawing(undefined,this.FinishPave)}if(G){var z=Math.round(J*0.25),u=Math.round(-F*0.02),A=Math.round(J*0.5),N=Math.round(F*0.04),m=this.draw_g.append("svg:g");m.append("svg:path").attr("d","M"+z+","+u+"h"+A+"v"+N+"h-"+A+"z").call(this.fillatt.func).call(this.lineatt.func);this.StartTextDrawing(I.fTextFont,N/1.5,m);this.DrawText({align:22,x:z,y:u,width:A,height:N,text:I.fLabel,color:S,draw_g:m});this.FinishTextDrawing(m,this.FinishPave);this.UseTextColor=true}};a.prototype.Format=function(l,i){if(!i){i="stat"}var k=this.GetObject();if(i=="stat"){i=k.fStatFormat;if(!i){i=b.gStyle.fStatFormat}}else{if(i=="fit"){i=k.fFitFormat;if(!i){i=b.gStyle.fFitFormat}}else{if(i=="entries"){if(l<1000000000){return l.toFixed(0)}i="14.7g"}else{if(i=="last"){i=this.lastformat}}}}delete this.lastformat;if(!i){i="6.4g"}var j=b.FFormat(l,i);this.lastformat=b.lastFFormat;return j};a.prototype.DrawPaveLegend=function(x,I){var l=this.GetObject(),B=l.fPrimitives.arr.length,s=l.fNColumns,q=B;if(s<2){s=1}else{while((q-1)*s>=B){q--}}function C(i){return !i.fObject&&!i.fOption&&(!i.fLabel||(i.fLabel==" "))}if(s==1){for(var H=0;H<B;++H){if(C(l.fPrimitives.arr[H])){q--}}}if(q<1){q=1}var R=this.get_color(l.fTextColor),t=Math.round(x/s),z=Math.round(0.03*x/s),y=Math.round(0.03*I),v=(I-2*y)/q,m=false,H=-1;this.StartTextDrawing(l.fTextFont,0.9*v);for(var A=0;A<B;++A){var M=l.fPrimitives.arr[A];if(C(M)){continue}if(s==1){++H}else{H=A}var o=M.fOption.toLowerCase(),K=H%s,O=(H-K)/s,J=K*t,p=J+Math.round(l.fMargin*t),j=Math.round(y+O*v),Q=Math.round(y+(O+0.5)*v),P=M,D=M,F=M,G=M.fObject,L=null,u=false;if((G!==null)&&(typeof G=="object")){if("fLineColor" in G){F=G}if("fFillColor" in G){P=G}if("fMarkerColor" in G){D=G}L=this.FindPainterFor(G)}if(o.indexOf("f")!=-1){var E=(L&&L.fillatt)?L.fillatt:this.createAttFill(P);this.draw_g.append("svg:rect").attr("x",J+z).attr("y",Math.round(j+v*0.1)).attr("width",p-2*z-J).attr("height",Math.round(v*0.8)).call(E.func);if(E.color!=="none"){u=true}}if(o.indexOf("l")!=-1){var N=(L&&L.lineatt)?L.lineatt:new b.TAttLineHandler(F);this.draw_g.append("svg:line").attr("x1",J+z).attr("y1",Q).attr("x2",p-z).attr("y2",Q).call(N.func);if(N.color!=="none"){u=true}}if(o.indexOf("e")!=-1&&(o.indexOf("l")==-1||o.indexOf("f")!=-1)){}if(o.indexOf("p")!=-1){var r=(L&&L.markeratt)?L.markeratt:new b.TAttMarkerHandler(D);this.draw_g.append("svg:path").attr("d",r.create((J+p)/2,Q)).call(r.func);if(r.color!=="none"){u=true}}if(!u&&L&&L.lineatt&&(L.lineatt.color!=="none")){this.draw_g.append("svg:rect").attr("x",J+z).attr("y",Math.round(j+v*0.1)).attr("width",p-2*z-J).attr("height",Math.round(v*0.8)).attr("fill","none").call(L.lineatt.func)}var k=p;if(o.length>0){m=true}else{if(!m){k=J+z}}if(M.fLabel&&(M.fLabel!=" ")){this.DrawText({align:"start",x:k,y:j,width:J+t-k-z,height:v,text:M.fLabel,color:R})}}this.FinishTextDrawing(null,this.FinishPave)};a.prototype.FillContextMenu=function(k){var j=this.GetObject();k.add("header: "+j._typename+"::"+j.fName);if(this.IsStats()){k.add("Default position",function(){j.fX2NDC=b.gStyle.fStatX;j.fX1NDC=j.fX2NDC-b.gStyle.fStatW;j.fY2NDC=b.gStyle.fStatY;j.fY1NDC=j.fY2NDC-b.gStyle.fStatH;j.fInit=1;this.Redraw()});k.add("SetStatFormat",function(){var l=prompt("Enter StatFormat",j.fStatFormat);if(l!=null){j.fStatFormat=l;this.Redraw()}});k.add("SetFitFormat",function(){var l=prompt("Enter FitFormat",j.fFitFormat);if(l!=null){j.fFitFormat=l;this.Redraw()}});k.add("separator");k.add("sub:SetOptStat",function(){var l=prompt("Enter OptStat",j.fOptStat);if(l!=null){j.fOptStat=parseInt(l);this.Redraw()}});function i(o,l){var m=(o<10)?j.fOptStat:j.fOptFit;m=parseInt(parseInt(m)/parseInt(Math.pow(10,o%10)))%10;k.addchk(m,l,m*100+o,function(p){var r=(p%100<10)?j.fOptStat:j.fOptFit;var q=parseInt(p/100);r-=(q>0?q:-1)*parseInt(Math.pow(10,p%10));if(p%100<10){j.fOptStat=r}else{j.fOptFit=r}this.Redraw()})}i(0,"Histogram name");i(1,"Entries");i(2,"Mean");i(3,"Std Dev");i(4,"Underflow");i(5,"Overflow");i(6,"Integral");i(7,"Skewness");i(8,"Kurtosis");k.add("endsub:");k.add("sub:SetOptFit",function(){var l=prompt("Enter OptStat",j.fOptFit);if(l!=null){j.fOptFit=parseInt(l);this.Redraw()}});i(10,"Fit parameters");i(11,"Par errors");i(12,"Chi square / NDF");i(13,"Probability");k.add("endsub:");k.add("separator")}else{if(j.fName==="title"){k.add("Default position",function(){j.fX1NDC=0.28;j.fY1NDC=0.94;j.fX2NDC=0.72;j.fY2NDC=0.99;j.fInit=1;this.Redraw()})}}if(this.UseTextColor){this.TextAttContextMenu(k)}this.FillAttContextMenu(k);return k.size()>0};a.prototype.ShowContextMenu=function(i){if(!i){c.event.stopPropagation();c.event.preventDefault();i=c.event}b.Painter.createMenu(this,function(j){j.painter.FillContextMenu(j);j.show(i)})};a.prototype.IsStats=function(){return this.MatchObjectType("TPaveStats")};a.prototype.ClearPave=function(){this.GetObject().Clear()};a.prototype.AddText=function(i){this.GetObject().AddText(i)};a.prototype.FillFunctionStat=function(m,r){if(!r||!m){return false}var j=r%10,o=Math.floor(r/10)%10,l=Math.floor(r/100)%10,s=Math.floor(r/1000)%10;if(l>0){this.AddText("#chi^2 / ndf = "+this.Format(m.fChisquare,"fit")+" / "+m.fNDF)}if(s>0){this.AddText("Prob = "+(("Math" in b)?this.Format(b.Math.Prob(m.fChisquare,m.fNDF)):"<not avail>"))}if(j>0){for(var i=0;i<m.GetNumPars();++i){var q=m.GetParName(i),k=m.GetParValue(i),p=m.GetParError(i);k=(k===undefined)?"<not avail>":this.Format(Number(k),"fit");if(p!==undefined){p=this.Format(p,"last");if((Number(p)===0)&&(m.GetParError(i)!=0)){p=this.Format(m.GetParError(i),"4.2g")}}if((o>0)&&p){this.AddText(q+" = "+k+" #pm "+p)}else{this.AddText(q+" = "+k)}}}return true};a.prototype.FillStatistic=function(){var m=this.GetObject(),i=m.$main_painter||this.main_painter();if(m.fName!=="stats"){return false}if(!i||typeof i.FillStatistic!=="function"){return false}var j=parseInt(m.fOptStat),o=parseInt(m.fOptFit);if(isNaN(j)){j=b.gStyle.fOptStat}if(isNaN(o)){o=b.gStyle.fOptFit}if(!i.FillStatistic(this,j,o)){return false}var k=m.fLines.arr.length,l=k*b.gStyle.StatFontSize;if((l<=0)||(b.gStyle.StatFont%10===3)){l=0.25*k*b.gStyle.StatH;m.fY1NDC=m.fY2NDC-l}return true};a.prototype.UpdateObject=function(j){if(!this.MatchObjectType(j)){return false}var i=this.GetObject();if(!("modified_NDC" in i)){i.fInit=j.fInit;i.fX1=j.fX1;i.fX2=j.fX2;i.fY1=j.fY1;i.fY2=j.fY2;i.fX1NDC=j.fX1NDC;i.fX2NDC=j.fX2NDC;i.fY1NDC=j.fY1NDC;i.fY2NDC=j.fY2NDC}switch(j._typename){case"TPaveText":i.fLines=b.clone(j.fLines);return true;case"TPaveLabel":i.fLabel=j.fLabel;return true;case"TPaveStats":i.fOptStat=j.fOptStat;i.fOptFit=j.fOptFit;return true;case"TLegend":i.fPrimitives=j.fPrimitives;i.fNColumns=j.fNColumns;return true}return false};a.prototype.Redraw=function(){this.DrawPave(true)};b.Painter.drawPave=function(l,k,j){var i=new b.TPavePainter(k);i.SetDivId(l,2,((typeof j=="string")&&(j.indexOf("onpad:")==0))?j.substr(6):undefined);switch(k._typename){case"TPaveLabel":i.PaveDrawFunc=i.DrawPaveLabel;break;case"TPaveStats":i.PaveDrawFunc=i.DrawPaveStats;break;case"TPaveText":i.PaveDrawFunc=i.DrawPaveText;break;case"TLegend":i.PaveDrawFunc=i.DrawPaveLegend;break}i.Redraw();return this.PaveDrawFunc?i.DrawingReady():i};b.Painter.drawLegend=b.Painter.drawPave;b.Painter.drawPaveText=b.Painter.drawPave;function e(i){b.TObjectPainter.call(this,i);this.histo=i;this.shrink_frame_left=0;this.draw_content=true;this.nbinsx=0;this.nbinsy=0;this.x_kind="normal";this.y_kind="normal";this.keys_handler=null;this.accept_drops=true;this.mode3d=false;this.zoom_changed_interactive=0;this.DecomposeTitle()}e.prototype=Object.create(b.TObjectPainter.prototype);e.prototype.IsTProfile=function(){return this.MatchObjectType("TProfile")};e.prototype.IsTH1K=function(){return this.MatchObjectType("TH1K")};e.prototype.IsTH2Poly=function(){return this.histo&&this.histo._typename.match(/^TH2Poly/)};e.prototype.Cleanup=function(){if(this.keys_handler){window.removeEventListener("keydown",this.keys_handler,false);this.keys_handler=null}if(typeof this.Create3DScene==="function"){this.Create3DScene(-1)}this.histo=null;delete this.x;delete this.grx;delete this.ConvertX;delete this.RevertX;delete this.y;delete this.gry;delete this.ConvertY;delete this.RevertY;delete this.z;delete this.grz;if(this.x_handle){this.x_handle.Cleanup();delete this.x_handle}if(this.y_handle){this.y_handle.Cleanup();delete this.y_handle}if(this.z_handle){this.z_handle.Cleanup();delete this.z_handle}delete this.fPalette;delete this.fContour;delete this.options;b.TObjectPainter.prototype.Cleanup.call(this)};e.prototype.Dimension=function(){if(!this.histo){return 0}if(this.histo._typename.indexOf("TH2")==0){return 2}if(this.histo._typename.indexOf("TProfile2D")==0){return 2}if(this.histo._typename.indexOf("TH3")==0){return 3}return 1};e.prototype.DecodeOptions=function(i,r){var p={Axis:0,Bar:0,Curve:0,Hist:0,Line:0,Error:0,errorX:b.gStyle.fErrorX,Mark:0,Fill:0,Same:0,Scat:0,ScatCoef:1,Func:1,Star:0,Arrow:0,Box:0,Text:0,Char:0,Color:0,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Spec:0,Pie:0,List:0,Zscale:0,FrontBox:1,BackBox:1,Candle:"",GLBox:0,GLColor:0,Project:"",System:b.Painter.Coord.kCARTESIAN,AutoColor:0,NoStat:false,ForceStat:false,AutoZoom:false,HighRes:0,Zero:1,Palette:0,BaseLine:false,Optimize:b.gStyle.OptimizeDraw,_pmc:false,_plc:false,_pfc:false,minimum:-1111,maximum:-1111,original:i},q=new b.DrawOptions(i||this.histo.fOption),o=this.Dimension(),l=this.root_pad(),s=false;if((o===1)&&(this.histo.fSumw2.length>0)){for(var k=0;k<this.histo.fSumw2.length;++k){if(this.histo.fSumw2[k]>0){p.Error=2;p.Zero=0;break}}}if(q.check("PAL",true)){p.Palette=q.partAsInt()}if(q.check("MINIMUM:",true)){p.minimum=parseFloat(q.part)}else{p.minimum=this.histo.fMinimum}if(q.check("MAXIMUM:",true)){p.maximum=parseFloat(q.part)}else{p.maximum=this.histo.fMaximum}if(q.check("NOOPTIMIZE")){p.Optimize=0}if(q.check("OPTIMIZE")){p.Optimize=2}if(q.check("AUTOCOL")){p.AutoColor=1;p.Hist=1}if(q.check("AUTOZOOM")){p.AutoZoom=1;p.Hist=1}if(q.check("NOSTAT")){p.NoStat=true}if(q.check("STAT")){p.ForceStat=true}var t=null;if(q.check("NOTOOLTIP")){t=false}if(q.check("TOOLTIP")){t=true}if((t!==null)&&this.frame_painter()){this.frame_painter().tooltip_allowed=t}if(q.check("LOGX")&&l){l.fLogx=1}if(q.check("LOGY")&&l){l.fLogy=1}if(q.check("LOGZ")&&l){l.fLogz=1}if(q.check("GRIDXY")&&l){l.fGridx=l.fGridy=1}if(q.check("GRIDX")&&l){l.fGridx=1}if(q.check("GRIDY")&&l){l.fGridy=1}if(q.check("TICKXY")&&l){l.fTickx=l.fTicky=1}if(q.check("TICKX")&&l){l.fTickx=1}if(q.check("TICKY")&&l){l.fTicky=1}if(q.check("FILL_",true)){if(q.partAsInt(1)>0){p.histoFillColor=q.partAsInt()}else{for(var j=0;j<8;++j){if(b.Painter.root_colors[j].toUpperCase()===q.part){p.histoFillColor=j}}}}if(q.check("LINE_",true)){if(q.partAsInt(1)>0){p.histoLineColor=b.Painter.root_colors[q.partAsInt()]}else{for(var j=0;j<8;++j){if(b.Painter.root_colors[j].toUpperCase()===q.part){p.histoLineColor=q.part}}}}if(q.check("X+")){p.AxisPos=10}if(q.check("Y+")){p.AxisPos+=1}if(q.check("SAMES")){p.Same=2;p.ForceStat=true}if(q.check("SAME")){p.Same=1;p.Func=0}if(q.empty()){p.Hist=1}if(q.check("SPEC")){p.Scat=0;p.Spec=1}if(q.check("BASE0")){p.BaseLine=0}else{if(b.gStyle.fHistMinimumZero){p.BaseLine=0}}if(q.check("PIE")){p.Pie=1}if(q.check("CANDLE",true)){p.Candle=q.part}if(q.check("GLBOX",true)){p.GLBox=10+q.partAsInt()}if(q.check("GLCOL")){p.GLColor=1}q.check("GL");if(q.check("LEGO",true)){p.Scat=0;p.Lego=1;if(q.part.indexOf("0")>=0){p.Zero=0}if(q.part.indexOf("1")>=0){p.Lego=11}if(q.part.indexOf("2")>=0){p.Lego=12}if(q.part.indexOf("3")>=0){p.Lego=13}if(q.part.indexOf("4")>=0){p.Lego=14}if(q.part.indexOf("FB")>=0){p.FrontBox=0}if(q.part.indexOf("BB")>=0){p.BackBox=0}if(q.part.indexOf("Z")>=0){p.Zscale=1}}if(q.check("SURF",true)){p.Scat=0;p.Surf=q.partAsInt(10,1);if(q.part.indexOf("FB")>=0){p.FrontBox=0}if(q.part.indexOf("BB")>=0){p.BackBox=0}if(q.part.indexOf("Z")>=0){p.Zscale=1}}if(q.check("TF3",true)){if(q.part.indexOf("FB")>=0){p.FrontBox=0}if(q.part.indexOf("BB")>=0){p.BackBox=0}}if(q.check("ISO",true)){if(q.part.indexOf("FB")>=0){p.FrontBox=0}if(q.part.indexOf("BB")>=0){p.BackBox=0}}if(p.Surf||p.Lego){if(q.check("FB")){p.FrontBox=0}if(q.check("BB")){p.BackBox=0}}if(q.check("LIST")){p.List=1}if(q.check("CONT",true)){if(o>1){p.Scat=0;p.Contour=1;if(q.part.indexOf("Z")>=0){p.Zscale=1}if(q.part.indexOf("1")>=0){p.Contour=11}else{if(q.part.indexOf("2")>=0){p.Contour=12}else{if(q.part.indexOf("3")>=0){p.Contour=13}else{if(q.part.indexOf("4")>=0){p.Contour=14}}}}}else{p.Hist=1}}if(q.check("HBAR",true)){p.Bar=20}else{if(q.check("BAR",true)){p.Bar=10}}if(p.Bar>0){p.Hist=0;s=true;p.Bar+=q.partAsInt()}if(q.check("ARR")){if(o>1){p.Arrow=1;p.Scat=0}else{p.Hist=1}}if(q.check("BOX",true)){p.Box=10+q.partAsInt()}if(p.Box){if(o>1){p.Scat=0}else{p.Hist=1}}if(q.check("COL",true)){p.Color=1;if(q.part.indexOf("0")>=0){p.Color=11}if(q.part.indexOf("1")>=0){p.Color=11}if(q.part.indexOf("2")>=0){p.Color=12}if(q.part.indexOf("3")>=0){p.Color=13}if(q.part.indexOf("Z")>=0){p.Zscale=1}if(q.part.indexOf("A")>=0){p.Axis=-1}if(o==1){p.Hist=1}else{p.Scat=0}}if(q.check("CHAR")){p.Char=1;p.Scat=0}if(q.check("FUNC")){p.Func=2;p.Hist=0}if(q.check("AXIS")){p.Axis=1}if(q.check("AXIG")){p.Axis=2}if(q.check("TEXT",true)){p.Text=1;p.Scat=0;p.Hist=0;var m=Math.min(q.partAsInt(),90);if(m){p.Text=1000+m}if(q.part.indexOf("N")>=0&&this.IsTH2Poly()){p.Text=3000+m}if(q.part.indexOf("E")>=0){p.Text=2000+m}}if(q.check("SCAT=",true)){p.Scat=1;p.ScatCoef=parseFloat(q.part);if(isNaN(p.ScatCoef)||(p.ScatCoef<=0)){p.ScatCoef=1}}if(q.check("SCAT")){p.Scat=1}if(q.check("POL")){p.System=b.Painter.Coord.kPOLAR}if(q.check("CYL")){p.System=b.Painter.Coord.kCYLINDRICAL}if(q.check("SPH")){p.System=b.Painter.Coord.kSPHERICAL}if(q.check("PSR")){p.System=b.Painter.Coord.kRAPIDITY}if(q.check("TRI",true)){p.Scat=0;p.Color=0;p.Tri=1;if(q.part.indexOf("FB")>=0){p.FrontBox=0}if(q.part.indexOf("BB")>=0){p.BackBox=0}if(q.part.indexOf("ERR")>=0){p.Error=1}}if(q.check("AITOFF")){p.Proj=1}if(q.check("MERCATOR")){p.Proj=2}if(q.check("SINUSOIDAL")){p.Proj=3}if(q.check("PARABOLIC")){p.Proj=4}if(p.Proj>0){p.Scat=0;p.Contour=14}if(q.check("PROJX",true)){p.Project="X"+q.partAsInt(0,1)}if(q.check("PROJY",true)){p.Project="Y"+q.partAsInt(0,1)}if((o==3)&&q.check("FB")){p.FrontBox=0}if((o==3)&&q.check("BB")){p.BackBox=0}p._pfc=q.check("PFC");p._plc=q.check("PLC");p._pmc=q.check("PMC");if(q.check("LF2")){p.Line=2;p.Hist=-1;p.Error=0;s=true}if(q.check("L")){p.Line=1;p.Hist=-1;p.Error=0}if(q.check("A")){p.Axis=-1}if(q.check("B1")){p.Bar=1;p.BaseLine=0;p.Hist=-1;s=true}if(q.check("B")){p.Bar=1;p.Hist=-1;s=true}if(q.check("C")){p.Curve=1;p.Hist=-1}if(q.check("][")){p.Off=1;p.Hist=1}if(q.check("F")){p.Fill=1}if(q.check("HIST")){p.Hist=2;p.Func=0;p.Error=0}if(q.check("P0")){p.Mark=1;p.Hist=-1;p.Zero=1}if(q.check("P")){p.Mark=1;p.Hist=-1;p.Zero=0}if(q.check("Z")){p.Zscale=1}if(q.check("*H")||q.check("*")){p.Mark=23;p.Hist=-1}if(q.check("H")){p.Hist=1}if(this.IsTH2Poly()){if(p.Fill+p.Line+p.Mark!=0){p.Scat=0}}if(q.check("E",true)){if(o==1){p.Error=1;p.Zero=0;if(!isNaN(parseInt(q.part[0]))){p.Error=10+parseInt(q.part[0])}if((p.Error===13)||(p.Error===14)){s=true}if(p.Error===10){p.Zero=1}if(q.part.indexOf("X0")>=0){p.errorX=0}}else{if(p.Error==0){p.Error=100;p.Scat=0}}}if(q.check("9")){p.HighRes=1}if(q.check("0")){p.Zero=0}if(r){if(s&&this.fillatt&&(this.fillatt.color=="none")){this.fillatt.Change(5,1001)}}return p};e.prototype.GetAutoColor=function(i){if(this.options.AutoColor<=0){return i}var j=this.options.AutoColor;this.options.AutoColor=j%8+1;return b.Painter.root_colors[j]};e.prototype.ScanContent=function(i){alert("HistPainter.prototype.ScanContent not implemented")};e.prototype.CheckPadRange=function(){if(!this.is_main_painter()){return}this.zoom_xmin=this.zoom_xmax=0;this.zoom_ymin=this.zoom_ymax=0;this.zoom_zmin=this.zoom_zmax=0;var o=this.Dimension(),p=this.histo.fXaxis,l=this.histo.fYaxis,j=this.histo.fXaxis;if(p.TestBit(b.EAxisBits.kAxisRange)){if((p.fFirst!==p.fLast)&&((p.fFirst>1)||(p.fLast<p.fNbins))){this.zoom_xmin=p.fFirst>1?p.GetBinLowEdge(p.fFirst):p.fXmin;this.zoom_xmax=p.fLast<p.fNbins?p.GetBinLowEdge(p.fLast+1):p.fXmax}}if((o>1)&&l.TestBit(b.EAxisBits.kAxisRange)){if((l.fFirst!==l.fLast)&&((l.fFirst>1)||(l.fLast<l.fNbins))){this.zoom_ymin=l.fFirst>1?l.GetBinLowEdge(l.fFirst):l.fXmin;this.zoom_ymax=l.fLast<l.fNbins?l.GetBinLowEdge(l.fLast+1):l.fXmax}}if((o>2)&&j.TestBit(b.EAxisBits.kAxisRange)){if((j.fFirst!==j.fLast)&&((j.fFirst>1)||(j.fLast<j.fNbins))){this.zoom_zmin=j.fFirst>1?j.GetBinLowEdge(j.fFirst):j.fXmin;this.zoom_zmax=j.fLast<j.fNbins?j.GetBinLowEdge(j.fLast+1):j.fXmax}}var m=this.root_pad();if(!m||!("fUxmin" in m)||this.create_canvas){return}var k=m.fUxmin,i=m.fUxmax;if((o<3)&&((k!==0)||(i!==1))){if(m.fLogx>0){k=Math.exp(k*Math.log(10));i=Math.exp(i*Math.log(10))}if(k!==p.fXmin||i!==p.fXmax){if(k>=p.fXmin&&i<=p.fXmax){this.zoom_xmin=k;this.zoom_xmax=i}}}k=m.fUymin;i=m.fUymax;if((o==2)&&((k!==0)||(i!==1))){if(m.fLogy>0){k=Math.exp(k*Math.log(10));i=Math.exp(i*Math.log(10))}if(k!==l.fXmin||i!==l.fXmax){if(k>=l.fXmin&&i<=l.fXmax){this.zoom_ymin=k;this.zoom_ymax=i}}}};e.prototype.CheckHistDrawAttributes=function(){if(this.options._pfc||this.options._plc||this.options._pmc){if(!this.pallette&&b.Painter.GetColorPalette){this.palette=b.Painter.GetColorPalette()}var k=this.pad_painter(true);if(this.palette&&k){var o=k.GetCurrentPrimitiveIndx(),m=k.GetNumPrimitives();var l=this.palette.calcColor(o,m);var p=this.add_color(l);if(this.options._pfc){this.histo.fFillColor=p;delete this.fillatt}if(this.options._plc){this.histo.fLineColor=p;delete this.lineatt}if(this.options._pmc){this.histo.fMarkerColor=p;delete this.markeratt}}this.options._pfc=this.options._plc=this.options._pmc=false}if(!this.fillatt||!this.fillatt.changed){this.fillatt=this.createAttFill(this.histo,undefined,this.options.histoFillColor,1)}if(!this.lineatt||!this.lineatt.changed){this.lineatt=new b.TAttLineHandler(this.histo,undefined,undefined,this.options.histoLineColor);var i=this.main_painter();if(i){var j=i.GetAutoColor(this.lineatt.color);if(j!==this.lineatt.color){this.lineatt.color=j;this.lineatt.changed=true}}}};e.prototype.UpdateObject=function(p,j){var o=this.GetObject();if(p!==o){if(!this.MatchObjectType(p)){return false}if(o.TestBit(b.TH1StatusBits.kNoStats)!=p.TestBit(b.TH1StatusBits.kNoStats)){o.fBits=p.fBits;var q=this.FindPainterFor(this.FindStat());if(q){q.Enabled=!o.TestBit(b.TH1StatusBits.kNoStats)}}if(this.snapid!==undefined){o.fName=p.fName}o.fFillColor=p.fFillColor;o.fFillStyle=p.fFillStyle;o.fLineColor=p.fLineColor;o.fLineStyle=p.fLineStyle;o.fLineWidth=p.fLineWidth;o.fEntries=p.fEntries;o.fTsumw=p.fTsumw;o.fTsumwx=p.fTsumwx;o.fTsumwx2=p.fTsumwx2;o.fXaxis.fNbins=p.fXaxis.fNbins;if(this.Dimension()>1){o.fTsumwy=p.fTsumwy;o.fTsumwy2=p.fTsumwy2;o.fTsumwxy=p.fTsumwxy;o.fYaxis.fNbins=p.fYaxis.fNbins;if(this.Dimension()>2){o.fTsumwz=p.fTsumwz;o.fTsumwz2=p.fTsumwz2;o.fTsumwxz=p.fTsumwxz;o.fTsumwyz=p.fTsumwyz;o.fZaxis.fNbins=p.fZaxis.fNbins}}o.fArray=p.fArray;o.fNcells=p.fNcells;o.fTitle=p.fTitle;o.fMinimum=p.fMinimum;o.fMaximum=p.fMaximum;function r(u,t){u.fTitle=t.fTitle;u.fLabels=t.fLabels}r(o.fXaxis,p.fXaxis);r(o.fYaxis,p.fYaxis);r(o.fZaxis,p.fZaxis);if(!this.main_painter().zoom_changed_interactive){function m(u,t){u.fXmin=t.fXmin;u.fXmax=t.fXmax;u.fFirst=t.fFirst;u.fLast=t.fLast;u.fBits=t.fBits}m(o.fXaxis,p.fXaxis);m(o.fYaxis,p.fYaxis);m(o.fZaxis,p.fZaxis)}o.fSumw2=p.fSumw2;if(this.IsTProfile()){o.fBinEntries=p.fBinEntries}if(this.IsTH1K()){o.fNIn=p.fNIn;o.fReady=false}this.DecomposeTitle();if(p.fFunctions&&this.options.Func){for(var k=0;k<p.fFunctions.arr.length;++k){var l=p.fFunctions.arr[k];if(!l||!l._typename){continue}var i=l.fName?this.FindPainterFor(null,l.fName,l._typename):null;if(i){i.UpdateObject(l)}else{if((l._typename!="TPaletteAxis")&&(l._typename!="TPaveStats")){console.log("Get "+l._typename+" in histogram functions list, need to use?")}}}}var s=(o.fOption!=p.fOption);o.fOption=p.fOption;if(((j!==undefined)&&(this.options.original!==j))||s){this.options=this.DecodeOptions(j)}}if(!this.zoom_changed_interactive){this.CheckPadRange()}this.ScanContent();this.histogram_updated=true;return true};e.prototype.CreateAxisFuncs=function(j,i){this.xmin=this.histo.fXaxis.fXmin;this.xmax=this.histo.fXaxis.fXmax;if(this.histo.fXaxis.fXbins.length==this.nbinsx+1){this.regularx=false;this.GetBinX=function(l){var m=Math.round(l);if(m<=0){return this.xmin}if(m>this.nbinsx){return this.xmax}if(m==l){return this.histo.fXaxis.fXbins[m]}var k=(l<m)?m-1:m+1;return this.histo.fXaxis.fXbins[m]*Math.abs(l-k)+this.histo.fXaxis.fXbins[k]*Math.abs(l-m)};this.GetIndexX=function(l,o){for(var m=1;m<this.histo.fXaxis.fXbins.length;++m){if(l<this.histo.fXaxis.fXbins[m]){return Math.floor(m-1+o)}}return this.nbinsx}}else{this.regularx=true;this.binwidthx=(this.xmax-this.xmin);if(this.nbinsx>0){this.binwidthx=this.binwidthx/this.nbinsx}this.GetBinX=function(k){return this.xmin+k*this.binwidthx};this.GetIndexX=function(k,l){return Math.floor((k-this.xmin)/this.binwidthx+l)}}this.ymin=this.histo.fYaxis.fXmin;this.ymax=this.histo.fYaxis.fXmax;if(!j||(this.nbinsy==0)){return}if(this.histo.fYaxis.fXbins.length==this.nbinsy+1){this.regulary=false;this.GetBinY=function(l){var m=Math.round(l);if(m<=0){return this.ymin}if(m>this.nbinsy){return this.ymax}if(m==l){return this.histo.fYaxis.fXbins[m]}var k=(l<m)?m-1:m+1;return this.histo.fYaxis.fXbins[m]*Math.abs(l-k)+this.histo.fYaxis.fXbins[k]*Math.abs(l-m)};this.GetIndexY=function(o,m){for(var l=1;l<this.histo.fYaxis.fXbins.length;++l){if(o<this.histo.fYaxis.fXbins[l]){return Math.floor(l-1+m)}}return this.nbinsy}}else{this.regulary=true;this.binwidthy=(this.ymax-this.ymin);if(this.nbinsy>0){this.binwidthy=this.binwidthy/this.nbinsy}this.GetBinY=function(k){return this.ymin+k*this.binwidthy};this.GetIndexY=function(l,k){return Math.floor((l-this.ymin)/this.binwidthy+k)}}if(!i||(this.nbinsz==0)){return}if(this.histo.fZaxis.fXbins.length==this.nbinsz+1){this.regularz=false;this.GetBinZ=function(l){var m=Math.round(l);if(m<=0){return this.zmin}if(m>this.nbinsz){return this.zmax}if(m==l){return this.histo.fZaxis.fXbins[m]}var k=(l<m)?m-1:m+1;return this.histo.fZaxis.fXbins[m]*Math.abs(l-k)+this.histo.fZaxis.fXbins[k]*Math.abs(l-m)};this.GetIndexZ=function(o,m){for(var l=1;l<this.histo.fZaxis.fXbins.length;++l){if(o<this.histo.fZaxis.fXbins[l]){return Math.floor(l-1+m)}}return this.nbinsz}}else{this.regularz=true;this.binwidthz=(this.zmax-this.zmin);if(this.nbinsz>0){this.binwidthz=this.binwidthz/this.nbinsz}this.GetBinZ=function(k){return this.zmin+k*this.binwidthz};this.GetIndexZ=function(l,k){return Math.floor((l-this.zmin)/this.binwidthz+k)}}};e.prototype.CreateXY=function(){if(!this.is_main_painter()){this.x=this.main_painter().x;this.y=this.main_painter().y;return}this.swap_xy=false;if(this.options.Bar>=20){this.swap_xy=true}this.logx=this.logy=false;var k=this.frame_width(),p=this.frame_height(),q=this.root_pad(),m=(this.options.Same>0);if(this.histo.fXaxis.fTimeDisplay){this.x_kind="time";this.timeoffsetx=b.Painter.getTimeOffset(this.histo.fXaxis);this.ConvertX=function(i){return new Date(this.timeoffsetx+i*1000)};this.RevertX=function(i){return(this.x.invert(i)-this.timeoffsetx)/1000}}else{this.x_kind=(this.histo.fXaxis.fLabels==null)?"normal":"labels";this.ConvertX=function(i){return i};this.RevertX=function(i){return this.x.invert(i)}}this.scale_xmin=this.xmin;this.scale_xmax=this.xmax;if(m){var l=q.fX2-q.fX1;this.scale_xmin=q.fX1+l*q.fLeftMargin;this.scale_xmax=q.fX2-l*q.fRightMargin;if(q.fLogx){this.scale_xmin=Math.pow(10,this.scale_xmin);this.scale_xmax=Math.pow(10,this.scale_xmax)}}if(this.zoom_xmin!=this.zoom_xmax){this.scale_xmin=this.zoom_xmin;this.scale_xmax=this.zoom_xmax}if(this.x_kind=="time"){this.x=c.scaleTime()}else{if(this.swap_xy?q.fLogy:q.fLogx){this.logx=true;if(this.scale_xmax<=0){this.scale_xmax=0}if((this.scale_xmin<=0)&&(this.nbinsx>0)){for(var o=0;o<this.nbinsx;++o){this.scale_xmin=Math.max(this.scale_xmin,this.GetBinX(o));if(this.scale_xmin>0){break}}}if((this.scale_xmin<=0)||(this.scale_xmin>=this.scale_xmax)){this.scale_xmin=this.scale_xmax*0.0001}this.x=c.scaleLog()}else{this.x=c.scaleLinear()}}this.x.domain([this.ConvertX(this.scale_xmin),this.ConvertX(this.scale_xmax)]).range(this.swap_xy?[p,0]:[0,k]);if(this.x_kind=="time"){this.grx=function(i){return this.x(this.ConvertX(i))}}else{if(this.logx){this.grx=function(i){return(i<this.scale_xmin)?(this.swap_xy?this.x.range()[0]+5:-5):this.x(i)}}else{this.grx=this.x}}this.scale_ymin=m?q.fUymin:this.ymin;this.scale_ymax=m?q.fUymax:this.ymax;if(m){var j=q.fY2-q.fY1;this.scale_ymin=q.fY1+j*q.fBottomMargin;this.scale_ymax=q.fY2-j*q.fTopMargin;if(q.fLogx){this.scale_xmin=Math.pow(10,this.scale_xmin);this.scale_xmax=Math.pow(10,this.scale_xmax)}}if(this.zoom_ymin!=this.zoom_ymax){this.scale_ymin=this.zoom_ymin;this.scale_ymax=this.zoom_ymax}if(this.histo.fYaxis.fTimeDisplay){this.y_kind="time";this.timeoffsety=b.Painter.getTimeOffset(this.histo.fYaxis);this.ConvertY=function(i){return new Date(this.timeoffsety+i*1000)};this.RevertY=function(i){return(this.y.invert(i)-this.timeoffsety)/1000}}else{this.y_kind=((this.Dimension()==2)&&(this.histo.fYaxis.fLabels!=null))?"labels":"normal";this.ConvertY=function(i){return i};this.RevertY=function(i){return this.y.invert(i)}}if(this.swap_xy?q.fLogx:q.fLogy){this.logy=true;if(this.scale_ymax<=0){this.scale_ymax=1}else{if((this.zoom_ymin===this.zoom_ymax)&&(this.Dimension()==1)&&this.draw_content){this.scale_ymax*=1.8}}if((this.scale_ymin<=0)&&(this.nbinsy>0)&&(this.Dimension()>1)){for(var o=0;o<this.nbinsy;++o){this.scale_ymin=Math.max(this.scale_ymin,this.GetBinY(o));if(this.scale_ymin>0){break}}}if((this.scale_ymin<=0)&&("ymin_nz" in this)&&(this.ymin_nz>0)&&(this.ymin_nz<0.01*this.ymax)){this.scale_ymin=0.3*this.ymin_nz}if((this.scale_ymin<=0)||(this.scale_ymin>=this.scale_ymax)){this.scale_ymin=0.0003*this.scale_ymax}this.y=c.scaleLog()}else{if(this.y_kind=="time"){this.y=c.scaleTime()}else{this.y=c.scaleLinear()}}this.y.domain([this.ConvertY(this.scale_ymin),this.ConvertY(this.scale_ymax)]).range(this.swap_xy?[0,k]:[p,0]);if(this.y_kind=="time"){this.gry=function(i){return this.y(this.ConvertY(i))}}else{if(this.logy){this.gry=function(i){return(i<this.scale_ymin)?(this.swap_xy?-5:this.y.range()[0]+5):this.y(i)}}else{this.gry=this.y}}this.SetRootPadRange(q)};e.prototype.SetRootPadRange=function(m,j){if(!m||this.options.Same){return}if(j){m.fLogx=m.fLogy=0;m.fUxmin=m.fUymin=-0.9;m.fUxmax=m.fUymax=0.9}else{m.fLogx=(this.swap_xy?this.logy:this.logx)?1:0;m.fUxmin=this.scale_xmin;m.fUxmax=this.scale_xmax;m.fLogy=(this.swap_xy?this.logx:this.logy)?1:0;m.fUymin=this.scale_ymin;m.fUymax=this.scale_ymax}if(m.fLogx){m.fUxmin=b.log10(m.fUxmin);m.fUxmax=b.log10(m.fUxmax)}if(m.fLogy){m.fUymin=b.log10(m.fUymin);m.fUymax=b.log10(m.fUymax)}var l=m.fUxmax-m.fUxmin,o=1-m.fLeftMargin-m.fRightMargin,i=m.fUymax-m.fUymin,k=1-m.fBottomMargin-m.fTopMargin;if(o<=0){o=0.01}if(k<=0){k=0.01}m.fX1=m.fUxmin-l/o*m.fLeftMargin;m.fX2=m.fUxmax+l/o*m.fRightMargin;m.fY1=m.fUymin-i/k*m.fBottomMargin;m.fY2=m.fUymax+i/k*m.fTopMargin};e.prototype.DrawGrids=function(){if(!this.is_main_painter()){return}var l=this.svg_frame().select(".grid_layer");l.selectAll(".xgrid").remove();l.selectAll(".ygrid").remove();var p=this.root_pad(),m=this.frame_height(),i=this.frame_width(),k,o=b.gStyle.fGridStyle,j=(b.gStyle.fGridColor>0)?this.get_color(b.gStyle.fGridColor):"black";if((o<0)||(o>=b.Painter.root_line_styles.length)){o=11}if(p&&p.fGridx&&this.x_handle){k="";for(var q=0;q<this.x_handle.ticks.length;++q){if(this.swap_xy){k+="M0,"+this.x_handle.ticks[q]+"h"+i}else{k+="M"+this.x_handle.ticks[q]+",0v"+m}}if(k.length>0){l.append("svg:path").attr("class","xgrid").attr("d",k).style("stroke",j).style("stroke-width",b.gStyle.fGridWidth).style("stroke-dasharray",b.Painter.root_line_styles[o])}}if(p&&p.fGridy&&this.y_handle){k="";for(var q=0;q<this.y_handle.ticks.length;++q){if(this.swap_xy){k+="M"+this.y_handle.ticks[q]+",0v"+m}else{k+="M0,"+this.y_handle.ticks[q]+"h"+i}}if(k.length>0){l.append("svg:path").attr("class","ygrid").attr("d",k).style("stroke",j).style("stroke-width",b.gStyle.fGridWidth).style("stroke-dasharray",b.Painter.root_line_styles[o])}}};e.prototype.DrawBins=function(){alert("HistPainter.DrawBins not implemented")};e.prototype.AxisAsText=function(i,j){if(i=="x"){if(this.x_kind=="time"){j=this.ConvertX(j)}if(this.x_handle&&("format" in this.x_handle)){return this.x_handle.format(j)}return j.toPrecision(4)}if(i=="y"){if(this.y_kind=="time"){j=this.ConvertY(j)}if(this.y_handle&&("format" in this.y_handle)){return this.y_handle.format(j)}return j.toPrecision(4)}return j.toPrecision(4)};e.prototype.DrawAxes=function(q){if(!this.is_main_painter()||this.options.Same){return}var o=this.svg_frame().select(".axis_layer"),r=this.frame_width(),m=this.frame_height(),k=this.root_pad();this.x_handle=new b.TAxisPainter(this.histo.fXaxis,true);this.x_handle.SetDivId(this.divid,-1);this.x_handle.pad_name=this.pad_name;this.x_handle.SetAxisConfig("xaxis",(this.logx&&(this.x_kind!=="time"))?"log":this.x_kind,this.x,this.xmin,this.xmax,this.scale_xmin,this.scale_xmax);this.x_handle.invert_side=(this.options.AxisPos>=10)||(k.fTickx>1);this.x_handle.has_obstacle=(this.options.Zscale>0);this.y_handle=new b.TAxisPainter(this.histo.fYaxis,true);this.y_handle.SetDivId(this.divid,-1);this.y_handle.pad_name=this.pad_name;this.y_handle.SetAxisConfig("yaxis",(this.logy&&this.y_kind!=="time")?"log":this.y_kind,this.y,this.ymin,this.ymax,this.scale_ymin,this.scale_ymax);this.y_handle.invert_side=((this.options.AxisPos%10)===1)||(k.fTicky>1);var p=this.swap_xy?this.y_handle:this.x_handle,i=this.swap_xy?this.x_handle:this.y_handle;p.DrawAxis(false,o,r,m,p.invert_side?undefined:"translate(0,"+m+")",false,k.fTickx?-m:0,this.options.Axis<0);i.DrawAxis(true,o,r,m,i.invert_side?"translate("+r+",0)":undefined,false,k.fTicky?r:0,this.options.Axis<0);if(q){return}var l=0,j=i.position;if((-0.2*r<j)&&(j<0)){l=-j/r+0.001;this.shrink_frame_left+=l}else{if((j>0)&&(j<0.3*r)&&(this.shrink_frame_left>0)&&(j/r>this.shrink_frame_left)){l=-this.shrink_frame_left;this.shrink_frame_left=0}}if(l!=0){this.frame_painter().Shrink(l,0);this.frame_painter().Redraw();this.CreateXY();this.DrawAxes(true)}};e.prototype.ToggleTitle=function(i){if(!this.is_main_painter()){return false}if(i==="only-check"){return !this.histo.TestBit(b.TH1StatusBits.kNoTitle)}this.histo.InvertBit(b.TH1StatusBits.kNoTitle);this.DrawTitle()};e.prototype.DecomposeTitle=function(){if(!this.histo||!this.histo.fTitle){return}var i=this.histo.fTitle.split(";");if(i.length===3){this.histo.fTitle=i[0];this.histo.fXaxis.fTitle=i[1];this.histo.fYaxis.fTitle=i[2]}};e.prototype.DrawTitle=function(){if(!this.is_main_painter()||this.options.Same){return}var j=this.FindPainterFor(null,"title");var k=(j!==null)?j.GetObject():null;if(k===null){k=this.FindInPrimitives("title")}if((k!==null)&&(k._typename!=="TPaveText")){k=null}var i=!this.histo.TestBit(b.TH1StatusBits.kNoTitle);if(k!==null){k.Clear();if(i){k.AddText(this.histo.fTitle)}if(j){j.Redraw()}}else{if(i&&!j&&(this.histo.fTitle.length>0)){k=b.Create("TPaveText");b.extend(k,{fName:"title",fX1NDC:0.28,fY1NDC:0.94,fX2NDC:0.72,fY2NDC:0.99});k.AddText(this.histo.fTitle);b.Painter.drawPave(this.divid,k)}}};e.prototype.UpdateStatWebCanvas=function(){if(!this.snapid){return}var i=this.FindStat(),j=this.FindPainterFor(i);if(j&&!j.snapid){j.Redraw()}};e.prototype.ToggleStat=function(i){var j=this.FindStat(),k=null;if(!i){i=""}if(j==null){if(i.indexOf("-check")>0){return false}j=this.CreateStat(true)}else{k=this.FindPainterFor(j)}if(i=="only-check"){return k?k.Enabled:false}if(i=="fitpar-check"){return j?j.fOptFit:false}if(i=="fitpar-toggle"){if(!j){return false}j.fOptFit=j.fOptFit?0:1111;if(k){k.Redraw()}return true}if(k){k.Enabled=!k.Enabled;k.Redraw();return k.Enabled}b.draw(this.divid,j,"onpad:"+this.pad_name);return true};e.prototype.IsAxisZoomed=function(i){var j=this.main_painter()||this;return j["zoom_"+i+"min"]!==j["zoom_"+i+"max"]};e.prototype.GetSelectIndex=function(k,s,r){var p=0,o=this.main_painter();if(!o){o=this}var l=this["nbins"+k];if(!l){l=0}if(!r){r=0}var j="GetIndex"+k.toUpperCase(),m=o["zoom_"+k+"min"],q=o["zoom_"+k+"max"];if((m!=q)&&(j in this)){if(s=="left"){p=this[j](m,r)}else{p=this[j](q,r+0.5)}}else{p=(s=="left")?0:l}var i;if(this.histo){i=this.histo["f"+k.toUpperCase()+"axis"]}if(i){if((i.fFirst===i.fLast)||!i.TestBit(b.EAxisBits.kAxisRange)||((i.fFirst<=1)&&(i.fLast>=l))){i=undefined}}if(s=="left"){if(p<0){p=0}if(i&&(i.fFirst>1)&&(p<i.fFirst)){p=i.fFirst-1}}else{if(p>l){p=l}if(i&&(i.fLast<=l)&&(p>i.fLast)){p=i.fLast}}return p};e.prototype.FindStat=function(){if(this.histo.fFunctions!==null){for(var j=0;j<this.histo.fFunctions.arr.length;++j){var k=this.histo.fFunctions.arr[j];if((k._typename=="TPaveStats")&&(k.fName=="stats")){return k}}}return null};e.prototype.IgnoreStatsFill=function(){return !this.histo||(!this.draw_content&&!this.create_stats)||(this.options.Axis>0)};e.prototype.CreateStat=function(k){if(!k&&!this.options.ForceStat){if(this.options.NoStat||this.histo.TestBit(b.TH1StatusBits.kNoStats)||!b.gStyle.AutoStat){return null}if(!this.draw_content||!this.is_main_painter()){return null}}this.create_stats=true;var j=this.FindStat();if(j){return j}var i=b.gStyle;j=b.Create("TPaveStats");b.extend(j,{fName:"stats",fOptStat:this.histo.$custom_stat||i.fOptStat,fOptFit:i.fOptFit,fBorderSize:1});j.fX1NDC=i.fStatX-i.fStatW;j.fY1NDC=i.fStatY-i.fStatH;j.fX2NDC=i.fStatX;j.fY2NDC=i.fStatY;j.fFillColor=i.fStatColor;j.fFillStyle=i.fStatStyle;j.fTextAngle=0;j.fTextSize=i.fStatFontSize;j.fTextAlign=12;j.fTextColor=i.fStatTextColor;j.fTextFont=i.fStatFont;if(this.histo._typename.match(/^TProfile/)||this.histo._typename.match(/^TH2/)){j.fY1NDC=0.67}j.AddText(this.histo.fName);this.AddFunction(j);return j};e.prototype.AddFunction=function(k,j){var i=this.GetObject();if(!i||!k){return}if(!i.fFunctions){i.fFunctions=b.Create("TList")}if(j){i.fFunctions.AddFirst(k)}else{i.fFunctions.Add(k)}};e.prototype.FindFunction=function(l){var j=this.GetObject().fFunctions;if(j===null){return null}for(var k=0;k<j.arr.length;++k){if(j.arr[k]._typename===l){return j.arr[k]}}return null};e.prototype.DrawNextFunction=function(m,o){if(!this.options.Func||!this.histo.fFunctions||(m>=this.histo.fFunctions.arr.length)){return b.CallBack(o)}var l=this.histo.fFunctions.arr[m],i=this.histo.fFunctions.opt[m],k=false,j=this.FindPainterFor(l);if(j===null){if(l._typename==="TPaveText"||l._typename==="TPaveStats"){k=!this.histo.TestBit(b.TH1StatusBits.kNoStats)&&!this.options.NoStat}else{if(l._typename==="TF1"){k=!l.TestBit(b.BIT(9))}else{k=(l._typename!=="TPaletteAxis")}}}if(k){return b.draw(this.divid,l,i,this.DrawNextFunction.bind(this,m+1,o))}this.DrawNextFunction(m+1,o)};e.prototype.UnzoomUserRange=function(p,o,m){if(!this.histo){return false}var l=false,j=this;function k(q){if(!q){return false}if(!q.TestBit(b.EAxisBits.kAxisRange)){return false}if(q.fFirst===q.fLast){return false}if((q.fFirst<=1)&&(q.fLast>=q.fNbins)){return false}q.InvertBit(b.EAxisBits.kAxisRange);return true}function i(r,q){if(j.Dimension()!==r){return false}if((j.options.minimum===-1111)&&(j.options.maximum===-1111)){return false}if(!j.draw_content){return false}j.options.minimum=j.options.maximum=-1111;j.ScanContent(true);return true}if(p&&k(this.histo.fXaxis)){l=true}if(o&&(k(this.histo.fYaxis)||i(1,this.histo))){l=true}if(m&&(k(this.histo.fZaxis)||i(2,this.histo))){l=true}return l};e.prototype.ToggleLog=function(m){var j=this.main_painter()||this,p=this.root_pad();var o=p["fLog"+m];if(!o){var l=this[m+"_kind"];if(this.swap_xy&&m==="x"){l=this["y_kind"]}else{if(this.swap_xy&&m==="y"){l=this["x_kind"]}}if(l==="labels"){return}}var i=this.pad_painter(true),k=this.pad_painter();if(i&&i.snapid&&k&&k._websocket){k.SendWebsocket("OBJEXEC:"+i.snapid+":SetLog"+m+(o?"(0)":"(1)"))}else{p["fLog"+m]=o?0:1;j.RedrawPad()}};e.prototype.Zoom=function(s,t,u,x,z,A){if(s==="x"){s=t;t=u;u=undefined}else{if(s==="y"){x=u;u=t;s=t=undefined}else{if(s==="z"){z=t;A=u;s=t=u=undefined}}}var o=this.main_painter(),l=(s!==t),k=(u!==x),j=(z!==A),r=false,q=false,p=false;if(l){var w=0,y=o.xmin;if(s<=y){s=y;w++}if(t>=o.xmax){t=o.xmax;w++}if(w===2){l=false;r=true}}else{r=(s===t)&&(s===0)}if(k){var w=0,B=o.ymin;if(u<=B){u=B;w++}if(x>=o.ymax){x=o.ymax;w++}if(w===2){k=false;q=true}}else{q=(u===x)&&(u===0)}if(j){var w=0,i=o.zmin;if(z<=i){z=i;w++}if(A>=o.zmax){A=o.zmax;w++}if(w===2){j=false;p=true}}else{p=(z===A)&&(z===0)}var m=false;if(l||k||j){o.ForEachPainter(function(C){if(l&&C.CanZoomIn("x",s,t)){o.zoom_xmin=s;o.zoom_xmax=t;m=true;l=false}if(k&&C.CanZoomIn("y",u,x)){o.zoom_ymin=u;o.zoom_ymax=x;m=true;k=false}if(j&&C.CanZoomIn("z",z,A)){o.zoom_zmin=z;o.zoom_zmax=A;m=true;j=false}})}if(r||q||p){if(r){if(o.zoom_xmin!==o.zoom_xmax){m=true}o.zoom_xmin=o.zoom_xmax=0}if(q){if(o.zoom_ymin!==o.zoom_ymax){m=true}o.zoom_ymin=o.zoom_ymax=0}if(p){if(o.zoom_zmin!==o.zoom_zmax){m=true}o.zoom_zmin=o.zoom_zmax=0}if(!m){m=o.UnzoomUserRange(r,q,p);var v=this.pad_painter(true);if(v&&v.painters){v.painters.forEach(function(C){if(C&&(C!==o)&&(typeof C.UnzoomUserRange=="function")){if(C.UnzoomUserRange(r,q,p)){m=true}}})}}}if(m){this.RedrawPad()}return m};e.prototype.Unzoom=function(m,k,j){if(typeof m==="undefined"){m=true;k=true;j=true}else{if(typeof m==="string"){j=m.indexOf("z")>=0;k=m.indexOf("y")>=0;m=m.indexOf("x")>=0}}var i=this.zoom_changed_interactive;if(m||k||m){this.zoom_changed_interactive=2}var l=this.Zoom(m?0:undefined,m?0:undefined,k?0:undefined,k?0:undefined,j?0:undefined,j?0:undefined);if((m||k||m)&&!l){this.zoom_changed_interactive=(!isNaN(i)&&(i>0))?i-1:0}return l};e.prototype.clearInteractiveElements=function(){b.Painter.closeMenu();if(this.zoom_rect!=null){this.zoom_rect.remove();this.zoom_rect=null}this.zoom_kind=0;this.SwitchTooltip(true)};e.prototype.mouseDoubleClick=function(){c.event.preventDefault();var i=c.mouse(this.svg_frame().node());this.clearInteractiveElements();var j="xyz";if((i[0]<0)||(i[0]>this.frame_width())){j=this.swap_xy?"x":"y"}else{if((i[1]<0)||(i[1]>this.frame_height())){j=this.swap_xy?"y":"x"}}this.Unzoom(j)};e.prototype.FindAlternativeClickHandler=function(o){var i=this.pad_painter(true);if(!i){return false}var m={x:o[0],y:o[1],painters:true,disabled:true,click_handler:true};var l=i.GetTooltips(m);for(var j=0;j<l.length;++j){if(l[j]&&(typeof l[j].click_handler=="function")){l[j].click_handler(l[j]);return true}}return false};e.prototype.startRectSel=function(){if(this.zoom_kind>100){return}if((c.event.which||c.event.button)!==1){return}c.event.preventDefault();var k=c.mouse(this.svg_frame().node());if(this.FindAlternativeClickHandler(k)){return}this.clearInteractiveElements();this.zoom_origin=k;var i=this.frame_width(),j=this.frame_height();this.zoom_curr=[Math.max(0,Math.min(i,this.zoom_origin[0])),Math.max(0,Math.min(j,this.zoom_origin[1]))];if((this.zoom_origin[0]<0)||(this.zoom_origin[0]>i)){this.zoom_kind=3;this.zoom_origin[0]=0;this.zoom_origin[1]=this.zoom_curr[1];this.zoom_curr[0]=i;this.zoom_curr[1]+=1}else{if((this.zoom_origin[1]<0)||(this.zoom_origin[1]>j)){this.zoom_kind=2;this.zoom_origin[0]=this.zoom_curr[0];this.zoom_origin[1]=0;this.zoom_curr[0]+=1;this.zoom_curr[1]=j}else{this.zoom_kind=1;this.zoom_origin[0]=this.zoom_curr[0];this.zoom_origin[1]=this.zoom_curr[1]}}c.select(window).on("mousemove.zoomRect",this.moveRectSel.bind(this)).on("mouseup.zoomRect",this.endRectSel.bind(this),true);this.zoom_rect=null;this.SwitchTooltip(false);c.event.stopPropagation()};e.prototype.moveRectSel=function(){if((this.zoom_kind==0)||(this.zoom_kind>100)){return}c.event.preventDefault();var i=c.mouse(this.svg_frame().node());i[0]=Math.max(0,Math.min(this.frame_width(),i[0]));i[1]=Math.max(0,Math.min(this.frame_height(),i[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=i[0];this.zoom_curr[1]=i[1];break;case 2:this.zoom_curr[0]=i[0];break;case 3:this.zoom_curr[1]=i[1];break}if(this.zoom_rect===null){this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("pointer-events","none")}this.zoom_rect.attr("x",Math.min(this.zoom_origin[0],this.zoom_curr[0])).attr("y",Math.min(this.zoom_origin[1],this.zoom_curr[1])).attr("width",Math.abs(this.zoom_curr[0]-this.zoom_origin[0])).attr("height",Math.abs(this.zoom_curr[1]-this.zoom_origin[1]))};e.prototype.endRectSel=function(){if((this.zoom_kind==0)||(this.zoom_kind>100)){return}c.event.preventDefault();c.select(window).on("mousemove.zoomRect",null).on("mouseup.zoomRect",null);var l=c.mouse(this.svg_frame().node()),p=[true,true];l[0]=Math.max(0,Math.min(this.frame_width(),l[0]));l[1]=Math.max(0,Math.min(this.frame_height(),l[1]));switch(this.zoom_kind){case 1:this.zoom_curr[0]=l[0];this.zoom_curr[1]=l[1];break;case 2:this.zoom_curr[0]=l[0];p[1]=false;break;case 3:this.zoom_curr[1]=l[1];p[0]=false;break}var j,r,u,k,q=false,v=this.swap_xy?1:0,t=1-v;if(p[v]&&(Math.abs(this.zoom_curr[v]-this.zoom_origin[v])>10)){j=Math.min(this.RevertX(this.zoom_origin[v]),this.RevertX(this.zoom_curr[v]));r=Math.max(this.RevertX(this.zoom_origin[v]),this.RevertX(this.zoom_curr[v]));q=true}if(p[t]&&(Math.abs(this.zoom_curr[t]-this.zoom_origin[t])>10)){u=Math.min(this.RevertY(this.zoom_origin[t]),this.RevertY(this.zoom_curr[t]));k=Math.max(this.RevertY(this.zoom_origin[t]),this.RevertY(this.zoom_curr[t]));q=true}var o=this.zoom_kind,i=(o===1)?{x:this.zoom_origin[0],y:this.zoom_origin[1]}:null;this.clearInteractiveElements();if(q){this.zoom_changed_interactive=2;this.Zoom(j,r,u,k)}else{switch(o){case 1:var s=this.frame_painter();if(s){s.ProcessFrameClick(i)}break;case 2:this.pad_painter().SelectObjectPainter(this.x_handle);break;case 3:this.pad_painter().SelectObjectPainter(this.y_handle);break}}this.zoom_kind=0};e.prototype.startTouchZoom=function(){if(this.zoom_kind!=0){c.event.preventDefault();c.event.stopPropagation();return}var j=c.touches(this.svg_frame().node());this.touch_cnt+=1;if(j.length==1){var l=new Date();var o=l.getTime()-this.last_touch.getTime();this.last_touch=l;if((o<300)&&(this.zoom_curr!=null)&&(Math.abs(this.zoom_curr[0]-j[0][0])<30)&&(Math.abs(this.zoom_curr[1]-j[0][1])<30)){c.event.preventDefault();c.event.stopPropagation();this.clearInteractiveElements();this.Unzoom("xyz");this.last_touch=new Date(0);this.svg_frame().on("touchcancel",null).on("touchend",null,true)}else{if(b.gStyle.ContextMenu){this.zoom_curr=j[0];this.svg_frame().on("touchcancel",this.endTouchSel.bind(this)).on("touchend",this.endTouchSel.bind(this));c.event.preventDefault();c.event.stopPropagation()}}}if((j.length!=2)||!b.gStyle.Zooming||!b.gStyle.ZoomTouch){return}c.event.preventDefault();c.event.stopPropagation();this.clearInteractiveElements();this.svg_frame().on("touchcancel",null).on("touchend",null);var i=j[0],p=j[1],k=this.frame_width(),m=this.frame_height();this.zoom_curr=[Math.min(i[0],p[0]),Math.min(i[1],p[1])];this.zoom_origin=[Math.max(i[0],p[0]),Math.max(i[1],p[1])];if((this.zoom_curr[0]<0)||(this.zoom_curr[0]>k)){this.zoom_kind=103;this.zoom_curr[0]=0;this.zoom_origin[0]=k}else{if((this.zoom_origin[1]>m)||(this.zoom_origin[1]<0)){this.zoom_kind=102;this.zoom_curr[1]=0;this.zoom_origin[1]=m}else{this.zoom_kind=101}}this.SwitchTooltip(false);this.zoom_rect=this.svg_frame().append("rect").attr("class","zoom").attr("id","zoomRect").attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);c.select(window).on("touchmove.zoomRect",this.moveTouchSel.bind(this)).on("touchcancel.zoomRect",this.endTouchSel.bind(this)).on("touchend.zoomRect",this.endTouchSel.bind(this))};e.prototype.moveTouchSel=function(){if(this.zoom_kind<100){return}c.event.preventDefault();var j=c.touches(this.svg_frame().node());if(j.length!=2){return this.clearInteractiveElements()}var i=j[0],k=j[1];if(this.zoom_kind!=103){this.zoom_curr[0]=Math.min(i[0],k[0]);this.zoom_origin[0]=Math.max(i[0],k[0])}if(this.zoom_kind!=102){this.zoom_curr[1]=Math.min(i[1],k[1]);this.zoom_origin[1]=Math.max(i[1],k[1])}this.zoom_rect.attr("x",this.zoom_curr[0]).attr("y",this.zoom_curr[1]).attr("width",this.zoom_origin[0]-this.zoom_curr[0]).attr("height",this.zoom_origin[1]-this.zoom_curr[1]);if((this.zoom_origin[0]-this.zoom_curr[0]>10)||(this.zoom_origin[1]-this.zoom_curr[1]>10)){this.SwitchTooltip(false)}c.event.stopPropagation()};e.prototype.endTouchSel=function(){this.svg_frame().on("touchcancel",null).on("touchend",null);if(this.zoom_kind===0){c.event.preventDefault();var j=new Date();var r=j.getTime()-this.last_touch.getTime();if((r>500)&&(r<2000)&&!this.frame_painter().IsTooltipShown()){this.ShowContextMenu("main",{clientX:this.zoom_curr[0],clientY:this.zoom_curr[1]});this.last_touch=new Date(0)}else{this.clearInteractiveElements()}}if(this.zoom_kind<100){return}c.event.preventDefault();c.select(window).on("touchmove.zoomRect",null).on("touchend.zoomRect",null).on("touchcancel.zoomRect",null);var i,q,s,k,p=false,l=this.swap_xy?1:0,o=1-l,m=[true,true];if(this.zoom_kind===102){m[1]=false}if(this.zoom_kind===103){m[0]=false}if(m[l]&&(Math.abs(this.zoom_curr[l]-this.zoom_origin[l])>10)){i=Math.min(this.RevertX(this.zoom_origin[l]),this.RevertX(this.zoom_curr[l]));q=Math.max(this.RevertX(this.zoom_origin[l]),this.RevertX(this.zoom_curr[l]));p=true}if(m[o]&&(Math.abs(this.zoom_curr[o]-this.zoom_origin[o])>10)){s=Math.min(this.RevertY(this.zoom_origin[o]),this.RevertY(this.zoom_curr[o]));k=Math.max(this.RevertY(this.zoom_origin[o]),this.RevertY(this.zoom_curr[o]));p=true}this.clearInteractiveElements();this.last_touch=new Date(0);if(p){this.zoom_changed_interactive=2;this.Zoom(i,q,s,k)}c.event.stopPropagation()};e.prototype.AllowDefaultYZooming=function(){if(this.Dimension()>1){return true}if(this.draw_content){return false}var l=this.pad_painter(true);if(l&&l.painters){for(var j=0;j<l.painters.length;++j){var i=l.painters[j];if((i!==this)&&i.wheel_zoomy!==undefined){return i.wheel_zoomy}}}return false};e.prototype.AnalyzeMouseWheelEvent=function(i,v,k,q){v.min=v.max=undefined;v.changed=false;if(q&&v.ignore){return}var u=0,w=1,s=1;if("dleft" in v){w=v.dleft;u=1}if("dright" in v){s=v.dright;u=1}if("delta" in v){u=v.delta}else{if(i&&i.wheelDelta!==undefined){u=-i.wheelDelta}else{if(i&&i.deltaY!==undefined){u=i.deltaY}else{if(i&&i.detail!==undefined){u=i.detail}}}}if(u===0){return}u=(u<0)?-0.2:0.2;w*=u;s*=u;var j=v.min=this["scale_"+v.name+"min"],m=v.max=this["scale_"+v.name+"max"],l=this[v.name+"min"],t=this[v.name+"max"];if((v.min===v.max)&&(u<0)){v.min=l;v.max=t}if(v.min>=v.max){return}if((k>0)&&(k<1)){if(this["log"+v.name]){var r=(v.min>0)?b.log10(v.max/v.min):2;if(r>10){r=10}else{if(r<0.01){r=0.01}}v.min=v.min/Math.pow(10,r*w*k);v.max=v.max*Math.pow(10,r*s*(1-k))}else{var o=(v.max-v.min),p=o;if(w>0){o=1.001*o/(1-w)}v.min+=-w*k*o;if(s>0){p=1.001*p/(1-s)}v.max-=-s*(1-k)*p}if(v.min>=v.max){v.min=v.max=undefined}else{if(w!==s){if(((v.min<l)&&(j===l))||((v.max>t)&&(m==t))){v.min=v.max=undefined}}}}else{v.min=v.max=undefined}v.changed=((v.min!==undefined)&&(v.max!==undefined))};e.prototype.mouseWheel=function(){c.event.stopPropagation();c.event.preventDefault();this.clearInteractiveElements();var l={name:"x",ignore:false},k={name:"y",ignore:!this.AllowDefaultYZooming()},m=c.mouse(this.svg_frame().node()),i=this.frame_width(),j=this.frame_height();this.AnalyzeMouseWheelEvent(c.event,this.swap_xy?k:l,m[0]/i,(m[1]>=0)&&(m[1]<=j));this.AnalyzeMouseWheelEvent(c.event,this.swap_xy?l:k,1-m[1]/j,(m[0]>=0)&&(m[0]<=i));this.Zoom(l.min,l.max,k.min,k.max);if(l.changed||k.changed){this.zoom_changed_interactive=2}};e.prototype.ShowAxisStatus=function(l){var k=this.GetShowStatusFunc();if(!k){return}var o=this.histo?this.histo["f"+l.toUpperCase()+"axis"]:null;var r=l,j="TAxis";if(o){r=o.fName;j=o.fTitle||"histogram TAxis object"}var i=c.mouse(this.svg_frame().node());var q=(l=="x")?0:1;if(this.swap_xy){q=1-q}var p=(l=="x")?this.RevertX(i[q]):this.RevertY(i[q]);k(r,j,l+" : "+this.AxisAsText(l,p),i[0].toFixed(0)+","+i[1].toFixed(0))};e.prototype.AddInteractive=function(){if((!b.gStyle.Zooming&&!b.gStyle.ContextMenu)||!this.is_main_painter()){return}var i=this.svg_frame();if(i.empty()||i.property("interactive_set")){return}this.AddKeysHandler();this.last_touch=new Date(0);this.zoom_kind=0;this.zoom_rect=null;this.zoom_origin=null;this.zoom_curr=null;this.touch_cnt=0;if(b.gStyle.Zooming){if(b.gStyle.ZoomMouse){i.on("mousedown",this.startRectSel.bind(this));i.on("dblclick",this.mouseDoubleClick.bind(this))}if(b.gStyle.ZoomWheel){i.on("wheel",this.mouseWheel.bind(this))}}if(b.touches&&((b.gStyle.Zooming&&b.gStyle.ZoomTouch)||b.gStyle.ContextMenu)){i.on("touchstart",this.startTouchZoom.bind(this))}if(b.gStyle.ContextMenu){if(b.touches){i.selectAll(".xaxis_container").on("touchstart",this.startTouchMenu.bind(this,"x"));i.selectAll(".yaxis_container").on("touchstart",this.startTouchMenu.bind(this,"y"))}i.on("contextmenu",this.ShowContextMenu.bind(this));i.selectAll(".xaxis_container").on("contextmenu",this.ShowContextMenu.bind(this,"x"));i.selectAll(".yaxis_container").on("contextmenu",this.ShowContextMenu.bind(this,"y"))}i.selectAll(".xaxis_container").on("mousemove",this.ShowAxisStatus.bind(this,"x"));i.selectAll(".yaxis_container").on("mousemove",this.ShowAxisStatus.bind(this,"y"));i.property("interactive_set",true)};e.prototype.AddKeysHandler=function(){if(this.keys_handler||!this.is_main_painter()||b.BatchMode||(typeof window=="undefined")){return}this.keys_handler=this.ProcessKeyPress.bind(this);window.addEventListener("keydown",this.keys_handler,false)};e.prototype.ProcessKeyPress=function(p){var i=this.select_main();if(i.empty()){return}var o=i.attr("frame_active");if(o&&o!=="true"){return}var k="";switch(p.keyCode){case 33:k="PageUp";break;case 34:k="PageDown";break;case 37:k="ArrowLeft";break;case 38:k="ArrowUp";break;case 39:k="ArrowRight";break;case 40:k="ArrowDown";break;case 42:k="PrintScreen";break;case 106:k="*";break;default:return false}if(p.shiftKey){k="Shift "+k}if(p.altKey){k="Alt "+k}if(p.ctrlKey){k="Ctrl "+k}var m={name:"x",dleft:0,dright:0};switch(k){case"ArrowLeft":m.dleft=-1;m.dright=1;break;case"ArrowRight":m.dleft=1;m.dright=-1;break;case"Ctrl ArrowLeft":m.dleft=m.dright=-1;break;case"Ctrl ArrowRight":m.dleft=m.dright=1;break;case"ArrowUp":m.name="y";m.dleft=1;m.dright=-1;break;case"ArrowDown":m.name="y";m.dleft=-1;m.dright=1;break;case"Ctrl ArrowUp":m.name="y";m.dleft=m.dright=1;break;case"Ctrl ArrowDown":m.name="y";m.dleft=m.dright=-1;break}if(m.dleft||m.dright){if(!b.gStyle.Zooming){return false}if(this.mode3d&&(k.indexOf("Ctrl")!==0)){return false}this.AnalyzeMouseWheelEvent(null,m,0.5);this.Zoom(m.name,m.min,m.max);if(m.changed){this.zoom_changed_interactive=2}p.stopPropagation();p.preventDefault()}else{var j=this.pad_painter(true),l=j?j.FindButton(k):"";if(l){j.PadButtonClick(l);p.stopPropagation();p.preventDefault()}}return true};e.prototype.ShowContextMenu=function(q,x,r){if(("zoom_kind" in this)&&(this.zoom_kind>100)){return}var v=this,s=false,t=null;if(!x){c.event.preventDefault();c.event.stopPropagation();x=c.event;if(q===undefined){var j=c.mouse(this.svg_frame().node()),p=c.touches(this.svg_frame().node()),m=this.pad_painter(true),i=null,l=null;t=this.frame_painter();if(p.length===1){i={x:p[0][0],y:p[0][1],touch:true}}else{if(j.length===2){i={x:j[0],y:j[1],touch:false}}}if((i!==null)&&(m!==null)){i.painters=true;var k=m.GetTooltips(i),w=1000;for(var o=0;o<k.length;++o){if(k[o]&&k[o].menu){var u=("menu_dist" in k[o])?k[o].menu_dist:7;if(u<w){l=k[o].painter;w=u}}}}if(l!==null){v=l}else{if(t!==null){q="frame"}}if(i!==null){s=(i.x>0)&&(i.x<20)&&(i.y>0)&&(i.y<20)}if(t){t.SetLastEventPos(i)}}}v.ctx_menu_evnt=x;b.Painter.createMenu(v,function(z){var y=z.painter.FillContextMenu(z,q,r);if(t&&(!y||(s&&(q!=="frame")))){y=t.FillContextMenu(z)}if(y){z.painter.FillObjectExecMenu(z,q,function(){z.painter.SwitchTooltip(false);z.show(z.painter.ctx_menu_evnt,z.painter.SwitchTooltip.bind(z.painter,true))})}})};e.prototype.ChangeUserRange=function(i){var m=this.histo["f"+i+"axis"];if(!m){return}var l="[1,"+m.fNbins+"]";if(m.TestBit(b.EAxisBits.kAxisRange)){l="["+m.fFirst+","+m.fLast+"]"}var k=prompt("Enter user range for axis "+i+" like [1,"+m.fNbins+"]",l);if(k==null){return}k=JSON.parse(k);if(!k||(k.length!=2)||isNaN(k[0])||isNaN(k[1])){return}m.fFirst=parseInt(k[0]);m.fLast=parseInt(k[1]);var j=(m.fFirst<m.fLast)&&(m.fFirst>=1)&&(m.fLast<=m.fNbins);if(j!=m.TestBit(b.EAxisBits.kAxisRange)){m.InvertBit(b.EAxisBits.kAxisRange)}this.Redraw()};e.prototype.FillContextMenu=function(o,l,m){this.clearInteractiveElements();if((l=="x")||(l=="y")||(l=="z")){var j=this.histo.fXaxis;if(l=="y"){j=this.histo.fYaxis}else{if(l=="z"){j=m?m:this.histo.fZaxis}}o.add("header: "+l.toUpperCase()+" axis");o.add("Unzoom",this.Unzoom.bind(this,l));o.addchk(this.options["Log"+l],"SetLog"+l,this.ToggleLog.bind(this,l));o.addchk(j.TestBit(b.EAxisBits.kMoreLogLabels),"More log",function(){j.InvertBit(b.EAxisBits.kMoreLogLabels);this.RedrawPad()});o.addchk(j.TestBit(b.EAxisBits.kNoExponent),"No exponent",function(){j.InvertBit(b.EAxisBits.kNoExponent);this.RedrawPad()});if((l==="z")&&(this.options.Zscale>0)){if(this.FillPaletteMenu){this.FillPaletteMenu(o)}}if(j!=null){o.add("sub:Labels");o.addchk(j.TestBit(b.EAxisBits.kCenterLabels),"Center",function(){j.InvertBit(b.EAxisBits.kCenterLabels);this.RedrawPad()});o.addchk(j.TestBit(b.EAxisBits.kLabelsVert),"Rotate",function(){j.InvertBit(b.EAxisBits.kLabelsVert);this.RedrawPad()});this.AddColorMenuEntry(o,"Color",j.fLabelColor,function(p){j.fLabelColor=parseInt(p);this.RedrawPad()});this.AddSizeMenuEntry(o,"Offset",0,0.1,0.01,j.fLabelOffset,function(p){j.fLabelOffset=parseFloat(p);this.RedrawPad()});this.AddSizeMenuEntry(o,"Size",0.02,0.11,0.01,j.fLabelSize,function(p){j.fLabelSize=parseFloat(p);this.RedrawPad()});o.add("endsub:");o.add("sub:Title");o.add("SetTitle",function(){var p=prompt("Enter axis title",j.fTitle);if(p!==null){j.fTitle=p;this.RedrawPad()}});o.addchk(j.TestBit(b.EAxisBits.kCenterTitle),"Center",function(){j.InvertBit(b.EAxisBits.kCenterTitle);this.RedrawPad()});o.addchk(j.TestBit(b.EAxisBits.kRotateTitle),"Rotate",function(){j.InvertBit(b.EAxisBits.kRotateTitle);this.RedrawPad()});this.AddColorMenuEntry(o,"Color",j.fTitleColor,function(p){j.fTitleColor=parseInt(p);this.RedrawPad()});this.AddSizeMenuEntry(o,"Offset",0,3,0.2,j.fTitleOffset,function(p){j.fTitleOffset=parseFloat(p);this.RedrawPad()});this.AddSizeMenuEntry(o,"Size",0.02,0.11,0.01,j.fTitleSize,function(p){j.fTitleSize=parseFloat(p);this.RedrawPad()});o.add("endsub:")}o.add("sub:Ticks");this.AddColorMenuEntry(o,"Color",j.fLineColor,function(p){j.fLineColor=parseInt(p);this.RedrawPad()});this.AddColorMenuEntry(o,"Color",j.fAxisColor,function(p){j.fAxisColor=parseInt(p);this.RedrawPad()});this.AddSizeMenuEntry(o,"Size",-0.05,0.055,0.01,j.fTickLength,function(p){j.fTickLength=parseFloat(p);this.RedrawPad()});o.add("endsub:");return true}if(l=="frame"){var k=this.frame_painter();if(k){return k.FillContextMenu(o)}}o.add("header:"+this.histo._typename+"::"+this.histo.fName);if(this.draw_content){o.addchk(this.ToggleStat("only-check"),"Show statbox",function(){this.ToggleStat()});if(this.Dimension()==1){o.add("User range X","X",this.ChangeUserRange)}else{o.add("sub:User ranges");o.add("X","X",this.ChangeUserRange);o.add("Y","Y",this.ChangeUserRange);if(this.Dimension()>2){o.add("Z","Z",this.ChangeUserRange)}o.add("endsub:")}if(typeof this.FillHistContextMenu=="function"){this.FillHistContextMenu(o)}}if((this.options.Lego>0)||(this.options.Surf>0)||(this.Dimension()===3)){if(o.size()>0){o.add("separator")}var i=this.main_painter()||this;o.addchk(i.tooltip_allowed,"Show tooltips",function(){i.tooltip_allowed=!i.tooltip_allowed});o.addchk(i.enable_highlight,"Highlight bins",function(){i.enable_highlight=!i.enable_highlight;if(!i.enable_highlight&&i.BinHighlight3D&&i.mode3d){i.BinHighlight3D(null)}});o.addchk(i.options.FrontBox,"Front box",function(){i.options.FrontBox=!i.options.FrontBox;if(i.Render3D){i.Render3D()}});o.addchk(i.options.BackBox,"Back box",function(){i.options.BackBox=!i.options.BackBox;if(i.Render3D){i.Render3D()}});if(this.draw_content){o.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.RedrawPad()});if((this.options.Lego==12)||(this.options.Lego==14)){o.addchk(this.options.Zscale,"Z scale",function(){this.ToggleColz()});if(this.FillPaletteMenu){this.FillPaletteMenu(o)}}}if(i.control&&typeof i.control.reset==="function"){o.add("Reset camera",function(){i.control.reset()})}}this.FillAttContextMenu(o);if(this.histogram_updated&&this.zoom_changed_interactive){o.add("Let update zoom",function(){this.zoom_changed_interactive=0})}return true};e.prototype.ButtonClick=function(i){if(!this.is_main_painter()){return false}switch(i){case"ToggleZoom":if((this.zoom_xmin!==this.zoom_xmax)||(this.zoom_ymin!==this.zoom_ymax)||(this.zoom_zmin!==this.zoom_zmax)){this.Unzoom();return true}if(this.draw_content&&(typeof this.AutoZoom==="function")){this.AutoZoom();return true}break;case"ToggleLogX":this.ToggleLog("x");break;case"ToggleLogY":this.ToggleLog("y");break;case"ToggleLogZ":this.ToggleLog("z");break;case"ToggleStatBox":this.ToggleStat();return true;break}return false};e.prototype.FillToolbar=function(){var i=this.pad_painter(true);if(i===null){return}i.AddButton(b.ToolbarIcons.auto_zoom,"Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *");i.AddButton(b.ToolbarIcons.arrow_right,"Toggle log x","ToggleLogX","PageDown");i.AddButton(b.ToolbarIcons.arrow_up,"Toggle log y","ToggleLogY","PageUp");if(this.Dimension()>1){i.AddButton(b.ToolbarIcons.arrow_diag,"Toggle log z","ToggleLogZ")}if(this.draw_content){i.AddButton(b.ToolbarIcons.statbox,"Toggle stat box","ToggleStatBox")}};e.prototype.Get3DToolTip=function(i){var j={bin:i,name:this.GetObject().fName,title:this.GetObject().fTitle};switch(this.Dimension()){case 1:j.ix=i;j.iy=1;j.value=this.histo.getBinContent(j.ix);j.error=this.histo.getBinError(i);j.lines=this.GetBinTips(i-1);break;case 2:j.ix=i%(this.nbinsx+2);j.iy=(i-j.ix)/(this.nbinsx+2);j.value=this.histo.getBinContent(j.ix,j.iy);j.error=this.histo.getBinError(i);j.lines=this.GetBinTips(j.ix-1,j.iy-1);break;case 3:j.ix=i%(this.nbinsx+2);j.iy=((i-j.ix)/(this.nbinsx+2))%(this.nbinsy+2);j.iz=(i-j.ix-j.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2);j.value=this.GetObject().getBinContent(j.ix,j.iy,j.iz);j.error=this.histo.getBinError(i);j.lines=this.GetBinTips(j.ix-1,j.iy-1,j.iz-1);break}return j};e.prototype.CreateContour=function(p,j,m,l){if(p<1){p=b.gStyle.fNumberContours}this.fContour=[];this.colzmin=j;this.colzmax=m;if(this.root_pad().fLogz){if(this.colzmax<=0){this.colzmax=1}if(this.colzmin<=0){if((l===undefined)||(l<=0)){this.colzmin=0.0001*this.colzmax}else{this.colzmin=((l<3)||(l>100))?0.3*l:1}}if(this.colzmin>=this.colzmax){this.colzmin=0.0001*this.colzmax}var k=Math.log(this.colzmin)/Math.log(10),o=Math.log(this.colzmax)/Math.log(10),i=(o-k)/p;this.fContour.push(this.colzmin);for(var q=1;q<p;q++){this.fContour.push(Math.exp((k+i*q)*Math.log(10)))}this.fContour.push(this.colzmax);this.fCustomContour=true}else{if((this.colzmin===this.colzmax)&&(this.colzmin!==0)){this.colzmax+=0.01*Math.abs(this.colzmax);this.colzmin-=0.01*Math.abs(this.colzmin)}var i=(this.colzmax-this.colzmin)/p;for(var q=0;q<=p;q++){this.fContour.push(this.colzmin+i*q)}}if(this.Dimension()<3){this.zmin=this.colzmin;this.zmax=this.colzmax}return this.fContour};e.prototype.GetContour=function(){if(this.fContour){return this.fContour}var i=this.main_painter();if((i!==this)&&i.fContour){this.fContour=i.fContour;this.fCustomContour=i.fCustomContour;this.colzmin=i.colzmin;this.colzmax=i.colzmax;return this.fContour}var k=this.GetObject(),o=b.gStyle.fNumberContours,j=this.minbin,m=this.maxbin,l=this.minposbin;if(j===m){j=this.gminbin;m=this.gmaxbin;l=this.gminposbin}if(k.fContour){o=k.fContour.length}if((this.options.minimum!==-1111)&&(this.options.maximum!=-1111)){j=this.options.minimum;m=this.options.maximum}if(this.zoom_zmin!=this.zoom_zmax){j=this.zoom_zmin;m=this.zoom_zmax}if(k.fContour&&(k.fContour.length>1)&&k.TestBit(b.TH1StatusBits.kUserContour)){this.fContour=b.clone(k.fContour);this.fCustomContour=true;this.colzmin=j;this.colzmax=m;if(m>this.fContour[this.fContour.length-1]){this.fContour.push(m)}if(this.Dimension()<3){this.zmin=this.colzmin;this.zmax=this.colzmax}return this.fContour}this.fCustomContour=false;return this.CreateContour(o,j,m,l)};e.prototype.getContourIndex=function(j){var o=this.GetContour();if(this.fCustomContour){var i=0,m=o.length-1,k;if(j<o[0]){return -1}if(j>=o[m]){return m}while(i<m-1){k=Math.round((i+m)/2);if(o[k]>j){m=k}else{i=k}}return i}if(j<this.colzmin){return(this.options.Color===11)?0:-1}if(j===this.colzmin){return((this.colzmin!=0)||(this.options.Color===11)||this.IsTH2Poly())?0:-1}return Math.floor(0.01+(j-this.colzmin)*(o.length-1)/(this.colzmax-this.colzmin))};e.prototype.getContourColor=function(k,o){var j=this.getContourIndex(k);if(j<0){return null}var m=this.GetContour(),i=this.GetPalette(),l=i.calcColorIndex(j,m.length);return o?l:i.getColor(l)};e.prototype.GetPalette=function(j){if(!this.fPalette||j){var i=this.options.Palette?null:this.pad_painter();this.fPalette=(i&&i.CanvasPalette)?i.CanvasPalette:b.Painter.GetColorPalette(this.options.Palette)}return this.fPalette};e.prototype.FillPaletteMenu=function(k){var j=this.options.Palette;if((j===null)||(j===0)){j=b.gStyle.Palette}function l(m){this.options.Palette=parseInt(m);this.GetPalette(true);this.Redraw()}function i(p,m,o){k.addchk((p===j)||o,"<nobr>"+m+"</nobr>",p,l)}k.add("sub:Palette");i(50,"ROOT 5",(j>=10)&&(j<51));i(51,"Deep Sea");i(52,"Grayscale",(j>0)&&(j<10));i(53,"Dark body radiator");i(54,"Two-color hue");i(55,"Rainbow");i(56,"Inverted dark body radiator");i(57,"Bird",(j>112));i(58,"Cubehelix");i(59,"Green Red Violet");i(60,"Blue Red Yellow");i(61,"Ocean");i(62,"Color Printable On Grey");i(63,"Alpine");i(64,"Aquamarine");i(65,"Army");i(66,"Atlantic");k.add("endsub:")};e.prototype.DrawColorPalette=function(m,q,p){if(!this.is_main_painter()){return null}var j=this.FindFunction("TPaletteAxis"),l=this.FindPainterFor(j);if(this._can_move_colz){p=true;delete this._can_move_colz}if(!l&&!j){l=this.FindPainterFor(undefined,undefined,"TPaletteAxis");if(l){j=l.GetObject();this.AddFunction(j,true)}}if(!m){if(l){l.Enabled=false;l.RemoveDrawG()}return null}if(!j){j=b.Create("TPave");b.extend(j,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:b.Create("TGaxis"),fX1NDC:0.91,fX2NDC:0.95,fY1NDC:0.1,fY2NDC:0.9,fInit:1});b.extend(j.fAxis,{fTitle:this.GetObject().fZaxis.fTitle,fChopt:"+",fLineColor:1,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:0.04,fTextAlign:11,fTextColor:1,fTextFont:42});this.AddFunction(j,true);p=true}else{if(j.fAxis){if(!j.fAxis.fChopt){j.fAxis.fChopt="+"}if(!j.fAxis.fNdiv){j.fAxis.fNdiv=12}if(!j.fAxis.fLabelOffset){j.fAxis.fLabelOffset=0.005}}}var k=this.frame_painter();if(p){j.fX2NDC=k.fX2NDC+0.01+(j.fX2NDC-j.fX1NDC);j.fX1NDC=k.fX2NDC+0.01;j.fY1NDC=k.fY1NDC;j.fY2NDC=k.fY2NDC}var i="";if(q){i+=";postpone"}if(p&&!this.do_redraw_palette){i+=";canmove"}if(l===null){var o=this.CurrentPadName(this.pad_name);l=b.draw(this.divid,j,i);this.CurrentPadName(o)}else{l.Enabled=true;l.DrawPave(i)}l.Redraw=function(){};if((j.fX1NDC-0.005<k.fX2NDC)&&!this.do_redraw_palette&&p){this.do_redraw_palette=true;k.fX2NDC=j.fX1NDC-0.01;k.Redraw();if(!q){this.Redraw()}delete this.do_redraw_palette}return l};e.prototype.ToggleColz=function(){if(this.options.Zscale>0){this.options.Zscale=0}else{this.options.Zscale=1}this.DrawColorPalette(this.options.Zscale>0,false,true)};e.prototype.PrepareColorDraw=function(s){if(!s){s={rounding:true,extra:0,middle:0}}if(s.extra===undefined){s.extra=0}if(s.middle===undefined){s.middle=0}var o=this.GetObject(),k=this.root_pad(),q=this.main_painter(),l=this.Dimension(),p,m,v,u,t,w,r={i1:this.GetSelectIndex("x","left",0-s.extra),i2:this.GetSelectIndex("x","right",1+s.extra),j1:(l===1)?0:this.GetSelectIndex("y","left",0-s.extra),j2:(l===1)?1:this.GetSelectIndex("y","right",1+s.extra),min:0,max:0,sumz:0};r.grx=new Float32Array(r.i2+1);r.gry=new Float32Array(r.j2+1);if(s.pixel_density){s.rounding=true}for(p=r.i1;p<=r.i2;++p){v=this.GetBinX(p+s.middle);if(q.logx&&(v<=0)){r.i1=p+1;continue}r.grx[p]=q.grx(v);if(s.rounding){r.grx[p]=Math.round(r.grx[p])}if(s.use3d){if(r.grx[p]<-q.size_xy3d){r.i1=p;r.grx[p]=-q.size_xy3d}if(r.grx[p]>q.size_xy3d){r.i2=p;r.grx[p]=q.size_xy3d}}}if(l===1){r.gry[0]=q.gry(0);r.gry[1]=q.gry(1)}else{for(m=r.j1;m<=r.j2;++m){u=this.GetBinY(m+s.middle);if(q.logy&&(u<=0)){r.j1=m+1;continue}r.gry[m]=q.gry(u);if(s.rounding){r.gry[m]=Math.round(r.gry[m])}if(s.use3d){if(r.gry[m]<-q.size_xy3d){r.j1=m;r.gry[m]=-q.size_xy3d}if(r.gry[m]>q.size_xy3d){r.j2=m;r.gry[m]=q.size_xy3d}}}}t=o.getBinContent(r.i1+1,r.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(p=r.i1;p<r.i2;++p){for(m=r.j1;m<r.j2;++m){t=o.getBinContent(p+1,m+1);r.sumz+=t;if(s.pixel_density){w=(r.grx[p+1]-r.grx[p])*(r.gry[m]-r.gry[m+1]);if(w<=0){continue}r.max=Math.max(r.max,t);if((t>0)&&((t<r.min)||(r.min===0))){r.min=t}t=t/w}if(this.maxbin===null){this.maxbin=this.minbin=t}else{this.maxbin=Math.max(this.maxbin,t);this.minbin=Math.min(this.minbin,t)}if(t>0){if((this.minposbin===null)||(t<this.minposbin)){this.minposbin=t}}}}this.fContour=null;this.fCustomContour=false;return r};function h(i){e.call(this,i)}h.prototype=Object.create(e.prototype);h.prototype.ConvertTH1K=function(){var j=this.GetObject();if(j.fReady){return}var i=j.fArray;j.fNcells=j.fXaxis.fNbins+2;j.fArray=new Float64Array(j.fNcells);for(var k=0;k<j.fNcells;++k){j.fArray[k]=0}for(var k=0;k<j.fNIn;++k){j.Fill(i[k])}j.fReady=true};h.prototype.ScanContent=function(t){if(!this.nbinsx&&t){t=false}if(this.options.Axis>0){this.draw_content=false}if(this.IsTH1K()){this.ConvertTH1K()}if(!t){this.nbinsx=this.histo.fXaxis.fNbins;this.nbinsy=0;this.CreateAxisFuncs(false)}var l=this.GetSelectIndex("x","left"),w=this.GetSelectIndex("x","right");if(t){if((l===this.scan_xleft)&&(w===this.scan_xright)){return}}this.scan_xleft=l;this.scan_xright=w;var m=0,j=0,u=0,r=0,s=true,k=this.IsTProfile(),v,o;for(var q=0;q<this.nbinsx;++q){v=this.histo.getBinContent(q+1);r+=k?this.histo.fBinEntries[q+1]:v;if((q<l)||(q>=w)){continue}if(v>0){if((j==0)||(v<j)){j=v}}if(s){m=u=v;s=false}o=(this.options.Error>0)?this.histo.getBinError(q+1):0;m=Math.min(m,v-o);u=Math.max(u,v+o)}if(k){r+=this.histo.fBinEntries[0]+this.histo.fBinEntries[this.nbinsx+1]}else{r+=this.histo.getBinContent(0)+this.histo.getBinContent(this.nbinsx+1)}this.stat_entries=r;if(this.histo.fEntries>1){this.stat_entries=this.histo.fEntries}this.hmin=m;this.hmax=u;this.ymin_nz=j;if((this.nbinsx==0)||((Math.abs(m)<1e-300&&Math.abs(u)<1e-300))){this.draw_content=false;m=this.ymin;u=this.ymax}else{this.draw_content=true}if(this.draw_content){if(m>=u){if(m==0){this.ymin=0;this.ymax=1}else{if(m<0){this.ymin=2*m;this.ymax=0}else{this.ymin=0;this.ymax=m*2}}}else{var x=(u-m)*0.05;this.ymin=m-x;if((this.ymin<0)&&(m>=0)){this.ymin=0}this.ymax=u+x}}m=this.options.minimum;u=this.options.maximum;var p=false;if((m!=-1111)&&(u!=-1111)&&!this.draw_content){this.ymin=m;this.ymax=u}else{if(m!=-1111){if(m<this.ymin){this.ymin=m}else{p=true}}if(u!=-1111){if(u>this.ymax){this.ymax=u}else{p=true}}}if(p&&this.draw_content){this.zoom_ymin=(m==-1111)?this.ymin:m;this.zoom_ymax=(u==-1111)?this.ymax:u}if(!this.options.Bar&&!this.options.Hist&&!this.options.Line&&!this.options.Error&&!this.options.Same&&!this.options.Lego&&!this.options.Text){if(this.options.Axis<0){this.options.Hist=1}else{this.draw_content=false}}};h.prototype.CountStat=function(v){var l=this.IsTProfile(),k=this.GetSelectIndex("x","left"),z=this.GetSelectIndex("x","right"),m=0,s=0,y=0,r=0,q=0,p,j=0,x=0,o=null,u=null,t={meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};for(p=k;p<z;++p){j=this.GetBinX(p+0.5);if(v&&!v(j)){continue}if(l){x=this.histo.fBinEntries[p+1];r+=this.histo.fArray[p+1];q+=this.histo.fSumw2[p+1]}else{x=this.histo.getBinContent(p+1)}if((o===null)||(x>u)){o=j;u=x}m+=x;s+=x*j;y+=x*j*j}if(!this.IsAxisZoomed("x")&&(this.histo.fTsumw>0)){m=this.histo.fTsumw;s=this.histo.fTsumwx;y=this.histo.fTsumwx2}t.integral=m;if(m>0){t.meanx=s/m;t.meany=r/m;t.rmsx=Math.sqrt(Math.abs(y/m-t.meanx*t.meanx));t.rmsy=Math.sqrt(Math.abs(q/m-t.meany*t.meany))}if(o!==null){t.xmax=o;t.wmax=u}return t};h.prototype.FillStatistic=function(o,p,v){if(this.IgnoreStatsFill()){return false}var m=this.CountStat(),s=p%10,t=Math.floor(p/10)%10,r=Math.floor(p/100)%10,u=Math.floor(p/1000)%10,i=Math.floor(p/10000)%10,j=Math.floor(p/100000)%10,k=Math.floor(p/1000000)%10,q=Math.floor(p/10000000)%10,l=Math.floor(p/100000000)%10;o.ClearPave();if(s>0){o.AddText(this.histo.fName)}if(this.IsTProfile()){if(t>0){o.AddText("Entries = "+o.Format(m.entries,"entries"))}if(r>0){o.AddText("Mean = "+o.Format(m.meanx));o.AddText("Mean y = "+o.Format(m.meany))}if(u>0){o.AddText("Std Dev = "+o.Format(m.rmsx));o.AddText("Std Dev y = "+o.Format(m.rmsy))}}else{if(t>0){o.AddText("Entries = "+o.Format(m.entries,"entries"))}if(r>0){o.AddText("Mean = "+o.Format(m.meanx))}if(u>0){o.AddText("Std Dev = "+o.Format(m.rmsx))}if(i>0){o.AddText("Underflow = "+o.Format((this.histo.fArray.length>0)?this.histo.fArray[0]:0,"entries"))}if(j>0){o.AddText("Overflow = "+o.Format((this.histo.fArray.length>0)?this.histo.fArray[this.histo.fArray.length-1]:0,"entries"))}if(k>0){o.AddText("Integral = "+o.Format(m.integral,"entries"))}if(q>0){o.AddText("Skew = <not avail>")}if(l>0){o.AddText("Kurt = <not avail>")}}if(v){o.FillFunctionStat(this.FindFunction("TF1"),v)}return true};h.prototype.DrawBars=function(x,u){this.CreateG(true);var l=this.GetSelectIndex("x","left",-1),F=this.GetSelectIndex("x","right",1),p=this.main_painter(),E=this.root_pad(),m=this,A,C,B,o,k,q,t,s,r,v="",D="",z="",j=(this.options.Bar>10)?this.options.Bar%10:0;if(j>4){j=4}s=p.swap_xy?0:u;if((this.options.BaseLine!==false)&&!isNaN(this.options.BaseLine)){if(this.options.BaseLine>=p.scale_ymin){s=Math.round(p.gry(this.options.BaseLine))}}for(A=l;A<F;++A){C=this.GetBinX(A);B=this.GetBinX(A+1);if(p.logx&&(B<=0)){continue}o=Math.round(p.grx(C));k=Math.round(p.grx(B));q=this.histo.getBinContent(A+1);if(p.logy&&(q<p.scale_ymin)){continue}t=Math.round(p.gry(q));r=k-o;o+=Math.round(this.histo.fBarOffset/1000*r);r=Math.round(this.histo.fBarWidth/1000*r);if(p.swap_xy){v+="M"+s+","+o+"h"+(t-s)+"v"+r+"h"+(s-t)+"z"}else{v+="M"+o+","+t+"h"+r+"v"+(s-t)+"h"+(-r)+"z"}if(j>0){k=o+r;r=Math.round(r*j/10);if(p.swap_xy){D+="M"+s+","+o+"h"+(t-s)+"v"+r+"h"+(s-t)+"z";z+="M"+s+","+k+"h"+(t-s)+"v"+(-r)+"h"+(s-t)+"z"}else{D+="M"+o+","+t+"h"+r+"v"+(s-t)+"h"+(-r)+"z";z+="M"+k+","+t+"h"+(-r)+"v"+(s-t)+"h"+r+"z"}}}if(v.length>0){this.draw_g.append("svg:path").attr("d",v).call(this.fillatt.func)}if(D.length>0){this.draw_g.append("svg:path").attr("d",D).call(this.fillatt.func).style("fill",c.rgb(this.fillatt.color).brighter(0.5).toString())}if(z.length>0){this.draw_g.append("svg:path").attr("d",z).call(this.fillatt.func).style("fill",c.rgb(this.fillatt.color).darker(0.5).toString())}};h.prototype.DrawFilledErrors=function(j,C){this.CreateG(true);var k=this.GetSelectIndex("x","left",-1),B=this.GetSelectIndex("x","right",1),p=this.main_painter(),m,u,o,s,t,r,q,A=[],w=[];for(m=k;m<B;++m){u=this.GetBinX(m+0.5);if(p.logx&&(u<=0)){continue}o=Math.round(p.grx(u));s=this.histo.getBinContent(m+1);t=this.histo.getBinError(m+1);if(p.logy&&(s-t<p.scale_ymin)){continue}r=Math.round(p.gry(s+t));q=Math.round(p.gry(s-t));A.push({grx:o,gry:r});w.unshift({grx:o,gry:q})}var l=(this.options.Error==14)?"bezier":"line";var z=b.Painter.BuildSvgPath(l,A),v=b.Painter.BuildSvgPath("L"+l,w);this.draw_g.append("svg:path").attr("d",z.path+v.path+"Z").style("stroke","none").call(this.fillatt.func)};h.prototype.DrawBins=function(){this.CheckHistDrawAttributes();var j=this.frame_width(),k=this.frame_height();if(!this.draw_content||(j<=0)||(k<=0)){return this.RemoveDrawG()}if(this.options.Bar>0){return this.DrawBars(j,k)}if((this.options.Error==13)||(this.options.Error==14)){return this.DrawFilledErrors(j,k)}this.CreateG(true);var p=this.GetSelectIndex("x","left",-1),al=this.GetSelectIndex("x","right",2),K=this.main_painter(),B=this.root_pad(),M=this,W="",ae=false,m,u,s,ai,V,ah,U,w,ak,Z,aa,ao,D,at=!this.options.Zero,o=(this.options.Error>0),Q=(this.options.Mark>0),l=(this.options.Line>0),F=(this.options.Text>0),T=null,z=null,aj=null,O=null,an="",am="",G=0,q,I,H,av,ar,af,ad,ac,au="",ab,r,Y;if(o&&!Q&&(this.histo.fMarkerStyle>1)){Q=true}if(this.options.Error==12){if(this.fillatt.color=="none"){Q=true}else{T=""}}else{if(this.options.Error>0){z=""}}if(l){O=""}if(Q){if(!this.markeratt){this.markeratt=new b.TAttMarkerHandler(this.histo,this.options.Mark-20)}if(this.markeratt.size>0){aj="";this.markeratt.reset_pos()}else{Q=false}}if(F){ab=this.get_color(this.histo.fMarkerColor);r=(this.options.Text>1000)?-1*(this.options.Text%1000):0;Y=20;if((this.histo.fMarkerSize!==1)&&r){Y=0.02*k*this.histo.fMarkerSize}if(!r&&(this.options.Text<1000)){var aq=j/(al-p+1);if(aq<3*Y){r=270;Y=Math.round(aq*0.7)}}this.StartTextDrawing(42,Y,this.draw_g,Y)}var S=((al-p)>3*j);if(this.options.Error==11){var P=this.lineatt.width+b.gStyle.fEndErrorSize;an="m0,"+P+"v-"+2*P+"m0,"+P;am="m"+P+",0h-"+2*P+"m"+P+",0";G=Math.floor((this.lineatt.width-1)/2)}var ap=o||Q;if(ap||F||l){S=true}for(ao=p;ao<=al;++ao){ai=this.GetBinX(ao);if(this.logx&&(ai<=0)){continue}V=Math.round(K.grx(ai));ae=(ao===al);if(ae&&(p<al)){U=s}else{ah=this.histo.getBinContent(ao+1);U=Math.round(K.gry(ah))}if(W.length===0){D=ao;aa=m=u=V;Z=w=ak=s=U;W="M"+u+","+s}else{if(S){if((V===u)&&!ae){if(U<w){D=ao}w=Math.min(w,U);ak=Math.max(ak,U);s=U}else{if(ap||F||l){av=this.histo.getBinContent(D+1);if(!at||(av!==0)){af=Math.round(K.grx(this.GetBinX(D)));ad=Math.round(K.grx(this.GetBinX(D+1)));ac=Math.round((af+ad)/2);q=Math.round(K.gry(av));I=H=20;if(o){ar=this.histo.getBinError(D+1);I=Math.round(q-K.gry(av+ar));H=Math.round(K.gry(av-ar)-q)}if(F){var X=av;if((this.options.Text>=2000)&&(this.options.Text<3000)&&this.IsTProfile()&&this.histo.fBinEntries){X=this.histo.fBinEntries[D+1]}var C=Math.round(af+(ad-af)*0.1),A=Math.round(q-2-Y),v=Math.round((ad-af)*0.8),t=Y,E=(X===Math.round(X))?X.toString():b.FFormat(X,b.gStyle.fPaintTextFormat),ag=22;if(r){C=ac;A=Math.round(q-2-Y/5);v=0;t=0;ag=12}if(X!==0){this.DrawText({align:ag,x:C,y:A,width:v,height:t,rotate:r,text:E,color:ab,latex:0})}}if(l&&(O!==null)){O+=((O.length===0)?"M":"L")+ac+","+q}if(ap){if((q>=-I)&&(q<=k+H)){if(T!==null){T+="M"+af+","+(q-I)+"h"+(ad-af)+"v"+(I+H+1)+"h-"+(ad-af)+"z"}if(aj!==null){aj+=this.markeratt.create(ac,q)}if(z!==null){if(this.options.errorX>0){var L=Math.round(ac-(ad-af)*this.options.errorX),J=Math.round(ac+(ad-af)*this.options.errorX);z+="M"+(L+G)+","+q+an+"h"+(J-L-2*G)+an}z+="M"+ac+","+(q-I+G)+am+"v"+(I+H-2*G)+am}}}}}if(!ap&&((w!==ak)||(Z!==w))){if(aa!==u){W+="h"+(u-aa)}if(s===w){if(ak!==Z){W+="v"+(ak-Z)}if(w!==ak){W+="v"+(w-ak)}}else{if(w!==Z){W+="v"+(w-Z)}if(ak!==w){W+="v"+(ak-w)}if(s!==ak){W+="v"+(s-ak)}}aa=u;Z=s}if(ae&&(aa!==V)){W+="h"+(V-aa)}D=ao;w=ak=s=U;u=V}}else{if((U!==s)||ae){if(V!==u){W+="h"+(V-u)}if(U!==s){W+="v"+(U-s)}s=U;u=V}}}}var N="";if(!this.fillatt.empty()){var R=(k+3);if((this.hmin>=0)&&(K.gry(0)<k)){R=Math.round(K.gry(0))}N="L"+u+","+R+"L"+m+","+R+"Z";if(W.length>0){W+=N}}if(ap||l){if((T!==null)&&(T.length>0)){this.draw_g.append("svg:path").attr("d",T).call(this.fillatt.func)}if((z!==null)&&(z.length>0)){this.draw_g.append("svg:path").attr("d",z).call(this.lineatt.func)}if((O!==null)&&(O.length>0)){if(!this.fillatt.empty()){this.draw_g.append("svg:path").attr("d",this.options.Line===2?(O+N):W).attr("stroke","none").call(this.fillatt.func)}this.draw_g.append("svg:path").attr("d",O).attr("fill","none").call(this.lineatt.func)}if((aj!==null)&&(aj.length>0)){this.draw_g.append("svg:path").attr("d",aj).call(this.markeratt.func)}}else{if((W.length>0)&&(this.options.Hist>0)){this.draw_g.append("svg:path").attr("d",W).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)}}if(F){this.FinishTextDrawing(this.draw_g)}};h.prototype.GetBinTips=function(q){var j=[],p=this.GetTipName(),k=this.main_painter(),m=this.GetObject(),o=this.GetBinX(q),l=this.GetBinX(q+1),i=m.getBinContent(q+1);if(p.length>0){j.push(p)}if((this.options.Error>0)||(this.options.Mark>0)){j.push("x = "+k.AxisAsText("x",(o+l)/2));j.push("y = "+k.AxisAsText("y",i));if(this.options.Error>0){j.push("error x = "+((l-o)/2).toPrecision(4));j.push("error y = "+this.histo.getBinError(q+1).toPrecision(4))}}else{j.push("bin = "+(q+1));if(k.x_kind==="labels"){j.push("x = "+k.AxisAsText("x",o))}else{if(k.x_kind==="time"){j.push("x = "+k.AxisAsText("x",(o+l)/2))}else{j.push("x = ["+k.AxisAsText("x",o)+", "+k.AxisAsText("x",l)+")")}}if(m["$baseh"]){i-=m["$baseh"].getBinContent(q+1)}if(i===Math.round(i)){j.push("entries = "+i)}else{j.push("entries = "+b.FFormat(i,b.gStyle.fStatFormat))}}return j};h.prototype.ProcessTooltip=function(V){if((V===null)||!this.draw_content||(this.options.Lego>0)||(this.options.Surf>0)){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}this.ProvideUserTooltip(null);return null}var i=this.frame_width(),j=this.frame_height(),B=this.main_painter(),v=this.root_pad(),t=this,F=null,A=true,z,K,y,o,I,k,u=2,q=this.GetSelectIndex("x","left",-1),R=this.GetSelectIndex("x","right",2),T=q,O=R;function E(l){var m=t.GetBinX(l);return(B.logx&&(m<=0))?null:B.grx(m)}function C(l){var m=t.histo.getBinContent(l+1);if(B.logy&&(m<t.scale_ymin)){return B.swap_xy?-1000:10*j}return Math.round(B.gry(m))}var Q=B.swap_xy?V.y:V.x,P=B.swap_xy?V.x:V.y;while(T<O-1){var S=Math.round((T+O)*0.5);var D=E(S);if((D===null)||(D<Q-0.5)){if(B.swap_xy){O=S}else{T=S}}else{if(D>Q+0.5){if(B.swap_xy){T=S}else{O=S}}else{T++;O--}}}F=O=T;z=E(F);if(B.swap_xy){while((T>q)&&(E(T-1)<z+2)){--T}while((O<R)&&(E(O+1)>z-2)){++O}}else{while((T>q)&&(E(T-1)>z-2)){--T}while((O<R)&&(E(O+1)<z+2)){++O}}if(T<O){var N=j;for(var S=T;S<=O;S++){var s=Math.abs(C(S)-P);if(s<N){N=s;F=S}}if(N>j/10){F=Math.round(T+(O-T)/j*P)}z=E(F)}z=Math.round(z);y=Math.round(E(F+1));if(this.options.Bar>0){var L=y-z;z+=Math.round(this.histo.fBarOffset/1000*L);y=z+Math.round(this.histo.fBarWidth/1000*L)}if(z>y){var W=z;z=y;y=W}K=Math.round((z+y)/2);I=o=k=C(F);if(this.options.Bar>0){A=true;u=0;o=Math.round(B.gry(((this.options.BaseLine!==false)&&(this.options.BaseLine>B.scale_ymin))?this.options.BaseLine:B.scale_ymin));if(o>k){var W=o;o=k;k=W}if(!V.touch&&(V.nproc===1)){if((P<o)||(P>k)){F=null}}}else{if((this.options.Error>0)||(this.options.Mark>0)||(this.options.Line>0)){A=true;var x=3;if(this.markeratt){x=Math.max(x,this.markeratt.GetFullSize())}if(this.options.Error>0){var H=this.histo.getBinContent(F+1),U=this.histo.getBinError(F+1);o=Math.round(B.gry(H+U));k=Math.round(B.gry(H-U));if((H==0)&&this.IsTProfile()){F=null}var p=(y-z)*this.options.errorX;z=Math.round(K-p);y=Math.round(K+p)}if(y-z<2*x){z=K-x;y=K+x}o=Math.min(o,I-x);k=Math.max(k,I+x);if(!V.touch&&(V.nproc===1)){if((P<o)||(P>k)){F=null}}}else{A=(V.nproc===1)&&(R-q<i);if(A){if((V.y<o)&&!V.touch){F=null}k=j;if((this.fillatt.color!=="none")&&(this.hmin>=0)){k=Math.round(B.gry(0));if((k>j)||(k<=o)){k=j}}}}}if(F!==null){if((F===q)&&(z>Q+u)){F=null}else{if((F===R-1)&&(y<Q-u)){F=null}else{if((Q<z-u)||(Q>y+u)){F=null}else{if(!this.options.Zero&&(this.histo.getBinContent(F+1)===0)){F=null}}}}}var J=this.draw_g.select(".tooltip_bin");if((F===null)||((k<=0)||(o>=j))){J.remove();this.ProvideUserTooltip(null);return null}var G={name:this.histo.fName,title:this.histo.fTitle,x:K,y:I,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.color:"blue",lines:this.GetBinTips(F)};if(V.disabled){J.remove();G.changed=true}else{if(A){if(J.empty()){J=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}G.changed=J.property("current_bin")!==F;if(G.changed){J.attr("x",B.swap_xy?o:z).attr("width",B.swap_xy?k-o:y-z).attr("y",B.swap_xy?z:o).attr("height",B.swap_xy?y-z:k-o).style("opacity","0.3").property("current_bin",F)}G.exact=(Math.abs(I-P)<=5)||((P>=o)&&(P<=k));G.menu=true;G.menu_dist=Math.sqrt((K-Q)*(K-Q)+(I-P)*(I-P))}else{var M=this.lineatt.width+3;if(J.empty()){J=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",M).call(this.lineatt.func).call(this.fillatt.func)}G.exact=(Math.abs(K-V.x)<=M)&&(Math.abs(I-V.y)<=M);G.menu=G.exact;G.menu_dist=Math.sqrt((K-V.x)*(K-V.x)+(I-V.y)*(I-V.y));G.changed=J.property("current_bin")!==F;if(G.changed){J.attr("cx",K).attr("cy",I).property("current_bin",F)}}}if(this.IsUserTooltipCallback()&&G.changed){this.ProvideUserTooltip({obj:this.histo,name:this.histo.fName,bin:F,cont:this.histo.getBinContent(F+1),grx:K,gry:I})}return G};h.prototype.FillHistContextMenu=function(j){j.add("Auto zoom-in",this.AutoZoom);var i=b.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");j.addDrawMenu("Draw with",i.opts,function(k){if(k==="inspect"){return b.draw(this.divid,this.GetObject(),k)}this.options=this.DecodeOptions(k,true);this.RedrawPad()})};h.prototype.AutoZoom=function(){var l=this.GetSelectIndex("x","left",-1),j=this.GetSelectIndex("x","right",1),m=j-l;if(m==0){return}var i=this.histo.getBinContent(l+1);for(var k=l;k<j;++k){i=Math.min(i,this.histo.getBinContent(k+1))}if(i>0){return}while((l<j)&&(this.histo.getBinContent(l+1)<=i)){++l}while((l<j)&&(this.histo.getBinContent(j)<=i)){--j}if((l===j-1)&&(l>2)&&(j<this.nbinsx-2)){--l;++j}if((j-l<m)&&(l<j)){this.Zoom(this.GetBinX(l),this.GetBinX(j))}};h.prototype.CanZoomIn=function(k,j,i){if((k=="x")&&(this.GetIndexX(i,0.5)-this.GetIndexX(j,0)>1)){return true}if((k=="y")&&(Math.abs(i-j)>Math.abs(this.ymax-this.ymin)*0.000001)){return true}return false};h.prototype.CallDrawFunc=function(m,k){var l=(this.options.Lego>0)?true:false,j=this.main_painter();if((j!==this)&&(j.mode3d!==l)){l=j.mode3d;this.options.Lego=j.options.Lego}var i=l?"Draw3D":"Draw2D";this[i](m,k)};h.prototype.Draw2D=function(i){if(typeof this.Create3DScene==="function"){this.Create3DScene(-1)}this.mode3d=false;this.ScanContent(true);this.CreateXY();if(typeof this.DrawColorPalette==="function"){this.DrawColorPalette(false)}this.DrawAxes();this.DrawGrids();this.DrawBins();this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();b.CallBack(i)};h.prototype.Draw3D=function(j,i){this.mode3d=true;b.AssertPrerequisites("hist3d",function(){this.Draw3D(j,i)}.bind(this))};h.prototype.Redraw=function(i){this.CallDrawFunc(null,i)};b.Painter.drawHistogram1D=function(l,j,k){var i=new h(j);i.SetDivId(l,1);i.options=i.DecodeOptions(k);if(!i.options.Lego){i.CheckPadRange()}i.ScanContent();i.CreateStat();i.CallDrawFunc(function(){i.DrawNextFunction(0,function(){if((i.options.Lego===0)&&i.options.AutoZoom){i.AutoZoom()}i.FillToolbar();i.DrawingReady()})});return i};function g(i){e.call(this,i);this.fContour=null;this.fCustomContour=false;this.fPalette=null}g.prototype=Object.create(e.prototype);g.prototype.Cleanup=function(){delete this.fCustomContour;delete this.tt_handle;e.prototype.Cleanup.call(this)};g.prototype.ToggleProjection=function(k,j){if(k=="Projections"){k=""}if((typeof k=="string")&&(k.length>1)){j=parseInt(k.substr(1));k=k[0]}if(!j){j=1}if(k&&(this.is_projection==k)){if(this.projection_width===j){k=""}else{this.projection_width=j;return}}delete this.proj_hist;this.is_projection=(this.is_projection===k)?"":k;this.projection_width=j;var i=this.pad_painter();if(i){i.ToggleProjection(this.is_projection,this.RedrawProjection.bind(this))}};g.prototype.RedrawProjection=function(o,m,k,t){if(!this.is_projection){return}if(t==undefined){if(!this.tt_handle){return}o=Math.round((this.tt_handle.i1+this.tt_handle.i2)/2);m=o+1;k=Math.round((this.tt_handle.j1+this.tt_handle.j2)/2);t=k+1}var l=this.pad_painter();if(l&&(this.snapid!==undefined)){var p="EXECANDSEND:D"+this.is_projection+"PROJ:"+this.snapid+":";if(this.is_projection=="X"){p+='ProjectionX("_projx",'+(k+1)+","+t+',"")'}else{p+='ProjectionY("_projy",'+(o+1)+","+m+',"")'}l.SendWebsocket(p);return}if(!this.proj_hist){if(this.is_projection=="X"){this.proj_hist=b.CreateHistogram("TH1D",this.nbinsx);b.extend(this.proj_hist.fXaxis,this.histo.fXaxis);this.proj_hist.fName="xproj";this.proj_hist.fTitle="X projection"}else{this.proj_hist=b.CreateHistogram("TH1D",this.nbinsy);b.extend(this.proj_hist.fXaxis,this.histo.fYaxis);this.proj_hist.fName="yproj";this.proj_hist.fTitle="Y projection"}}if(this.is_projection=="X"){for(var r=0;r<this.nbinsx;++r){var s=0;for(var q=k;q<t;++q){s+=this.histo.getBinContent(r+1,q+1)}this.proj_hist.setBinContent(r+1,s)}}else{for(var q=0;q<this.nbinsy;++q){var s=0;for(var r=o;r<m;++r){s+=this.histo.getBinContent(r+1,q+1)}this.proj_hist.setBinContent(q+1,s)}}return l.DrawProjection(this.is_projection,this.proj_hist)};g.prototype.ExecuteMenuCommand=function(j,i){if(e.prototype.ExecuteMenuCommand.call(this,j,i)){return true}if((j.fName=="SetShowProjectionX")||(j.fName=="SetShowProjectionY")){this.ToggleProjection(j.fName[17],i&&parseInt(i)?parseInt(i):1);return true}return false};g.prototype.FillHistContextMenu=function(o){o.add("sub:Projections",this.ToggleProjection);var m=this.is_projection||"";if(m){m+=this.projection_width}var l=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10"];for(var i=0;i<l.length;++i){o.addchk(m==l[i],l[i],l[i],this.ToggleProjection)}o.add("endsub:");o.add("Auto zoom-in",this.AutoZoom);var j=b.getDrawSettings("ROOT."+this.GetObject()._typename,"nosame");o.addDrawMenu("Draw with",j.opts,function(k){if(k==="inspect"){return b.draw(this.divid,this.GetObject(),k)}this.options=this.DecodeOptions(k);this.RedrawPad()});if(this.options.Color>0){this.FillPaletteMenu(o)}};g.prototype.ButtonClick=function(i){if(e.prototype.ButtonClick.call(this,i)){return true}if(this!==this.main_painter()){return false}switch(i){case"ToggleColor":this.ToggleColor();break;case"ToggleColorZ":if(this.options.Lego===12||this.options.Lego===14||this.options.Color>0||this.options.Contour>0||this.options.Surf===11||this.options.Surf===12){this.ToggleColz()}break;case"Toggle3D":if(this.options.Surf>0){this.options.Surf=-this.options.Surf}else{if(this.options.Lego>0){this.options.Lego=0}else{if(this.options.Surf<0){this.options.Surf=-this.options.Surf}else{if((this.nbinsx>=50)||(this.nbinsy>=50)){this.options.Lego=(this.options.Color>0)?14:13}else{this.options.Lego=(this.options.Color>0)?12:1}this.options.Zero=0}}}this.RedrawPad();break;default:return false}return true};g.prototype.FillToolbar=function(){e.prototype.FillToolbar.call(this);var i=this.pad_painter(true);if(i===null){return}if(!this.IsTH2Poly()){i.AddButton(b.ToolbarIcons.th2color,"Toggle color","ToggleColor")}i.AddButton(b.ToolbarIcons.th2colorz,"Toggle color palette","ToggleColorZ");i.AddButton(b.ToolbarIcons.th2draw3d,"Toggle 3D mode","Toggle3D")};g.prototype.ToggleColor=function(){var i=true;if(this.options.Lego>0){this.options.Lego=0;i=false}else{if(this.options.Surf>0){this.options.Surf=-this.options.Surf;i=false}}if(this.options.Color==0){this.options.Color=("LastColor" in this.options)?this.options.LastColor:1}else{if(i){this.options.LastColor=this.options.Color;this.options.Color=0}}this._can_move_colz=true;this.Redraw()};g.prototype.AutoZoom=function(){if(this.IsTH2Poly()){return}var r=this.GetSelectIndex("x","left",-1),q=this.GetSelectIndex("x","right",1),B=this.GetSelectIndex("y","left",-1),A=this.GetSelectIndex("y","right",1),y,u,v=this.GetObject();if((r==q)||(B==A)){return}var t=v.getBinContent(r+1,B+1);for(y=r;y<q;++y){for(u=B;u<A;++u){t=Math.min(t,v.getBinContent(y+1,u+1))}}if(t>0){return}var o=q,m=r,k=A,s=B;for(y=r;y<q;++y){for(u=B;u<A;++u){if(v.getBinContent(y+1,u+1)>t){if(y<o){o=y}if(y>=m){m=y+1}if(u<k){k=u}if(u>=s){s=u+1}}}}var l,x,z,p,w=false;if((o===m-1)&&(o>r+1)&&(m<q-1)){o--;m++}if((k===s-1)&&(k>B+1)&&(s<A-1)){k--;s++}if((o>r||m<q)&&(o<m-1)){l=this.GetBinX(o);x=this.GetBinX(m);w=true}if((k>B||s<A)&&(k<s-1)){z=this.GetBinY(k);p=this.GetBinY(s);w=true}if(w){this.Zoom(l,x,z,p)}};g.prototype.ScanContent=function(p){if(p&&this.nbinsx&&this.nbinsy){return}var o,m,l=this.GetObject();this.nbinsx=l.fXaxis.fNbins;this.nbinsy=l.fYaxis.fNbins;this.CreateAxisFuncs(true);if(this.IsTH2Poly()){this.gminposbin=null;this.gminbin=this.gmaxbin=0;for(var r=0,k=l.fBins.arr.length;r<k;++r){var q=l.fBins.arr[r].fContent;if(r===0){this.gminbin=this.gmaxbin=q}if(q<this.gminbin){this.gminbin=q}else{if(q>this.gmaxbin){this.gmaxbin=q}}if(q>0){if((this.gminposbin===null)||(this.gminposbin>q)){this.gminposbin=q}}}}else{this.gminbin=this.gmaxbin=l.getBinContent(1,1);this.gminposbin=null;for(o=0;o<this.nbinsx;++o){for(m=0;m<this.nbinsy;++m){var q=l.getBinContent(o+1,m+1);if(q<this.gminbin){this.gminbin=q}else{if(q>this.gmaxbin){this.gmaxbin=q}}if(q>0){if((this.gminposbin===null)||(this.gminposbin>q)){this.gminposbin=q}}}}}if(this.gminposbin===null){this.gminposbin=this.gmaxbin*0.0001}if(this.options.Axis>0){this.draw_content=false}else{this.draw_content=this.gmaxbin>0}};g.prototype.CountStat=function(s){var u=this.GetObject(),m=0,q=0,D=0,p=0,C=0,I=0,k,F,o,y,K,M={entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.IsTH2Poly()){var H=u.fBins.arr.length,E,x,B,z,t,w,j,r=this.main_painter();for(E=0;E<H;++E){x=u.fBins.arr[E];k=1;F=1;if(x.fXmin>r.scale_xmax){k=2}else{if(x.fXmax<r.scale_xmin){k=0}}if(x.fYmin>r.scale_ymax){F=2}else{if(x.fYmax<r.scale_ymin){F=0}}o=y=j=0;z=x.fPoly;w=1;if(z._typename==="TMultiGraph"){w=x.fPoly.fGraphs.arr.length;z=null}for(t=0;t<w;++t){if(!z||(t>0)){z=x.fPoly.fGraphs.arr[t]}for(B=0;B<z.fNpoints;++B){++j;o+=z.fX[B];y+=z.fY[B]}}if(j>1){o=o/j;y=y/j}K=x.fContent;M.entries+=K;M.matrix[F*3+k]+=K;if((k!=1)||(F!=1)){continue}if((s!=null)&&!s(o,y)){continue}if((M.wmax==null)||(K>M.wmax)){M.wmax=K;M.xmax=o;M.ymax=y}m+=K;q+=o*K;D+=y*K;p+=o*o*K;C+=y*y*K;I+=o*y*K}}else{var l=this.GetSelectIndex("x","left"),A=this.GetSelectIndex("x","right"),J=this.GetSelectIndex("y","left"),G=this.GetSelectIndex("y","right"),v,L;for(v=0;v<=this.nbinsx+1;++v){k=(v<=l)?0:(v>A?2:1);o=this.GetBinX(v-0.5);for(L=0;L<=this.nbinsy+1;++L){F=(L<=J)?0:(L>G?2:1);y=this.GetBinY(L-0.5);K=u.getBinContent(v,L);M.entries+=K;M.matrix[F*3+k]+=K;if((k!=1)||(F!=1)){continue}if((s!=null)&&!s(o,y)){continue}if((M.wmax==null)||(K>M.wmax)){M.wmax=K;M.xmax=o;M.ymax=y}m+=K;q+=o*K;D+=y*K;p+=o*o*K;C+=y*y*K;I+=o*y*K}}}if(!this.IsAxisZoomed("x")&&!this.IsAxisZoomed("y")&&(u.fTsumw>0)){m=u.fTsumw;q=u.fTsumwx;p=u.fTsumwx2;D=u.fTsumwy;C=u.fTsumwy2;I=u.fTsumwxy}if(m>0){M.meanx=q/m;M.meany=D/m;M.rmsx=Math.sqrt(Math.abs(p/m-M.meanx*M.meanx));M.rmsy=Math.sqrt(Math.abs(C/m-M.meany*M.meany))}if(M.wmax===null){M.wmax=0}M.integral=m;if(u.fEntries>1){M.entries=u.fEntries}return M};g.prototype.FillStatistic=function(q,r,x){if(this.IgnoreStatsFill()){return false}var p=this.CountStat(),u=Math.floor(r%10),v=Math.floor(r/10)%10,t=Math.floor(r/100)%10,w=Math.floor(r/1000)%10,i=Math.floor(r/10000)%10,j=Math.floor(r/100000)%10,l=Math.floor(r/1000000)%10,s=Math.floor(r/10000000)%10,o=Math.floor(r/100000000)%10;q.ClearPave();if(u>0){q.AddText(this.GetObject().fName)}if(v>0){q.AddText("Entries = "+q.Format(p.entries,"entries"))}if(t>0){q.AddText("Mean x = "+q.Format(p.meanx));q.AddText("Mean y = "+q.Format(p.meany))}if(w>0){q.AddText("Std Dev x = "+q.Format(p.rmsx));q.AddText("Std Dev y = "+q.Format(p.rmsy))}if(l>0){q.AddText("Integral = "+q.Format(p.matrix[4],"entries"))}if(s>0){q.AddText("Skewness x = <undef>");q.AddText("Skewness y = <undef>")}if(o>0){q.AddText("Kurt = <undef>")}if((i>0)||(j>0)){var k=p.matrix;q.AddText(""+k[6].toFixed(0)+" | "+k[7].toFixed(0)+" | "+k[7].toFixed(0));q.AddText(""+k[3].toFixed(0)+" | "+k[4].toFixed(0)+" | "+k[5].toFixed(0));q.AddText(""+k[0].toFixed(0)+" | "+k[1].toFixed(0)+" | "+k[2].toFixed(0))}if(x){q.FillFunctionStat(this.FindFunction("TF1"),x)}return true};g.prototype.DrawBinsColor=function(u,p){var m=this.GetObject(),q=this.PrepareColorDraw(),k=[],t=[],s=[],x,y,v,o,l,r;for(o=q.i1;o<q.i2;++o){for(l=q.j1;l<q.j2;++l){r=m.getBinContent(o+1,l+1);x=this.getContourColor(r,true);if(r===0){if(this.options.Color===11){continue}if((x===null)&&this._show_empty_bins){x=0}}if(x===null){continue}y="M"+q.grx[o]+","+q.gry[l+1];if(k[x]===undefined){k[x]=y}else{v="m"+(q.grx[o]-t[x])+","+(q.gry[l+1]-s[x]);k[x]+=(v.length<y.length)?v:y}t[x]=q.grx[o];s[x]=q.gry[l+1];k[x]+="v"+(q.gry[l]-q.gry[l+1])+"h"+(q.grx[o+1]-q.grx[o])+"v"+(q.gry[l+1]-q.gry[l])+"z"}}for(x=0;x<k.length;++x){if(k[x]!==undefined){this.draw_g.append("svg:path").attr("palette-index",x).attr("fill",this.fPalette.getColor(x)).attr("d",k[x])}}return q};g.prototype.BuildContour=function(K,J,ah,C){var E=this.GetObject(),Q=404,p=400,U=new Float32Array(2*Q),l=new Float32Array(2*Q),B=new Int32Array(2*Q),V=0,af,R,Y=[],aj,H=0,aa=[0,0,0,0],Z=[0,0,0,0],r=[0,0,0,0],N=[0,0,0,0],ai,ag,ae,ac,ad,M,o,ab,O,D,A,M,q;function u(i){for(var j=0;j<J.length;++j){if(i<J[j]){return j-1}}return J.length-1}function s(ak,au,ax,k,y,at,aw,j){var av=(ax===aw),i=av?(j-k):(aw-ax),ar=au+1,x=y-ak,al=V-1,ao=Q/2-3+V,m=0,aq,an,am,ap;while(ar<=at&&al<=ao){ap=J[ar];am=ap-ak;an=am/x;aq=i*an;if(av){U[al]=ax;l[al]=k+aq}else{U[al]=ax+aq;l[al]=k}B[al]=ar;m++;al+=2;ar++}return m}for(ag=K.j1;ag<K.j2-1;++ag){Z[1]=Z[0]=(K.gry[ag]+K.gry[ag+1])/2;Z[3]=Z[2]=(K.gry[ag+1]+K.gry[ag+2])/2;for(ai=K.i1;ai<K.i2-1;++ai){r[0]=E.getBinContent(ai+1,ag+1);r[1]=E.getBinContent(ai+2,ag+1);r[2]=E.getBinContent(ai+2,ag+2);r[3]=E.getBinContent(ai+1,ag+2);for(ae=0;ae<4;ae++){N[ae]=u(r[ae])}if((N[0]!==N[1])||(N[1]!==N[2])||(N[2]!==N[3])||(N[3]!==N[0])){aa[3]=aa[0]=(K.grx[ai]+K.grx[ai+1])/2;aa[2]=aa[1]=(K.grx[ai+1]+K.grx[ai+2])/2;if(r[0]<=r[1]){ac=0}else{ac=1}if(r[2]<=r[3]){ad=2}else{ad=3}if(r[ac]>r[ad]){ac=ad}ac++;V=1;for(M=1;M<=4;M++){ad=ac%4+1;o=s(r[ac-1],N[ac-1],aa[ac-1],Z[ac-1],r[ad-1],N[ad-1],aa[ad-1],Z[ad-1]);V+=2*o;ac=ad}if(r[0]<=r[1]){ac=0}else{ac=1}if(r[2]<=r[3]){ad=2}else{ad=3}if(r[ac]>r[ad]){ac=ad}ac++;V=2;for(M=1;M<=4;M++){if(ac==1){ad=4}else{ad=ac-1}o=s(r[ac-1],N[ac-1],aa[ac-1],Z[ac-1],r[ad-1],N[ad-1],aa[ad-1],Z[ad-1]);V+=2*o;ac=ad}ab=0;for(M=1;M<=V-5;M+=2){while(B[M-1]!=B[M]){O=U[M];D=l[M];A=B[M];for(q=M;q<=V-5;q+=2){U[q]=U[q+2];l[q]=l[q+2];B[q]=B[q+2]}U[V-3]=O;l[V-3]=D;B[V-3]=A;if(ab>p){break}ab++}}if(ab>p){continue}for(M=1;M<=V-2;M+=2){af=B[M-1];if((af>=0)&&(af<J.length)){R=Y[af];if(!R){R=Y[af]=b.CreateTPolyLine(Q*4,true)}aj=R.fLastPoint;if(aj<R.fN-2){R.fX[aj+1]=Math.round(U[M-1]);R.fY[aj+1]=Math.round(l[M-1]);R.fX[aj+2]=Math.round(U[M]);R.fY[aj+2]=Math.round(l[M]);R.fLastPoint=aj+2;H=Math.max(H,R.fLastPoint+1)}else{}}}}}}var S=new Int32Array(J.length),z=0;for(af=0;af<J.length;af++){if(J[af]>=0){z=af;break}}ae=0;for(af=z-1;af>=0;af--){S[ae]=af;ae++}for(af=z;af<J.length;af++){S[ae]=af;ae++}var W=new Int32Array(2*H),G=new Int32Array(2*H);for(ae=0;ae<J.length;++ae){af=S[ae];R=Y[af];if(!R){continue}var L=ah.calcColorIndex(af,J.length),P=R.fX,w=R.fY,aj=R.fLastPoint+1,X=0,F,I,t=0,T=0,v;while(true){F=H;I=F+1;W[F]=P[X];G[F]=w[X];W[I]=P[X+1];G[I]=w[X+1];P[X]=P[X+1]=t;w[X]=w[X+1]=T;while(true){v=0;for(ai=2;ai<aj;ai+=2){if((I<2*H-1)&&(P[ai]===W[I])&&(w[ai]===G[I])){I++;W[I]=P[ai+1];G[I]=w[ai+1];P[ai]=P[ai+1]=t;w[ai]=w[ai+1]=T;v++}if((F>0)&&(P[ai+1]===W[F])&&(w[ai+1]===G[F])){F--;W[F]=P[ai];G[F]=w[ai];P[ai]=P[ai+1]=t;w[ai]=w[ai+1]=T;v++}}if(v==0){break}}if((F+1<I)&&(F>=0)){C(L,W,G,F,I,af)}X=0;for(ai=2;ai<aj;ai+=2){if(P[ai]!==t&&w[ai]!==T){X=ai;break}}if(X===0){break}}}};g.prototype.DrawBinsContour=function(o,k){var m=this.PrepareColorDraw({rounding:false,extra:100});var l=this.GetContour(),j=this.GetPalette(),i=this;if(this.options.Contour===14){this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",o).attr("height",k).style("fill",j.calcColor(0,l.length))}this.BuildContour(m,l,j,function(z,t,p,w,v){var y=j.getColor(z),s=y,x=null;switch(i.options.Contour){case 1:break;case 11:s="none";x=new b.TAttLineHandler(y);break;case 12:s="none";x=new b.TAttLineHandler({fLineColor:1,fLineStyle:(z%5+1),fLineWidth:1});break;case 13:s="none";x=i.lineatt;break;case 14:break}var r="M"+t[w]+","+p[w];for(var u=w+1;u<=v;++u){r+="l"+(t[u]-t[u-1])+","+(p[u]-p[u-1])}if(s!=="none"){r+="Z"}var q=i.draw_g.append("svg:path").attr("class","th2_contour").attr("d",r).style("fill",s);if(x!==null){q.call(x.func)}else{q.style("stroke","none")}});m.hide_only_zeros=true;return m};g.prototype.CreatePolyBin=function(s,w){var m="",j,i=1,l=null;if(w.fPoly._typename=="TMultiGraph"){i=w.fPoly.fGraphs.arr.length}else{l=w.fPoly}for(j=0;j<i;++j){if(!l||(j>0)){l=w.fPoly.fGraphs.arr[j]}var v=l.fNpoints,k,u=l.fX,t=l.fY,p=Math.round(s.grx(u[0])),o=Math.round(s.gry(t[0])),r,q;if((v>2)&&(u[0]==u[v-1])&&(t[0]==t[v-1])){v--}m+="M"+p+","+o;for(k=1;k<v;++k){r=Math.round(s.grx(u[k]));q=Math.round(s.gry(t[k]));if((p!==r)||(o!==q)){if(p===r){m+="v"+(q-o)}else{if(o===q){m+="h"+(r-p)}else{m+="l"+(r-p)+","+(q-o)}}}p=r;o=q}m+="z"}return m};g.prototype.DrawPolyBinsColor=function(q,A){var r=this.GetObject(),m=this.main_painter(),D=[],o=[],k,v,s,C,x,z=r.fBins.arr.length;this.fContour=null;this.fCustomContour=false;this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;for(x=0;x<z;++x){s=r.fBins.arr[x];k=this.getContourColor(s.fContent,true);if(k===null){continue}if((s.fContent===0)&&(this.options.Color===11)){continue}if((s.fXmin>m.scale_xmax)||(s.fXmax<m.scale_xmin)||(s.fYmin>m.scale_ymax)||(s.fYmax<m.scale_ymin)){continue}v=this.CreatePolyBin(m,s);if(D[k]===undefined){D[k]=v}else{D[k]+=v}if(this.options.Text){o.push(s)}}for(k=0;k<D.length;++k){if(D[k]){C=this.draw_g.append("svg:path").attr("palette-index",k).attr("fill",this.fPalette.getColor(k)).attr("d",D[k]);if(this.options.Line){C.call(this.lineatt.func)}}}if(o.length>0){var j=this.get_color(r.fMarkerColor),l=(this.options.Text>1000)?-1*(this.options.Text%1000):0,y=this.draw_g.append("svg:g").attr("class","th2poly_text"),p=12;if((r.fMarkerSize!==1)&&l){p=Math.round(0.02*A*r.fMarkerSize)}this.StartTextDrawing(42,p,y,p);for(x=0;x<o.length;++x){s=o[x];var u=Math.round(m.x((s.fXmin+s.fXmax)/2)),t=Math.round(m.y((s.fYmin+s.fYmax)/2)),B="";if(this.options.Text<1000){B=(Math.round(s.fContent)===s.fContent)?s.fContent.toString():b.FFormat(s.fContent,b.gStyle.fPaintTextFormat)}else{if(s.fPoly){B=s.fPoly.fName}if(B==="Graph"){B=""}if(!B){B=s.fNumber}}this.DrawText({align:22,x:u,y:t,rotate:l,text:B,color:j,latex:0,draw_g:y})}this.FinishTextDrawing(y,null)}return{poly:true}};g.prototype.DrawBinsText=function(q,A,D){var s=this.GetObject(),z,x,r,m,t,F,B,v,u,E,C;if(D===null){D=this.PrepareColorDraw({rounding:false})}var k=this.get_color(s.fMarkerColor),o=(this.options.Text>1000)?-1*(this.options.Text%1000):0,y=this.draw_g.append("svg:g").attr("class","th2_text"),p=20,l=0;if((s.fMarkerSize!==1)&&o){p=Math.round(0.02*A*s.fMarkerSize)}if(s.fBarOffset!==0){l=s.fBarOffset*0.001}this.StartTextDrawing(42,p,y,p);for(z=D.i1;z<D.i2;++z){for(x=D.j1;x<D.j2;++x){r=s.getBinContent(z+1,x+1);if((r===0)&&!this._show_empty_bins){continue}t=D.grx[z+1]-D.grx[z];F=D.gry[x]-D.gry[x+1];if((this.options.Text>=2000)&&(this.options.Text<3000)&&this.MatchObjectType("TProfile2D")&&(typeof s.getBinEntries=="function")){r=s.getBinEntries(z+1,x+1)}B=(r===Math.round(r))?r.toString():b.FFormat(r,b.gStyle.fPaintTextFormat);if(o){v=Math.round(D.grx[z]+t*0.5);u=Math.round(D.gry[x+1]+F*(0.5+l));E=0;C=0}else{v=Math.round(D.grx[z]+t*0.1);u=Math.round(D.gry[x+1]+F*(0.1+l));E=Math.round(t*0.8);C=Math.round(F*0.8)}this.DrawText({align:22,x:v,y:u,width:E,height:C,rotate:o,text:B,color:k,latex:0,draw_g:y})}}this.FinishTextDrawing(y,null);D.hide_only_zeros=true;return D};g.prototype.DrawBinsArrow=function(s,H){var v=this.GetObject(),E,C,u,q,x,O,J,M,z=1e-30,t,r,B,k,K,o,I,G,m,l,y,N,p;var L=this.PrepareColorDraw({rounding:false});var F=(L.grx[L.i2]-L.grx[L.i1])/(L.i2-L.i1+1-0.03)/2,D=(L.gry[L.j2]-L.gry[L.j1])/(L.j2-L.j1+1-0.03)/2;var A="";for(var M=0;M<2;++M){for(E=L.i1;E<L.i2;++E){for(C=L.j1;C<L.j2;++C){if(E===L.i1){t=v.getBinContent(E+2,C+1)-v.getBinContent(E+1,C+1)}else{if(E===L.i2-1){t=v.getBinContent(E+1,C+1)-v.getBinContent(E,C+1)}else{t=0.5*(v.getBinContent(E+2,C+1)-v.getBinContent(E,C+1))}}if(C===L.j1){r=v.getBinContent(E+1,C+2)-v.getBinContent(E+1,C+1)}else{if(C===L.j2-1){r=v.getBinContent(E+1,C+1)-v.getBinContent(E+1,C)}else{r=0.5*(v.getBinContent(E+1,C+2)-v.getBinContent(E+1,C))}}if(M===0){z=Math.max(z,Math.abs(t),Math.abs(r))}else{B=(L.grx[E]+L.grx[E+1])/2;k=(L.gry[C]+L.gry[C+1])/2;K=F*t/z;o=D*r/z;I=B-K;G=B+K;m=k-o;l=k+o;t=Math.round(G-I);r=Math.round(l-m);if((t!==0)||(r!==0)){A+="M"+Math.round(I)+","+Math.round(m)+"l"+t+","+r;if(Math.abs(t)>5||Math.abs(r)>5){y=Math.sqrt(2/(t*t+r*r));N=Math.round(y*(t+r));p=Math.round(y*(t-r));if((N!==0)&&(p!==0)){A+="l"+(-N)+","+p+"m"+N+","+(-p)+"l"+(-p)+","+(-N)}}}}}}}this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",A).style("fill","none").call(this.lineatt.func);return L};g.prototype.DrawBinsBox=function(E,L){var G=this.GetObject(),Q=this.PrepareColorDraw({rounding:false}),C=this.main_painter();if(C===this){if(C.maxbin===C.minbin){C.maxbin=C.gmaxbin;C.minbin=C.gminbin;C.minposbin=C.gminposbin}if(C.maxbin===C.minbin){C.minbin=Math.min(0,C.maxbin-1)}}var v=Math.max(Math.abs(C.maxbin),Math.abs(C.minbin)),p=Math.max(0,C.minbin),K,I,F,x,T="",s="",t="",r="",D,M,o,m,B,H,S,u,l,k,z=1,P=false,J=0,N=1;if(this.root_pad().fLogz&&(v>0)){P=true;N=Math.log(v);if(p>0){J=Math.log(p)}else{if((C.minposbin>=1)&&(C.minposbin<100)){J=Math.log(0.7)}else{J=(C.minposbin>0)?Math.log(0.7*C.minposbin):N-10}}if(J>=N){J=N-10}z=1/(N-J)}else{z=1/(v-p)}for(K=Q.i1;K<Q.i2;++K){for(I=Q.j1;I<Q.j2;++I){F=G.getBinContent(K+1,I+1);x=Math.abs(F);if((x===0)||(x<p)){continue}M=P?((x>0)?Math.log(x)-J:0):(x-p);M=0.5*((M<0)?1:(1-Math.sqrt(M*z)));if(M<0){M=0}S=Q.grx[K+1]-Q.grx[K];u=Q.gry[I]-Q.gry[I+1];o=M*S;m=M*u;B=Math.round(Q.grx[K]+o);H=Math.round(Q.gry[I+1]+m);S=Math.max(Math.round(S-2*o),1);u=Math.max(Math.round(u-2*m),1);T+="M"+B+","+H+"v"+u+"h"+S+"v-"+u+"z";if((F<0)&&(this.options.Box===10)){s+="M"+B+","+H+"l"+S+","+u+"M"+(B+S)+","+H+"l-"+S+","+u}if((this.options.Box===11)&&(S>5)&&(u>5)){var R=Math.round(S*0.1),q=Math.round(u*0.1),A="M"+B+","+H+"h"+S+"l"+(-R)+","+q+"h"+(2*R-S)+"v"+(u-2*q)+"l"+(-R)+","+q+"z",y="M"+(B+S)+","+(H+u)+"v"+(-u)+"l"+(-R)+","+q+"v"+(u-2*q)+"h"+(2*R-S)+"l"+(-R)+","+q+"z";if(F<0){r+=A;t+=y}else{t+=A;r+=y}}}}if(T.length>0){var O=this.draw_g.append("svg:path").attr("d",T).call(this.fillatt.func);if((this.options.Box===11)||(this.fillatt.color!=="none")){O.style("stroke","none")}else{O.call(this.lineatt.func)}}if((t.length>0)&&(this.fillatt.color!=="none")){this.draw_g.append("svg:path").attr("d",t).style("stroke","none").call(this.fillatt.func).style("fill",c.rgb(this.fillatt.color).brighter(0.5).toString())}if(r.length>0){this.draw_g.append("svg:path").attr("d",r).style("stroke","none").call(this.fillatt.func).style("fill",this.fillatt.color==="none"?"red":c.rgb(this.fillatt.color).darker(0.5).toString())}if(s.length>0){var O=this.draw_g.append("svg:path").attr("d",s).style("fill","none");if(this.lineatt.color!=="none"){O.call(this.lineatt.func)}else{O.style("stroke","black")}}return Q};g.prototype.DrawCandle=function(q,v){var r=this.GetObject(),A=this.PrepareColorDraw(),z=this.root_pad(),m=this.main_painter(),u,t,o,E,C,B,l,D,p,k,q,F,s="",x="";if(!this.markeratt){if(r.fMarkerColor===1){r.fMarkerColor=r.fLineColor}this.markeratt=new b.TAttMarkerHandler(r,5)}this.markeratt.reset_pos();A.candle=[];for(u=A.i1;u<A.i2;++u){C=0;k=0;p=0;for(t=0;t<this.nbinsy;++t){k+=r.getBinContent(u+1,t+1)}F={bin:u,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(t=0;t<this.nbinsy;++t){l=r.getBinContent(u+1,t+1);if(p/k<0.001&&(p+l)/k>=0.001){F.whiskerm=this.GetBinY(t+0.5)}if(p/k<0.25&&(p+l)/k>=0.25){F.m25y=this.GetBinY(t+0.5)}if(p/k<0.5&&(p+l)/k>=0.5){F.median=this.GetBinY(t+0.5)}if(p/k<0.75&&(p+l)/k>=0.75){F.p25y=this.GetBinY(t+0.5)}if(p/k<0.999&&(p+l)/k>=0.999){F.whiskerp=this.GetBinY(t+0.5)}p+=l;o=this.GetBinY(t+0.5);C+=l*o}if(p>0){F.meany=C/p}F.iqr=F.p25y-F.m25y;if((F.m25y-1.5*F.iqr)>F.whsikerm){F.whiskerm=F.m25y-1.5*F.iqr}if((F.p25y+1.5*F.iqr)<F.whiskerp){F.whiskerp=F.p25y+1.5*F.iqr}if(m.logy&&(F.whiskerm<=0)){continue}q=A.grx[u+1]-A.grx[u];q*=0.66;D=(A.grx[u+1]+A.grx[u])/2+r.fBarOffset/1000*q;if(r.fBarWidth>0){q=q*r.fBarWidth/1000}F.x1=Math.round(D-q/2);F.x2=Math.round(D+q/2);D=Math.round(D);F.y0=Math.round(m.gry(F.median));s+="M"+F.x1+","+F.y0+"h"+(F.x2-F.x1);F.y1=Math.round(m.gry(F.p25y));F.y2=Math.round(m.gry(F.m25y));s+="M"+F.x1+","+F.y1+"v"+(F.y2-F.y1)+"h"+(F.x2-F.x1)+"v-"+(F.y2-F.y1)+"z";F.yy1=Math.round(m.gry(F.whiskerp));F.yy2=Math.round(m.gry(F.whiskerm));s+="M"+D+","+F.y1+"v"+(F.yy1-F.y1);s+="M"+F.x1+","+F.yy1+"h"+(F.x2-F.x1);s+="M"+D+","+F.y2+"v"+(F.yy2-F.y2);s+="M"+F.x1+","+F.yy2+"h"+(F.x2-F.x1);for(t=0;t<this.nbinsy;++t){l=r.getBinContent(u+1,t+1);if(l>0&&this.GetBinY(t+0.5)<F.whiskerm){x+=this.markeratt.create(D,this.GetBinY(t+0.5))}if(l>0&&this.GetBinY(t+0.5)>F.whiskerp){x+=this.markeratt.create(D,this.GetBinY(t+0.5))}}A.candle.push(F)}if(s.length>0){this.draw_g.append("svg:path").attr("d",s).call(this.lineatt.func).call(this.fillatt.func)}if(x.length>0){this.draw_g.append("svg:path").attr("d",x).call(this.markeratt.func)}return A};g.prototype.DrawBinsScatter=function(t,J){var y=this.GetObject(),N=this.PrepareColorDraw({rounding:true,pixel_density:true}),O=[],M=[],L=[],p=[],s=[],r,o,l,I,G,x,q,u,z=1,Q=this.options.ScatCoef*((this.gmaxbin)>2000?2000/this.gmaxbin:1);if(Q*N.sumz<100000){if(!this.markeratt){this.markeratt=new b.TAttMarkerHandler(y)}this.markeratt.reset_pos();var A="",C,v;for(I=N.i1;I<N.i2;++I){q=N.grx[I+1]-N.grx[I];for(G=N.j1;G<N.j2;++G){u=N.gry[G]-N.gry[G+1];x=y.getBinContent(I+1,G+1);v=Math.round(Q*x);if(v<=0){continue}for(C=0;C<v;++C){A+=this.markeratt.create(Math.round(N.grx[I]+q*Math.random()),Math.round(N.gry[G+1]+u*Math.random()))}}}this.draw_g.append("svg:path").attr("d",A).call(this.markeratt.func);return N}if(this.maxbin>0.7){z=0.7/this.maxbin}var F=Math.round(N.max-N.min);this.CreateContour((F>50)?50:F,this.minposbin,this.maxbin,this.minposbin);for(I=N.i1;I<N.i2;++I){for(G=N.j1;G<N.j2;++G){x=y.getBinContent(I+1,G+1);if((x<=0)||(x<this.minbin)){continue}q=N.grx[I+1]-N.grx[I];u=N.gry[G]-N.gry[G+1];if(q*u<=0){continue}r=this.getContourIndex(x/q/u);if(r<0){continue}o="M"+N.grx[I]+","+N.gry[G+1];if(O[r]===undefined){O[r]=o;p[r]=q;s[r]=u}else{l="m"+(N.grx[I]-M[r])+","+(N.gry[G+1]-L[r]);O[r]+=(l.length<o.length)?l:o;p[r]=Math.max(p[r],q);s[r]=Math.max(s[r],u)}M[r]=N.grx[I];L[r]=N.gry[G+1];O[r]+="v"+u+"h"+q+"v-"+u+"z"}}var P=this.svg_frame().select(".main_layer"),m=P.select("defs");if(m.empty()&&(O.length>0)){m=P.insert("svg:defs",":first-child")}if(!this.markeratt){this.markeratt=new b.TAttMarkerHandler(y)}for(r=0;r<O.length;++r){if((O[r]!==undefined)&&(r<this.fContour.length)){var E="scatter_"+r,K=m.select("."+E);if(K.empty()){K=m.append("svg:pattern").attr("class",E).attr("id","jsroot_scatter_pattern_"+b.id_counter++).attr("patternUnits","userSpaceOnUse")}else{K.selectAll("*").remove()}var v=Math.round(z*this.fContour[r]*p[r]*s[r]);if(v<1){v=1}var H=new Float32Array(v),D=new Float32Array(v);if(v===1){H[0]=D[0]=0.5}else{for(var B=0;B<v;++B){H[B]=Math.random();D[B]=Math.random()}}this.markeratt.reset_pos();var A="";for(var B=0;B<v;++B){A+=this.markeratt.create(H[B]*p[r],D[B]*s[r])}K.attr("width",p[r]).attr("height",s[r]).append("svg:path").attr("d",A).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",r).attr("fill","url(#"+K.attr("id")+")").attr("d",O[r])}}return N};g.prototype.DrawBins=function(){this.CheckHistDrawAttributes();this.CreateG(true);var i=this.frame_width(),j=this.frame_height(),k=null;if(this.options.Color+this.options.Box+this.options.Scat+this.options.Text+this.options.Contour+this.options.Arrow+this.options.Candle.length==0){this.options.Scat=1}if(this.draw_content){if(this.IsTH2Poly()){k=this.DrawPolyBinsColor(i,j)}else{if(this.options.Color>0){k=this.DrawBinsColor(i,j)}else{if(this.options.Scat>0){k=this.DrawBinsScatter(i,j)}else{if(this.options.Box>0){k=this.DrawBinsBox(i,j)}else{if(this.options.Arrow>0){k=this.DrawBinsArrow(i,j)}else{if(this.options.Contour>0){k=this.DrawBinsContour(i,j)}else{if(this.options.Candle.length>0){k=this.DrawCandle(i,j)}}}}}}}}if(this.options.Text>0){k=this.DrawBinsText(i,j,k)}this.tt_handle=k};g.prototype.GetBinTips=function(p,o){var l=[],k=this.main_painter();l.push(this.GetTipName());if(k.x_kind=="labels"){l.push("x = "+k.AxisAsText("x",this.GetBinX(p)))}else{l.push("x = ["+k.AxisAsText("x",this.GetBinX(p))+", "+k.AxisAsText("x",this.GetBinX(p+1))+")")}if(k.y_kind=="labels"){l.push("y = "+k.AxisAsText("y",this.GetBinY(o)))}else{l.push("y = ["+k.AxisAsText("y",this.GetBinY(o))+", "+k.AxisAsText("y",this.GetBinY(o+1))+")")}l.push("bin = "+p+", "+o);var m=this.GetObject(),q=m.getBinContent(p+1,o+1);if(m.$baseh){q-=m.$baseh.getBinContent(p+1,o+1)}if(q===Math.round(q)){l.push("entries = "+q)}else{l.push("entries = "+b.FFormat(q,b.gStyle.fStatFormat))}return l};g.prototype.GetCandleTips=function(k){var j=[],i=this.main_painter();j.push(this.GetTipName());j.push("x = "+i.AxisAsText("x",this.GetBinX(k.bin)));j.push("mean y = "+b.FFormat(k.meany,b.gStyle.fStatFormat));j.push("m25 = "+b.FFormat(k.m25y,b.gStyle.fStatFormat));j.push("p25 = "+b.FFormat(k.p25y,b.gStyle.fStatFormat));return j};g.prototype.ProvidePolyBinHints=function(m,i,r){var s=this.histo.fBins.arr[m],p=this.main_painter(),q=s.fPoly.fName,t=[],o=0;if(q==="Graph"){q=""}if(q.length===0){q=s.fNumber}if((i===undefined)&&(r===undefined)){i=r=0;var l=s.fPoly,k=1;if(l._typename==="TMultiGraph"){k=s.fPoly.fGraphs.arr.length;l=null}for(var j=0;j<k;++j){if(!l||(j>0)){l=s.fPoly.fGraphs.arr[j]}for(n=0;n<l.fNpoints;++n){++o;i+=l.fX[n];r+=l.fY[n]}}if(o>1){i=i/o;r=r/o}}t.push(this.GetTipName());t.push("x = "+p.AxisAsText("x",i));t.push("y = "+p.AxisAsText("y",r));if(o>0){t.push("npnts = "+o)}t.push("bin = "+q);if(s.fContent===Math.round(s.fContent)){t.push("content = "+s.fContent)}else{t.push("content = "+b.FFormat(s.fContent,b.gStyle.fStatFormat))}return t};g.prototype.ProcessTooltip=function(N){if(!N||!this.draw_content||!this.draw_g||!this.tt_handle){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}this.ProvideUserTooltip(null);return null}var x=this.GetObject(),J=this.tt_handle,G,M=this.draw_g.select(".tooltip_bin");if(J.poly){var u=this.main_painter(),s,r,m=-1;if(u.grx===u.x){s=u.x.invert(N.x)}if(u.gry===u.y){r=u.y.invert(N.y)}if((s!==undefined)&&(r!==undefined)){var G,I=x.fBins.arr.length,z;for(G=0;(G<I)&&(m<0);++G){z=x.fBins.arr[G];if((s<z.fXmin)||(s>z.fXmax)||(r<z.fYmin)||(r>z.fYmax)){continue}if((z.fContent===0)&&(this.options.Color===11)){continue}var C=z.fPoly,A=1;if(C._typename==="TMultiGraph"){A=z.fPoly.fGraphs.arr.length;C=null}for(var v=0;v<A;++v){if(!C||(v>0)){C=z.fPoly.fGraphs.arr[v]}if(C.IsInside(s,r)){m=G;break}}}}if(m<0){M.remove();this.ProvideUserTooltip(null);return null}var O={name:x.fName,title:x.fTitle,x:N.x,y:N.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.color:"blue",exact:true,menu:true,lines:this.ProvidePolyBinHints(m,s,r)};if(N.disabled){M.remove();O.changed=true}else{if(M.empty()){M=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")}O.changed=M.property("current_bin")!==m;if(O.changed){M.attr("d",this.CreatePolyBin(u,z)).style("opacity","0.7").property("current_bin",m)}}if(this.IsUserTooltipCallback()&&O.changed){this.ProvideUserTooltip({obj:x,name:x.fName,bin:m,cont:z.fContent,grx:N.x,gry:N.y})}return O}else{if(J.candle){var B;for(G=0;G<J.candle.length;++G){B=J.candle[G];if((B.x1<=N.x)&&(N.x<=B.x2)&&(B.yy1<=N.y)&&(N.y<=B.yy2)){break}}if(G>=J.candle.length){M.remove();this.ProvideUserTooltip(null);return null}var O={name:x.fName,title:x.fTitle,x:N.x,y:N.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.color:"blue",lines:this.GetCandleTips(B),exact:true,menu:true};if(N.disabled){M.remove();O.changed=true}else{if(M.empty()){M=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}O.changed=M.property("current_bin")!==G;if(O.changed){M.attr("x",B.x1).attr("width",B.x2-B.x1).attr("y",B.yy1).attr("height",B.yy2-B.yy1).style("opacity","0.7").property("current_bin",G)}}if(this.IsUserTooltipCallback()&&O.changed){this.ProvideUserTooltip({obj:x,name:x.fName,bin:G+1,cont:B.median,binx:G+1,biny:1,grx:N.x,gry:N.y})}return O}}var G,F,w=0,t=null;for(G=J.i1;G<J.i2;++G){if((N.x>=J.grx[G])&&(N.x<=J.grx[G+1])){break}}for(F=J.j1;F<J.j2;++F){if((N.y>=J.gry[F+1])&&(N.y<=J.gry[F])){break}}if((G<J.i2)&&(F<J.j2)){w=x.getBinContent(G+1,F+1);if(this.is_projection){t=0}else{if(J.hide_only_zeros){t=(w===0)&&!this._show_empty_bins?null:0}else{t=this.getContourColor(w,true);if((t===null)&&(w===0)&&this._show_empty_bins){t=0}}}}if(t===null){M.remove();this.ProvideUserTooltip(null);return null}var O={name:x.fName,title:x.fTitle,x:N.x,y:N.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.color:"blue",lines:this.GetBinTips(G,F),exact:true,menu:true};if(this.options.Color>0){O.color2=this.GetPalette().getColor(t)}if(N.disabled){M.remove();O.changed=true}else{if(M.empty()){M=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}var E=G,D=G+1,l=F,k=F+1,K=J.grx[E],H=J.grx[D],q=J.gry[k],o=J.gry[l],y=G*10000+F;if(this.is_projection=="X"){K=0;H=this.frame_width();if(this.projection_width>1){var L=(this.projection_width-1)/2;if(k+L>=J.j2){k=Math.min(Math.round(k+L),J.j2);l=Math.max(k-this.projection_width,J.j1)}else{l=Math.max(Math.round(l-L),J.j1);k=Math.min(l+this.projection_width,J.j2)}}q=J.gry[k];o=J.gry[l];y=l*777+k*333}else{if(this.is_projection=="Y"){q=0;o=this.frame_height();if(this.projection_width>1){var L=(this.projection_width-1)/2;if(D+L>=J.i2){D=Math.min(Math.round(D+L),J.i2);E=Math.max(D-this.projection_width,J.i1)}else{E=Math.max(Math.round(E-L),J.i1);D=Math.min(E+this.projection_width,J.i2)}}K=J.grx[E],H=J.grx[D],y=E*777+D*333}}O.changed=M.property("current_bin")!==y;if(O.changed){M.attr("x",K).attr("width",H-K).attr("y",q).attr("height",o-q).style("opacity","0.7").property("current_bin",y)}if(this.is_projection&&O.changed){this.RedrawProjection(E,D,l,k)}}if(this.IsUserTooltipCallback()&&O.changed){this.ProvideUserTooltip({obj:x,name:x.fName,bin:x.getBin(G+1,F+1),cont:w,binx:G+1,biny:F+1,grx:N.x,gry:N.y})}return O};g.prototype.CanZoomIn=function(k,j,i){if((k=="x")&&(this.GetIndexX(i,0.5)-this.GetIndexX(j,0)>1)){return true}if((k=="y")&&(this.GetIndexY(i,0.5)-this.GetIndexY(j,0)>1)){return true}if(k=="z"){return true}return false};g.prototype.Draw2D=function(k,j){this.mode3d=false;if(typeof this.Create3DScene=="function"){this.Create3DScene(-1)}this.CreateXY();var i=this.DrawColorPalette((this.options.Zscale>0)&&((this.options.Color>0)||(this.options.Contour>0)),true);this.DrawAxes();this.DrawGrids();this.DrawBins();if(i){i.DrawPave()}this.DrawTitle();this.UpdateStatWebCanvas();this.AddInteractive();b.CallBack(k)};g.prototype.Draw3D=function(j,i){this.mode3d=true;b.AssertPrerequisites("hist3d",function(){this.Draw3D(j,i)}.bind(this))};g.prototype.CallDrawFunc=function(m,k){var j=this.main_painter(),l=false;if((this.options.Contour>0)&&(j!==this)){l=j.mode3d}else{if((this.options.Lego>0)||(this.options.Surf>0)||(this.options.Error>0)){l=true}}if((j!==this)&&(l!==j.mode3d)){l=j.mode3d;this.options.Lego=j.options.Lego;this.options.Surf=j.options.Surf;this.options.Error=j.options.Error}var i=l?"Draw3D":"Draw2D";this[i](m,k)};g.prototype.Redraw=function(i){this.CallDrawFunc(null,i)};b.Painter.drawHistogram2D=function(l,j,k){var i=new b.TH2Painter(j);i.SetDivId(l,1);i.options=i.DecodeOptions(k);if(i.IsTH2Poly()){if(i.options.Lego){i.options.Lego=12}else{if(!i.options.Color){i.options.Color=1}}}i._show_empty_bins=false;i._can_move_colz=true;if((i.options.Contour!==14)&&!i.options.Lego&&!i.options.Surf){i.CheckPadRange()}i.ScanContent();i.CreateStat();i.CallDrawFunc(function(){this.DrawNextFunction(0,function(){if((this.options.Lego<=0)&&(this.options.Surf<=0)){if(this.options.AutoZoom){this.AutoZoom()}}this.FillToolbar();if(this.options.Project&&!this.mode3d){this.ToggleProjection(this.options.Project)}this.DrawingReady()}.bind(this))}.bind(i));return i};function f(i){b.TObjectPainter.call(this,i);this.nostack=false;this.firstpainter=null;this.painters=[]}f.prototype=Object.create(b.TObjectPainter.prototype);f.prototype.Cleanup=function(){delete this.firstpainter;delete this.painters;b.TObjectPainter.prototype.Cleanup.call(this)};f.prototype.HasErrors=function(i){if(i.fSumw2&&(i.fSumw2.length>0)){for(var j=0;j<i.fSumw2.length;++j){if(i.fSumw2[j]>0){return true}}}return false};f.prototype.BuildStack=function(){var l=this.GetObject();if(!l.fHists){return false}var k=l.fHists.arr.length;if(k<=0){return false}var j=b.Create("TList");j.Add(b.clone(l.fHists.arr[0]));this.haserrors=this.HasErrors(l.fHists.arr[0]);for(var p=1;p<k;++p){var m=b.clone(l.fHists.arr[p]),o=j.arr[p-1];if((m.fNbins!=o.fNbins)||(m.fXaxis.fXmin!=o.fXaxis.fXmin)||(m.fXaxis.fXmax!=o.fXaxis.fXmax)){b.console("When drawing THStack, cannot sum-up histograms "+m.fName+" and "+o.fName);j.Clear();return false}this.haserrors=this.haserrors||this.HasErrors(l.fHists.arr[p]);for(var q=0;q<m.fArray.length;++q){m.fArray[q]+=o.fArray[q]}j.Add(m)}l.fStack=j;return true};f.prototype.GetHistMinMax=function(t,w){var u={min:0,max:0},v=true,k=true;if(t.fMinimum!==-1111){u.min=t.fMinimum;v=false}if(t.fMaximum!==-1111){u.max=t.fMaximum;k=false}if(!v&&!k){return u}var p=1,m=t.fXaxis.fNbins,y=1,x=1,s=true;if(t.fXaxis.TestBit(b.EAxisBits.kAxisRange)){p=t.fXaxis.fFirst;m=t.fXaxis.fLast}if(t._typename.indexOf("TH2")===0){x=t.fYaxis.fNbins;if(t.fYaxis.TestBit(b.EAxisBits.kAxisRange)){y=t.fYaxis.fFirst;x=t.fYaxis.fLast}}for(var q=y;q<=x;++q){for(var r=p;r<=m;++r){var l=t.getBinContent(r,q),o=w?t.getBinError(t.getBin(r,q)):0;if(v&&(s||(l-o<u.min))){u.min=l-o}if(k&&(s||(l+o>u.max))){u.max=l+o}s=false}}return u};f.prototype.GetMinMax=function(m,p){var l={min:0,max:0},j=this.GetObject();if(this.nostack){for(var k=0;k<j.fHists.arr.length;++k){var o=this.GetHistMinMax(j.fHists.arr[k],m);if(k==0){l=o}else{if(o.min<l.min){l.min=o.min}if(o.max>l.max){l.max=o.max}}}if(j.fMaximum!=-1111){l.max=j.fMaximum}else{l.max*=1.05}if(j.fMinimum!=-1111){l.min=j.fMinimum}}else{l.min=this.GetHistMinMax(j.fStack.arr[0],m).min;l.max=this.GetHistMinMax(j.fStack.arr[j.fStack.arr.length-1],m).max*1.05}if(p){if(p.fLogy){if(l.min<0){l.min=l.max*0.0001}}else{if((l.min>0)&&(l.min<0.05*l.max)){l.min=0}}}return l};f.prototype.DrawNextHisto=function(o,i,l,m){if(l==="callback"){l=null;if(o<0){this.firstpainter=m}else{this.painters.push(m)}o++}var s=this.GetObject(),r=s.fHistogram,u="",j=this.nostack?s.fHists:s.fStack,t=(j&&j.arr)?j.arr.length:0,q=0;if(o>=t){this._pfc=this._plc=this._pmc=false;return this.DrawingReady()}if(o>=0){q=this.horder?o:t-o-1;r=j.arr[q];u=j.opt[q]||r.fOption||i;if(u.toUpperCase().indexOf(i)<0){u+=i}u+=" same";if(this._pfc||this._plc||this._pmc){if(!this.pallette&&b.Painter.GetColorPalette){this.palette=b.Painter.GetColorPalette()}if(this.palette){var k=this.palette.calcColor(q,t+1);var p=this.add_color(k);if(this._pfc){r.fFillColor=p}if(this._plc){r.fLineColor=p}if(this._pmc){r.fMarkerColor=p}}}}else{u=(i||"")+" axis";if(l){u+=";minimum:"+l.min+";maximum:"+l.max}}if((q>0)&&!this.nostack){r.$baseh=j.arr[q-1]}b.draw(this.divid,r,u,this.DrawNextHisto.bind(this,o,i,"callback"))};f.prototype.drawStack=function(j){var z=this.root_pad(),m=this.GetObject(),l=m.fHists,B=l.arr.length,k=1;if((B>0)&&(l.arr[0]._typename.indexOf("TH2")==0)){k=2}if((k==2)&&!j){j="lego1"}var A=new b.DrawOptions(j),o=A.check("SAME");this.nostack=A.check("NOSTACK");this._pfc=A.check("PFC");this._plc=A.check("PLC");this._pmc=A.check("PMC");j=A.remain();if(!this.nostack){this.nostack=!this.BuildStack()}this.dolego=A.check("LEGO");if(!this.nostack&&this.haserrors&&!this.dolego&&!A.check("HIST")){j+=" E"}this.horder=this.nostack||this.dolego;var x=this.GetMinMax(A.check("E"),z);var p=m.fHistogram;if(!p){var q=0,s=0,u=0,y=0;for(var v=0;v<B;++v){var w=l.arr[v];if(v==0||w.fXaxis.fXmin<q){q=w.fXaxis.fXmin}if(v==0||w.fXaxis.fXmax>s){s=w.fXaxis.fXmax}if(v==0||w.fYaxis.fXmin<u){u=w.fYaxis.fXmin}if(v==0||w.fYaxis.fXmax>y){y=w.fYaxis.fXmax}}var w=m.fHists.arr[0];p=b.CreateHistogram((k==1)?"TH1I":"TH2I",w.fXaxis.fNbins,w.fYaxis.fNbins);p.fName="axis_hist";p.fXaxis=b.clone(w.fXaxis);p.fYaxis=b.clone(w.fYaxis);p.fXaxis.fXmin=q;p.fXaxis.fXmax=s;p.fYaxis.fXmin=u;p.fYaxis.fXmax=y;m.fHistogram=p}p.fTitle=m.fTitle;if(z&&z.fLogy){if(x.max<=0){x.max=1}if(x.min<=0){x.min=0.0001*x.max}var r=1/(1+0.5*b.log10(x.max/x.min)),t=1+0.2*b.log10(x.max/x.min);x.min*=r;x.max*=t}this.DrawNextHisto(!o?-1:0,j,x);return this};f.prototype.UpdateObject=function(p){if(!this.MatchObjectType(p)){return false}var k=this.nostack?p.fHists:p.fStack;if(!k){return false}var m=false;if(this.firstpainter){if(this.firstpainter.UpdateObject(p.fHistogram)){m=true}}var j=Math.min(k.arr.length,this.painters.length);for(var l=0;l<j;++l){var o=k.arr[this.horder?l:j-l-1];if(this.painters[l].UpdateObject(o)){m=true}}return m};b.Painter.drawHStack=function(l,i,k){var j=new b.THStackPainter(i);j.SetDivId(l,-1);if(!i.fHists||(i.fHists.arr.length==0)){return j.DrawingReady()}j.drawStack(k);j.SetDivId(l);return j};b.Painter.drawTF2=function(u,o,m){var t=null,z=0,v=0,l=1,s=new b.DrawOptions(m);if(s.check("NOSAVE")){l=0}if(!o.fSave||o.fSave.length<7||!l){l=0}else{l=o.fSave.length;z=Math.round(o.fSave[l-2]);v=Math.round(o.fSave[l-1]);if(l!==(z+1)*(v+1)+6){l=0}}if(l>6){var C=(o.fSave[l-5]-o.fSave[l-6])/z/2,B=(o.fSave[l-3]-o.fSave[l-4])/v/2;t=b.CreateHistogram("TH2F",z+1,v+1);t.fXaxis.fXmin=o.fSave[l-6]-C;t.fXaxis.fXmax=o.fSave[l-5]+C;t.fYaxis.fXmin=o.fSave[l-4]-B;t.fYaxis.fXmax=o.fSave[l-3]+B;for(var p=0,q=0;q<=v;++q){for(var r=0;r<=z;++r){t.setBinContent(t.getBin(r+1,q+1),o.fSave[p++])}}}else{z=Math.max(o.fNpx,2);v=Math.max(o.fNpy,2);t=b.CreateHistogram("TH2F",z,v);t.fXaxis.fXmin=o.fXmin;t.fXaxis.fXmax=o.fXmax;t.fYaxis.fXmin=o.fYmin;t.fYaxis.fXmax=o.fYmax;for(var q=0;q<v;++q){for(var r=0;r<z;++r){var A=o.fXmin+(r+0.5)*(o.fXmax-o.fXmin)/z,w=o.fYmin+(q+0.5)*(o.fYmax-o.fYmin)/v;t.setBinContent(t.getBin(r+1,q+1),o.evalPar(A,w))}}}t.fName="Func";t.fTitle=o.fTitle;t.fMinimum=o.fMinimum;t.fMaximum=o.fMaximum;t.fLineColor=o.fLineColor;t.fLineStyle=o.fLineStyle;t.fLineWidth=o.fLineWidth;t.fFillColor=o.fFillColor;t.fFillStyle=o.fFillStyle;t.fMarkerColor=o.fMarkerColor;t.fMarkerStyle=o.fMarkerStyle;t.fMarkerSize=o.fMarkerSize;t.fBits|=b.TH1StatusBits.kNoStats;if(s.empty()){m="cont3"}else{if(s.opt==="SAME"){m="cont2 same"}else{m=s.opt}}return b.Painter.drawHistogram2D(u,t,m)};b.TPavePainter=a;b.TAxisPainter=d;b.THistPainter=e;b.TH1Painter=h;b.TH2Painter=g;b.THStackPainter=f;return b}));