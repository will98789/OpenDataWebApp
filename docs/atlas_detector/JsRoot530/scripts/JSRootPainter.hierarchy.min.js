(function(a){if(typeof define==="function"&&define.amd){define(["JSRootCore","d3","JSRootPainter"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"),require("./JSRootPainter.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.js","JSRootPainter.hierarchy.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.hierarchy.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.hierarchy.js")}a(JSROOT,d3)}}}(function(d,k){d.sources.push("hierarchy");function h(m,o){if((o==null)||!("fFolders" in o)||(o.fFolders==null)){return false}if(o.fFolders.arr.length===0){m._more=false;return true}m._childs=[];for(var l=0;l<o.fFolders.arr.length;++l){var n=o.fFolders.arr[l];m._childs.push({_name:n.fName,_kind:"ROOT."+n._typename,_obj:n})}return true}function i(m,o){if((o==null)||!("fTasks" in o)||(o.fTasks==null)){return false}j(m,o,{exclude:["fTasks","fName"]});if((o.fTasks.arr.length===0)&&(m._childs.length==0)){m._more=false;return true}for(var l=0;l<o.fTasks.arr.length;++l){var n=o.fTasks.arr[l];m._childs.push({_name:n.fName,_kind:"ROOT."+n._typename,_obj:n})}return true}function e(m,t){if(!d.IsRootCollection(t)){return false}if((t.arr===undefined)||(t.arr.length===0)){m._more=false;return true}var l=false,p=m;while(p){if(p._do_context){l=true}p=p._parent}var x=(t._typename=="TMap"),v=[],o=[],q=[];for(var s=0;s<t.arr.length;++s){var r=x?t.arr[s].first:t.arr[s];if(!r){continue}var n=r.fName||r.name;if(!n){continue}var u=v.indexOf(n);if(u>=0){o[u]++}else{o[v.length]=q[v.length]=1;v.push(n)}}m._childs=[];for(var s=0;s<t.arr.length;++s){var r=x?t.arr[s].first:t.arr[s];var w;if(!r||!r._typename){w={_name:s.toString(),_kind:"ROOT.NULL",_title:"NULL",_value:"null",_obj:null}}else{w={_name:r.fName||r.name,_kind:"ROOT."+r._typename,_title:(r.fTitle||"")+" type:"+r._typename,_obj:r};switch(r._typename){case"TColor":w._value=d.Painter.MakeColorRGB(r);break;case"TText":w._value=r.fTitle;break;case"TLatex":w._value=r.fTitle;break;case"TObjString":w._value=r.fString;break;default:if(t.opt&&t.opt[s]&&t.opt[s].length){w._value=t.opt[s]}}if(l&&d.canDraw(r._typename)){w._direct_context=true}if(!w._name||(!isNaN(parseInt(w._name))&&(parseInt(w._name)!==s))||(t.arr.indexOf(r)<s)){w._name=s.toString()}else{var u=v.indexOf(r.fName);if((u>=0)&&(o[u]>1)){w._cycle=q[u]++;w._keyname=w._name;w._name=w._keyname+";"+w._cycle}}}m._childs.push(w)}return true}function a(r,q,o,s){if(q===undefined){return false}r._childs=[];for(var n=0;n<q.length;++n){var m=q[n];var p={_name:m.fName+";"+m.fCycle,_cycle:m.fCycle,_kind:"ROOT."+m.fClassName,_title:m.fTitle,_keyname:m.fName,_readobj:null,_parent:r};if(m.fObjlen>100000){p._title+=" (size: "+(m.fObjlen/1000000).toFixed(1)+"MB)"}if("fRealName" in m){p._realname=m.fRealName+";"+m.fCycle}if(m.fClassName=="TDirectory"||m.fClassName=="TDirectoryFile"){var l=null;if((s!=null)&&(o!=null)){l=o.GetDir(s+m.fName)}if(l==null){p._more=true;p._expand=function(t,u){return a(t,u.fKeys)}}else{p._name=m.fName;a(p,l.fKeys,o,s+m.fName+"/")}}else{if((m.fClassName=="TList")&&(m.fName=="StreamerInfo")){p._name="StreamerInfo";p._kind="ROOT.TStreamerInfoList";p._title="List of streamer infos for binary I/O";p._readobj=o.fStreamerInfos}}r._childs.push(p)}return true}function j(v,t,n){if(!v||(t===null)){return false}v._childs=[];var w=Object.prototype.toString.apply(t);if(w==="[object DataView]"){var G={_parent:v,_name:"size",_value:t.byteLength.toString(),_vclass:"h_value_num"};v._childs.push(G);var r=(t.byteLength<10)?1:d.log10(t.byteLength);for(var y=0;y<t.byteLength;++y){if(y%16===0){G={_parent:v,_name:y.toString(),_value:"",_vclass:"h_value_num"};while(G._name.length<r){G._name="0"+G._name}v._childs.push(G)}var M=t.getUint8(y).toString(16);while(M.length<2){M="0"+M}if(G._value.length>0){G._value+=(y%4===0)?" | ":" "}G._value+=M}return true}var L=true,H=false,z=v;while(z){if(z._do_context){H=true}if("_nosimple" in z){L=z._nosimple;break}z=z._parent}var o=(w.lastIndexOf("Array]")==w.length-6)&&(w.indexOf("[object")==0)&&!isNaN(t.length),C=o&&(t.length>d.gStyle.HierarchyLimit),J=false;if(o&&(v._name==="Object")&&!v._parent){v._name="Array"}if(C){J=true;for(var y=0;y<t.length;++y){var I=typeof t[y];if((I==="number")||(I==="boolean")||(I=="string"&&(t[y].length<16))){continue}J=false;break}}if(!("_obj" in v)){v._obj=t}else{if(v._obj!==t){alert("object missmatch")}}if(!v._title){if(t._typename){v._title="ROOT."+t._typename}else{if(o){v._title="Array len: "+t.length}}}if(J){for(var y=0;y<t.length;){var u=Math.min(y+10,t.length),s=true,E=y;while(s){s=true;for(var F=E;F<u;++F){if(t[y]!==t[F]){s=false}}if(s){if(u===t.length){break}E=u;u=Math.min(u+10,t.length)}else{if(E!==y){u=E;s=true;break}}}var G={_parent:v,_name:y+".."+(u-1),_vclass:"h_value_num"};if(s){G._value=t[y].toString()}else{G._value="";for(var F=y;F<u;++F){G._value+=((F===y)?"[ ":", ")+t[F].toString()}G._value+=" ]"}v._childs.push(G);y=u}return true}var p,m,q,B;for(var K in t){if((K=="_typename")||(K[0]=="$")){continue}var l=t[K];if(typeof l=="function"){continue}if(n&&n.exclude&&(n.exclude.indexOf(K)>=0)){continue}if(C&&p){if(q===l){++B;m=K;continue}if(B>0){p._name+=".."+m}}var G={_parent:v,_name:K};if(C){p=G;m=K;q=l;B=0}if(l===null){G._value=G._title="null";if(!L){v._childs.push(G)}continue}var x=false;if(typeof l=="object"){w=Object.prototype.toString.apply(l);if((w.lastIndexOf("Array]")==w.length-6)&&(w.indexOf("[object")==0)){G._title="array len="+l.length;x=(w!="[object Array]");if(l.length===0){G._value="[ ]";G._more=false}else{G._value="[...]";G._more=true;G._expand=j;G._obj=l}}else{if(w==="[object DataView]"){G._title="DataView len="+l.byteLength;G._value="[...]";G._more=true;G._expand=j;G._obj=l}else{if(w==="[object Date]"){G._more=false;G._title="Date";G._value=l.toString();G._vclass="h_value_num"}else{if(l.$kind||l._typename){G._kind=G._title="ROOT."+(l.$kind||l._typename)}if(l._typename){G._title=l._typename;if(H&&d.canDraw(l._typename)){G._direct_context=true}}var D=v,A=false;while(D&&!A){A=(D._obj===l);D=D._parent}if(A){G._value="{ prnt }";x=true}else{G._obj=l;G._more=false;switch(l._typename){case"TColor":G._value=d.Painter.MakeColorRGB(l);break;case"TText":G._value=l.fTitle;break;case"TLatex":G._value=l.fTitle;break;case"TObjString":G._value=l.fString;break;default:if(d.IsRootCollection(l)&&(typeof l.arr==="object")){G._value=l.arr.length?"[...]":"[]";G._title+=", size:"+l.arr.length;if(l.arr.length>0){G._more=true}}else{G._more=true;G._value="{ }"}}}}}}}else{if((typeof l==="number")||(typeof l==="boolean")){x=true;if(K=="fBits"){G._value="0x"+l.toString(16)}else{G._value=l.toString()}G._vclass="h_value_num"}else{if(typeof l==="string"){x=true;G._value="&quot;"+l.replace(/\&/g,"&amp;").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"&quot;";G._vclass="h_value_str"}else{if(typeof l==="undefined"){x=true;G._value="undefined";G._vclass="h_value_num"}else{x=true;alert("miss "+K+"  "+typeof l)}}}}if(!x||!L){v._childs.push(G)}}if(C&&p&&(B>0)){p._name+=".."+m}return true}d.hpainter=null;function c(l,m,n){d.TBasePainter.call(this);this.name=l;this.h=null;this.with_icons=true;this.background=n;this.files_monitoring=(m==null);this.nobrowser=(m===null);if(!this.nobrowser){this.SetDivId(m)}if(!d.hpainter){d.hpainter=this}}c.prototype=Object.create(d.TBasePainter.prototype);c.prototype.Cleanup=function(){this.clear(true);d.TBasePainter.prototype.Cleanup.call(this);if(d.hpainter===this){d.hpainter=null}};c.prototype.FileHierarchy=function(m){var l=this;var n={_name:m.fFileName,_title:(m.fTitle?(m.fTitle+", path "):"")+m.fFullURL,_kind:"ROOT.TFile",_file:m,_fullurl:m.fFullURL,_localfile:m.fLocalFile,_had_direct_read:false,_get:function(p,s,r){var o=this;if(p&&p._readobj){return d.CallBack(r,p,p._readobj)}if(p!=null){s=l.itemFullName(p,o)}function q(t){if(o._file==null){o._file=t}if(t==null){return d.CallBack(r,p,null)}t.ReadObject(s,function(w){if((p==null)&&(w!=null)){var x=l.Find({name:s,top:o,last_exists:true,check_keys:true});if((x!=null)&&("last" in x)&&(x.last!=o)){var u=t.GetDir(l.itemFullName(x.last,o));if(u){x.last._name=x.last._keyname;var v=l.itemFullName(x.last,o);a(x.last,u.fKeys,t,v+"/")}}else{a(o,t.fKeys,t,"")}p=l.Find({name:s,top:o})}if(p!=null){p._readobj=w;if("_expand" in p){p._name=p._keyname}}d.CallBack(r,p,w)})}if(o._file){q(o._file)}else{if(o._localfile){new d.TLocalFile(o._localfile,q)}else{if(o._fullurl){new d.TFile(o._fullurl,q)}}}}};a(n,m.fKeys,m,"");return n};c.prototype.ForEach=function(n,m){if(m==null){m=this.h}if((m==null)||(typeof n!="function")){return}function l(o){n(o);if("_childs" in o){for(var p=0;p<o._childs.length;++p){o._childs[p]._parent=o;l(o._childs[p])}}}l(m)};c.prototype.Find=function(l){function m(u,y){if(!y||(y.length==0)||!u){return u}var t=y.length;if(!u._parent&&(u._kind!=="TopFolder")&&(y.indexOf(u._name)===0)){if(y===u._name){return u}var s=u._name.length;if(y[s]=="/"){y=y.substr(s+1);t=y.length}}function v(B,A){if(!A){B._parent=u}if((t>=y.length-1)||(t<0)){return B}return m(B,y.substr(t+1))}while(t>0){var x=(t>=y.length)?y:y.substr(0,t);if(u._childs){for(var q=0;q<u._childs.length;++q){if(u._childs[q]._name==x){return v(u._childs[q])}}if((u._kind==="TopFolder")&&(u._childs[0]._online!==undefined)){for(var q=0;q<u._childs[0]._childs.length;++q){if(u._childs[0]._childs[q]._name==x){return v(u._childs[0]._childs[q],true)}}}if(l.check_keys){var w=null;for(var q=0;q<u._childs.length;++q){if(u._childs[q]._keyname===x){if(!w||(w._cycle<u._childs[q]._cycle)){w=u._childs[q]}}}if(w){return v(w)}}var z=l.allow_index;if((x[0]==="[")&&(x[x.length-1]==="]")&&!isNaN(parseInt(x.substr(1,x.length-2)))){z=true;x=x.substr(1,x.length-2)}if(z){var r=parseInt(x);if(!isNaN(r)&&(r>=0)&&(r<u._childs.length)){return v(u._childs[r])}}}t=y.lastIndexOf("/",t-1)}if(l.force){if(u._childs===undefined){u._childs=[]}t=y.indexOf("/");var p={_name:((t<0)?y:y.substr(0,t))};u._childs.push(p);return v(p)}return(l.last_exists&&u)?{last:u,rest:y}:null}var n=this.h,o="";if(l===null){return null}else{if(typeof l=="string"){o=l;l={}}else{if(typeof l=="object"){o=l.name;if("top" in l){n=l.top}}else{return null}}}if(o==="__top_folder__"){return n}return m(n,o)};c.prototype.itemFullName=function(n,o,m){if(n&&n._kind==="TopFolder"){return"__top_folder__"}var l="";while(n){if((n._online!==undefined)&&!o){return l}if((n===o)||(n._kind==="TopFolder")){break}if(m&&!n._parent){break}if(l.length>0){l="/"+l}l=n._name+l;n=n._parent}return l};c.prototype.ExecuteCommand=function(q,t){var u=this.Find(q);var l=this.GetOnlineItemUrl(u)+"/cmd.json";var m=this;var p=k.select((typeof t=="function")?undefined:t);if("_numargs" in u){for(var o=0;o<u._numargs;++o){var r="arg"+(o+1);var s=null;if(o+2<arguments.length){s=arguments[o+2]}if((s==null)&&(typeof t=="object")){s=prompt("Input argument "+r+" for command "+u._name,"")}if(s==null){return}l+=((o==0)?"?":"&")+r+"="+s}}if(!p.empty()){p.style("background","yellow");if(u&&u._title){p.attr("title","Executing "+u._title)}}d.NewHttpRequest(l,"text",function(v){if(typeof t=="function"){return t(v)}if(p.empty()){return}var n=((v!=null)&&(v!="false"))?"green":"red";if(u&&u._title){p.attr("title",u._title+" lastres="+v)}p.style("background",n);setTimeout(function(){p.style("background","")},2000);if((n=="green")&&("_hreload" in u)){m.reload()}if((n=="green")&&("_update_item" in u)){m.updateItems(u._update_item.split(";"))}}).send()};c.prototype.RefreshHtml=function(m){if(!this.divid){return d.CallBack(m)}var l=this;d.AssertPrerequisites("jq2d",function(){l.RefreshHtml(m)})};c.prototype.get=function(q,m,t){if(q===null){return d.CallBack(m,null,null)}var n,p,l=this;if(typeof q==="string"){n=q}else{if(typeof q==="object"){if((q._parent!==undefined)&&(q._name!==undefined)&&(q._kind!==undefined)){p=q}else{if(q.name!==undefined){n=q.name}else{if(q.arg!==undefined){n=q.arg}else{if(q.item!==undefined){p=q.item}}}}}}if(p){n=this.itemFullName(p)}else{p=this.Find({name:n,allow_index:true,check_keys:true})}var o=(p!=null)?null:this.Find({name:n,last_exists:true,check_keys:true,allow_index:true});if((o!==null)&&("last" in o)&&(o.last!==null)){var r=this.itemFullName(o.last);if((typeof q=="object")&&("rest" in q)){if((q.rest==o.rest)||(q.rest.length<=o.rest.length)){return d.CallBack(m)}}return this.expand(r,function(v){if(!v){d.CallBack(m)}var u=l.itemFullName(o.last);if(u.length>0){u+="/"}l.get({name:u+o.rest,rest:o.rest},m,t)},null,true)}if((p!==null)&&(typeof p._obj=="object")){return d.CallBack(m,p,p._obj)}var s=p;while(s!=null){if(("_get" in s)&&(typeof s._get=="function")){return s._get(p,null,m,t)}s=("_parent" in s)?s._parent:null}d.CallBack(m,p,null)};c.prototype.draw=function(n,m,l){return d.draw(n,m,l)};c.prototype.redraw=function(n,m,l){return d.redraw(n,m,l)};c.prototype.player=function(q,m,p){var n=this.Find(q);if(!n||!("_player" in n)){return d.CallBack(p,null)}var o=this;var l=("_prereq" in n)?n._prereq:"";d.AssertPrerequisites(l,function(){var r=d.findFunction(n._player);if(r==null){return d.CallBack(p,null)}o.CreateDisplay(function(t){var s=null;if(t){s=r(o,q,m)}d.CallBack(p,s)})})};c.prototype.canDisplay=function(m,l){if(!m){return false}if("_player" in m){return true}if(m._can_draw===true){return true}if(l=="inspect"){return true}var n=d.getDrawHandle(m._kind,l);return n&&(("func" in n)||("draw_field" in n))};c.prototype.isItemDisplayed=function(m){var l=this.GetDisplay();if(!l){return false}return l.FindFrame(m)!==null};c.prototype.display=function(s,u,m){var o=this,v=null,t=false,x=null,q=s,r=s,n="::_display_on_frame_::",l=u?u.indexOf(n):-1;if(l>=0){r=u.substr(l+n.length);u=u.substr(0,l)}function w(p){if(!t){d.progress()}if(p&&(typeof p==="object")&&(typeof p.SetItemName==="function")){p.SetItemName(q,t?null:u,o);if(x&&!x._painter){x._painter=p}}d.CallBack(m,p||v,q)}o.CreateDisplay(function(z){if(!z){return w()}x=o.Find(q);if(x&&("_player" in x)){return o.player(q,u,w)}t=(typeof(u)=="string")&&(u.indexOf("update:")==0);if(t){u=u.substr(7);if(!x||x._doing_update){return w()}x._doing_update=true}if(x&&!o.canDisplay(x,u)){return w()}var y="";if((typeof(u)=="string")&&(u.indexOf("divid:")>=0)){var p=u.indexOf("divid:");y=u.slice(p+6);u=u.slice(0,p)}if(!t){d.progress("Loading "+q)}o.get(q,function(A,B){if(!t){d.progress()}if(!x){x=A}if(t&&x){delete x._doing_update}if(!B){return w()}if(!t){d.progress("Drawing "+q)}if(y.length>0){return(t?d.redraw:d.draw)(y,B,u,w)}z.ForEachPainter(function(E,F){if(E.GetItemName()!=q){return}if(!t&&(u!=null)&&(E.GetItemDrawOpt()!=u)){return}z.ActivateFrame(F);var D=null;if(B._typename){D=d.getDrawHandle("ROOT."+B._typename)}if(D&&D.draw_field&&B[D.draw_field]){B=B[D.draw_field]}if(E.RedrawObject(B)){v=E}});if(v){return w()}if(t){d.console("something went wrong - did not found painter when doing update of "+q);return w()}var C=z.FindFrame(r,true);k.select(C).html("");z.ActivateFrame(C);d.draw(k.select(C).attr("id"),B,u,w);if(d.gStyle.DragAndDrop){o.enable_dropping(C,q)}},u)})};c.prototype.enable_dragging=function(l,m){};c.prototype.enable_dropping=function(l,m){};c.prototype.dropitem=function(q,p,l,n){var m=this;if(l&&typeof l==="function"){n=l;l=""}if(l===undefined){l=""}function o(r){if(r&&(typeof r==="object")){r.SetItemName(q,null,m)}d.CallBack(n)}m.get(q,function(r,t){if(!t){return d.CallBack(n)}var s=new d.TObjectPainter();s.SetDivId(p,-1);var u=s.main_painter(true);if(u&&(typeof u.PerformDrop==="function")){return u.PerformDrop(t,q,r,l,o)}if(u&&u.accept_drops){return d.draw(p,t,"same "+l,o)}m.CleanupFrame(p);return d.draw(p,t,l,o)});return true};c.prototype.updateItems=function(l){if((this.disp==null)||(l==null)){return}var m=[],n=[];this.disp.ForEachPainter(function(o){var q=o.GetItemName();if((q==null)||(m.indexOf(q)>=0)){return}if(typeof l=="array"){if(l.indexOf(q)<0){return}}else{if(l!=q){return}}m.push(q);n.push("update:"+o.GetItemDrawOpt())},true);if(m.length>0){this.displayAll(m,n)}};c.prototype.updateAll=function(n,o){if(this.disp==null){return}if(n==="monitoring"){n=!this._monitoring_on}var q=[],m=[],p=this;this.disp.ForEachPainter(function(v){var w=v.GetItemName(),r=v.GetItemDrawOpt();if((w==null)||(q.indexOf(w)>=0)){return}var t=p.Find(w),s=false;if(!t||("_not_monitor" in t)||("_player" in t)){return}if("_always_monitor" in t){s=true}else{var u=d.getDrawHandle(t._kind);if(u&&("monitor" in u)){if((u.monitor===false)||(u.monitor=="never")){return}if(u.monitor==="always"){s=true}}}if(s||!n){q.push(w);m.push("update:"+r)}},true);var l=this;if(this.files_monitoring&&!n){this.ForEachRootFile(function(r){l.ForEach(function(s){delete s._readobj},r);delete r._file})}if(q.length>0){this.displayAll(q,m)}};c.prototype.displayAll=function(u,o,v){if(!u||(u.length==0)){return d.CallBack(v)}var B=this;if(!o){o=[]}while(o.length<u.length){o.push("")}if((o.length==1)&&(o[0]=="iotest")){B.clear();k.select("#"+B.disp_frameid).html("<h2>Start I/O test</h2>");var q=new Date();return B.get(u[0],function(G,H){var n=new Date();k.select("#"+B.disp_frameid).append("h2").html("Item "+u[0]+" reading time = "+(n.getTime()-q.getTime())+"ms");return d.CallBack(v)})}var p=new Array(u.length),D=new Array(u.length);for(var A=0;A<u.length;++A){p[A]=D[A]=null;var E=u[A],x=true;if(E&&(E.length>1)&&(E[0]=="'")&&(E[E.length-1]=="'")){u[A]=E.substr(1,E.length-2);x=false}var C=B.Find({name:u[A],check_keys:true});if(C){u[A]=B.itemFullName(C);continue}if(x&&(u[A][0]=="[")&&(u[A][u[A].length-1]=="]")){p[A]=d.ParseAsArray(u[A]);u[A]=p[A].shift()}else{if(x&&(u[A].indexOf("+")>0)){p[A]=u[A].split("+");u[A]=p[A].shift()}}if(p[A]&&p[A].length>0){for(var z=0;z<p[A].length;++z){var r=p[A][z].indexOf("_same_");if((r>0)&&(B.Find(p[A][z])==null)){p[A][z]=p[A][z].substr(0,r)+u[A].substr(r)}C=B.Find({name:p[A][z],check_keys:true});if(C){p[A][z]=B.itemFullName(C)}}if((o[A][0]=="[")&&(o[A][o[A].length-1]=="]")){D[A]=d.ParseAsArray(o[A]);o[A]=D[A].shift()}else{if(o[A].indexOf("+")>0){D[A]=o[A].split("+");o[A]=D[A].shift()}else{D[A]=[]}}while(D[A].length<p[A].length){D[A].push("")}}var r=u[A].indexOf("_same_");if((r>0)&&!B.Find(u[A])&&(A>0)){u[A]=u[A].substr(0,r)+u[0].substr(r)}C=B.Find({name:u[A],check_keys:true});if(C){u[A]=B.itemFullName(C)}}for(var w=u.length-1;w>=0;--w){var l=B.Find(u[w]);if(!l||B.canDisplay(l,o[w])){continue}B.expand(u[w],null,null,true);u.splice(w,1);o.splice(w,1);p.splice(w,1)}if(u.length==0){return d.CallBack(v)}var s=new Array(u.length),m=new Array(u.length);for(var w=0;w<u.length;++w){m[w]=0;var F=u[w],y=0;if(u.indexOf(F)<w){m[w]=true}while(s.indexOf(F)>=0){F=u[w]+"_"+y++}s[w]=F}for(var w=0;w<u.length;++w){if(m[w]!==0){continue}var t=w;for(var y=0;y<u.length;++y){if((u[w]===u[y])&&(o[y].indexOf("main")>=0)){t=y}}for(var y=0;y<u.length;++y){if(u[w]===u[y]){m[y]=(t!=y)}}}B.CreateDisplay(function(H){if(!H){return d.CallBack(v)}for(var G=0;G<u.length;++G){if(o[G].indexOf("update:")!==0){H.CreateFrame(s[G]);o[G]+="::_display_on_frame_::"+s[G]}}function n(L,I){if(I&&p[L]&&(p[L].length>0)){return B.dropitem(p[L].shift(),I.divid,D[L].shift(),n.bind(B,L,I))}p[L]=null;u[L]=null;var K=false;for(var J=0;J<u.length;++J){if(p[J]){K=true}if(u[J]===null){continue}K=true;if(m[J]&&u.indexOf(u[J])===J){m[J]=false;B.display(u[J],o[J],n.bind(B,J))}}if(!K&&v){d.CallBack(v);v=null}}for(var G=0;G<u.length;++G){if(!m[G]){B.display(u[G],o[G],n.bind(B,G))}}})};c.prototype.reload=function(){var l=this;if("_online" in this.h){this.OpenOnline(this.h._online,function(){l.RefreshHtml()})}};c.prototype.UpdateTreeNode=function(){};c.prototype.actiavte=function(m,o){if(typeof m=="string"){m=[m]}var q=[],l=this,r=[];this.ForEach(function(s){if(s._background){q.push(s);delete s._background}});function n(){if(typeof l.UpdateBackground!=="function"){return}for(var s=r.length-1;s>=0;--s){l.UpdateTreeNode(r[s])}for(var s=0;s<q.length;++s){l.UpdateBackground(q[s],o)}}function p(w,s){if(w===undefined){if(m.length==0){return n()}w=m.shift()}var t=l.Find(w);if(!t){var v=l.Find({name:w,last_exists:true,check_keys:true,allow_index:true});if(!v||!v.last){return p()}v.now_found=l.itemFullName(v.last);if(o){if((s!==undefined)&&(v.now_found===s)){return p()}return l.expand(v.now_found,function(y){if(!y){return p()}var x=l.itemFullName(v.last);if(x.length>0){x+="/"}p(x+v.rest,v.now_found)})}t=v.last}if(t){var u=t._parent;while(u){if(!u._isopen){if(o){u._isopen=true;if(r.indexOf(u)<0){r.push(u)}}else{t=u;break}}u=u._parent}t._background="grey";if(q.indexOf(t)<0){q.push(t)}}p()}if(o){if(!this.browser_kind){return this.CreateBrowser("float",true,p)}if(!this.browser_visible){this.ToggleBrowserVisisbility()}}p()};c.prototype.expand=function(r,o,q,l){var n=this,m=this.Find(r);if(!m&&q){return d.CallBack(o)}function p(t,v,s){if(!s){s=n.itemFullName(t)}var u=t._expand?null:d.getDrawHandle(t._kind,"::expand");if(v&&u&&u.expand_item){v=v[u.expand_item];if(v&&v._typename){u=d.getDrawHandle("ROOT."+v._typename,"::expand")}}if(u&&u.expand){d.AssertPrerequisites(u.prereq,function(){t._expand=d.findFunction(u.expand);if(t._expand){return p(t,v,s)}d.CallBack(o)});return true}if(v&&t&&(typeof t._expand==="function")){if(t._expand(t,v)){t._isopen=true;if(t._parent&&!t._parent._isopen){t._parent._isopen=true;if(!l){n.UpdateTreeNode(t._parent)}}else{if(!l){n.UpdateTreeNode(t,q)}}d.CallBack(o,t);return true}}if(v&&j(t,v)){t._isopen=true;if(t._parent&&!t._parent._isopen){t._parent._isopen=true;if(!l){n.UpdateTreeNode(t._parent)}}else{if(!l){n.UpdateTreeNode(t,q)}}d.CallBack(o,t);return true}return false}if(m){if((m._more===false)||(!m._parent&&m._childs)){return d.CallBack(o)}if(m._childs&&m._isopen){m._isopen=false;if(!l){n.UpdateTreeNode(m,q)}return d.CallBack(o)}if(m._obj&&p(m,m._obj,r)){return}}d.progress("Loading "+r);this.get(r,function(s,t){d.progress();if(t&&p(s,t)){return}d.CallBack(o)},"hierarchy_expand")};c.prototype.GetTopOnlineItem=function(l){if(l!=null){while((l!=null)&&(!("_online" in l))){l=l._parent}return l}if(this.h==null){return null}if("_online" in this.h){return this.h}if((this.h._childs!=null)&&("_online" in this.h._childs[0])){return this.h._childs[0]}return null};c.prototype.ForEachJsonFile=function(m){if(this.h==null){return}if("_jsonfile" in this.h){return d.CallBack(m,this.h)}if(this.h._childs!=null){for(var o=0;o<this.h._childs.length;++o){var l=this.h._childs[o];if("_jsonfile" in l){d.CallBack(m,l)}}}};c.prototype.OpenJsonFile=function(o,n){var m=false;this.ForEachJsonFile(function(p){if(p._jsonfile==o){m=true}});if(m){return d.CallBack(n)}var l=this;d.NewHttpRequest(o,"object",function(r){if(!r){return d.CallBack(n)}var q={_jsonfile:o,_kind:"ROOT."+r._typename,_jsontmp:r,_name:o.split("/").pop()};if(r.fTitle){q._title=r.fTitle}q._get=function(t,v,u){if(t._jsontmp){return d.CallBack(u,t,t._jsontmp)}d.NewHttpRequest(t._jsonfile,"object",function(w){t._jsontmp=w;d.CallBack(u,t,t._jsontmp)}).send()};if(l.h==null){l.h=q}else{if(l.h._kind=="TopFolder"){l.h._childs.push(q)}else{var s=l.h,p=("_jsonfile" in s)?"Files":"Items";l.h={_name:p,_kind:"TopFolder",_childs:[s,q]}}}l.RefreshHtml(n)}).send(null)};c.prototype.ForEachRootFile=function(m){if(this.h==null){return}if((this.h._kind=="ROOT.TFile")&&(this.h._file!=null)){return d.CallBack(m,this.h)}if(this.h._childs!=null){for(var o=0;o<this.h._childs.length;++o){var l=this.h._childs[o];if((l._kind=="ROOT.TFile")&&("_fullurl" in l)){d.CallBack(m,l)}}}};c.prototype.OpenRootFile=function(o,n){var m=false;this.ForEachRootFile(function(p){if(p._fullurl===o){m=true}});if(m){return d.CallBack(n)}var l=this;d.progress("Opening "+o+" ...");d.OpenFile(o,function(r){d.progress();if(!r){if(!k.select("#gui_fileCORS").style("background","red").empty()){setTimeout(function(){k.select("#gui_fileCORS").style("background","")},5000)}return d.CallBack(n,false)}var q=l.FileHierarchy(r);q._isopen=true;if(l.h==null){l.h=q;if(l._topname){q._name=l._topname}}else{if(l.h._kind=="TopFolder"){l.h._childs.push(q)}else{var s=l.h,p=(s._kind=="ROOT.TFile")?"Files":"Items";l.h={_name:p,_kind:"TopFolder",_childs:[s,q],_isopen:true}}}l.RefreshHtml(n)})};c.prototype.ApplyStyle=function(l,o){if(!l){return d.CallBack(o)}if(typeof l==="object"){if(l._typename==="TStyle"){d.extend(d.gStyle,l)}return d.CallBack(o)}if(typeof l==="string"){var n=this,m=this.Find({name:l,allow_index:true,check_keys:true});if(m!==null){return this.get(m,function(p,q){n.ApplyStyle(q,o)})}if(l.indexOf(".json")>0){return d.NewHttpRequest(l,"object",function(p){n.ApplyStyle(p,o)}).send(null)}}return d.CallBack(o)};c.prototype.GetFileProp=function(n){var l=this.Find(n);if(l==null){return null}var m=l._name;while(l._parent){l=l._parent;if("_file" in l){return{kind:"file",fileurl:l._file.fURL,itemname:m,localfile:!!l._file.fLocalFile}}if("_jsonfile" in l){return{kind:"json",fileurl:l._jsonfile,itemname:m}}m=l._name+"/"+m}return null};d.MarkAsStreamerInfo=function(l,m,n){if(n&&(n._typename=="TList")){n._typename="TStreamerInfoList"}};c.prototype.GetOnlineItemUrl=function(m){if(typeof m=="string"){m=this.Find(m)}var l=m;while(l&&(l._online===undefined)){l=l._parent}return l?(l._online+this.itemFullName(m,l)):null};c.prototype.isOnlineItem=function(l){return this.GetOnlineItemUrl(l)!==null};c.prototype.GetOnlineItem=function(x,t,v,r){var m=t,p=false,u="",y="object",l=this,o=null;if(r==="hierarchy_expand"){p=true;r=undefined}if(x!=null){m=this.GetOnlineItemUrl(x);var n=null;if("_kind" in x){o=d.getDrawHandle(x._kind)}if(p){u="h.json?compact=3";x._expand=d.Painter.OnlineHierarchy}else{if("_make_request" in x){n=d.findFunction(x._make_request)}else{if((o!=null)&&("make_request" in o)){n=o.make_request}}}if(typeof n=="function"){var s=n(l,x,m,r);if(s!=null){if(typeof s=="string"){u=s}else{if("req" in s){u=s.req}if("kind" in s){y=s.kind}}}}if((u.length==0)&&(x._kind.indexOf("ROOT.")!=0)){u="item.json.gz?compact=3"}}if((t==null)&&(x!=null)&&("_cached_draw_object" in this)&&(u.length==0)){var q=this._cached_draw_object;delete this._cached_draw_object;return d.CallBack(v,x,q)}if(u.length==0){u="root.json.gz?compact=23"}if(m.length>0){m+="/"}m+=u;var w=d.NewHttpRequest(m,y,function(B){var A=null;if(!p&&(x!=null)&&("_after_request" in x)){A=d.findFunction(x._after_request)}else{if((o!=null)&&("after_request" in o)){A=o.after_request}}if(typeof A=="function"){var z=A(l,x,B,r,w);if((z!=null)&&(typeof z=="object")){B=z}}d.CallBack(v,x,B)});w.send(null)};d.Painter.OnlineHierarchy=function(l,m){if((m!=null)&&(l!=null)&&("_childs" in m)){for(var o=0;o<m._childs.length;++o){if(m._childs[o]._more||m._childs[o]._childs){m._childs[o]._expand=d.Painter.OnlineHierarchy}}l._childs=m._childs;m._childs=null;return true}return false};c.prototype.OpenOnline=function(n,o){var l=this;function p(r){l.h=r;if(l.h==null){return}if(("_title" in l.h)&&(l.h._title!="")){document.title=l.h._title}r._isopen=true;l.h._online=n;l.h._get=function(u,w,v,t){l.GetOnlineItem(u,w,v,t)};l.h._expand=d.Painter.OnlineHierarchy;var q="",s="";l.ForEach(function(u){if("_childs" in u){u._expand=d.Painter.OnlineHierarchy}if("_autoload" in u){var t=u._autoload.split(";");for(var v=0;v<t.length;++v){if((t[v].length>3)&&((t[v].lastIndexOf(".js")==t[v].length-3)||(t[v].lastIndexOf(".css")==t[v].length-4))){if(q.indexOf(t[v])<0){q+=t[v]+";"}}else{if(s.indexOf(t[v])<0){s+=t[v]+";"}}}}});if(q.length>0){q="user:"+q}d.AssertPrerequisites(s+q,function(){l.ForEach(function(v){if(!("_drawfunc" in v)||!("_kind" in v)){return}var u="kind:"+v._kind;if(v._kind.indexOf("ROOT.")==0){u=v._kind.slice(5)}var t=v._drawopt;if(!d.canDraw(u)||(t!=null)){d.addDrawFunc({name:u,func:v._drawfunc,script:v._drawscript,opt:t})}});d.CallBack(o,l)})}if(!n){n=""}if(typeof n=="object"){var m=n;n="";return p(m)}d.NewHttpRequest(n+"h.json?compact=3","object",p).send(null)};c.prototype.GetOnlineProp=function(n){var l=this.Find(n);if(!l){return null}var m=l._name;while(l._parent!=null){l=l._parent;if("_online" in l){return{server:l._online,itemname:m}}m=l._name+"/"+m}return null};c.prototype.FillOnlineMenu=function(l,t,r){var u=this,m=this.Find(r),p=d.getDrawSettings(m._kind,"nosame;noinspect"),o=d.getDrawHandle(m._kind),q=("_kind" in m)?m._kind.indexOf("ROOT.")==0:false;if(p.opts){p.opts.push("inspect");l.addDrawMenu("Draw",p.opts,function(v){u.display(r,v)})}if(!m._childs&&(m._more||q||p.expand)){l.add("Expand",function(){u.expand(r)})}if(o&&("execute" in o)){l.add("Execute",function(){u.ExecuteCommand(r,l.tree_node)})}var s=t.server+t.itemname+"/draw.htm";var n="?";if(this.IsMonitoring()){s+=n+"monitoring="+this.MonitoringInterval();n="&"}if(p.opts){l.addDrawMenu("Draw in new window",p.opts,function(v){window.open(s+n+"opt="+v)})}if(p.opts&&(p.opts.length>0)&&q){l.addDrawMenu("Draw as png",p.opts,function(v){window.open(t.server+t.itemname+"/root.png?w=400&h=300&opt="+v)})}if("_player" in m){l.add("Player",function(){u.player(r)})}};c.prototype.Adopt=function(l){this.h=l;this.RefreshHtml()};c.prototype.SetMonitoring=function(m,l){if(m!==undefined){this._monitoring_on=false;this._monitoring_interval=3000;m=!m?0:parseInt(m);if(!isNaN(m)&&(m>0)){this._monitoring_on=true;this._monitoring_interval=Math.max(100,m)}}if(l!==undefined){this._monitoring_on=l}if(this._monitoring_handle){clearInterval(this._monitoring_handle)}this._monitoring_handle=setInterval(this.updateAll.bind(this,"monitoring"),this._monitoring_interval)};c.prototype.MonitoringInterval=function(l){return("_monitoring_interval" in this)?this._monitoring_interval:3000};c.prototype.EnableMonitoring=function(l){this._monitoring_on=l};c.prototype.IsMonitoring=function(){return this._monitoring_on};c.prototype.SetDisplay=function(m,l){if((l==null)&&(typeof m=="object")){this.disp=m;this.disp_kind="custom";this.disp_frameid=null}else{this.disp_kind=m;this.disp_frameid=l}if(!this.register_resize){this.register_resize=true;d.RegisterForResize(this)}};c.prototype.GetLayout=function(){return this.disp_kind};c.prototype.ClearPainter=function(l){this.ForEach(function(m){if(m._painter===l){delete m._painter}})};c.prototype.clear=function(l){if(this.disp){this.disp.Reset();delete this.disp}var m=[];this.ForEach(function(n){delete n._painter;if(!l&&(typeof n.clear=="function")){n.clear()}if(l){m.push(n)}});if(l){if(this._monitoring_handle){clearInterval(this._monitoring_handle);delete this._monitoring_handle}this.select_main().html("");m.forEach(function(n){delete n._parent;delete n._childs;delete n._obj;delete n._d3cont});delete this.h}};c.prototype.GetDisplay=function(){return("disp" in this)?this.disp:null};c.prototype.CleanupFrame=function(m){var l=d.cleanup(m);if(l&&(l.length>0)){this.ForEach(function(n){if(n._painter&&l.indexOf(n._painter)>=0){delete n._painter}})}};c.prototype.CreateDisplay=function(l){if("disp" in this){if((this.disp.NumDraw()>0)||(this.disp_kind=="custom")){return d.CallBack(l,this.disp)}this.disp.Reset();delete this.disp}if(document.getElementById(this.disp_frameid)==null){return d.CallBack(l,null)}if((this.disp_kind=="simple")||(this.disp_kind.indexOf("grid")==0)&&(this.disp_kind.indexOf("gridi")<0)){this.disp=new b(this.disp_frameid,this.disp_kind)}else{return d.AssertPrerequisites("jq2d",this.CreateDisplay.bind(this,l))}if(this.disp){this.disp.CleanupFrame=this.CleanupFrame.bind(this)}d.CallBack(l,this.disp)};c.prototype.updateOnOtherFrames=function(l,o){var p=this.disp,n=null,m=false;if(!p){return false}if(o._typename){n=d.getDrawHandle("ROOT."+o._typename)}if(n&&n.draw_field&&o[n.draw_field]){o=o[n.draw_field]}p.ForEachPainter(function(q,r){if((q===l)||(q.GetItemName()!=l.GetItemName())){return}p.ActivateFrame(r);if(q.RedrawObject(o)){m=true}});return m};c.prototype.CheckResize=function(l){if(this.disp){this.disp.CheckMDIResize(null,l)}};c.prototype.StartGUI=function(B,l,r){function x(L){var K=d.GetUrlOption(L,r);if((K===null)&&B&&!B.empty()&&B.node().hasAttribute(L)){K=B.attr(L)}return K}function v(M){var L=d.GetUrlOptionAsArray(M,r);if(L.length>0||!B||B.empty()){return L}while(M.length>0){var O=M.indexOf(";");var K=O>0?M.substr(0,O):M;if(O>0){M=M.substr(O+1)}else{M=""}var N=true;if(K[0]=="#"){K=K.substr(1);N=false}if(K==="files"){continue}if(!B.node().hasAttribute(K)){continue}var P=B.attr(K);if(N){L=L.concat(d.ParseAsArray(P))}else{if(P!==null){L.push(P)}}}return L}var s=this,o=x("prereq")||"",w=d.GetUrlOption("path",r)||"",I=v("#file;files"),G=x("localfile"),p=v("#json;jsons"),y=v("expand"),C=v("#item;items"),z=v("#opt;opts"),n=x("monitoring"),H=x("layout"),F=v("#style"),A=x("status"),q=x("browser"),J=x("title");if(x("float")!==null){q="float"}else{if(x("fix")!==null){q="fix"}}this.no_select=x("noselect");if(x("files_monitoring")!==null){this.files_monitoring=true}if(J){document.title=J}var u=x("load");if(u){o+=";io;2d;load:"+u}if(y.length==0&&(x("expand")==="")){y.push("")}if(w){for(var E=0;E<I.length;++E){I[E]=w+I[E]}for(var E=0;E<p.length;++E){p[E]=w+p[E]}}if((C.length==0)&&x("item")===""){C.push("")}if((p.length==1)&&(C.length==0)&&(y.length==0)){C.push("")}if(!this.disp_kind){if((typeof H=="string")&&(H.length>0)){this.disp_kind=H}else{switch(C.length){case 0:case 1:this.disp_kind="simple";break;case 2:this.disp_kind="vert2";break;case 3:this.disp_kind="vert21";break;case 4:this.disp_kind="vert22";break;case 5:this.disp_kind="vert32";break;case 6:this.disp_kind="vert222";break;case 7:this.disp_kind="vert322";break;case 8:this.disp_kind="vert332";break;case 9:this.disp_kind="vert333";break;default:this.disp_kind="flex"}}}if(A==="no"){A=null}else{if(A==="off"){this.status_disabled=true;A=null}else{if((A!==null)&&(A!=="on")){A=parseInt(A);if(isNaN(A)||(A<5)){A="on"}}}}if(this.no_select===""){this.no_select=true}if(!q){q="fix"}else{if(q==="no"){q=""}else{if(q==="off"){q="";A=null;this.exclude_browser=true}}}if(x("nofloat")!==null){this.float_browser_disabled=true}if(this.start_without_browser){q=""}if(A||q){o="jq2d;"+o}this._topname=x("topname");if(B){this.PrepareGuiDiv(B,this.disp_kind)}function m(K){if(q){s.CreateBrowser(q);q=""}if(A){s.CreateStatusLine(A,"toggle");A=null}if(p.length>0){s.OpenJsonFile(p.shift(),m)}else{if(I.length>0){s.OpenRootFile(I.shift(),m)}else{if((G!==null)&&(typeof s.SelectLocalFile=="function")){G=null;s.SelectLocalFile(m)}else{if(y.length>0){s.expand(y.shift(),m)}else{if(F.length>0){s.ApplyStyle(F.shift(),m)}else{s.displayAll(C,z,function(){s.RefreshHtml();s.SetMonitoring(n);d.CallBack(l)})}}}}}}function D(){if(("_monitoring" in s.h)&&!n){n=s.h._monitoring}if(("_layout" in s.h)&&(H==null)){s.disp_kind=s.h._layout}if(("_loadfile" in s.h)&&(I.length==0)){I=d.ParseAsArray(s.h._loadfile)}if(("_drawitem" in s.h)&&(C.length==0)){C=d.ParseAsArray(s.h._drawitem);z=d.ParseAsArray(s.h._drawopt)}m()}var t=null;if(this.is_online){if(typeof GetCachedHierarchy=="function"){t=GetCachedHierarchy()}if(typeof t!=="object"){t=""}}if(t!==null){s.OpenOnline(t,D)}else{if(o.length>0){d.AssertPrerequisites(o,m)}else{m()}}};c.prototype.PrepareGuiDiv=function(l,o){this.gui_div=l.attr("id");l.append("div").attr("id",this.gui_div+"_drawing").classed("jsroot_draw_area",true).style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0);if(!this.exclude_browser){var m=l.append("div").classed("jsroot_browser",true);var n=m.append("div").classed("jsroot_browser_btns",true).classed("jsroot",true);n.style("position","absolute").style("left","7px").style("top","7px");if(d.touches){n.style("opacity","0.2")}d.ToolbarIcons.CreateSVG(n,d.ToolbarIcons.diamand,15,"toggle fix-pos browser").style("margin","3px").on("click",this.CreateBrowser.bind(this,"fix",true));if(!this.float_browser_disabled){d.ToolbarIcons.CreateSVG(n,d.ToolbarIcons.circle,15,"toggle float browser").style("margin","3px").on("click",this.CreateBrowser.bind(this,"float",true))}if(!this.status_disabled){d.ToolbarIcons.CreateSVG(n,d.ToolbarIcons.three_circles,15,"toggle status line").style("margin","3px").on("click",this.CreateStatusLine.bind(this,"on","toggle"))}}this.SetDisplay(o,this.gui_div+"_drawing")};c.prototype.CreateStatusLine=function(l,n){if(!this.gui_div){return}var m=this;d.AssertPrerequisites("jq2d",function(){m.CreateStatusLine(l,n)})};c.prototype.CreateBrowser=function(m,l,o){if(!this.gui_div){return}var n=this;d.AssertPrerequisites("jq2d",function(){n.CreateBrowser(m,l,o)})};d.BuildNobrowserGUI=function(){var l=k.select("#simpleGUI"),o=false,p=false;if(l.empty()){o=true;l=k.select("#onlineGUI");if(l.empty()){l=k.select("#drawGUI");p=true}if(l.empty()){return alert("no div for simple nobrowser gui found")}}if(l.attr("ignoreurl")==="true"){d.gStyle.IgnoreUrlOptions=true}d.Painter.readStyleFromURL();k.select("html").style("height","100%");k.select("body").style("min-height","100%").style("margin",0).style("overflow","hidden");l.style("position","absolute").style("left",0).style("top",0).style("bottom",0).style("right",0).style("padding",1);var n=null,r=true;if(d.GetUrlOption("webcanvas")!==null){n="websocket"}else{if(d.GetUrlOption("longpollcanvas")!==null){n="longpoll"}else{if(d.GetUrlOption("cef_canvas")!==null){n="cefquery"}}}if(d.GetUrlOption("qt5")!==null){d.browser.qt5=true}if(p&&n){var m=new d.TCanvasPainter(null);m.batch_mode=d.GetUrlOption("batch_mode")!==null;if(m.batch_mode){d.BatchMode=true}if(window){window.onbeforeunload=m.WindowBeforeUnloadHanlder.bind(m);if(d.browser.qt5){window.onqt5unload=window.onbeforeunload}}if(r&&!m.batch_mode){m._configured_socket_kind=n;m.use_openui=true;return d.AssertPrerequisites("openui5",function(){var t={canvas_painter:m};var s=new sap.ui.model.json.JSONModel(t);sap.ui.getCore().setModel(s,"TopCanvasId--MainPanel");new d.sap.ui.xmlview({id:"TopCanvasId",viewName:"sap.ui.jsroot.view.Canvas"}).placeAt(l.attr("id"))})}m.SetDivId(l.attr("id"),-1);m.OpenWebsocket(n);if(!m.batch_mode){d.RegisterForResize(m)}return}var q=new d.HierarchyPainter("root",null);q.is_online=o;if(p){q.exclude_browser=true}q.start_without_browser=true;q.StartGUI(l,function(){if(!p){return}var t=d.findFunction("GetCachedObject");var u=(typeof t=="function")?d.JSONR_unref(t()):null;if(u){q._cached_draw_object=u}var s=d.GetUrlOption("opt")||"";if(d.GetUrlOption("websocket")!==null){s+=";websocket"}q.display("",s)})};d.Painter.drawStreamerInfo=function(s,q){var u=new d.HierarchyPainter("sinfo",s,"white");u.h={_name:"StreamerInfo",_childs:[]};for(var p=0;p<q.arr.length;++p){var v=q.arr[p];if(v._typename=="TList"){continue}if(typeof(v.fName)=="undefined"){d.console("strange element in StreamerInfo with type "+v._typename);continue}var w={_name:v.fName+";"+v.fClassVersion,_kind:"class "+v.fName,_title:"class:"+v.fName+" version:"+v.fClassVersion+" checksum:"+v.fCheckSum,_icon:"img_class",_childs:[]};if(v.fTitle!=""){w._title+="  "+v.fTitle}u.h._childs.push(w);if(typeof v.fElements=="undefined"){continue}for(var o=0;o<v.fElements.arr.length;++o){var n=v.fElements.arr[o];if(!n||!n.fName){continue}var m=n.fTypeName+" "+n.fName,t=n.fTypeName+" type:"+n.fType;if(n.fArrayDim===1){m+="["+n.fArrayLength+"]"}else{for(var r=0;r<n.fArrayDim;++r){m+="["+n.fMaxIndex[r]+"]"}}if(n.fBaseVersion===4294967295){m+=":-1"}else{if(n.fBaseVersion!==undefined){m+=":"+n.fBaseVersion}}m+=";";if(n.fTitle!=""){m+=" // "+n.fTitle}w._childs.push({_name:m,_title:t,_kind:n.fTypeName,_icon:(n.fTypeName=="BASE")?"img_class":"img_member"})}if(w._childs.length==0){delete w._childs}}u.RefreshHtml(function(){u.SetDivId(s);u.DrawingReady()});return u};d.Painter.drawInspector=function(n,m){d.cleanup(n);var l=new d.HierarchyPainter("inspector",n,"white");l.default_by_click="expand";l.with_icons=false;l.h={_name:"Object",_title:"",_click_action:"expand",_nosimple:false,_do_context:true};if((typeof m.fTitle==="string")&&(m.fTitle.length>0)){l.h._title=m.fTitle}if(m._typename){l.h._title+="  type:"+m._typename}if((typeof m.fName==="string")&&(m.fName.length>0)){l.h._name=m.fName}l.fill_context=function(q,o){var p=d.getDrawSettings(o._kind,"nosame");if(p.opts){q.addDrawMenu("nosub:Draw",p.opts,function(r){if(!o||!o._obj){return}var s=o._obj,t=this.divid;d.cleanup(t);d.draw(t,s,r)})}};if(d.IsRootCollection(m)){l.h._name=m.name||m._typename;e(l.h,m)}else{j(l.h,m)}l.RefreshHtml(function(){l.SetDivId(n);l.DrawingReady()});return l};function f(l){d.TBasePainter.call(this);this.frameid=l;this.SetDivId(l);this.select_main().property("mdi",this);this.CleanupFrame=d.cleanup;this.active_frame_title=""}f.prototype=Object.create(d.TBasePainter.prototype);f.prototype.BeforeCreateFrame=function(l){this.active_frame_title=l};f.prototype.ForEachFrame=function(l,m){console.warn("ForEachFrame not implemented in MDIDisplay")};f.prototype.ForEachPainter=function(l,m){this.ForEachFrame(function(o){var n=new d.TObjectPainter();n.SetDivId(o,-1);n.ForEachPainter(function(p){l(p,o)})},m)};f.prototype.NumDraw=function(){var l=0;this.ForEachFrame(function(){++l});return l};f.prototype.FindFrame=function(m,n){var l=null;this.ForEachFrame(function(o){if(k.select(o).attr("frame_title")==m){l=o}});if((l==null)&&n){l=this.CreateFrame(m)}return l};f.prototype.ActivateFrame=function(l){this.active_frame_title=k.select(l).attr("frame_title")};f.prototype.GetActiveFrame=function(){return this.FindFrame(this.active_frame_title)};f.prototype.CheckMDIResize=function(m,n){var l=null;this.ForEachPainter(function(o,p){if(m&&(k.select(p).attr("id")!=m)){return}if((o.GetItemName()!==null)&&(typeof o.CheckResize=="function")){if(l===p){return}o.CheckResize(n);l=p}})};f.prototype.Reset=function(){this.active_frame_title="";this.ForEachFrame(this.CleanupFrame);this.select_main().html("").property("mdi",null)};f.prototype.Draw=function(o,m,l){if(!m){return}if(!d.canDraw(m._typename,l)){return}var n=this.FindFrame(o,true);this.ActivateFrame(n);return d.redraw(n,m,l)};function g(){d.MDIDisplay.call(this,"dummy");this.frames={}}g.prototype=Object.create(f.prototype);g.prototype.AddFrame=function(m,l){if(!(m in this.frames)){this.frames[m]=""}this.frames[m]+=(l+";")};g.prototype.ForEachFrame=function(m,p){var o=Object.keys(this.frames);for(var l=0;l<o.length;++l){var n=k.select("#"+o[l]);if(!n.empty()){d.CallBack(m,n.node())}}};g.prototype.CreateFrame=function(n){this.BeforeCreateFrame(n);var o=Object.keys(this.frames);for(var m=0;m<o.length;++m){var l=this.frames[o[m]];if(l.indexOf(n+";")>=0){return k.select("#"+o[m]).node()}}return null};g.prototype.Reset=function(){f.prototype.Reset.call(this);this.ForEachFrame(function(l){k.select(l).html("")})};function b(p,n,l){d.MDIDisplay.call(this,p);this.framecnt=0;this.getcnt=0;this.groups=[];this.vertical=n&&(n[0]=="v");this.use_separarators=!n||(n.indexOf("x")<0);this.simple_layout=false;this.select_main().style("overflow","hidden");if(n==="simple"){this.simple_layout=true;this.use_separarators=false;this.framecnt=1;return}var q=2,r=undefined,v=undefined;if((n.indexOf("grid")==0)||l){if(l){n=n+"x"+l}else{n=n.substr(4).trim()}this.use_separarators=false;if(n[0]==="i"){this.use_separarators=true;n=n.substr(1)}var m=n.indexOf("x"),t=3,s=3;if(m>0){s=parseInt(n.substr(m+1));t=parseInt(n.substr(0,m))}else{t=s=parseInt(n)}if(isNaN(t)){t=3}if(isNaN(s)){s=3}if(s>1){this.vertical=true;q=s;if(t>1){r=new Array(q);for(var o=0;o<q;++o){r[o]=t}}}else{if(t>1){this.vertical=false;q=t}else{this.simple_layout=true;this.use_separarators=false;this.framecnt=1;return}}n=""}if(n&&n.indexOf("_")>0){var u=parseInt(n.substr(n.indexOf("_")+1),10);if(!isNaN(u)&&(u>10)){n=n.substr(0,n.indexOf("_"));v=[];while(u>0){v.unshift(Math.max(u%10,1));u=Math.round((u-v[0])/10);if(v[0]===0){v[0]=1}}}}n=n?parseInt(n.replace(/^\D+/g,""),10):0;if(n&&(n>1)){if(n<10){q=n}else{r=[];while(n>0){r.unshift(n%10);n=Math.round((n-r[0])/10);if(r[0]==0){r[0]=1}}q=r.length}}if(v&&(v.length!==q)){v=undefined}if(!this.simple_layout){this.CreateGroup(this,this.select_main(),q,r,v)}}b.prototype=Object.create(f.prototype);b.prototype.CreateGroup=function(t,q,s,u,w){if(!w){w=new Array(s)}var r=0,p=0;for(var m=0;m<s;++m){r+=(w[m]||1)}for(var m=0;m<s;++m){w[m]=Math.round(100*(w[m]||1)/r);p+=w[m];if(m==s-1){w[m]+=(100-p)}}for(var l=0;l<s;++l){var v={id:l,drawid:-1,position:0,size:w[l]};if(l>0){v.position=t.groups[l-1].position+t.groups[l-1].size}v.position0=v.position;if(!u||!u[l]||u[l]<2){v.drawid=this.framecnt++}t.groups.push(v);var o=q.append("div").attr("groupid",v.id);if(t.vertical){o.style("float","bottom").style("height",v.size+"%").style("width","100%")}else{o.style("float","left").style("width",v.size+"%").style("height","100%")}if(v.drawid>=0){o.classed("jsroot_newgrid",true);if(typeof this.frameid==="string"){o.attr("id",this.frameid+"_"+v.drawid)}}else{o.style("display","flex").style("flex-direction",t.vertical?"row":"column")}if(u&&(u[l]>1)){v.vertical=!t.vertical;v.groups=[];o.style("overflow","hidden");this.CreateGroup(v,o,u[l])}}if(this.use_separarators&&this.CreateSeparator){for(var l=1;l<s;++l){this.CreateSeparator(t,q,t.groups[l])}}};b.prototype.ForEachFrame=function(m,n){var l=this.select_main();if(this.simple_layout){m(l.node())}else{l.selectAll(".jsroot_newgrid").each(function(){m(k.select(this).node())})}};b.prototype.GetActiveFrame=function(){if(this.simple_layout){return this.select_main().node()}var l=f.prototype.GetActiveFrame.call(this);if(l){return l}this.ForEachFrame(function(m){if(!l){l=m}},true);return l};b.prototype.ActivateFrame=function(l){this.active_frame_title=k.select(l).attr("frame_title")};b.prototype.GetFrame=function(n){var l=this.select_main();if(this.simple_layout){return l.node()}var m=null;l.selectAll(".jsroot_newgrid").each(function(){if(n--===0){m=this}});return m};b.prototype.NumGridFrames=function(){return this.framecnt};b.prototype.CreateFrame=function(m){this.BeforeCreateFrame(m);var l=this.GetFrame(this.getcnt);if(!this.simple_layout&&this.framecnt){this.getcnt=(this.getcnt+1)%this.framecnt}k.select(l).attr("frame_title",m);d.cleanup(l);return l};d.Painter.FolderHierarchy=h;d.Painter.ObjectHierarchy=j;d.Painter.TaskHierarchy=i;d.Painter.ListHierarchy=e;d.Painter.KeysHierarchy=a;d.HierarchyPainter=c;d.MDIDisplay=f;d.CustomDisplay=g;d.GridDisplay=b;return d}));