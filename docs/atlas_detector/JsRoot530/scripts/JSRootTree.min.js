(function(a){if(typeof define==="function"&&define.amd){define(["JSRootCore","JSRootIOEvolution","JSRootMath"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./JSRootIOEvolution.js"),require("./JSRootMath.js"))}else{if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootTree.js")}if(typeof JSROOT.IO!="object"){throw new Error("JSROOT.IO not defined","JSRootTree.js")}a(JSROOT)}}}(function(a){a.sources.push("tree");a.BranchType={kLeafNode:0,kBaseClassNode:1,kObjectNode:2,kClonesNode:3,kSTLNode:4,kClonesMemberNode:31,kSTLMemberNode:41};a.IO.BranchBits={kDoNotProcess:a.BIT(10),kIsClone:a.BIT(11),kBranchObject:a.BIT(12),kBranchAny:a.BIT(17),kAutoDelete:a.BIT(15),kDoNotUseBufferMap:a.BIT(22)};a.TSelector=function(){this.branches=[];this.names=[];this.directs=[];this.break_execution=0;this.tgtobj={}};a.TSelector.prototype.AddBranch=function(c,b,d){if(!b){b=(typeof c==="string")?c:("br"+this.branches.length)}this.branches.push(c);this.names.push(b);this.directs.push(d);return this.branches.length-1};a.TSelector.prototype.indexOfBranch=function(b){return this.branches.indexOf(b)};a.TSelector.prototype.nameOfBranch=function(b){return this.names[b]};a.TSelector.prototype.ShowProgress=function(b){};a.TSelector.prototype.Abort=function(){this.break_execution=-1111};a.TSelector.prototype.Begin=function(b){};a.TSelector.prototype.Process=function(b){};a.TSelector.prototype.Terminate=function(b){};a.CheckArrayPrototype=function(c,b){if(typeof c!=="object"){return 0}var h=Object.prototype.toString.apply(c);if(h.indexOf("[object")!==0){return 0}var i=h.indexOf("Array]");if(i<0){return 0}if(i>8){return 2}if(!b){return 1}var g,e=true;for(var d=0;d<c.length;++d){var f=typeof c[d];if(!g){g=f}if(f!==g){e=false;break}if((f=="object")&&a.CheckArrayPrototype(c[d])){e=false;break}}return e?2:1};a.ArrayIterator=function(c,b,d){this.object=c;this.value=0;this.arr=[];this.indx=[];this.cnt=-1;this.tgtobj=d;if(typeof b==="object"){this.select=b}else{this.select=[]}};a.ArrayIterator.prototype.next=function(){var d,c,b=this.cnt,e;if(b>=0){if(++this.fastindx<this.fastlimit){this.value=this.fastarr[this.fastindx];return true}while(--b>=0){if((this.select[b]===undefined)&&(++this.indx[b]<this.arr[b].length)){break}}if(b<0){return false}}while(true){if(b<0){d=this.object}else{d=(this.arr[b])[this.indx[b]]}c=d?typeof d:"any";if(c==="object"){if(d._typename!==undefined){if(a.IsRootCollection(d)){d=d.arr;c="array"}else{c="any"}}else{if(!isNaN(d.length)&&(a.CheckArrayPrototype(d)>0)){c="array"}else{c="any"}}}if(this.select[b+1]=="$self$"){this.value=d;this.fastindx=this.fastlimit=0;this.cnt=b+1;return true}if((c=="any")&&(typeof this.select[b+1]==="string")){this.arr[++b]=d;this.indx[b]=this.select[b];continue}if((c==="array")&&((d.length>0)||(this.select[b+1]==="$size$"))){this.arr[++b]=d;switch(this.select[b]){case undefined:this.indx[b]=0;break;case"$last$":this.indx[b]=d.length-1;break;case"$size$":this.value=d.length;this.fastindx=this.fastlimit=0;this.cnt=b;return true;break;default:if(!isNaN(this.select[b])){this.indx[b]=this.select[b];if(this.indx[b]<0){this.indx[b]=d.length-1}}else{this.select[b].Produce(this.tgtobj);this.indx[b]=Math.round(this.select[b].get(0))}}}else{if(b<0){return false}this.value=d;if(this.select[b]===undefined){this.fastarr=this.arr[b];this.fastindx=this.indx[b];this.fastlimit=this.fastarr.length}else{this.fastindx=this.fastlimit=0}this.cnt=b;return true}}return false};a.ArrayIterator.prototype.reset=function(){this.arr=[];this.indx=[];delete this.fastarr;this.cnt=-1;this.value=0};a.TDrawVariable=function(b){this.globals=b;this.code="";this.brindex=[];this.branches=[];this.brarray=[];this.func=null;this.kind=undefined;this.buf=[]};a.TDrawVariable.prototype.Parse=function(h,n,b,d,c){function l(u){if((u>="A")&&(u<="Z")){return true}if((u>="a")&&(u<="z")){return true}return(u==="_")}function k(u){if(l(u)){return true}if((u>="0")&&(u<="9")){return true}return false}if(!b){b=""}this.code=(d?d.fName:"")+b;var f=0,e=0,s=null;while((f<b.length)||d){var q=[];if(d){s=d;d=undefined}else{while((f<b.length)&&!l(b[f])){f++}e=f;while((e<b.length)&&(k(b[e])||b[e]===".")){e++}if(b[e]=="$"){var m="";switch(b.substr(f,e-f)){case"LocalEntry":case"Entry":m="arg.$globals.entry";break;case"Entries":m="arg.$globals.entries";break}if(m){b=b.substr(0,f)+m+b.substr(e+1);f=f+m.length;continue}}s=h.FindBranch(b.substr(f,e-f),true);if(!s){f=e+1;continue}if(s.branch&&(s.rest!==undefined)){e-=s.rest.length;c=s.read_mode;s=s.branch}if((e>=b.length-1)&&(b[b.length-1]===".")){q.push("$self$");e=b.length}}while(e<b.length){if((b[e]==="@")&&(b.substr(e,5)=="@size")&&(q.length==0)){e+=5;c=true;break}if(b[e]==="."){var j=++e;if((b[j]==="@")&&(b.substr(j,5)==="@size")){q.push("$size$");e+=5;break}if(!l(b[j])){q.push("$self$");break}while((e<b.length)&&k(b[e])){e++}if(b[e]=="("){e=j-1;break}if((q.length===0)&&s){if((s.fType===a.BranchType.kClonesNode)||(s.fType===a.BranchType.kSTLNode)){q.push(undefined)}else{var i=a.IO.GetBranchObjectClass(s,h,false,true);if(i&&a.IsRootCollection(null,i)){q.push(undefined)}}}q.push(b.substr(j,e-j));continue}if(b[e]!=="["){break}if(b[e+1]=="]"){q.push(undefined);e+=2;continue}var j=e++,o=0;while((e<b.length)&&((b[e]!="]")||(o>0))){if(b[e]=="["){o++}else{if(b[e]=="]"){o--}}e++}var g=b.substr(j+1,e-j-1);switch(g){case"":case"$all$":q.push(undefined);break;case"$last$":q.push("$last$");break;case"$size$":q.push("$size$");break;case"$first$":q.push(0);break;default:if(!isNaN(parseInt(g))){q.push(parseInt(g))}else{var p=new a.TDrawVariable(this.globals);if(!p.Parse(h,n,g)){return false}q.push(p)}}e++}if(q.length===0){q=undefined}else{if((q.length===1)&&(q[0]===undefined)){q=true}}var t=n.indexOfBranch(s);if(t<0){t=n.AddBranch(s,undefined,c)}c=undefined;this.brindex.push(t);this.branches.push(n.nameOfBranch(t));this.brarray.push(q);if((f===0)&&(e===b.length)&&(this.branches.length===1)){this.direct_branch=true;return true}var r="arg.var"+(this.branches.length-1);b=b.substr(0,f)+r+b.substr(e);f=f+r.length}b=b.replace(/TMath::Exp\(/g,"Math.exp(").replace(/TMath::Abs\(/g,"Math.abs(").replace(/TMath::Prob\(/g,"arg.$math.Prob(").replace(/TMath::Gaus\(/g,"arg.$math.Gaus(");this.func=new Function("arg","return ("+b+")");return true};a.TDrawVariable.prototype.is_dummy=function(){return(this.branches.length===0)&&!this.func};a.TDrawVariable.prototype.Produce=function(h){this.length=1;this.isarray=false;if(this.is_dummy()){this.value=1;this.kind="number";return}var b={$globals:this.globals,$math:a.Math},d=-1,g=[];for(var i=0;i<this.branches.length;++i){var f="var"+i;b[f]=h[this.branches[i]];if(this.brarray[i]===undefined){this.brarray[i]=(a.CheckArrayPrototype(b[f])>0)||a.IsRootCollection(b[f])}if(this.brarray[i]===false){continue}if((this.brarray[i]===true)&&(a.CheckArrayPrototype(b[f],true)===2)){g[i]=b[f]}else{var c=new a.ArrayIterator(b[f],this.brarray[i],h);g[i]=[];while(c.next()){g[i].push(c.value)}}if((d<0)||(d<g[i].length)){d=g[i].length}}if(d<0){this.value=this.direct_branch?b.var0:this.func(b);if(!this.kind){this.kind=typeof this.value}return}if(d==0){this.length=0;this.value=0;return}this.length=d;this.isarray=true;if(this.direct_branch){this.value=g[0]}else{this.value=new Array(d);for(var e=0;e<d;++e){for(var i=0;i<this.branches.length;++i){if(g[i]){b["var"+i]=g[i][e]}}this.value[e]=this.func(b)}}if(!this.kind){this.kind=typeof this.value[0]}};a.TDrawVariable.prototype.get=function(b){return this.isarray?this.value[b]:this.value};a.TDrawVariable.prototype.AppendArray=function(b){this.buf=this.buf.concat(b[this.branches[0]])};a.TDrawSelector=function(b){a.TSelector.call(this);this.ndim=0;this.vars=[];this.cut=null;this.hist=null;this.histo_callback=b;this.histo_drawopt="";this.hist_name="$htemp";this.hist_title="Result of TTree::Draw";this.hist_args=[];this.arr_limit=1000;this.htype="F";this.monitoring=0;this.globals={};this.last_progress=0;this.aver_diff=0};a.TDrawSelector.prototype=Object.create(a.TSelector.prototype);a.TDrawSelector.prototype.ParseParameters=function(l,h,k){if(!k||(typeof k!=="string")){return""}var i=k.lastIndexOf(";");while(i>=0){var g=k.substr(i+1),d=undefined;k=k.substr(0,i);i=k.lastIndexOf(";");var c=g.indexOf(":");if(c>0){d=g.substr(c+1);g=g.substr(0,c)}var e=parseInt(d);if(!d||isNaN(e)){e=undefined}switch(g){case"num":case"entries":case"numentries":if(d==="all"){h.numentries=l.fEntries}else{if(d==="half"){h.numentries=Math.round(l.fEntries/2)}else{if(e!==undefined){h.numentries=e}}}break;case"first":if(e!==undefined){h.firstentry=e}break;case"mon":case"monitor":h.monitoring=(e!==undefined)?e:5000;break;case"player":h.player=true;break;case"dump":h.dump=true;break;case"maxseg":case"maxrange":if(e){l.$file.fMaxRanges=e}break;case"accum":if(e){this.arr_limit=e}break;case"htype":if(d&&(d.length===1)){this.htype=d.toUpperCase();if((this.htype!=="C")&&(this.htype!=="S")&&(this.htype!=="I")&&(this.htype!=="F")&&(this.htype!=="L")&&(this.htype!=="D")){this.htype="F"}}break;case"hbins":this.hist_nbins=parseInt(d);if(isNaN(this.hist_nbins)||(this.hist_nbins<=3)){delete this.hist_nbins}break;case"drawopt":h.drawopt=d;break}}i=k.lastIndexOf(">>");if(i>=0){var j=k.substr(i+2).trim();k=k.substr(0,i).trim();i=j.indexOf("(");if(i>0){this.hist_name=j.substr(0,i);j=j.substr(i)}if(j==="dump"){h.dump=true}else{if(i<0){this.hist_name=j}else{if((j[0]=="(")&&(j[j.length-1]==")")){j=j.substr(1,j.length-2).split(",");var f=true;for(var b=0;b<j.length;++b){j[b]=(b%3===0)?parseInt(j[b]):parseFloat(j[b]);if(isNaN(j[b])){f=false}}if(f){this.hist_args=j}}}}}if(h.dump){this.dump_values=true;h.reallocate_objects=true;if(h.numentries===undefined){h.numentries=10}}return k};a.TDrawSelector.prototype.ParseDrawExpression=function(l,e){var j=this.ParseParameters(l,e,e.expr),h="";this.hist_title="drawing '"+j+"' from "+l.fName;var g=0;if(e.cut){h=e.cut}else{g=j.replace(/TMath::/g,"TMath__").lastIndexOf("::");if(g>0){h=j.substr(g+2).trim();j=j.substr(0,g).trim()}}e.parse_expr=j;e.parse_cut=h;var f=[],k=0,i=0,c=0;for(g=0;g<j.length;++g){switch(j[g]){case"(":k++;break;case")":k--;break;case"[":i++;break;case"]":i--;break;case":":if(j[g+1]==":"){g++;continue}if(!k&&!i&&(g>c)){f.push(j.substr(c,g-c))}c=g+1;break}}if(!k&&!i&&(g>c)){f.push(j.substr(c,g-c))}if((f.length<1)||(f.length>3)){return false}this.ndim=f.length;var d=!h;for(var b=0;b<this.ndim;++b){this.vars[b]=new a.TDrawVariable(this.globals);if(!this.vars[b].Parse(l,this,f[b])){return false}if(!this.vars[b].direct_branch){d=false}}this.cut=new a.TDrawVariable(this.globals);if(h){if(!this.cut.Parse(l,this,h)){return false}}if(!this.branches.length){console.warn("no any branch is selected");return false}if(d){this.ProcessArrays=this.ProcessArraysFunc}this.monitoring=e.monitoring;if(e.drawopt!==undefined){this.histo_drawopt=e.drawopt}else{this.histo_drawopt=(this.ndim===2)?"col":""}return true};a.TDrawSelector.prototype.DrawOnlyBranch=function(b,d,e,c){this.ndim=1;if(e.indexOf("dump")==0){e=";"+e}e=this.ParseParameters(b,c,e);this.monitoring=c.monitoring;if(c.dump){this.dump_values=true;c.reallocate_objects=true}if(this.dump_values){this.hist=[];this.leaf=c.leaf;this.copy_fields=((c.branch.fLeaves&&(c.branch.fLeaves.arr.length>1))||(c.branch.fBranches&&(c.branch.fBranches.arr.length>0)))&&!c.leaf;this.AddBranch(d,"br0",c.direct_branch);this.Process=this.ProcessDump;return true}this.vars[0]=new a.TDrawVariable(this.globals);if(!this.vars[0].Parse(b,this,e,d,c.direct_branch)){return false}this.hist_title="drawing branch '"+d.fName+(e?"' expr:'"+e:"")+"'  from "+b.fName;this.cut=new a.TDrawVariable(this.globals);if(this.vars[0].direct_branch){this.ProcessArrays=this.ProcessArraysFunc}return true};a.TDrawSelector.prototype.Begin=function(b){this.globals.entries=b.fEntries;if(this.monitoring){this.lasttm=new Date().getTime()}};a.TDrawSelector.prototype.ShowProgress=function(f){if(typeof document=="undefined"||!a.progress){return}if((f===undefined)||isNaN(f)){return a.progress()}if(this.last_progress!==f){var g=f-this.last_progress;if(!this.aver_diff){this.aver_diff=g}this.aver_diff=g*0.3+this.aver_diff*0.7}var d=0;if(this.aver_diff<=0){d=0}else{if(this.aver_diff<0.0001){d=3}else{if(this.aver_diff<0.001){d=2}else{if(this.aver_diff<0.01){d=1}}}}var e=document.createElement("p"),c=document.createTextNode("TTree draw "+(f*100).toFixed(d)+" %  "),b=this;e.appendChild(c);e.title="Click on element to break drawing";e.onclick=function(){if(++b.break_execution<3){e.title="Tree draw will break after next I/O operation";return c.nodeValue="Breaking ... "}b.Abort();a.progress()};a.progress(e);this.last_progress=f};a.TDrawSelector.prototype.GetBitsBins=function(e,c){c.nbins=c.max=e;c.fLabels=a.Create("THashList");for(var b=0;b<e;++b){var d=a.Create("TObjString");d.fString=b.toString();d.fUniqueID=b+1;c.fLabels.Add(d)}return c};a.TDrawSelector.prototype.GetMinMaxBins=function(b,g){var l={min:0,max:0,nbins:g,k:1,fLabels:null,title:""};if(b>=this.ndim){return l}var j=this.vars[b].buf;l.title=this.vars[b].code||"";if(this.vars[b].kind==="object"){var h,e=true,f=8;for(var d=0;d<j.length;++d){if(!j[d]){continue}if(!h){h=j[d]._typename}if(h!==j[d]._typename){e=false}if(j[d].fNbits){f=Math.max(f,j[d].fNbits+1)}}if(h&&e){if((h==="TBits")&&(b===0)){this.Fill1DHistogram=this.FillTBitsHistogram;if(f%8){f=(f&65520)+8}if((this.hist_name==="bits")&&(this.hist_args.length==1)&&this.hist_args[0]){f=this.hist_args[0]}return this.GetBitsBins(f,l)}}}if(this.vars[b].kind==="string"){l.lbls=[];for(var d=0;d<j.length;++d){if(l.lbls.indexOf(j[d])<0){l.lbls.push(j[d])}}l.lbls.sort();l.max=l.nbins=l.lbls.length;l.fLabels=a.Create("THashList");for(var d=0;d<l.lbls.length;++d){var m=a.Create("TObjString");m.fString=l.lbls[d];m.fUniqueID=d+1;if(m.fString===""){m.fString="<empty>"}l.fLabels.Add(m)}}else{if((b===0)&&(this.hist_name==="bits")&&(this.hist_args.length<=1)){this.Fill1DHistogram=this.FillBitsHistogram;return this.GetBitsBins(this.hist_args[0]||32,l)}else{if(b*3+2<this.hist_args.length){l.nbins=this.hist_args[b*3];l.min=this.hist_args[b*3+1];l.max=this.hist_args[b*3+2]}else{l.min=Math.min.apply(null,j);l.max=Math.max.apply(null,j);if(this.hist_nbins){g=l.nbins=this.hist_nbins}l.isinteger=(Math.round(l.min)===l.min)&&(Math.round(l.max)===l.max);if(l.isinteger){for(var d=0;d<j.length;++d){if(j[d]!==Math.round(j[d])){l.isinteger=false;break}}}if(l.isinteger){l.min=Math.round(l.min);l.max=Math.round(l.max);if(l.max-l.min<g*5){l.min-=1;l.max+=2;l.nbins=Math.round(l.max-l.min)}else{var i=(l.max-l.min+2),c=Math.floor(i/g);while(c*g<i){c++}l.max=l.min+g*c}}else{if(l.min>=l.max){l.max=l.min;if(Math.abs(l.min)<100){l.min-=1;l.max+=1}else{if(l.min>0){l.min*=0.9;l.max*=1.1}else{l.min*=1.1;l.max*=0.9}}}else{l.max+=(l.max-l.min)/l.nbins}}}}}l.k=l.nbins/(l.max-l.min);l.GetBin=function(n){var k=this.lbls?this.lbls.indexOf(n):Math.floor((n-this.min)*this.k);return(k<0)?0:((k>this.nbins)?this.nbins+1:k+1)};return l};a.TDrawSelector.prototype.CreateHistogram=function(){if(this.hist||!this.vars[0].buf){return}if(this.dump_values){this.hist=[];this.Fill1DHistogram=this.Fill2DHistogram=this.Fill3DHistogram=this.DumpValue}else{this.x=this.GetMinMaxBins(0,(this.ndim>1)?50:200);this.y=this.GetMinMaxBins(1,50);this.z=this.GetMinMaxBins(2,50);switch(this.ndim){case 1:this.hist=a.CreateHistogram("TH1"+this.htype,this.x.nbins);break;case 2:this.hist=a.CreateHistogram("TH2"+this.htype,this.x.nbins,this.y.nbins);break;case 3:this.hist=a.CreateHistogram("TH3"+this.htype,this.x.nbins,this.y.nbins,this.z.nbins);break}this.hist.fXaxis.fTitle=this.x.title;this.hist.fXaxis.fXmin=this.x.min;this.hist.fXaxis.fXmax=this.x.max;this.hist.fXaxis.fLabels=this.x.fLabels;if(this.ndim>1){this.hist.fYaxis.fTitle=this.y.title}this.hist.fYaxis.fXmin=this.y.min;this.hist.fYaxis.fXmax=this.y.max;this.hist.fYaxis.fLabels=this.y.fLabels;if(this.ndim>2){this.hist.fZaxis.fTitle=this.z.title}this.hist.fZaxis.fXmin=this.z.min;this.hist.fZaxis.fXmax=this.z.max;this.hist.fZaxis.fLabels=this.z.fLabels;this.hist.fName=this.hist_name;this.hist.fTitle=this.hist_title;this.hist.$custom_stat=(this.hist_name=="$htemp")?111110:111111}var f=this.vars[0].buf,d=this.cut.buf,b=f.length;switch(this.ndim){case 1:for(var g=0;g<b;++g){this.Fill1DHistogram(f[g],d?d[g]:1)}break;case 2:var e=this.vars[1].buf;for(var g=0;g<b;++g){this.Fill2DHistogram(f[g],e[g],d?d[g]:1)}delete this.vars[1].buf;break;case 3:var e=this.vars[1].buf,c=this.vars[2].buf;for(var g=0;g<b;++g){this.Fill2DHistogram(f[g],e[g],c[g],d?d[g]:1)}delete this.vars[1].buf;delete this.vars[2].buf;break}delete this.vars[0].buf;delete this.cut.buf};a.TDrawSelector.prototype.FillTBitsHistogram=function(h,e){if(!e||!h||!h.fNbits||!h.fAllBits){return}var f=Math.min(h.fNbits+1,h.fNbytes*8);for(var g=0,d=1,c=0;g<f;++g){if(h.fAllBits[c]&&d){if(g<=this.x.nbins){this.hist.fArray[g+1]+=e}else{this.hist.fArray[this.x.nbins+1]+=e}}d*=2;if(d>=256){d=1;++c}}};a.TDrawSelector.prototype.FillBitsHistogram=function(e,c){if(!c){return}for(var d=0,b=1;d<this.x.nbins;++d){if(e&b){this.hist.fArray[d+1]+=c}b*=2}};a.TDrawSelector.prototype.Fill1DHistogram=function(d,c){var b=this.x.GetBin(d);this.hist.fArray[b]+=c;if(!this.x.lbls){this.hist.fTsumw+=c;this.hist.fTsumwx+=c*d;this.hist.fTsumwx2+=c*d*d}};a.TDrawSelector.prototype.Fill2DHistogram=function(f,e,d){var c=this.x.GetBin(f),b=this.y.GetBin(e);this.hist.fArray[c+(this.x.nbins+2)*b]+=d;if(!this.x.lbls&&!this.y.lbls){this.hist.fTsumw+=d;this.hist.fTsumwx+=d*f;this.hist.fTsumwy+=d*e;this.hist.fTsumwx2+=d*f*f;this.hist.fTsumwxy+=d*f*e;this.hist.fTsumwy2+=d*e*e}};a.TDrawSelector.prototype.Fill3DHistogram=function(h,g,f,e){var d=this.x.GetBin(h),c=this.y.GetBin(g),b=this.z.GetBin(f);this.hist.fArray[d+(this.x.nbins+2)*(c+(this.y.nbins+2)*b)]+=e;if(!this.x.lbls&&!this.y.lbls&&!this.z.lbls){this.hist.fTsumw+=e;this.hist.fTsumwx+=e*h;this.hist.fTsumwy+=e*g;this.hist.fTsumwz+=e*f;this.hist.fTsumwx2+=e*h*h;this.hist.fTsumwy2+=e*g*g;this.hist.fTsumwz2+=e*f*f;this.hist.fTsumwxy+=e*h*g;this.hist.fTsumwxz+=e*h*f;this.hist.fTsumwyz+=e*g*f}};a.TDrawSelector.prototype.DumpValue=function(f,e,d,b){var c;switch(this.ndim){case 1:c={x:f,weight:e};break;case 2:c={x:f,y:e,weight:d};break;case 3:c={x:f,y:e,z:d,weight:b};break}if(this.cut.is_dummy()){if(this.ndim===1){c=f}else{delete c.weight}}this.hist.push(c)};a.TDrawSelector.prototype.ProcessArraysFunc=function(j){if(this.arr_limit){var g=this.vars[0],i=this.tgtarr.br0.length,e=this.vars[1],d=this.vars[2];if((g.buf.length===0)&&(i>=this.arr_limit)){g.buf=this.tgtarr.br0;if(e){e.buf=this.tgtarr.br1}if(d){d.buf=this.tgtarr.br2}}else{for(var b=0;b<i;++b){g.buf.push(this.tgtarr.br0[b]);if(e){e.buf.push(this.tgtarr.br1[b])}if(d){d.buf.push(this.tgtarr.br2[b])}}}g.kind="number";if(e){e.kind="number"}if(d){d.kind="number"}this.cut.buf=null;if(g.buf.length>=this.arr_limit){this.CreateHistogram();this.arr_limit=0}}else{var h=this.tgtarr.br0,i=h.length;switch(this.ndim){case 1:for(var b=0;b<i;++b){this.Fill1DHistogram(h[b],1)}break;case 2:var f=this.tgtarr.br1;for(var b=0;b<i;++b){this.Fill2DHistogram(h[b],f[b],1)}break;case 3:var f=this.tgtarr.br1,c=this.tgtarr.br2;for(var b=0;b<i;++b){this.Fill3DHistogram(h[b],f[b],c[b],1)}break}}};a.TDrawSelector.prototype.ProcessDump=function(c){var b=this.leaf?this.tgtobj.br0[this.leaf]:this.tgtobj.br0;if(b&&this.copy_fields){if(a.CheckArrayPrototype(b)===0){this.hist.push(a.extend({},b))}else{this.hist.push(b)}}else{this.hist.push(b)}};a.TDrawSelector.prototype.Process=function(k){this.globals.entry=k;for(var c=0;c<this.ndim;++c){this.vars[c].Produce(this.tgtobj)}this.cut.Produce(this.tgtobj);var g=this.vars[0],e=this.vars[1],d=this.vars[2],j=this.cut;if(this.arr_limit){switch(this.ndim){case 1:for(var i=0;i<g.length;++i){g.buf.push(g.get(i));j.buf.push(j.value)}break;case 2:for(var i=0;i<g.length;++i){for(var h=0;h<e.length;++h){g.buf.push(g.get(i));e.buf.push(e.get(h));j.buf.push(j.value)}}break;case 3:for(var i=0;i<g.length;++i){for(var h=0;h<e.length;++h){for(var f=0;f<d.length;++f){g.buf.push(g.get(i));e.buf.push(e.get(h));d.buf.push(d.get(f));j.buf.push(j.value)}}}break}if(g.buf.length>=this.arr_limit){this.CreateHistogram();this.arr_limit=0}}else{if(this.hist){switch(this.ndim){case 1:for(var i=0;i<g.length;++i){this.Fill1DHistogram(g.get(i),j.value)}break;case 2:for(var i=0;i<g.length;++i){for(var h=0;h<e.length;++h){this.Fill2DHistogram(g.get(i),e.get(h),j.value)}}break;case 3:for(var i=0;i<g.length;++i){for(var h=0;h<e.length;++h){for(var f=0;f<d.length;++f){this.Fill3DHistogram(g.get(i),e.get(h),d.get(f),j.value)}}}break}}}if(this.monitoring&&this.hist&&!this.dump_values){var b=new Date().getTime();if(b-this.lasttm>this.monitoring){this.lasttm=b;a.CallBack(this.histo_callback,this.hist,this.histo_drawopt,true)}}};a.TDrawSelector.prototype.Terminate=function(b){if(b&&!this.hist){this.CreateHistogram()}this.ShowProgress();return a.CallBack(this.histo_callback,this.hist,this.dump_values?"inspect":this.histo_drawopt)};a.IO.FindBrachStreamerElement=function(f,e){if(!f||!e||(f._typename!=="TBranchElement")||(f.fID<0)||(f.fStreamerType<0)){return null}var h=e.FindStreamerInfo(f.fClassName,f.fClassVersion,f.fCheckSum),b=(h&&h.fElements)?h.fElements.arr:null;if(!b){return null}var d=f.fName;var i=d.indexOf("[");if(i>0){d=d.substr(0,i)}i=d.lastIndexOf(".");if(i>0){d=d.substr(i+1)}function g(j){if(!j){return false}if(j.fName!==d){return false}if(j.fType===f.fStreamerType){return true}if((j.fType===a.IO.kBool)&&(f.fStreamerType===a.IO.kUChar)){return true}if(((f.fStreamerType===a.IO.kSTL)||(f.fStreamerType===a.IO.kSTL+a.IO.kOffsetL)||(f.fStreamerType===a.IO.kSTLp)||(f.fStreamerType===a.IO.kSTLp+a.IO.kOffsetL))&&(j.fType===a.IO.kStreamer)){return true}console.warn("Should match element",j.fType,"with branch",f.fStreamerType);return false}if(g(b[f.fID])){return b[f.fID]}for(var c=0;c<b.length;++c){if((c!==f.fID)&&g(b[c])){return b[c]}}console.error("Did not found/match element for branch",f.fName,"class",f.fClassName);return null};a.IO.DefineMemberTypeName=function(e,j,c){var g=e.FindStreamerInfo(j),h=(g&&g.fElements)?g.fElements.arr:null,d=null;if(!h){return""}for(var f=0;f<h.length;++f){if(h[f].fTypeName==="BASE"){var i=a.IO.DefineMemberTypeName(e,h[f].fName,c);if(i){return i}}else{if(h[f].fName===c){d=h[f];break}}}if(!d){return""}var b=d.fTypeName;if(b[b.length-1]==="*"){b=b.substr(0,b.length-1)}return b};a.IO.GetBranchObjectClass=function(e,b,d,f){if(!e||(e._typename!=="TBranchElement")){return""}if((e.fType===a.BranchType.kLeafNode)&&(e.fID===-2)&&(e.fStreamerType===-1)){return e.fClassName}if(d&&e.fClonesName&&((e.fType===a.BranchType.kClonesNode)||(e.fType===a.BranchType.kSTLNode))){return e.fClonesName}var c=a.IO.FindBrachStreamerElement(e,b.$file);if((e.fType===a.BranchType.kBaseClassNode)&&c&&(c.fTypeName==="BASE")){return c.fName}if(e.fType===a.BranchType.kObjectNode){if(c&&((c.fType===a.IO.kObject)||(c.fType===a.IO.kAny))){return c.fTypeName}return"TObject"}if((e.fType===a.BranchType.kLeafNode)&&c&&f){if((c.fType===a.IO.kObject)||(c.fType===a.IO.kAny)){return c.fTypeName}if(c.fType===a.IO.kObjectp){return c.fTypeName.substr(0,c.fTypeName.length-1)}}return""};a.IO.MakeMethodsList=function(e){var b=a.getMethods(e);var d={names:[],values:[],Create:function(){var f={};for(var g=0;g<this.names.length;++g){f[this.names[g]]=this.values[g]}return f}};d.names.push("_typename");d.values.push(e);for(var c in b){d.names.push(c);d.values.push(b[c])}return d};a.IO.DetectBranchMemberClass=function(c,e,f){var b="";for(var d=(f||0);d<c.arr.length;++d){if((c.arr[d].fName.indexOf(e)===0)&&c.arr[d].fClassName){b=c.arr[d].fClassName}}return b};a.TreeMethods={};a.TreeMethods.Process=function(q,f){if(!f){f={}}if(!q||!this.$file||!q.branches){console.error("required parameter missing for TTree::Process");if(q){q.Terminate(false)}return false}var w={tree:this,file:this.$file,selector:q,arr:[],curr:-1,current_entry:-1,simple_read:true,process_arrays:true};var j=0;function l(h,k){var n=0;switch(h._typename){case"TLeafF":n=a.IO.kFloat;break;case"TLeafD":n=a.IO.kDouble;break;case"TLeafO":n=a.IO.kBool;break;case"TLeafB":n=h.fIsUnsigned?a.IO.kUChar:a.IO.kChar;break;case"TLeafS":n=h.fIsUnsigned?a.IO.kUShort:a.IO.kShort;break;case"TLeafI":n=h.fIsUnsigned?a.IO.kUInt:a.IO.kInt;break;case"TLeafL":n=h.fIsUnsigned?a.IO.kULong64:a.IO.kLong64;break;case"TLeafC":n=a.IO.kTString;break;default:return null}return a.IO.CreateStreamerElement(k||h.fName,n)}function g(n){for(var h=0;h<w.arr.length;++h){if(w.arr[h].branch===n){return w.arr[h]}}return null}function t(y,J,aa,V){if(typeof y==="string"){y=w.tree.FindBranch(y)}if(!y){console.error("Did not found branch");return null}var T=g(y);if(T){console.error("Branch already configured for reading",y.fName);if(T.tgt!==J){console.error("Target object differs")}return S}if(!y.fEntries){console.warn("Branch ",y.fName," does not have entries");return null}T={branch:y,tgt:J,name:aa,index:-1,member:null,type:0,curr_entry:-1,raw:null,basket:null,curr_basket:0,read_entry:-1,staged_entry:-1,first_readentry:-1,staged_basket:0,numentries:y.fEntries,numbaskets:y.fWriteBasket,counters:null,ascounter:[],baskets:[],staged_prev:0,staged_now:0,progress_showtm:0,GetBasketEntry:function(ab){if(!this.branch||(ab>this.branch.fMaxBaskets)){return 0}var ad=(ab<this.branch.fMaxBaskets)?this.branch.fBasketEntry[ab]:0;if(ad){return ad}var ac=(ab>0)?this.branch.fBaskets.arr[ab-1]:null;return ac?(this.branch.fBasketEntry[ab-1]+ac.fNevBuf):0},GetTarget:function(ad){if(!this.tgt){return ad}for(var ab=0;ab<this.tgt.length;++ab){var ac=this.tgt[ab];if(!ad[ac.name]){ad[ac.name]=ac.lst.Create()}ad=ad[ac.name]}return ad},GetEntry:function(ab){var k=ab-this.first_entry,ac;if(!this.branch.TestBit(a.IO.BranchBits.kDoNotUseBufferMap)){this.raw.ClearObjectMap()}if(this.basket.fEntryOffset){ac=this.basket.fEntryOffset[k];if(this.basket.fDisplacement){this.raw.fDisplacement=this.basket.fDisplacement[k]}}else{ac=this.basket.fKeylen+this.basket.fNevBufSize*k}this.raw.locate(ac-this.raw.raw_shift)}};while(T.GetBasketEntry(T.numbaskets+1)){T.numbaskets++}var U=y.fBranches?y.fBranches.arr.length:0,X=y.fLeaves?y.fLeaves.arr.length:0,Q=(X>0)?y.fLeaves.arr[0]:null,S=null,z=null,Y=(y._typename==="TBranchElement"),G=0,H=null,F=null,I="";if(y.fBranchCount){H=g(y.fBranchCount);if(!H){H=t(y.fBranchCount,J,"$counter"+j++,true)}if(!H){console.error("Cannot add counter branch",y.fBranchCount.fName);return null}var W=y.fBranchCount2;if(!W&&(y.fBranchCount.fStreamerType===a.IO.kSTL)&&((y.fStreamerType===a.IO.kStreamLoop)||(y.fStreamerType===a.IO.kOffsetL+a.IO.kStreamLoop))){var D=a.IO.FindBrachStreamerElement(y,w.file),C=y.fBranchCount.fBranches.arr;if(D&&D.fCountName&&C){for(var O=0;O<C.length;++O){if(C[O].fName===y.fBranchCount.fName+"."+D.fCountName){W=C[O];break}}}if(!W){console.error("Did not found branch for second counter of kStreamLoop element")}}if(W){F=g(W);if(!F){F=t(W,J,"$counter"+j++,true)}if(!F){console.error("Cannot add counter branch2",W.fName);return null}}}else{if(X===1&&Q&&Q.fLeafCount){var B=w.tree.FindBranch(Q.fLeafCount.fName);if(B){H=g(B);if(!H){H=t(B,J,"$counter"+j++,true)}if(!H){console.error("Cannot add counter branch",B.fName);return null}}}}function n(ah,ab,ai){if(!ah||!ah.arr.length){return true}var al=y.fName;if(al[al.length-1]==="."){al=al.substr(0,al.length-1)}if((typeof V==="string")&&(V[0]==".")){al+=V}al+=".";for(var af=0;af<ah.arr.length;++af){var ak=ah.arr[af];if((ai>0)&&(ak.fType!==ai)){continue}if(ak.fType===a.BranchType.kBaseClassNode){if(!n(ak.fBranches,ab,ai)){return false}continue}var ae=a.IO.FindBrachStreamerElement(ak,w.file);if(ae&&(ae.fTypeName==="BASE")){if(ak.fTotBytes&&!t(ak,J,aa,V)){return false}if(!n(ak.fBranches,ab,ai)){return false}continue}var aj=ak.fName,ag=1;if(ak.fName.indexOf(al)===0){aj=aj.substr(al.length)}else{if(ai>0){continue}}var ac=aj.indexOf("[");if(ac>0){aj=aj.substr(0,ac)}ac=aj.indexOf("<");if(ac>0){aj=aj.substr(0,ac)}if(ai>0){ag="$child$";var ad=aj.indexOf(".");if(ad>0){ag=a.IO.DetectBranchMemberClass(ah,y.fName+"."+aj.substr(0,ad+1),af)||"TObject"}}if(!t(ak,ab,aj,ag)){return false}}return true}if(y._typename==="TBranchObject"){z={name:aa,typename:y.fClassName,virtual:Q.fVirtual,func:function(k,ac){var ab=this.typename;if(this.virtual){ab=k.ReadFastString(k.ntou1()+1)}ac[this.name]=k.ClassStreamer({},ab)}}}else{if((y.fType===a.BranchType.kClonesNode)||(y.fType===a.BranchType.kSTLNode)){S=a.IO.CreateStreamerElement(aa,a.IO.kInt);if(!V||((typeof V==="string")&&(V[0]==="."))||(V===1)){w.process_arrays=false;z={name:aa,conttype:y.fClonesName||"TObject",reallocate:f.reallocate_objects,func:function(k,ac){var ab=k.ntoi4(),ad=0;if(!ac[this.name]||this.reallocate){ac[this.name]=new Array(ab)}else{ad=ac[this.name].length;ac[this.name].length=ab}while(ad<ab){ac[this.name][ad++]=this.methods.Create()}}};if((typeof V==="string")&&(V[0]===".")){z.conttype=a.IO.DetectBranchMemberClass(y.fBranches,y.fName+V);if(!z.conttype){console.error("Cannot select object",V,"in the branch",y.fName);return null}}z.methods=a.IO.MakeMethodsList(z.conttype);G=(y.fType===a.BranchType.kClonesNode)?a.BranchType.kClonesMemberNode:a.BranchType.kSTLMemberNode}}else{if((I=a.IO.GetBranchObjectClass(y,w.tree))){if(V===true){console.warn("Object branch "+I+" can not have data to be read directly");return null}w.process_arrays=false;var E=new Array(J?(J.length+1):1);for(var M=0;M<E.length-1;++M){E[M]=J[M]}E[E.length-1]={name:aa,lst:a.IO.MakeMethodsList(I)};if(!n(y.fBranches,E,0)){return null}return T}else{if(Y&&(X===1)&&(Q.fName===y.fName)&&(y.fID==-1)){S=a.IO.CreateStreamerElement(aa,y.fClassName);if(S.fType===a.IO.kAny){var Z=w.file.GetStreamer(y.fClassName,{val:y.fClassVersion,checksum:y.fCheckSum});if(!Z){S=null;console.warn("not found streamer!")}else{z={name:aa,typename:y.fClassName,streamer:Z,func:function(k,ac){var ab={_typename:this.typename};for(var ad=0;ad<this.streamer.length;++ad){this.streamer[ad].func(k,ab)}ac[this.name]=ab}}}}}else{if(Y&&(X<=1)){S=a.IO.FindBrachStreamerElement(y,w.file);if(!S&&y.fStreamerType&&(y.fStreamerType<20)){S=a.IO.CreateStreamerElement(aa,y.fStreamerType)}}else{if(X===1){S=l(Q,aa)}else{if((y._typename==="TBranch")&&(X>1)){var h=new Array(X),P=true;for(var M=0;M<X;++M){h[M]=l(y.fLeaves.arr[M]);h[M]=a.IO.CreateMember(h[M],w.file);if(!h[M]){P=false}}if(P){z={name:aa,leaves:h,func:function(ab,ac){var ad=ac[this.name],k=0;if(!ad){ac[this.name]=ad={}}while(k<this.leaves.length){this.leaves[k++].func(ab,ad)}}}}}}}}}}}if(!S&&!z){console.warn("Not supported branch kind",y.fName,y._typename);return null}if(!z){z=a.IO.CreateMember(S,w.file);if((z.base!==undefined)&&z.basename){z.func=function(k,ab){if(!ab[this.name]){ab[this.name]={_typename:this.basename}}k.ClassStreamer(ab[this.name],this.basename)}}}if(H&&(typeof V==="string")){z.name0=H.name;var L=aa.split(".");if(L.length===1){z.get=function(k,ab){return k[ab]}}else{if(V==="$child$"){console.error("target name contains point, but suppose to be direct child",aa);return null}else{if(L.length===2){aa=z.name=L[1];z.name1=L[0];z.subtype1=V;z.methods1=a.IO.MakeMethodsList(z.subtype1);z.get=function(k,ac){var ab=k[ac][this.name1];if(!ab){ab=k[ac][this.name1]=this.methods1.Create()}return ab}}else{if(!y.fParentName){console.error("Not possible to provide more than 2 parts in the target name",aa);return null}aa=z.name=L.pop();z.snames=L;z.smethods=[];var N=y.fParentName;for(var O=0;O<L.length;++O){var A=a.IO.DefineMemberTypeName(w.file,N,L[O]);z.smethods[O]=a.IO.MakeMethodsList(A||"AbstractClass");N=A}z.get=function(ab,af){var ae=ab[af][this.snames[0]];if(!ae){ae=ab[af][this.snames[0]]=this.smethods[0].Create()}for(var ac=1;ac<this.snames.length;++ac){var ad=ae[this.snames[ac]];if(!ad){ad=ae[this.snames[ac]]=this.smethods[ac].Create()}ae=ad}return ae}}}}if(z.objs_branch_func){z.func=z.objs_branch_func}else{z.func0=z.func;z.func=function(ab,ac){var k=ac[this.name0],ad=0;while(ad<k.length){this.func0(ab,this.get(k,ad++))}}}}else{if(H){w.process_arrays=false;if((S.fType===a.IO.kDouble32)||(S.fType===a.IO.kFloat16)){z.stl_size=H.name;z.func=function(k,ab){ab[this.name]=this.readarr(k,ab[this.stl_size])}}else{if(((S.fType===a.IO.kOffsetP+a.IO.kDouble32)||(S.fType===a.IO.kOffsetP+a.IO.kFloat16))&&y.fBranchCount2){z.stl_size=H.name;z.arr_size=F.name;z.func=function(ab,ac){var af=ac[this.stl_size],ad=ac[this.arr_size],k=new Array(af);for(var ae=0;ae<af;++ae){k[ae]=(ab.ntou1()===1)?this.readarr(ab,ad[ae]):[]}ac[this.name]=k}}else{if(((S.fType>0)&&(S.fType<a.IO.kOffsetL))||(S.fType===a.IO.kTString)||(((S.fType>a.IO.kOffsetP)&&(S.fType<a.IO.kOffsetP+a.IO.kOffsetL))&&y.fBranchCount2)){z={name:aa,stl_size:H.name,type:S.fType,func:function(k,ab){ab[this.name]=k.ReadFastArray(ab[this.stl_size],this.type)}};if(y.fBranchCount2){z.type-=a.IO.kOffsetP;z.arr_size=F.name;z.func=function(ab,ac){var af=ac[this.stl_size],ad=ac[this.arr_size],k=new Array(af);for(var ae=0;ae<af;++ae){k[ae]=(ab.ntou1()===1)?ab.ReadFastArray(ad[ae],this.type):[]}ac[this.name]=k}}}else{if((S.fType>a.IO.kOffsetP)&&(S.fType<a.IO.kOffsetP+a.IO.kOffsetL)&&z.cntname){z.cntname=H.name}else{if(S.fType==a.IO.kStreamer){if(F){throw new Error("Second branch counter not supported yet with JSROOT.IO.kStreamer")}z.func=z.branch_func;z.stl_size=H.name}else{if((S.fType===a.IO.kStreamLoop)||(S.fType===a.IO.kOffsetL+a.IO.kStreamLoop)){if(F){z.stl_size=H.name;z.cntname=F.name;z.func=z.branch_func}else{z.cntname=H.name}}else{z.name="$stl_member";var K;if(F){if(z.cntname){K=F.name;z.cntname="$loop_size"}else{throw new Error("Second branch counter not used - very BAD")}}var R={name:aa,stl_size:H.name,loop_size:K,member0:z,func:function(ab,ad){var ac=ad[this.stl_size],k=new Array(ac),ae=0;for(var ae=0;ae<ac;++ae){if(this.loop_size){ad.$loop_size=ad[this.loop_size][ae]}this.member0.func(ab,ad);k[ae]=ad.$stl_member}delete ad.$stl_member;delete ad.$loop_size;ad[this.name]=k}};z=R}}}}}}}}z.name=aa;T.member=z;if(S){T.type=S.fType}T.index=w.arr.length;if(H){T.counters=[H.index];H.ascounter.push(T.index);if(F){T.counters.push(F.index);F.ascounter.push(T.index)}}w.arr.push(T);if(G){if(!n(y.fBranches,J,G)){return null}}return T}for(var e=0;e<q.branches.length;++e){var v=t(q.branches[e],undefined,q.names[e],q.directs[e]);if(!v){q.Terminate(false);return false}}for(var s=1;(s<w.arr.length)&&w.simple_read;++s){var v=w.arr[s],c=w.arr[0];if((v.numentries!==c.numentries)||(v.numbaskets!==c.numbaskets)){w.simple_read=false}for(var o=0;o<v.numbaskets;++o){if(v.GetBasketEntry(o)!==c.GetBasketEntry(o)){w.simple_read=false}}}w.firstentry=w.lastentry=0;for(var e=0;e<w.arr.length;++e){var d=w.arr[e].branch,m=d.fFirstEntry;if(m===undefined){m=(d.fBasketBytes[0]?d.fBasketEntry[0]:0)}w.firstentry=Math.max(w.firstentry,m);w.lastentry=(e===0)?(m+d.fEntries):Math.min(w.lastentry,m+d.fEntries)}if(w.firstentry>=w.lastentry){console.warn("No any common events for selected branches");q.Terminate(false);return false}w.process_min=w.firstentry;w.process_max=w.lastentry;if(!isNaN(f.firstentry)&&(f.firstentry>w.firstentry)&&(f.firstentry<w.lastentry)){w.process_min=f.firstentry}w.current_entry=w.staged_now=w.process_min;if(!isNaN(f.numentries)&&(f.numentries>0)){var r=w.process_min+f.numentries;if(r<w.process_max){w.process_max=r}}if((typeof q.ProcessArrays==="function")&&w.simple_read){for(var p=0;p<w.arr.length;++p){var u=w.arr[p];if((u.type<=0)||(u.type>=a.IO.kOffsetL)||(u.type===a.IO.kCharStar)){w.process_arrays=false}}if(w.process_arrays){q.tgtarr={};for(var e=0;e<w.arr.length;++e){var v=w.arr[e];var u=a.IO.CreateStreamerElement(v.name,v.type);u.fType=v.type+a.IO.kOffsetL;u.fArrayLength=10;u.fArrayDim=1;u.fMaxIndex[0]=10;v.arrmember=a.IO.CreateMember(u,w.file)}}}else{w.process_arrays=false}function i(z,h){var y=[],k="";function n(){y=[];k="";for(var D=0;D<z.length;++D){if(z[D].done){continue}var C=z[D].branch;if(y.length===0){k=C.fFileName}else{if(k!==C.fFileName){continue}}z[D].selected=true;y.push(C.fBasketSeek[z[D].basket],C.fBasketBytes[z[D].basket])}return y.length>0}function A(E){if((w.staged_prev===w.staged_now)||(w.process_max<=w.process_min)){return}var C=new Date().getTime();if(C-w.progress_showtm<500){return}w.progress_showtm=C;var D=(w.staged_prev+E*(w.staged_now-w.staged_prev))/(w.process_max-w.process_min);w.selector.ShowProgress(D)}function B(J){if(!J||((y.length>2)&&(J.length*2!==y.length))){return a.CallBack(h,null)}var H=[],I=0;for(var D=0;D<z.length;++D){if(!z[D].selected){continue}z[D].selected=false;z[D].done=true;var C=(y.length>2)?J[I++]:J,E=a.CreateTBuffer(C,0,w.file),F=E.ClassStreamer({},"TBasket");if(F.fNbytes!==z[D].branch.fBasketBytes[z[D].basket]){console.error("mismatch in read basket sizes",z[D].branch.fBasketBytes[z[D].basket])}z[D].bskt_obj=F;if(F.fKeylen+F.fObjlen===F.fNbytes){E.raw_shift=0}else{var G=a.R__unzip(C,F.fObjlen,false,E.o);if(G){E=a.CreateTBuffer(G,0,w.file);E.raw_shift=F.fKeylen;E.fTagOffset=F.fKeylen}else{throw new Error("FAIL TO UNPACK")}}z[D].raw=E;if(z[D].branch.fEntryOffsetLen>0){E.ReadBasketEntryOffset(F,E.raw_shift)}}if(n()){w.file.ReadBuffer(y,B,k,A)}else{a.CallBack(h,z)}}if(n()){w.file.ReadBuffer(y,B,k,A)}else{a.CallBack(h,null)}}function b(){var H=0,F=[],C=true,E=false,G=w.process_max;while((H<1000000)&&C){C=false;for(var y=w.arr.length-1;y>=0;--y){var z=w.arr[y];while(z.staged_basket<z.numbaskets){var A=z.staged_basket++;if(z.GetBasketEntry(A)>=w.process_max){break}if(z.first_readentry<0){var D=z.GetBasketEntry(A+1),I=(D<=w.process_min);if(I){continue}z.curr_basket=A;z.first_readentry=z.GetBasketEntry(A)}var B={id:y,branch:z.branch,basket:A,raw:null};var h=z.branch.fBaskets.arr[A];if(h){B.raw=h.fBufferRef;if(B.raw){B.raw.locate(0)}else{B.raw=a.CreateTBuffer(null,0,w.file)}B.raw.raw_shift=h.fKeylen;if(h.fBufferRef&&(z.branch.fEntryOffsetLen>0)){B.raw.ReadBasketEntryOffset(h,B.raw.raw_shift)}B.bskt_obj=h;E=true;z.baskets[A]=B}else{F.push(B);H+=z.branch.fBasketBytes[A];C=true}z.staged_entry=z.GetBasketEntry(A+1);G=Math.min(G,z.staged_entry);break}}}if((H===0)&&!E){return w.selector.Terminate(true)}w.staged_prev=w.staged_now;w.staged_now=G;var J=0;if(w.process_max>w.process_min){J=(w.staged_prev-w.process_min)/(w.process_max-w.process_min)}w.selector.ShowProgress(J);w.progress_showtm=new Date().getTime();if(H>0){return i(F,x)}if(E){return x([])}throw new Error("No any data is requested - never come here")}function x(A){if((w.selector.break_execution!==0)||(A===null)){return w.selector.Terminate(false)}for(var C=0;C<A.length;++C){w.arr[A[C].id].baskets[A[C].basket]=A[C]}var z=false;while(true){var y=100000000,k=w.process_max,C,B;for(C=0;C<w.arr.length;++C){B=w.arr[C];if(!B.raw||!B.basket||(B.first_entry+B.basket.fNevBuf<=w.current_entry)){delete B.raw;delete B.basket;if((B.curr_basket>=B.numbaskets)){if(C==0){return w.selector.Terminate(true)}continue}var h=B.baskets[B.curr_basket];if(!h){if(!z){console.warn("no data?",B.branch.fName,B.curr_basket);return w.selector.Terminate(false)}return b()}B.raw=h.raw;B.basket=h.bskt_obj;B.first_entry=B.GetBasketEntry(h.basket);h.raw=null;h.branch=null;h.bskt_obj=null;B.baskets[B.curr_basket++]=undefined}y=Math.min(y,B.first_entry+B.basket.fNevBuf-w.current_entry)}if(w.current_entry+y>w.process_max){y=w.process_max-w.current_entry}if(w.process_arrays&&(y>1)){for(C=0;C<w.arr.length;++C){B=w.arr[C];B.GetEntry(w.current_entry);B.arrmember.arrlength=y;B.arrmember.func(B.raw,w.selector.tgtarr);B.raw=null}w.selector.ProcessArrays(w.current_entry);w.current_entry+=y;z=true}else{while(y--){for(C=0;C<w.arr.length;++C){B=w.arr[C];B.GetEntry(w.current_entry);B.member.func(B.raw,B.GetTarget(w.selector.tgtobj))}w.selector.Process(w.current_entry);w.current_entry++;z=true}}if(w.current_entry>=w.process_max){return w.selector.Terminate(true)}}}w.selector.Begin(this);b();return true};a.TreeMethods.FindBranch=function(d,f,h){var c=false,m=d,i=null;if(h===undefined){c=true;h=this.fBranches;var j=m.indexOf("[");if(j>0){m=m.substr(0,j)}}if(!h||(h.arr.length===0)){return null}for(var e=0;e<h.arr.length;++e){var g=h.arr[e].fName;if(g[g.length-1]=="]"){g=g.substr(0,g.indexOf("["))}if((m.indexOf(g)!==0)&&(g.indexOf("<")>0)){var l=g.indexOf("<"),k=g.lastIndexOf(">");g=g.substr(0,l)+g.substr(k+1)}if(g===m){i={branch:h.arr[e],rest:""};break}if(m.indexOf(g)!==0){continue}var b=g.length;if(g[b-1]==="."){b--}if(m[b]!=="."){continue}i=this.FindBranch(m,f,h.arr[e].fBranches);if(!i){i=this.FindBranch(m.substr(b+1),f,h.arr[e].fBranches)}if(!i){i={branch:h.arr[e],rest:m.substr(b)}}break}if(!c||!i){return i}if(d.length>m.length){i.rest+=d.substr(m.length)}if(!f&&(i.rest.length>0)){return null}return f?i:i.branch};a.TreeMethods.Draw=function(c,d){if(typeof c==="string"){c={expr:c}}if(!c.expr){c.expr=""}if(c.expr==="testio"){return this.IOTest(c,d)}var b=new a.TDrawSelector(d);if(c.branch){if(!b.DrawOnlyBranch(this,c.branch,c.expr,c)){b=null}}else{if(!b.ParseDrawExpression(this,c)){b=null}}if(!b){return a.CallBack(d,null)}return this.Process(b,c)};a.TreeMethods.IOTest=function(d,g){if(!d.names&&!d.bracnhes){d.branches=[];d.names=[];d.nchilds=[];d.nbr=0;function f(m,h){if(!m||!m.fBranches){return 0}var k=0;for(var p=0;p<m.fBranches.arr.length;++p){var j=m.fBranches.arr[p],i=(h?h+"/":"")+j.fName;d.branches.push(j);d.names.push(i);d.nchilds.push(0);var o=d.nchilds.length-1;k+=j.fLeaves?j.fLeaves.arr.length:0;var l=f(j,i);k+=l;d.nchilds[o]=l}return k}var c=f(this);d.names.push("Total are "+d.branches.length+" branches with "+c+" leaves")}d.lasttm=new Date().getTime();d.lastnbr=d.nbr;var b=this;function e(){var h=new a.TSelector;h.AddBranch(d.branches[d.nbr],"br0");h.Process=function(){if(this.tgtobj.br0===undefined){this.fail=true}};h.Terminate=function(q){if(typeof q!=="string"){q=(!q||this.fails)?"FAIL":"ok"}d.names[d.nbr]=q+" "+d.names[d.nbr];d.nbr++;if(d.nbr>=d.branches.length){a.progress();return a.CallBack(g,d.names,"inspect")}var p=new Date().getTime();if((p-d.lasttm>5000)||(d.nbr-d.lastnbr>50)){setTimeout(b.IOTest.bind(b,d,g),100)}else{e()}};a.progress("br "+d.nbr+"/"+d.branches.length+" "+d.names[d.nbr]);var m=d.branches[d.nbr];var l=a.IO.GetBranchObjectClass(m,b),j=m.fEntries;var i=(!m.fLeaves||(m.fLeaves.arr.length===0));if(l){i=(d.nchilds[d.nbr]>100)}if(i||(j<=0)){h.Terminate("ignore")}else{var k={numentries:10},o=m.fFirstEntry||0,n=m.fEntryNumber||(o+j);if(j<k.numentries){k.numentries=j}else{k.firstentry=o+Math.round((n-o-k.numentries)*Math.random())}console.log("test branch",m.fName,"first",(k.firstentry||0),"num",k.numentries);b.Process(h,k)}}e()};if(a.Painter){a.Painter.CreateBranchItem=function(d,i,l,e){if(!d||!i){return false}var h=i.fBranches?i.fBranches.arr.length:0,b=i.fLeaves?i.fLeaves.arr.length:0;function g(j){var m=j.indexOf("[");if(m>0){j=j.substr(0,m)}if(e&&j.indexOf(e.fName)==0){j=j.substr(e.fName.length);if(j[0]==="."){j=j.substr(1)}}return j}i.$tree=l;var k={_name:g(i.fName),_kind:"ROOT."+i._typename,_title:i.fTitle,_obj:i};if(!d._childs){d._childs=[]}d._childs.push(k);if(i._typename==="TBranchElement"){k._title+=" from "+i.fClassName+";"+i.fClassVersion}if(h>0){k._more=true;k._expand=function(m,j){if(!j){return false}if(!m._childs){m._childs=[]}if(j.fLeaves&&(j.fLeaves.arr.length===1)&&((j.fType===a.BranchType.kClonesNode)||(j.fType===a.BranchType.kSTLNode))){j.fLeaves.arr[0].$branch=j;m._childs.push({_name:"@size",_title:"container size",_kind:"ROOT.TLeafElement",_icon:"img_leaf",_obj:j.fLeaves.arr[0],_more:false})}for(var q=0;q<j.fBranches.arr.length;++q){a.Painter.CreateBranchItem(m,j.fBranches.arr[q],j.$tree,j)}var p=a.IO.GetBranchObjectClass(j,j.$tree,true),n=p?a.getMethods(p):null;if(n&&(j.fBranches.arr.length>0)){for(var o in n){if(typeof n[o]!=="function"){continue}var r=n[o].toString();if((r.indexOf("return")>0)&&(r.indexOf("function ()")==0)){m._childs.push({_name:o+"()",_title:"function "+o+" of class "+p,_kind:"ROOT.TBranchFunc",_obj:{_typename:"TBranchFunc",branch:j,func:o},_more:false})}}}return true};return true}else{if(b===1){k._icon="img_leaf";k._more=false}else{if(b>1){k._childs=[];for(var f=0;f<b;++f){i.fLeaves.arr[f].$branch=i;var c={_name:g(i.fLeaves.arr[f].fName),_kind:"ROOT."+i.fLeaves.arr[f]._typename,_obj:i.fLeaves.arr[f]};k._childs.push(c)}}}}return true}}if(a.Painter){a.Painter.TreeHierarchy=function(c,d){if(d._typename!="TTree"&&d._typename!="TNtuple"&&d._typename!="TNtupleD"){return false}c._childs=[];c._tree=d;for(var b=0;b<d.fBranches.arr.length;++b){a.Painter.CreateBranchItem(c,d.fBranches.arr[b],d)}return true}}if(a.Painter){a.Painter.drawTree=function(h,f,e){var c=new a.TObjectPainter(f);var b=f,d=e;if(f._typename=="TBranchFunc"){d={expr:"."+f.func+"()",branch:f.branch};if(e&&e.indexOf("dump")==0){d.expr+=">>"+e}else{if(e){d.expr+=e}}b=f.branch.$tree}else{if(f.$branch){d={expr:"."+f.fName+(e||""),branch:f.$branch};if((d.branch.fType===a.BranchType.kClonesNode)||(d.branch.fType===a.BranchType.kSTLNode)){d.expr=e;d.direct_branch=true}b=f.$branch.$tree}else{if(f.$tree){if(!e&&f.fStreamerType&&(f.fStreamerType!==a.IO.kTString)&&(f.fStreamerType>=a.IO.kObject)&&(f.fStreamerType<=a.IO.kAnyP)){e="dump"}d={expr:e,branch:f};b=f.$tree}else{if((d==="player")||!d){a.AssertPrerequisites("jq2d",function(){a.CreateTreePlayer(c);c.ConfigureTree(b);c.Show(h);c.DrawingReady()});return c}if(typeof d==="string"){d={expr:d}}}}}if(!b){console.error("No TTree object available for TTree::Draw");return c.DrawingReady()}var g=c.DrawingReady.bind(c);c._return_res_painter=true;a.cleanup(h);b.Draw(d,function(j,i,l){var k="";if(!d.player){k=h}else{if(d.create_player===2){k=c.drawid}}if(k){return a.redraw(k,j,i,l?null:g)}if(d.create_player===1){d.player_intermediate=l;return}d.player_create=1;d.player_intermediate=l;a.AssertPrerequisites("jq2d",function(){a.CreateTreePlayer(c);c.ConfigureTree(b);c.Show(h,d);d.create_player=2;a.redraw(c.drawid,j,i,d.player_intermediate?null:g);c.SetItemName("TreePlayer")})});return c}}return a}));