(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter","d3","JSRootMath"],a)}else{if(typeof exports==="object"&&typeof module!=="undefined"){a(require("./JSRootCore.js"),require("./d3.min.js"),require("./JSRootMath.js"))}else{if(typeof d3!="object"){throw new Error("This extension requires d3.v3.js","JSRootPainter.more.js")}if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","JSRootPainter.more.js")}if(typeof JSROOT.Painter!="object"){throw new Error("JSROOT.Painter not defined","JSRootPainter.more.js")}a(JSROOT,d3)}}}(function(d,s){d.sources.push("more2d");function o(){var A=this.GetObject(),z=this.pad_width(),x=this.pad_height(),u=A.fX,F=A.fY,B=this.get_color(A.fTextColor),D=false,E=1,y=A.fTextSize||0.05,v=this.main_painter();if(A.TestBit(d.BIT(14))){u=u*z;F=(1-F)*x}else{if(v&&!v.mode3d){z=this.frame_width();x=this.frame_height();D="upper_layer";u=v.grx(u);F=v.gry(F)}else{if(this.root_pad()!==null){u=this.ConvertToNDC("x",u)*z;F=(1-this.ConvertToNDC("y",F))*x}else{A.fTextAlign=22;u=z/2;F=x/2;if(!B){B="black"}}}}this.CreateG(D);var C={align:A.fTextAlign,x:Math.round(u),y:Math.round(F),text:A.fTitle,color:B,latex:0};if(A.fTextAngle){C.rotate=-A.fTextAngle}if(A._typename=="TLatex"){C.latex=1;E=0.9}else{if(A._typename=="TMathText"){C.latex=2;E=0.8}}this.StartTextDrawing(A.fTextFont,Math.round((y>1)?y:y*Math.min(z,x)*E));this.DrawText(C);this.FinishTextDrawing()}function m(){var w=this.GetObject(),v=new d.TAttLineHandler(w),x=d.BIT(14),u=w.TestBit(x);this.CreateG();this.draw_g.append("svg:line").attr("x1",this.AxisToSvg("x",w.fX1,u)).attr("y1",this.AxisToSvg("y",w.fY1,u)).attr("x2",this.AxisToSvg("x",w.fX2,u)).attr("y2",this.AxisToSvg("y",w.fY2,u)).call(v.func)}function j(){var x=this.GetObject(),w=new d.TAttLineHandler(x),y=this.createAttFill(x),v=d.BIT(14),u=x.TestBit(v),z="";this.CreateG();for(var A=0;A<=x.fLastPoint;++A){z+=((A>0)?"L":"M")+this.AxisToSvg("x",x.fX[A],u)+","+this.AxisToSvg("y",x.fY[A],u)}if(y.color!=="none"){z+="Z"}this.draw_g.append("svg:path").attr("d",z).call(w.func).call(y.func)}function l(){var A=this.GetObject();if(!this.lineatt){this.lineatt=new d.TAttLineHandler(A)}if(!this.fillatt){this.fillatt=this.createAttFill(A)}this.CreateG();var H=this.AxisToSvg("x",A.fX1,false),F=this.AxisToSvg("y",A.fY1,false),z=this.AxisToSvg("x",A.fX1+A.fR1,false)-H,v=F-this.AxisToSvg("y",A.fY1+A.fR2,false);if((A.fPhimin==0)&&(A.fPhimax==360)&&(A.fTheta==0)){this.draw_g.append("svg:ellipse").attr("cx",H).attr("cy",F).attr("rx",z).attr("ry",v).call(this.lineatt.func).call(this.fillatt.func);return}var D=Math.cos(Math.PI*A.fTheta/180),K=Math.sin(Math.PI*A.fTheta/180),J=z*Math.cos(A.fPhimin*Math.PI/180),C=v*Math.sin(A.fPhimin*Math.PI/180),w=J*D-C*K,G=-J*K-C*D,I=z*Math.cos(A.fPhimax*Math.PI/180),B=v*Math.sin(A.fPhimax*Math.PI/180),u=I*D-B*K,E=-I*K-B*D;this.draw_g.attr("transform","translate("+Math.round(H)+","+Math.round(F)+")").append("svg:path").attr("d","M0,0L"+Math.round(w)+","+Math.round(G)+"A"+Math.round(z)+","+Math.round(v)+","+Math.round(-A.fTheta)+",1,0,"+Math.round(u)+","+Math.round(E)+"Z").call(this.lineatt.func).call(this.fillatt.func)}function k(A,x,v){var y=this.GetObject(),E=(typeof this._drawopt=="string")&&(this._drawopt.toUpperCase().indexOf("L")>=0),B=new d.TAttLineHandler(y),z=this.createAttFill(y);this.CreateG();var w=this.AxisToSvg("x",y.fX1,false),u=this.AxisToSvg("x",y.fX2,false),D=this.AxisToSvg("y",y.fY1,false),C=this.AxisToSvg("y",y.fY2,false);if((z.color!="none")&&!E){B.color="none"}this.draw_g.append("svg:rect").attr("x",Math.min(w,u)).attr("y",Math.min(D,C)).attr("width",Math.abs(u-w)).attr("height",Math.abs(D-C)).call(B.func).call(z.func)}function g(){var w=this.GetObject(),z=new d.TAttMarkerHandler(w),A=d.BIT(14),v=w.TestBit(A);this.CreateG();var u=this.AxisToSvg("x",w.fX,v),C=this.AxisToSvg("y",w.fY,v),B=z.create(u,C);if(B){this.draw_g.append("svg:path").attr("d",B).call(z.func)}}function q(){var w=this.GetObject(),v=new d.TAttMarkerHandler(w),u=false;this.CreateG();var x="";for(var y=0;y<w.fN;++y){x+=v.create(this.AxisToSvg("x",w.fX[y],u),this.AxisToSvg("y",w.fY[y],u))}if(x){this.draw_g.append("svg:path").attr("d",x).call(v.func)}}function e(){var z=this.GetObject();if(!this.lineatt){this.lineatt=new d.TAttLineHandler(z)}if(!this.fillatt){this.fillatt=this.createAttFill(z)}var u=Math.max(3,Math.round(Math.max(this.pad_width(),this.pad_height())*z.fArrowSize)),K=Math.round(u*Math.tan(z.fAngle/2*Math.PI/180));this.CreateG();var N=this.AxisToSvg("x",z.fX1,false),A=this.AxisToSvg("y",z.fY1,false),M=this.AxisToSvg("x",z.fX2,false),x=this.AxisToSvg("y",z.fY2,false),v="M0,0L"+u+","+K+"L0,"+(2*K),G="M"+u+",0L0,"+K+"L"+u+","+(2*K),C=null,D=null,I=null,w=null,H=z.fOption,L=H.length;if(H.indexOf("<")==0){var y=(H.indexOf("<|")==0);if(!w){w=this.draw_g.append("defs")}C="jsroot_arrowmarker_"+d.id_counter++;var F=w.append("svg:marker").attr("id",C).attr("markerWidth",u).attr("markerHeight",2*K).attr("refX","0").attr("refY",K).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("svg:path").style("fill","none").attr("d",G+(y?" Z":"")).call(this.lineatt.func);if(y){F.call(this.fillatt.func)}}var E=0;if(H.indexOf("->-")>=0){E=1}else{if(H.indexOf("-|>-")>=0){E=11}else{if(H.indexOf("-<-")>=0){E=2}else{if(H.indexOf("-<|-")>=0){E=12}}}}if(E>0){var y=E>10;if(!w){w=this.draw_g.append("defs")}D="jsroot_arrowmarker_"+d.id_counter++;var O=w.append("svg:marker").attr("id",D).attr("markerWidth",u).attr("markerHeight",2*K).attr("refX",Math.round(u*0.5)).attr("refY",K).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("svg:path").style("fill","none").attr("d",((E%10==1)?v:G)+((E>10)?" Z":"")).call(this.lineatt.func);if(E>10){O.call(this.fillatt.func)}}if(H.lastIndexOf(">")==L-1){var y=(H.lastIndexOf("|>")==L-2)&&(L>1);if(!w){w=this.draw_g.append("defs")}I="jsroot_arrowmarker_"+d.id_counter++;var B=w.append("svg:marker").attr("id",I).attr("markerWidth",u).attr("markerHeight",2*K).attr("refX",u).attr("refY",K).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("svg:path").style("fill","none").attr("d",v+(y?" Z":"")).call(this.lineatt.func);if(y){B.call(this.fillatt.func)}}var J=this.draw_g.append("svg:path").attr("d","M"+N+","+A+((D==null)?"":"L"+Math.round(N/2+M/2)+","+Math.round(A/2+x/2))+"L"+M+","+x).call(this.lineatt.func);if(C){J.style("marker-start","url(#"+C+")")}if(D){J.style("marker-mid","url(#"+D+")")}if(I){J.style("marker-end","url(#"+I+")")}}function f(z,x,w){var u=new d.TObjectPainter(x),v=-1;function y(){if(++v>=x._items.arr.length){return u.DrawingReady()}d.draw(z,x._items.arr[v],x._items.opt[v],y)}d.draw(z,x._hist,"hist",y);return u}function t(u){d.TObjectPainter.call(this,u);this.bins=null}t.prototype=Object.create(d.TObjectPainter.prototype);t.prototype.Eval=function(u){return this.GetObject().evalPar(u)};t.prototype.CreateBins=function(G){var y=this.main_painter(),w=0,A=0,B=this.GetObject();if((y!==null)&&!G){if(y.zoom_xmin!==y.zoom_xmax){w=y.zoom_xmin;A=y.zoom_xmax}else{w=y.xmin;A=y.xmax}}if((B.fSave.length>0)&&!this.nosave){var E=B.fSave.length-2,v=B.fSave[E],z=B.fSave[E+1],H=(z-v)/(E-1),D=[];for(var x=0;x<E;++x){var u=v+H*x;if((w!==A)&&((u+2*H<w)||(u-2*H>A))){continue}var C=B.fSave[x];if(!isNaN(C)){D.push({x:u,y:C})}}return D}var v=B.fXmin,z=B.fXmax,F=false;if(w!==A){if(w>v){v=w}if(A<z){z=A}}if((y!==null)&&y.logx&&(v>0)&&(z>0)){F=true;v=Math.log(v);z=Math.log(z)}var E=Math.max(B.fNpx,101),H=(z-v)/(E-1),D=[];for(var x=0;x<E;x++){var u=v+x*H;if(F){u=Math.exp(u)}var C=this.Eval(u);if(!isNaN(C)){D.push({x:u,y:C})}}return D};t.prototype.CreateDummyHisto=function(){var z=0,w=1,x=0,u=1,y=this.CreateBins(true);if(y&&(y.length>0)){z=w=y[0].x;x=u=y[0].y;y.forEach(function(B){z=Math.min(B.x,z);w=Math.max(B.x,w);x=Math.min(B.y,x);u=Math.max(B.y,u)});if(u>0){u*=1.05}if(x<0){x*=1.05}}var v=d.Create("TH1I"),A=this.GetObject();v.fName=A.fName+"_hist";v.fTitle=A.fTitle;v.fXaxis.fXmin=z;v.fXaxis.fXmax=w;v.fYaxis.fXmin=x;v.fYaxis.fXmax=u;return v};t.prototype.ProcessTooltip=function(u){var w=false;if((u===null)||(this.bins===null)){w=true}else{if((this.bins.length==0)||(u.x<this.bins[0].grx)||(u.x>this.bins[this.bins.length-1].grx)){w=true}}if(w){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var A=100000,z=-1,F;for(var y=0;y<this.bins.length;++y){F=this.bins[y];var E=Math.abs(F.grx-u.x);if(E<A){A=E;z=y}}F=this.bins[z];var x=this.draw_g.select(".tooltip_bin"),B=this.lineatt.width+3;if(x.empty()){x=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",B).call(this.lineatt.func).call(this.fillatt.func)}var D={name:this.GetObject().fName,title:this.GetObject().fTitle,x:F.grx,y:F.gry,color1:this.lineatt.color,color2:this.fillatt.color,lines:[],exact:(Math.abs(F.grx-u.x)<B)&&(Math.abs(F.gry-u.y)<B)};D.changed=x.property("current_bin")!==z;D.menu=D.exact;D.menu_dist=Math.sqrt((F.grx-u.x)*(F.grx-u.x)+(F.gry-u.y)*(F.gry-u.y));if(D.changed){x.attr("cx",F.grx).attr("cy",F.gry).property("current_bin",z)}var v=this.GetTipName();if(v.length>0){D.lines.push(v)}var C=this.main_painter();if(C!==null){D.lines.push("x = "+C.AxisAsText("x",F.x)+" y = "+C.AxisAsText("y",F.y))}return D};t.prototype.Redraw=function(){var B=this.frame_width(),x=this.frame_height(),y=this.GetObject(),z=this.main_painter(),u=this.GetTipName("\n");this.CreateG(true);this.bins=this.CreateBins(false);if(!this.lineatt){this.lineatt=new d.TAttLineHandler(y)}this.lineatt.used=false;if(!this.fillatt){this.fillatt=this.createAttFill(y,undefined,undefined,1)}this.fillatt.used=false;for(var v=0;v<this.bins.length;++v){var D=this.bins[v];D.grx=z.grx(D.x);D.gry=z.gry(D.y)}if(this.bins.length>2){var A=x;if((z.hmin!==undefined)&&(z.hmin>=0)){A=Math.round(z.gry(0));if((A>x)||(A<0)){A=x}}var C=d.Painter.BuildSvgPath("bezier",this.bins,A,2);if(this.lineatt.color!="none"){this.draw_g.append("svg:path").attr("class","line").attr("d",C.path).style("fill","none").call(this.lineatt.func)}if(this.fillatt.color!="none"){this.draw_g.append("svg:path").attr("class","area").attr("d",C.path+C.close).style("stroke","none").call(this.fillatt.func)}}};t.prototype.CanZoomIn=function(x,w,u){if(x!=="x"){return false}var A=this.GetObject();if(A.fSave.length>0){var z=A.fNpx;var y=A.fSave[z+1];var v=A.fSave[z+2];return Math.abs(y-v)/z<Math.abs(w-u)}return true};t.prototype.PerformDraw=function(){if(this.main_painter()===null){var v=this.CreateDummyHisto(),u=this;d.draw(this.divid,v,"AXIS",function(w){u.SetDivId(u.divid);u.Redraw();return u.DrawingReady()});return u}this.SetDivId(this.divid);this.Redraw();return this.DrawingReady()};d.Painter.drawFunction=function(y,x,v){var u=new t(x);u.SetDivId(y,-1);var w=new d.DrawOptions(v);u.nosave=w.check("NOSAVE");if(d.Math!==undefined){return u.PerformDraw()}d.AssertPrerequisites("math",u.PerformDraw.bind(u));return u};function b(u){d.TObjectPainter.call(this,u);this.ownhisto=false;this.bins=null;this.xmin=this.ymin=this.xmax=this.ymax=0;this.wheel_zoomy=true;this.is_bent=(u._typename=="TGraphBentErrors");this.has_errors=(u._typename=="TGraphErrors")||(u._typename=="TGraphAsymmErrors")||this.is_bent||u._typename.match(/^RooHist/)}b.prototype=Object.create(d.TObjectPainter.prototype);b.prototype.Redraw=function(){this.DrawBins()};b.prototype.DecodeOptions=function(v){var x=new d.DrawOptions(v);var u={Line:0,Curve:0,Rect:0,Mark:0,Bar:0,OutRange:0,EF:0,Fill:0,Errors:0,MainError:1,Ends:1,Axis:"AXIS",original:v};var w=this.GetObject();if(this.has_errors){u.Errors=1}u._pfc=x.check("PFC");u._plc=x.check("PLC");u._pmc=x.check("PMC");if(x.check("L")){u.Line=1}if(x.check("F")){u.Fill=1}if(x.check("IA")){u.Axis="A"}else{if(x.check("A")){u.Axis="AXIS"}}if(x.check("X+")){u.Axis+="X+"}if(x.check("Y+")){u.Axis+="Y+"}if(x.check("C")){u.Curve=1;if(!u.Fill){u.Line=1}}if(x.check("*")){u.Mark=103}if(x.check("P0")){u.Mark=104}if(x.check("P")){u.Mark=1}if(x.check("B")){u.Bar=1;u.Errors=0}if(x.check("Z")){u.Errors=1;u.Ends=0}if(x.check("||")){u.Errors=1;u.MainError=0;u.Ends=1}if(x.check("[]")){u.Errors=1;u.MainError=0;u.Ends=2}if(x.check("|>")){u.Errors=1;u.Ends=3}if(x.check(">")){u.Errors=1;u.Ends=4}if(x.check("0")){u.Mark=1;u.Errors=1;u.OutRange=1}if(x.check("1")){if(u.Bar==1){u.Bar=2}}if(x.check("2")){u.Rect=1;u.Line=0;u.Errors=0}if(x.check("3")){u.EF=1;u.Line=0;u.Errors=0}if(x.check("4")){u.EF=2;u.Line=0;u.Errors=0}if(x.check("5")){u.Rect=2;u.Line=0;u.Errors=0}if(x.check("X")){u.Errors=0}if((u.Mark==1)&&(w.fMarkerStyle==1)){u.Mark=101}if(u.Line+u.Fill+u.Mark+u.Bar+u.EF+u.Rect+u.Errors==0){if(x.empty()){u.Line=1}}if(w._typename=="TGraphErrors"){if(s.max(w.fEX)<1e-300&&s.max(w.fEY)<1e-300){u.Errors=0}}return u};b.prototype.CreateBins=function(){var u=this.GetObject();if(!u){return}var x,w=0,y=u.fNpoints;if((u._typename==="TCutG")&&(y>3)){y--}if(u._typename=="TGraphErrors"){w=1}else{if(u._typename=="TGraphAsymmErrors"||u._typename=="TGraphBentErrors"||u._typename.match(/^RooHist/)){w=2}}this.bins=[];for(x=0;x<y;++x){var v={x:u.fX[x],y:u.fY[x],indx:x};switch(w){case 1:v.exlow=v.exhigh=u.fEX[x];v.eylow=v.eyhigh=u.fEY[x];break;case 2:v.exlow=u.fEXlow[x];v.exhigh=u.fEXhigh[x];v.eylow=u.fEYlow[x];v.eyhigh=u.fEYhigh[x];break}this.bins.push(v);if(x===0){this.xmin=this.xmax=v.x;this.ymin=this.ymax=v.y}if(w>0){this.xmin=Math.min(this.xmin,v.x-v.exlow,v.x+v.exhigh);this.xmax=Math.max(this.xmax,v.x-v.exlow,v.x+v.exhigh);this.ymin=Math.min(this.ymin,v.y-v.eylow,v.y+v.eyhigh);this.ymax=Math.max(this.ymax,v.y-v.eylow,v.y+v.eyhigh)}else{this.xmin=Math.min(this.xmin,v.x);this.xmax=Math.max(this.xmax,v.x);this.ymin=Math.min(this.ymin,v.y);this.ymax=Math.max(this.ymax,v.y)}}};b.prototype.CreateHistogram=function(){var u=this.xmin,z=this.xmax,B=this.ymin,v=this.ymax;if(u>=z){z=u+1}if(B>=v){v=B+1}var F=(z-u)*0.1,E=(v-B)*0.1,D=u-F,w=z+F,A=B-E,x=v+E;if((D<0)&&(u>=0)){D=u*0.9}if((w>0)&&(z<=0)){w=0}var C=this.GetObject();if(C.fMinimum!=-1111){A=B=C.fMinimum}if(C.fMaximum!=-1111){x=v=C.fMaximum}if((A<0)&&(B>=0)){A=0.9*B}var y=d.CreateHistogram("TH1I",100);y.fName=C.fName+"_h";y.fTitle=C.fTitle;y.fXaxis.fXmin=D;y.fXaxis.fXmax=w;y.fYaxis.fXmin=A;y.fYaxis.fXmax=x;y.fMinimum=A;y.fMaximum=x;y.fBits=y.fBits|d.TH1StatusBits.kNoStats;return y};b.prototype.OptimizeBins=function(u){if((this.bins.length<30)&&!u){return this.bins}var y=null;if(typeof u=="function"){for(var x=0;x<this.bins.length;++x){if(u(this.bins[x],x)){if(y==null){y=(x==0)?[]:this.bins.slice(0,x)}}else{if(y!=null){y.push(this.bins[x])}}}}if(y==null){y=this.bins}if((y.length<5000)||(d.gStyle.OptimizeDraw==0)){return y}var w=Math.floor(y.length/5000);if(w<2){w=2}var v=[];for(var x=0;x<y.length;x+=w){v.push(y[x])}return v};b.prototype.TooltipText=function(y,x){var v=this.main_painter(),u=[];u.push(this.GetTipName());if(y){u.push("x = "+v.AxisAsText("x",y.x));u.push("y = "+v.AxisAsText("y",y.y));if(this.options.Errors&&(v.x_kind=="normal")&&("exlow" in y)&&((y.exlow!=0)||(y.exhigh!=0))){u.push("error x = -"+v.AxisAsText("x",y.exlow)+"/+"+v.AxisAsText("x",y.exhigh))}if((this.options.Errors||(this.options.EF>0))&&(v.y_kind=="normal")&&("eylow" in y)&&((y.eylow!=0)||(y.eyhigh!=0))){u.push("error y = -"+v.AxisAsText("y",y.eylow)+"/+"+v.AxisAsText("y",y.eyhigh))}}if(x){return u}var w="";for(var z=0;z<u.length;++z){w+=((z>0?"\n":"")+u[z])}return w};b.prototype.DrawBins=function(){this.CreateG(true);var F=this,E=this.main_painter(),S=this.frame_width(),aa=this.frame_height(),R=this.GetObject(),u=0;if(this.options._pfc||this.options._plc||this.options._pmc){if(!this.pallette&&d.Painter.GetColorPalette){this.palette=d.Painter.GetColorPalette()}var y=this.pad_painter(true);if(this.palette&&y){var G=y.GetCurrentPrimitiveIndx(),ac=y.GetNumPrimitives();var J=this.palette.calcColor(G,ac);var Q=this.add_color(J);if(this.options._pfc){R.fFillColor=Q;delete this.fillatt}if(this.options._plc){R.fLineColor=Q;delete this.lineatt}if(this.options._pmc){R.fMarkerColor=Q;delete this.markeratt}}this.options._pfc=this.options._plc=this.options._pmc=false}if(!this.lineatt){this.lineatt=new d.TAttLineHandler(R,undefined,true)}if(!this.fillatt){this.fillatt=this.createAttFill(R,undefined,undefined,1)}this.fillatt.used=false;if(this.fillatt){this.fillatt.used=false}this.draw_kind="none";this.marker_size=0;if(this.lineatt.excl_side!=0){u=this.lineatt.excl_width;if(this.lineatt.width>0){this.options.Line=1}}var K=null;if(this.options.EF){K=this.OptimizeBins();for(var V=0;V<K.length;++V){var v=K[V];v.grx=E.grx(v.x);v.gry=E.gry(v.y-v.eylow)}var C=d.Painter.BuildSvgPath(this.options.EF>1?"bezier":"line",K),H=[];for(var V=K.length-1;V>=0;--V){var v=K[V];v.gry=E.gry(v.y+v.eyhigh);H.push(v)}var z=d.Painter.BuildSvgPath(this.options.EF>1?"Lbezier":"Lline",H);this.draw_g.append("svg:path").attr("d",C.path+z.path+"Z").style("stroke","none").call(this.fillatt.func);this.draw_kind="lines"}if(this.options.Line==1||this.options.Fill==1||(u!==0)){var af="";if(R._typename=="TCutG"){this.options.Fill=1}if(this.options.Fill==1){af="Z";u=0}if(K===null){K=this.OptimizeBins()}for(var V=0;V<K.length;++V){var v=K[V];v.grx=E.grx(v.x);v.gry=E.gry(v.y)}var U="line";if(this.options.Curve===1){U="bezier"}else{if(u!==0){U+="calc"}}var T=d.Painter.BuildSvgPath(U,K);if(u!==0){var ad=[];for(var V=K.length-1;V>=0;--V){var v=K[V];var D=Math.sqrt(v.dgrx*v.dgrx+v.dgry*v.dgry);v.grx+=u*v.dgry/D;v.gry-=u*v.dgrx/D;ad.push(v)}var z=d.Painter.BuildSvgPath("L"+((this.options.Curve===1)?"bezier":"line"),ad);this.draw_g.append("svg:path").attr("d",T.path+z.path+"Z").style("stroke","none").call(this.fillatt.func).style("opacity",0.75)}if(this.options.Line||this.options.Fill){var X=this.draw_g.append("svg:path").attr("d",T.path+af);if(this.options.Line){X.call(this.lineatt.func)}else{X.style("stroke","none")}if(this.options.Fill){X.call(this.fillatt.func)}else{X.style("fill","none")}}this.draw_kind="lines"}var O=null;if(this.options.Errors||this.options.Rect||this.options.Bar){K=this.OptimizeBins(function(ak,aj){var ai=E.grx(ak.x);if(!F.options.Bar&&((ai<0)||(ai>S))){return true}var w=E.gry(ak.y);if(!F.options.Bar&&!F.options.OutRange&&((w<0)||(w>aa))){return true}ak.grx1=Math.round(ai);ak.gry1=Math.round(w);if(F.has_errors){ak.grx0=Math.round(E.grx(ak.x-ak.exlow)-ai);ak.grx2=Math.round(E.grx(ak.x+ak.exhigh)-ai);ak.gry0=Math.round(E.gry(ak.y-ak.eylow)-w);ak.gry2=Math.round(E.gry(ak.y+ak.eyhigh)-w);if(F.is_bent){ak.grdx0=Math.round(E.gry(ak.y+R.fEXlowd[aj])-w);ak.grdx2=Math.round(E.gry(ak.y+R.fEXhighd[aj])-w);ak.grdy0=Math.round(E.grx(ak.x+R.fEYlowd[aj])-ai);ak.grdy2=Math.round(E.grx(ak.x+R.fEYhighd[aj])-ai)}else{ak.grdx0=ak.grdx2=ak.grdy0=ak.grdy2=0}}return false});this.draw_kind="nodes";O=this.draw_g.selectAll(".grpoint").data(K).enter().append("svg:g").attr("class","grpoint").attr("transform",function(w){return"translate("+w.grx1+","+w.gry1+")"})}if(this.options.Bar){for(var Z=1;Z<K.length-1;++Z){K[Z].width=Math.max(2,(K[Z+1].grx1-K[Z-1].grx1)/2-2)}switch(K.length){case 0:break;case 1:K[0].width=S/4;break;case 2:K[0].width=K[1].width=(K[1].grx1-K[0].grx1)/2;break;default:K[0].width=K[1].width;K[K.length-1].width=K[K.length-2].width}var ah=Math.round(E.gry(0));O.append("svg:rect").attr("x",function(w){return Math.round(-w.width/2)}).attr("y",function(w){w.bar=true;if(F.options.Bar!==1){return 0}return(w.gry1>ah)?ah-w.gry1:0}).attr("width",function(w){return Math.round(w.width)}).attr("height",function(w){if(F.options.Bar!==1){return aa>w.gry1?aa-w.gry1:0}return Math.abs(ah-w.gry1)}).call(this.fillatt.func)}if(this.options.Rect){O.filter(function(w){return(w.exlow>0)&&(w.exhigh>0)&&(w.eylow>0)&&(w.eyhigh>0)}).append("svg:rect").attr("x",function(w){w.rect=true;return w.grx0}).attr("y",function(w){return w.gry2}).attr("width",function(w){return w.grx2-w.grx0}).attr("height",function(w){return w.gry0-w.gry2}).call(this.fillatt.func).call(this.options.Rect===2?this.lineatt.func:function(){})}this.error_size=0;if(this.options.Errors){var I=this.lineatt.width+d.gStyle.fEndErrorSize,ag=0,x=this.options.Ends?"m0,"+I+"v-"+2*I:"",ae=this.options.Ends?"m"+I+",0h-"+2*I:"",W=x,P=x,Y=ae,B=ae,A=this.options.MainError?"M0,0L":"M";switch(this.options.Ends){case 2:ag=Math.max(this.lineatt.width+1,Math.round(I*0.66));W="m"+ag+","+I+"h-"+ag+"v-"+2*I+"h"+ag;P="m-"+ag+","+I+"h"+ag+"v-"+2*I+"h-"+ag;Y="m-"+I+","+ag+"v-"+ag+"h"+2*I+"v"+ag;B="m-"+I+",-"+ag+"v"+ag+"h"+2*I+"v-"+ag;break;case 3:I=Math.max(I,Math.round(R.fMarkerSize*8*0.66));ag=Math.max(this.lineatt.width+1,Math.round(I*0.66));W="l"+ag+","+I+"v-"+2*I+"l-"+ag+","+I;P="l-"+ag+","+I+"v-"+2*I+"l"+ag+","+I;Y="l-"+I+","+ag+"h"+2*I+"l-"+I+",-"+ag;B="l-"+I+",-"+ag+"h"+2*I+"l-"+I+","+ag;break;case 4:I=Math.max(I,Math.round(R.fMarkerSize*8*0.66));ag=Math.max(this.lineatt.width+1,Math.round(I*0.66));W="l"+ag+","+I+"m0,-"+2*I+"l-"+ag+","+I;P="l-"+ag+","+I+"m0,-"+2*I+"l"+ag+","+I;Y="l-"+I+","+ag+"m"+2*I+",0l-"+I+",-"+ag;B="l-"+I+",-"+ag+"m"+2*I+",0l-"+I+","+ag;break}this.error_size=I;I=Math.floor((this.lineatt.width-1)/2);O.filter(function(w){return(w.exlow>0)||(w.exhigh>0)||(w.eylow>0)||(w.eyhigh>0)}).append("svg:path").call(this.lineatt.func).style("fill","none").attr("d",function(w){w.error=true;return((w.exlow>0)?A+(w.grx0+I)+","+w.grdx0+W:"")+((w.exhigh>0)?A+(w.grx2-I)+","+w.grdx2+P:"")+((w.eylow>0)?A+w.grdy0+","+(w.gry0-I)+B:"")+((w.eyhigh>0)?A+w.grdy2+","+(w.gry2+I)+Y:"")})}if(this.options.Mark){var N=Math.max(1,Math.round(this.bins.length/50000)),T="",V,ab,M,L;if(!this.markeratt){this.markeratt=new d.TAttMarkerHandler(R,this.options.Mark-100)}else{this.markeratt.Change(undefined,this.options.Mark-100)}this.marker_size=this.markeratt.GetFullSize();this.markeratt.reset_pos();for(V=0;V<this.bins.length;V+=N){ab=this.bins[V];M=E.grx(ab.x);if((M>-this.marker_size)&&(M<S+this.marker_size)){L=E.gry(ab.y);if((L>-this.marker_size)&&(L<aa+this.marker_size)){T+=this.markeratt.create(M,L)}}}if(T.length>0){this.draw_g.append("svg:path").attr("d",T).call(this.markeratt.func);if((O===null)&&(this.draw_kind=="none")){this.draw_kind=(this.options.Mark==101)?"path":"mark"}}}};b.prototype.ExtractTooltip=function(u){if(!u){return null}if((this.draw_kind=="lines")||(this.draw_kind=="path")||(this.draw_kind=="mark")){return this.ExtractTooltipForPath(u)}if(this.draw_kind!="nodes"){return null}var v=this.frame_width(),D=this.frame_height(),x=this.main_painter(),B=this,C=null,A=10000000000,w=null;this.draw_g.selectAll(".grpoint").each(function(){var J=s.select(this).datum();if(J===undefined){return}var I=Math.pow(u.x-J.grx1,2);if(u.nproc===1){I+=Math.pow(u.y-J.gry1,2)}if(I>=A){return}var H=null;if(J.error||J.rect||J.marker){H={x1:Math.min(-B.error_size,J.grx0),x2:Math.max(B.error_size,J.grx2),y1:Math.min(-B.error_size,J.gry2),y2:Math.max(B.error_size,J.gry0)}}else{if(J.bar){H={x1:-J.width/2,x2:J.width/2,y1:0,y2:D-J.gry1};if(B.options.Bar===1){var G=x.gry(0);H.y1=(J.gry1>G)?G-J.gry1:0;H.y2=(J.gry1>G)?0:G-J.gry1}}else{H={x1:-5,x2:5,y1:-5,y2:5}}}var F=(u.x>=J.grx1+H.x1)&&(u.x<=J.grx1+H.x2);var E=(u.y>=J.gry1+H.y1)&&(u.y<=J.gry1+H.y2);if(F&&(E||(u.nproc>1))){A=I;C=this;w=H;w.exact=F&&E}});if(C===null){return null}var z=s.select(C).datum();var y={name:this.GetObject().fName,title:this.GetObject().fTitle,x:z.grx1,y:z.gry1,color1:this.lineatt.color,lines:this.TooltipText(z,true),rect:w,d3bin:C};if(this.fillatt&&this.fillatt.used){y.color2=this.fillatt.color}if(w.exact){y.exact=true}y.menu=y.exact;y.menu_dist=3;y.bin=z;y.binindx=z.indx;if(u.click_handler&&y.exact&&this.TestEditable()){y.click_handler=this.InvokeClickHandler.bind(this)}return y};b.prototype.ShowTooltip=function(w){if(!w){if(this.draw_g){this.draw_g.select(".tooltip_bin").remove()}return}if(w.usepath){return this.ShowTooltipForPath(w)}var v=s.select(w.d3bin).datum();var u=this.draw_g.select(".tooltip_bin");if(u.empty()){u=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")}w.changed=u.property("current_bin")!==w.d3bin;if(w.changed){u.attr("x",v.grx1+w.rect.x1).attr("width",w.rect.x2-w.rect.x1).attr("y",v.gry1+w.rect.y1).attr("height",w.rect.y2-w.rect.y1).style("opacity","0.3").property("current_bin",w.d3bin)}};b.prototype.ProcessTooltip=function(u){var v=this.ExtractTooltip(u);if(!u||!u.disabled){this.ShowTooltip(v)}return v};b.prototype.FindBestBin=function(L){if(!this.bins){return null}var K=(this.draw_kind=="lines"),x=(this.draw_kind=="mark"),F=-1,J=null,A=10000000000,C=this.main_painter(),H,y,w,I,E;for(I=0;I<this.bins.length;++I){E=this.bins[I];y=C.grx(E.x);w=C.gry(E.y);H=(L.x-y)*(L.x-y)+(L.y-w)*(L.y-w);if(H<A){A=H;J=E;F=I}}if((A>100)&&K){J=null}var v=Math.max(this.lineatt.width+3,4);if(this.marker_size>0){v=Math.max(this.marker_size,v)}if(J!==null){A=Math.sqrt(Math.pow(L.x-C.grx(J.x),2)+Math.pow(L.y-C.gry(J.y),2))}if(!K&&!x&&(A>v)){J=null}if(x&&(J!==null)){if((L.nproc==1)&&(A>v)){J=null}else{if((this.bins.length==1)&&(A>3*v)){J=null}}}if(J===null){F=-1}var M={bin:J,indx:F,dist:A,radius:Math.round(v)};if((J===null)&&K){A=10000;function B(N,P,O){return((P>=N)&&(N>=O))||((P<=N)&&(N<=O))}var u=this.bins[0],z=C.grx(u.x),D,G=0;for(I=1;I<this.bins.length;++I){E=this.bins[I];y=C.grx(E.x);if(B(L.x,z,y)){D=C.gry(u.y);w=C.gry(E.y);if(Math.abs(y-z)<1){G=L.y;H=B(L.y,D,w)?0:Math.min(Math.abs(L.y-D),Math.abs(L.y-w))}else{G=D+(L.x-z)/(y-z)*(w-D);H=Math.abs(G-L.y)}if(H<A){A=H;M.linex=L.x;M.liney=G}}u=E;z=y}if(A<v*0.5){M.linedist=A;M.closeline=true}}return M};b.prototype.TestEditable=function(u){var w=this.GetObject(),v=d.BIT(18);if(!w){return false}if(u){w.InvertBit(v)}return !w.TestBit(v)};b.prototype.ExtractTooltipForPath=function(x){if(this.bins===null){return null}var z=this.FindBestBin(x);if(!z||(!z.bin&&!z.closeline)){return null}var y=(this.draw_kind=="lines"),v=(this.draw_kind=="mark"),u=this.main_painter();var w={name:this.GetObject().fName,title:this.GetObject().fTitle,x:z.bin?u.grx(z.bin.x):z.linex,y:z.bin?u.gry(z.bin.y):z.liney,color1:this.lineatt.color,lines:this.TooltipText(z.bin,true),usepath:true};w.ismark=v;w.islines=y;if(z.closeline){w.menu=w.exact=true;w.menu_dist=z.linedist}else{if(z.bin){if(this.options.EF&&y){w.gry1=u.gry(z.bin.y-z.bin.eylow);w.gry2=u.gry(z.bin.y+z.bin.eyhigh)}else{w.gry1=w.gry2=u.gry(z.bin.y)}w.binindx=z.indx;w.bin=z.bin;w.radius=z.radius;w.exact=(Math.abs(x.x-w.x)<=z.radius)&&((Math.abs(x.y-w.gry1)<=z.radius)||(Math.abs(x.y-w.gry2)<=z.radius));w.menu=w.exact;w.menu_dist=Math.sqrt((x.x-w.x)*(x.x-w.x)+Math.pow(Math.min(Math.abs(x.y-w.gry1),Math.abs(x.y-w.gry2)),2));if(x.click_handler&&w.exact&&this.TestEditable()){w.click_handler=this.InvokeClickHandler.bind(this)}}}if(this.fillatt&&this.fillatt.used){w.color2=this.fillatt.color}if(!y){w.color1=this.get_color(this.GetObject().fMarkerColor);if(!w.color2){w.color2=w.color1}}return w};b.prototype.ShowTooltipForPath=function(w){var u=this.draw_g.select(".tooltip_bin");if(!w||!w.bin){u.remove();return}if(u.empty()){u=this.draw_g.append("svg:g").attr("class","tooltip_bin")}w.changed=u.property("current_bin")!==w.bin;if(w.changed){u.selectAll("*").remove();u.property("current_bin",w.bin);if(w.ismark){u.append("svg:rect").attr("class","h1bin").style("pointer-events","none").style("opacity","0.3").attr("x",Math.round(w.x-w.radius)).attr("y",Math.round(w.y-w.radius)).attr("width",2*w.radius).attr("height",2*w.radius)}else{u.append("svg:circle").attr("cy",Math.round(w.gry1));if(Math.abs(w.gry1-w.gry2)>1){u.append("svg:circle").attr("cy",Math.round(w.gry2))}var v=u.selectAll("circle").attr("r",w.radius).attr("cx",Math.round(w.x));if(!w.islines){v.style("stroke",w.color1=="black"?"green":"black").style("fill","none")}else{if(this.options.Line){v.call(this.lineatt.func)}else{v.style("stroke","black")}if(this.options.Fill){v.call(this.fillatt.func)}else{v.style("fill","none")}}}}};b.prototype.movePntHandler=function(v){var w=s.mouse(this.svg_frame().node());var u=this.main_painter();if(!u||!this.interactive_bin){return}this.interactive_bin.x=u.RevertX(w[0]+this.interactive_delta_x);this.interactive_bin.y=u.RevertY(w[1]+this.interactive_delta_y);this.DrawBins()};b.prototype.endPntHandler=function(){if(this.snapid&&this.interactive_bin){var u="SetPoint("+this.interactive_bin.indx+","+this.interactive_bin.x+","+this.interactive_bin.y+")";var v=this.pad_painter();if(v){v.SendWebsocket("OBJEXEC:"+this.snapid+":"+u)}}delete this.interactive_bin;s.select(window).on("mousemove.graphPnt",null).on("mouseup.graphPnt",null)};b.prototype.InvokeClickHandler=function(v){if(!v.bin){return}this.interactive_bin=v.bin;s.select(window).on("mousemove.graphPnt",this.movePntHandler.bind(this)).on("mouseup.graphPnt",this.endPntHandler.bind(this),true);var w=s.mouse(this.svg_frame().node());var u=this.main_painter();this.interactive_delta_x=u?u.x(this.interactive_bin.x)-w[0]:0;this.interactive_delta_y=u?u.y(this.interactive_bin.y)-w[1]:0};b.prototype.FillContextMenu=function(u){d.TObjectPainter.prototype.FillContextMenu.call(this,u);if(!this.snapid){u.addchk(this.TestEditable(),"Editable",this.TestEditable.bind(this,true))}return u.size()>0};b.prototype.ExecuteMenuCommand=function(u,A){if(d.TObjectPainter.prototype.ExecuteMenuCommand.call(this,u,A)){return true}var w=this.pad_painter(),B=this.frame_painter();if((u.fName=="RemovePoint")||(u.fName=="InsertPoint")){var v=B?B.GetLastEventPos():null;if(!w||!B||!v){return true}var z=this.ExtractTooltip(v);if(u.fName=="InsertPoint"){var y=this.main_painter(),D=y&&y.RevertX?y.RevertX(v.x):0,C=y&&y.RevertY?y.RevertY(v.y):0;w.ShowMessage("InsertPoint("+D.toFixed(3)+","+C.toFixed(3)+") not yet implemented")}else{if(this.args_menu_id&&z&&(z.binindx!==undefined)){var x="RemovePoint("+z.binindx+")";console.log("execute "+x+" for object "+this.args_menu_id);w.SendWebsocket("OBJEXEC:"+this.args_menu_id+":"+x)}}return true}return false};b.prototype.UpdateObject=function(x,v){if(!this.MatchObjectType(x)){return false}if((v!==undefined)&&(v!=this.options.original)){this.options=this.DecodeOptions(v)}var w=this.GetObject();w.fBits=x.fBits;w.fTitle=x.fTitle;w.fX=x.fX;w.fY=x.fY;w.fNpoints=x.fNpoints;this.CreateBins();if(this.ownhisto){var u=this.main_painter();if(x.fHistogram){u.UpdateObject(x.fHistogram)}u.GetObject().fTitle=w.fTitle}return true};b.prototype.CanZoomIn=function(x,w,u){var v=this.GetObject();if((v===null)||(x!=="x")){return false}for(var y=0;y<v.fNpoints;++y){if((w<v.fX[y])&&(v.fX[y]<u)){return true}}return false};b.prototype.ButtonClick=function(v){if(v!=="ToggleZoom"){return false}var u=this.main_painter();if(u===null){return false}if((this.xmin===this.xmax)&&(this.ymin=this.ymax)){return false}u.Zoom(this.xmin,this.xmax,this.ymin,this.ymax);return true};b.prototype.FindFunc=function(){var u=this.GetObject();if(u&&u.fFunctions){for(var v=0;v<u.fFunctions.arr.length;++v){var w=u.fFunctions.arr[v];if((w._typename=="TF1")||(w._typename=="TF2")){return w}}}return w};b.prototype.FindStat=function(){var u=this.GetObject();if(u&&u.fFunctions){for(var v=0;v<u.fFunctions.arr.length;++v){var w=u.fFunctions.arr[v];if((w._typename=="TPaveStats")&&(w.fName=="stats")){return w}}}return null};b.prototype.CreateStat=function(){var x=this.FindFunc();if(!x){return null}var w=this.FindStat();if(w){return w}var u=this.pad_painter();if(u&&u.normal_canvas){return null}this.create_stats=true;var v=d.gStyle;w=d.Create("TPaveStats");d.extend(w,{fName:"stats",fOptStat:0,fOptFit:v.fOptFit||111,fBorderSize:1});w.fX1NDC=v.fStatX-v.fStatW;w.fY1NDC=v.fStatY-v.fStatH;w.fX2NDC=v.fStatX;w.fY2NDC=v.fStatY;w.fFillColor=v.fStatColor;w.fFillStyle=v.fStatStyle;w.fTextAngle=0;w.fTextSize=v.fStatFontSize;w.fTextAlign=12;w.fTextColor=v.fStatTextColor;w.fTextFont=v.fStatFont;w.AddText(x.fName);this.GetObject().fFunctions.Add(w);return w};b.prototype.FillStatistic=function(v,u,x){var w=this.FindFunc();if(!w||!x||!this.create_stats){return false}v.ClearPave();v.FillFunctionStat(w,x);return true};b.prototype.DrawNextFunction=function(w,y){var x=this.GetObject();if(!x.fFunctions||(w>=x.fFunctions.arr.length)){return d.CallBack(y)}var v=x.fFunctions.arr[w],u=x.fFunctions.opt[w];v.$main_painter=this;d.draw(this.divid,v,u,this.DrawNextFunction.bind(this,w+1,y))};b.prototype.PerformDrawing=function(v,u){if(u){this.ownhisto=true}this.SetDivId(v);this.DrawBins();this.DrawNextFunction(0,this.DrawingReady.bind(this));return this};d.Painter.drawGraph=function(x,w,v){var u=new b(w);u.options=u.DecodeOptions(v);u.SetDivId(x,-1);u.CreateBins();u.CreateStat();if(!u.main_painter()){if(!w.fHistogram){w.fHistogram=u.CreateHistogram()}d.draw(x,w.fHistogram,u.options.Axis,u.PerformDrawing.bind(u,x))}else{u.PerformDrawing(x)}return u};function p(u){d.TObjectPainter.call(this,u);this.$polargram=true}p.prototype=Object.create(d.TObjectPainter.prototype);p.prototype.translate=function(y,u,v){var x=this.r(u),w=x/this.szx*this.szy;var z={x:x*Math.cos(-y-this.angle),y:w*Math.sin(-y-this.angle)};if(!v){z.x=Math.round(z.x);z.y=Math.round(z.y)}z.rx=x;z.ry=w;return z};p.prototype.format=function(u){if(u===Math.round(u)){return u.toString()}if(this.ndig>10){return u.toExponential(4)}return u.toFixed((this.ndig>0)?this.ndig:0)};p.prototype.Redraw=function(){if(!this.is_main_painter()){return}var Q=this.root_pad(),U=this.GetObject(),C=this.pad_width(),K=this.pad_height(),N=Math.round(C/2),L=Math.round(K/2),F=Math.round(Math.max(0.1,0.5-Math.max(Q.fLeftMargin,Q.fRightMargin))*C),E=Math.round(Math.max(0.1,0.5-Math.max(Q.fBottomMargin,Q.fTopMargin))*K);this.CreateG();this.draw_g.attr("transform","translate("+N+","+L+")");this.r=s.scaleLinear().domain([U.fRwrmin,U.fRwrmax]).range([0,F]);this.szx=F;this.szy=E;this.angle=U.fAxisAngle||0;var S=this.r.ticks(5),G=Math.floor((U.fNdivRad%10000)/100);if(!this.lineatt){this.lineatt=new d.TAttLineHandler(U)}if(!this.gridatt){this.gridatt=new d.TAttLineHandler({fLineColor:U.fLineColor,fLineStyle:2,fLineWidth:1})}var D=Math.abs(U.fRwrmax-U.fRwrmin);this.ndig=(D<=0)?-3:Math.round(d.log10(S.length/D));var I=[],T=0;while(T<S.length){var M=this.format(S[T]);if(I.indexOf(M)>=0){if(++this.ndig>10){break}I=[];T=0;continue}I.push(M);T++}var x=false;if(S[S.length-1]<U.fRwrmax){S.push(U.fRwrmax);x=true}this.StartTextDrawing(U.fRadialLabelFont,Math.round(U.fRadialTextSize*E*2));for(var J=0;J<S.length;++J){var B=this.r(S[J]),A=B/F*E;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(B)).attr("ry",Math.round(A)).style("fill","none").call(this.lineatt.func);if((J<S.length-1)||!x){this.DrawText({align:23,x:Math.round(B),y:Math.round(U.fRadialTextSize*E*0.5),text:this.format(S[J]),color:this.get_color[U.fRadialLabelColor],latex:0})}if((G>1)&&((J<S.length-1)||!x)){var H=(S[1]-S[0])/G;for(var v=1;v<G;++v){var z=S[J]+H*v;if(z>U.fRwrmax){break}B=this.r(z);A=B/F*E;this.draw_g.append("ellipse").attr("cx",0).attr("cy",0).attr("rx",Math.round(B)).attr("ry",Math.round(A)).style("fill","none").call(this.gridatt.func)}}}this.FinishTextDrawing();var R=Math.round(U.fPolarTextSize*E*2);this.StartTextDrawing(U.fPolarLabelFont,R);var y=U.fNdivPol%100;if((y!==8)&&(y!==3)){y=8}var I=(y==8)?["0","#frac{#pi}{4}","#frac{#pi}{2}","#frac{3#pi}{4}","#pi","#frac{5#pi}{4}","#frac{3#pi}{2}","#frac{7#pi}{4}"]:["0","#frac{2#pi}{3}","#frac{4#pi}{3}"],u=[12,11,21,31,32,33,23,13];for(var J=0;J<y;++J){var P=-J*2*Math.PI/y-this.angle;this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(F*Math.cos(P))).attr("y2",Math.round(E*Math.sin(P))).call(this.lineatt.func);var O=Math.round(16-P/Math.PI*4)%8;this.DrawText({align:u[O],x:Math.round((F+R)*Math.cos(P)),y:Math.round((E+R/F*E)*(Math.sin(P))),text:I[J],color:this.get_color[U.fPolarLabelColor],latex:1})}this.FinishTextDrawing();var G=Math.floor((U.fNdivPol%10000)/100);if(G>1){for(var J=0;J<y*G;++J){if(J%G===0){continue}var P=-J*2*Math.PI/y/G-this.angle;this.draw_g.append("line").attr("x1",0).attr("y1",0).attr("x2",Math.round(F*Math.cos(P))).attr("y2",Math.round(E*Math.sin(P))).call(this.gridatt.func)}}};d.Painter.drawGraphPolargram=function(y,x,w){var v=new p(x);v.SetDivId(y,-1);var u=v.main_painter();if(u){if(u.GetObject()!==x){console.error("Cannot superimpose TGraphPolargram with any other drawings")}return null}v.SetDivId(y,4);v.Redraw();return v.DrawingReady()};function h(u){d.TObjectPainter.call(this,u)}h.prototype=Object.create(d.TObjectPainter.prototype);h.prototype.Redraw=function(){this.DrawBins()};h.prototype.DecodeOptions=function(u){var v=new d.DrawOptions(u||"L");this.options={mark:v.check("P"),err:v.check("E"),fill:v.check("F"),line:v.check("L"),curve:v.check("C")}};h.prototype.DrawBins=function(){var C=this.GetObject(),w=this.main_painter();if(!C||!w||!w.$polargram){return}if(this.options.mark&&!this.markeratt){this.markeratt=new d.TAttMarkerHandler(C)}if((this.options.err||this.options.line||this.options.curve)&&!this.lineatt){this.lineatt=new d.TAttLineHandler(C)}if(this.options.fill&&!this.fillatt){this.fillatt=this.createAttFill(C)}this.CreateG();this.draw_g.attr("transform",w.draw_g.attr("transform"));var x="",v="",y="",D=[];for(var u=0;u<C.fNpoints;++u){if(this.options.err){var B=w.translate(C.fX[u],C.fY[u]-C.fEY[u]),A=w.translate(C.fX[u],C.fY[u]+C.fEY[u]);v+="M"+B.x+","+B.y+"L"+A.x+","+A.y;B=w.translate(C.fX[u]+C.fEX[u],C.fY[u]);A=w.translate(C.fX[u]-C.fEX[u],C.fY[u]);v+="M"+B.x+","+B.y+"A"+A.rx+","+A.ry+",0,0,1,"+A.x+","+A.y}var z=w.translate(C.fX[u],C.fY[u]);if(this.options.mark){x+=this.markeratt.create(z.x,z.y)}if(this.options.line||this.options.fill){y+=(y?"L":"M")+z.x+","+z.y}if(this.options.curve){z.grx=z.x;z.gry=z.y;D.push(z)}}if(this.options.fill&&y){this.draw_g.append("svg:path").attr("d",y+"Z").style("stroke","none").call(this.fillatt.func)}if(this.options.line&&y){this.draw_g.append("svg:path").attr("d",y).style("fill","none").call(this.lineatt.func)}if(this.options.curve&&D.length){this.draw_g.append("svg:path").attr("d",d.Painter.BuildSvgPath("bezier",D).path).style("fill","none").call(this.lineatt.func)}if(v){this.draw_g.append("svg:path").attr("d",v).style("fill","none").call(this.lineatt.func)}if(x){this.draw_g.append("svg:path").attr("d",x).call(this.markeratt.func)}};h.prototype.CreatePolargram=function(){var w=d.Create("TGraphPolargram"),v=this.GetObject();var u=v.fY[0]||0,y=u;for(var x=0;x<v.fNpoints;++x){u=Math.min(u,v.fY[x]-v.fEY[x]);y=Math.max(y,v.fY[x]+v.fEY[x])}w.fRwrmin=u-(y-u)*0.1;w.fRwrmax=y+(y-u)*0.1;return w};h.prototype.PerformDrawing=function(u){this.SetDivId(u);this.DrawBins();this.DrawingReady()};d.Painter.drawGraphPolar=function(y,x,w){var v=new h(x);v.DecodeOptions(w);v.SetDivId(y,-1);var u=v.main_painter();if(u){if(!u.$polargram){console.error("Cannot superimpose TGraphPolar with plain histograms");return null}v.PerformDrawing(y)}else{if(!x.fPolargram){x.fPolargram=v.CreatePolargram()}d.draw(y,x.fPolargram,"",v.PerformDrawing.bind(v,y))}return v};function c(u){d.TObjectPainter.call(this,u);this.bins=null}c.prototype=Object.create(d.TObjectPainter.prototype);c.prototype.UpdateObject=function(v,u){var w=this.GetObject();if(w._typename!=v._typename){return false}if(w!==v){d.extend(w,v)}if(u!==undefined){this.DecodeOptions(u)}return true};c.prototype.Eval=function(w,u){var v=u-w.fX;if(w._typename=="TSplinePoly3"){return w.fY+v*(w.fB+v*(w.fC+v*w.fD))}if(w._typename=="TSplinePoly5"){return w.fY+v*(w.fB+v*(w.fC+v*(w.fD+v*(w.fE+v*w.fF))))}return w.fY+v};c.prototype.FindX=function(v){var z=this.GetObject(),y=0,w=z.fNp-1;if(v<=z.fXmin){return 0}if(v>=z.fXmax){return w}if(z.fKstep){y=Math.round((v-z.fXmin)/z.fDelta);if(v<z.fPoly[y].fX){y=Math.max(y-1,0)}else{if(y<w){if(v>z.fPoly[y+1].fX){++y}}}}else{while(w-y>1){var u=Math.round((y+w)/2);if(v>z.fPoly[u].fX){y=u}else{w=u}}}return y};c.prototype.CreateDummyHisto=function(){var y=0,w=1,x=0,u=1,z=this.GetObject();if(z&&z.fPoly){y=w=z.fPoly[0].fX;x=u=z.fPoly[0].fY;z.fPoly.forEach(function(A){y=Math.min(A.fX,y);w=Math.max(A.fX,w);x=Math.min(A.fY,x);u=Math.max(A.fY,u)});if(u>0){u*=1.05}if(x<0){x*=1.05}}var v=d.Create("TH1I");v.fName=z.fName+"_hist";v.fTitle=z.fTitle;v.fXaxis.fXmin=y;v.fXaxis.fXmax=w;v.fYaxis.fXmin=x;v.fYaxis.fXmax=u;return v};c.prototype.ProcessTooltip=function(v){var y=false,B=this.GetObject(),A=this.main_painter(),u,F,z=null,C=0;if((v===null)||!B||!A){y=true}else{u=A.RevertX(v.x);C=this.FindX(u);z=B.fPoly[C];F=this.Eval(z,u);if((C<B.fN-1)&&(Math.abs(B.fPoly[C+1].fX-u)<Math.abs(u-z.fX))){z=B.fPoly[++C]}if(Math.abs(A.grx(z.fX)-v.x)<0.5*this.knot_size){u=z.fX;F=z.fY}else{z=null;if((u<B.fXmin)||(u>B.fXmax)){y=true}}}if(y){if(this.draw_g!==null){this.draw_g.select(".tooltip_bin").remove()}return null}var x=this.draw_g.select(".tooltip_bin"),D=this.lineatt.width+3;if(x.empty()){x=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",D).style("fill","none").call(this.lineatt.func)}var E={name:this.GetObject().fName,title:this.GetObject().fTitle,x:A.grx(u),y:A.gry(F),color1:this.lineatt.color,lines:[],exact:(z!==null)||(Math.abs(A.gry(F)-v.y)<D)};E.changed=x.property("current_xx")!==u;E.menu=E.exact;E.menu_dist=Math.sqrt((E.x-v.x)*(E.x-v.x)+(E.y-v.y)*(E.y-v.y));if(E.changed){x.attr("cx",Math.round(E.x)).attr("cy",Math.round(E.y)).property("current_xx",u)}var w=this.GetTipName();if(w.length>0){E.lines.push(w)}E.lines.push("x = "+A.AxisAsText("x",u));E.lines.push("y = "+A.AxisAsText("y",F));if(z!==null){E.lines.push("knot = "+C);E.lines.push("B = "+d.FFormat(z.fB,d.gStyle.fStatFormat));E.lines.push("C = "+d.FFormat(z.fC,d.gStyle.fStatFormat));E.lines.push("D = "+d.FFormat(z.fD,d.gStyle.fStatFormat));if((z.fE!==undefined)&&(z.fF!==undefined)){E.lines.push("E = "+d.FFormat(z.fE,d.gStyle.fStatFormat));E.lines.push("F = "+d.FFormat(z.fF,d.gStyle.fStatFormat))}}return E};c.prototype.Redraw=function(){var C=this.frame_width(),K=this.frame_height(),J=this.GetObject(),A=this.main_painter(),M=this.GetTipName("\n");this.CreateG(true);this.knot_size=5;if(!this.lineatt){this.lineatt=new d.TAttLineHandler(J)}if(this.options.Line||this.options.Curve){var B=Math.max(10,J.fNpx);var D=Math.max(A.scale_xmin,J.fXmin),G=Math.min(A.scale_xmax,J.fXmax),L=this.FindX(D),I=[];if(A.logx){D=Math.log(D);G=Math.log(G)}for(var H=0;H<B;++H){var y=D+(G-D)/B*(H-1);if(A.logx){y=Math.exp(y)}while((L<J.fNp-1)&&(y>J.fPoly[L+1].fX)){++L}var F=this.Eval(J.fPoly[L],y);I.push({x:y,y:F,grx:A.grx(y),gry:A.gry(F)})}var z=K;if((A.hmin!==undefined)&&(A.hmin>=0)){z=Math.round(A.gry(0));if((z>K)||(z<0)){z=K}}var E=d.Painter.BuildSvgPath("bezier",I,z,2);this.draw_g.append("svg:path").attr("class","line").attr("d",E.path).style("fill","none").call(this.lineatt.func)}if(this.options.Mark){var E="";if(!this.markeratt){this.markeratt=new d.TAttMarkerHandler(J)}this.markeratt.reset_pos();this.knot_size=this.markeratt.GetFullSize();for(var H=0;H<J.fPoly.length;H++){var u=J.fPoly[H],x=A.grx(u.fX);if((x>-this.knot_size)&&(x<C+this.knot_size)){var v=A.gry(u.fY);if((v>-this.knot_size)&&(v<K+this.knot_size)){E+=this.markeratt.create(x,v)}}}if(E){this.draw_g.append("svg:path").attr("d",E).call(this.markeratt.func)}}};c.prototype.CanZoomIn=function(w,v,u){if(w!=="x"){return false}var x=this.GetObject();if(!x){return false}return true};c.prototype.DecodeOptions=function(u){var v=new d.DrawOptions(u);this.options={Same:v.check("SAME"),Line:v.check("L"),Curve:v.check("C"),Mark:v.check("P")}};c.prototype.FirstDraw=function(){this.SetDivId(this.divid);this.Redraw();return this.DrawingReady()};d.Painter.drawSpline=function(y,x,w){var u=new c(x);u.SetDivId(y,-1);u.DecodeOptions(w);if(!u.main_painter()){if(u.options.Same){console.warn("TSpline painter requires histogram to be drawn");return null}var v=u.CreateDummyHisto();d.draw(y,v,"AXIS",u.FirstDraw.bind(u));return u}return u.FirstDraw()};function r(u){d.TObjectPainter.call(this,u)}r.prototype=Object.create(d.TObjectPainter.prototype);r.prototype.Redraw=function(){if(this.step===undefined){this.StartDrawing(false)}};r.prototype.DecodeOptions=function(u){var v=new d.DrawOptions(u||"REPEAT");this.options={once:v.check("ONCE"),repeat:v.check("REPEAT"),first:v.check("FIRST")}};r.prototype.DrawPrimitives=function(w,y,v){if(w===0){this._doing_primitives=true}var u=this.GetObject().fSteps.arr[this.step];while(true){if(v){v.$grtimeid=this.selfid}if(!u||(w>=u.arr.length)){delete this._doing_primitives;return d.CallBack(y)}var x={func:this.DrawPrimitives.bind(this,w+1,y)};v=d.draw(this.divid,u.arr[w],u.opt[w],x);if(!x.completed){return}w++}};r.prototype.Selector=function(u){return u&&(u.$grtimeid===this.selfid)};r.prototype.ContineDrawing=function(){var v=this.GetObject();if(!this.ready_called){this.ready_called=true;this.DrawingReady()}if(this.options.first){delete this.step;return}if(this.wait_animation_frame){delete this.wait_animation_frame;var u=this.pad_painter(true);if(!u){delete this.step;return}u.CleanPrimitives(this.Selector.bind(this));this.DrawPrimitives(0,this.ContineDrawing.bind(this))}else{if(this.running_timeout){clearTimeout(this.running_timeout);delete this.running_timeout;this.wait_animation_frame=true;requestAnimationFrame(this.ContineDrawing.bind(this))}else{var w=v.fSleepTime;if(!w||(w<100)){w=10}if(++this.step>v.fSteps.arr.length){if(this.options.repeat){this.step=0;w=Math.max(5000,5*w)}else{delete this.step;return}}this.running_timeout=setTimeout(this.ContineDrawing.bind(this),w)}}};r.prototype.StartDrawing=function(u){if(u!==false){this.SetDivId(this.divid)}this.step=0;this.DrawPrimitives(0,this.ContineDrawing.bind(this))};d.Painter.drawGraphTime=function(x,v,w){var u=new r(v);u.SetDivId(x,-1);if(u.main_painter()){console.error("Cannot draw graph time on top of other histograms");return null}if(!v.fFrame){console.error("Frame histogram not exists");return null}u.DecodeOptions(w);if(!v.fFrame.fTitle&&v.fTitle){v.fFrame.fTitle=v.fTitle}u.selfid="grtime"+d.id_counter++;d.draw(x,v.fFrame,"AXIS",u.StartDrawing.bind(u));return u};function i(u){d.TObjectPainter.call(this,u);this.fBoundary="Normal"}i.prototype=Object.create(d.TObjectPainter.prototype);i.prototype.GetEfficiency=function(u){var w=this.GetObject(),v=w.fTotalHistogram.getBinContent(u),x=w.fPassedHistogram.getBinContent(u);return v?x/v:0};i.prototype.Normal=function(x,B,A,u){if(x==0){return u?1:0}var y=(1-A)/2,w=B/x,v=Math.sqrt(w*(1-w)/x),z=d.Math.normal_quantile(1-y,v);if(u){return((w+z)>1)?1:(w+z)}return((w-z)<0)?0:(w-z)};i.prototype.GetEfficiencyErrorLow=function(u){var x=this.GetObject(),w=x.fTotalHistogram.getBinContent(u),y=x.fPassedHistogram.getBinContent(u),v=this.GetEfficiency(u);return v-this[this.fBoundary](w,y,x.fConfLevel,false)};i.prototype.GetEfficiencyErrorUp=function(u){var x=this.GetObject(),w=x.fTotalHistogram.getBinContent(u),y=x.fPassedHistogram.getBinContent(u),v=this.GetEfficiency(u);return this[this.fBoundary](w,y,x.fConfLevel,true)-v};i.prototype.CreateGraph=function(){var u=d.Create("TGraphAsymmErrors");u.fName="eff_graph";return u};i.prototype.FillGraph=function(v,w){var y=this.GetObject(),z=y.fTotalHistogram.fXaxis.fNbins,x=w.toLowerCase(),B=false,u=0;if(x.indexOf("e0")>=0){B=true}for(var A=0;A<z;++A){if(!B&&y.fTotalHistogram.getBinContent(A+1)===0){continue}v.fX[u]=y.fTotalHistogram.fXaxis.GetBinCenter(A+1);v.fY[u]=this.GetEfficiency(A+1);v.fEXlow[u]=y.fTotalHistogram.fXaxis.GetBinCenter(A+1)-y.fTotalHistogram.fXaxis.GetBinLowEdge(A+1);v.fEXhigh[u]=y.fTotalHistogram.fXaxis.GetBinLowEdge(A+2)-y.fTotalHistogram.fXaxis.GetBinCenter(A+1);v.fEYlow[u]=this.GetEfficiencyErrorLow(A+1);v.fEYhigh[u]=this.GetEfficiencyErrorUp(A+1);++u}v.fNpoints=u};d.Painter.drawEfficiency=function(y,x,w){if(!x||!x.fTotalHistogram||(x.fTotalHistogram._typename.indexOf("TH1")!=0)){return null}var u=new i(x);u.options=w;var v=u.CreateGraph();u.FillGraph(v,w);d.draw(y,v,w,function(){u.SetDivId(y);u.DrawingReady()});return u};function n(u){d.TObjectPainter.call(this,u);this.firstpainter=null;this.autorange=false;this.painters=[]}n.prototype=Object.create(d.TObjectPainter.prototype);n.prototype.Cleanup=function(){this.painters=[];d.TObjectPainter.prototype.Cleanup.call(this)};n.prototype.UpdateObject=function(A){if(!this.MatchObjectType(A)){return false}var B=this.GetObject(),v=A.fGraphs;B.fTitle=A.fTitle;var z=false;if(this.firstpainter){var u=A.fHistogram;if(this.autorange&&!u){u=this.ScanGraphsRange(v)}if(this.firstpainter.UpdateObject(u)){z=true}}for(var w=0;w<v.arr.length;++w){if(w<this.painters.length){if(this.painters[w].UpdateObject(v.arr[w])){z=true}}}if(A.fFunctions){for(var w=0;w<A.fFunctions.arr.length;++w){var y=A.fFunctions.arr[w];if(!y||!y._typename||!y.fName){continue}var x=this.FindPainterFor(null,y.fName,y._typename);if(x){x.UpdateObject(y)}}}return z};n.prototype.ComputeGraphRange=function(w,u){if(u.fNpoints==0){return}if(w.first){w.xmin=w.xmax=u.fX[0];w.ymin=w.ymax=u.fY[0];w.first=false}for(var v=0;v<u.fNpoints;++v){w.xmin=Math.min(w.xmin,u.fX[v]);w.xmax=Math.max(w.xmax,u.fX[v]);w.ymin=Math.min(w.ymin,u.fY[v]);w.ymax=Math.max(w.ymax,u.fY[v])}return w};n.prototype.padtoX=function(v,u){if(v.fLogx&&(u<50)){return Math.exp(2.302585092994*u)}return u};n.prototype.ScanGraphsRange=function(B,z,w){var x=this.GetObject(),y,C,H,G,F=0,v=0,E=false,D=false,u={xmin:0,xmax:0,ymin:0,ymax:0,first:true};if(w!=null){E=w.fLogx;D=w.fLogy;u.xmin=w.fUxmin;u.xmax=w.fUxmax;u.ymin=w.fUymin;u.ymax=w.fUymax;u.first=false}if(z!=null){C=z.fYaxis.fXmin;y=z.fYaxis.fXmax;if(w!=null){F=this.padtoX(w,u.xmin);v=this.padtoX(w,u.xmax)}}else{this.autorange=true;for(var A=0;A<B.arr.length;++A){this.ComputeGraphRange(u,B.arr[A])}if(u.xmin==u.xmax){u.xmax+=1}if(u.ymin==u.ymax){u.ymax+=1}H=0.05*(u.xmax-u.xmin);G=0.05*(u.ymax-u.ymin);F=u.xmin-H;v=u.xmax+H;if(D){if(u.ymin<=0){u.ymin=0.001*u.ymax}C=u.ymin/(1+0.5*d.log10(u.ymax/u.ymin));y=u.ymax*(1+0.2*d.log10(u.ymax/u.ymin))}else{C=u.ymin-G;y=u.ymax+G}if(C<0&&u.ymin>=0){C=0}if(y>0&&u.ymax<=0){y=0}}if(F<0&&u.xmin>=0){F=E?0.9*u.xmin:0}if(v>0&&u.xmax<=0){v=E?1.1*u.xmax:0}if(x.fMinimum!=-1111){u.ymin=C=x.fMinimum}if(x.fMaximum!=-1111){u.ymax=y=x.fMaximum}if(C<0&&u.ymin>=0&&D){C=0.9*u.ymin}if(y>0&&u.ymax<=0&&D){y=1.1*u.ymax}if(C<=0&&D){C=0.001*y}if(!D&&C>0&&C<0.05*y){C=0}if(F<=0&&E){F=(v>1000)?1:0.001*v}if(!z){z=d.Create("TH1I");z.fTitle=x.fTitle;z.fXaxis.fXmin=F;z.fXaxis.fXmax=v}z.fYaxis.fXmin=C;z.fYaxis.fXmax=y;return z};n.prototype.DrawAxis=function(w){var v=this.GetObject(),u=this.ScanGraphsRange(v.fGraphs,v.fHistogram,this.root_pad());d.draw(this.divid,u,"AXIS",w)};n.prototype.DrawNextFunction=function(u,w){var v=this.GetObject();if(!v.fFunctions||(u>=v.fFunctions.arr.length)){return d.CallBack(w)}d.draw(this.divid,v.fFunctions.arr[u],v.fFunctions.opt[u],this.DrawNextFunction.bind(this,u+1,w))};n.prototype.DrawNextGraph=function(x,w,y){if(y){this.painters.push(y)}var v=this.GetObject().fGraphs;if(x>=v.arr.length){this._pfc=this._plc=this._pmc=false;return this.DrawNextFunction(0,this.DrawingReady.bind(this))}if(this._pfc||this._plc||this._pmc){if(!this.pallette&&d.Painter.GetColorPalette){this.palette=d.Painter.GetColorPalette()}if(this.palette){var u=this.palette.calcColor(x,v.arr.length+1);var z=this.add_color(u);if(this._pfc){v.arr[x].fFillColor=z}if(this._plc){v.arr[x].fLineColor=z}if(this._pmc){v.arr[x].fMarkerColor=z}}}d.draw(this.divid,v.arr[x],v.opt[x]||w,this.DrawNextGraph.bind(this,x+1,w))};d.Painter.drawMultiGraph=function(y,x,v){var u=new n(x);u.SetDivId(y,-1);var w=new d.DrawOptions(v);w.check("3D");w.check("FB");u._pfc=w.check("PFC");u._plc=w.check("PLC");u._pmc=w.check("PMC");if(w.check("A")||!u.main_painter()){u.DrawAxis(function(z){u.firstpainter=z;u.SetDivId(y);u.DrawNextGraph(0,w.remain())})}else{u.SetDivId(y);u.DrawNextGraph(0,w.remain())}return u};function a(x,w,v){var u=new d.TObjectPainter(w);u.UpdateObject=function(y){if(!this.MatchObjectType(y)){return false}this.draw_object=y;return true};u.Redraw=function(){var E=this.GetObject(),M=null,U=0,T=null,L=null,G=null;if(!E||!E.fOper){return}this.CreateG();for(var O=0;O<E.fOper.arr.length;++O){var D=E.fOper.opt[O];switch(D){case"attr":M=E.fOper.arr[O];T=L=G=null;continue;case"rect":case"box":var R=this.AxisToSvg("x",E.fBuf[U++]),A=this.AxisToSvg("y",E.fBuf[U++]),Q=this.AxisToSvg("x",E.fBuf[U++]),z=this.AxisToSvg("y",E.fBuf[U++]);var y=this.draw_g.append("svg:rect").attr("x",Math.min(R,Q)).attr("y",Math.min(A,z)).attr("width",Math.abs(Q-R)).attr("height",Math.abs(A-z));if(D==="box"){if(!L){L=this.createAttFill(M)}y.call(L.func).style("stroke","none")}else{if(!T){T=new d.TAttLineHandler(M)}y.call(T.func).style("fill","none")}continue;case"line":case"linendc":var N=(D==="linendc"),R=this.AxisToSvg("x",E.fBuf[U++],N),A=this.AxisToSvg("y",E.fBuf[U++],N),Q=this.AxisToSvg("x",E.fBuf[U++],N),z=this.AxisToSvg("y",E.fBuf[U++],N);if(!T){T=new d.TAttLineHandler(M)}this.draw_g.append("svg:line").attr("x1",R).attr("y1",A).attr("x2",Q).attr("y2",z).call(T.func);continue;case"polyline":case"polylinendc":case"fillarea":case"fillareandc":var J=parseInt(E.fOper.arr[O].fString),P="",N=(D.indexOf("ndc")>0);for(var K=0;K<J;++K){P+=((K>0)?"L":"M")+this.AxisToSvg("x",E.fBuf[U++],N)+","+this.AxisToSvg("y",E.fBuf[U++],N)}if(D.indexOf("fillarea")==0){P+="Z"}var I=this.draw_g.append("svg:path").attr("d",P);if(D.indexOf("fillarea")==0){if(!L){L=this.createAttFill(M)}I.call(L.func).attr("stroke","none")}else{if(!T){T=new d.TAttLineHandler(M)}I.call(T.func).attr("fill","none")}continue;case"polymarker":var J=parseInt(E.fOper.arr[O].fString),P="";if(!G){G=new d.TAttMarkerHandler(M)}G.reset_pos();for(var K=0;K<J;++K){P+=G.create(this.AxisToSvg("x",E.fBuf[U++],false),this.AxisToSvg("y",E.fBuf[U++],false))}if(P){this.draw_g.append("svg:path").attr("d",P).call(G.func)}continue;case"text":case"textndc":var N=(D==="textndc"),B=this.AxisToSvg("x",E.fBuf[U++],N),H=this.AxisToSvg("y",E.fBuf[U++],N);if(M){var F=(M.fTextSize>1)?M.fTextSize:this.pad_height()*M.fTextSize;var C=this.draw_g.append("svg:g");this.StartTextDrawing(M.fTextFont,F,C);var S=M.fTextAngle;S-=Math.floor(S/360)*360;this.DrawText({align:M.fTextAlign,x:B,y:H,rotate:S,text:E.fOper.arr[O].fString,color:d.Painter.root_colors[M.fTextColor],latex:0,draw_g:C});this.FinishTextDrawing(C)}continue;default:console.log("unsupported operation",D)}}};u.SetDivId(x);u.options=v;u.Redraw();return u.DrawingReady()}d.Painter.drawText=o;d.Painter.drawLine=m;d.Painter.drawPolyLine=j;d.Painter.drawArrow=e;d.Painter.drawEllipse=l;d.Painter.drawBox=k;d.Painter.drawMarker=g;d.Painter.drawPolyMarker=q;d.Painter.drawWebPainting=a;d.Painter.drawRooPlot=f;d.TF1Painter=t;d.TGraphPainter=b;d.TGraphPolarPainter=h;d.TMultiGraphPainter=n;d.TSplinePainter=c;return d}));